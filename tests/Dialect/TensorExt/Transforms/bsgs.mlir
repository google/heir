
func.func @simple_sum(%arg0: tensor<16xf32>) -> tensor<16xf32> {
    %cst_0 = arith.constant dense<"0x5036CB3D584F72BFBA00FA3DBF82CB3FBF6FFB3F6D8B66BDAE8AA13EBF5F023FC2D49C3FCCA8D6BD532AA23F522F40BE1AD4EABE79B7B8BE37B836BF1C591EBEED693F3E27116D3D0DBFF0BE726237BF9C8203BF4DF072BFAF6CACBD83868D3F8523E03DD65AFDBE15A656BE8B94383DC5DE023F4A69D73E989532BE66736C3E647E8E3FAA05383F79DF193FE1645E3F24B92ABEC166A93E615C2DC0497814BD07ED413DD757033F1923163D76727CBEC759C83FF01E2F3D23B418BFABF141BE1C7029BF32109FBF4E00073FA4569FBD7F70C5BE8D4BDF3F473F593F911CAB3F13E9853E590DF63EC24284BEADBB19BF37CE383FEB0713BDD8C9243F63FE853EBEE1923FC956703F29DA10BEB0863BBF733F6C3FBF4AEABDE32D25BF4BC424BE016DA2BEC4280CBF374FFD3D755B6F3F9B9C1BBECBACC6BD6CAA17BE26F7803F83F258BEADE2DCBE1C9693BDD15A1FC07CE7DA3E9FD976BFDF71D0BD7A020C3FD73A6F3E8EA7EABEB9F2A3BED185903E4C08633DCA2E0EBF21AE853F68822ABF77DDA1BFEE8F443E12360BBF97BE063E1F83C13FB809763E382D6CBE6509A73E2D0268BE74C317BE4597B5BB6294083F195E3E3E28F39CBC3C11793F7BFA0F3FD7EDB93C3EF9903FEEFCFBBD94A451BF0284113ECD4C10BF2DD392BD95E499BEEBC9613EBEB947BE576920BF8D0700BF90944FBDE8A4C23FBE51FABE34128B3E309239C090A07CBF051EBDBEE4AA0B3FF339193FC88265BF9C4FECB8EE54DB3EEFFC3CBF870B93BE6A4E0F3ED998223F511F9DBF8D844E3F47B452BEA3B655BF842D833E7803133FAE500E3F0C8726BE1B19E13C6B2BABBE4BF853BED6E0493E695FA93E3402CB3EEC66B9BEACE7A1BF8E44723F2791AF3D2A0A763EAB2F1C3EB0C3163FCDB2E83E598190BFA2AD41BEA1F5FA3EC202C5BE8D53EB3DCDCA91BEA695923EC68B41BE4072EE3F79CC633C665C36BFF31C79BE4CA4BDBFCC272F3FD1DB2ABFDC29103F369C0D3F1A15F63E6E31C9BEA1078D3EBE94AABE387D02BF1937CB3F50F054BF570AFE3D1039C43DCE54193F5129963F7AE739BE2B3A19BF5D971B3FCC190A3F65AB74BF1CDB073F40F376BF5A0439BF3C3297BDF615053D553A37BF161EB23E961D7C3E8FB21CBF9ABE19C074A657BF6C0AC33F198BD9BE1091853EECD986BF022E55BE47C021BE4D87BDBE1FD4A7BE75BF7FBE7D4EB63F6EC745BF4FDC1F3E5FEE0ABD36CD1B3FECACB53E3D09BD3D0FDF2E3DA75C0DBFED900CBEAE4E853DE4A9393EBD0E8D3EA96AA03E3640A63F1EFEF83E0042113E3DCF823EB562A1BD1EC09EBF99D43DBE88925B3EF1F9953EBDA0BABC12C739BD19464BBFE147C3BE3CB9E83EDDD4C93E8D9F843D55B69FBF1936893F4C661B3FEC98153FD9A115C0EA77253E85E451BFA19AA4BEFDA50DBB6E8E23BFE5F4E1BE"> : tensor<16x16xf32>

  %row0 = tensor.extract_slice %cst_0[0, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c0 = arith.constant 0 : index
  %rot0 = tensor_ext.rotate %arg0, %c0 : tensor<16xf32>, index
  %result0 = arith.muli %rot0, %row0 : f32

  %row1 = tensor.extract_slice %cst_0[1, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c1 = arith.constant 1 : index
  %rot1 = tensor_ext.rotate %arg0, %c1 : tensor<16xf32>, index
  %result1 = arith.muli %rot1, %row1 : f32

  %row2 = tensor.extract_slice %cst_0[2, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c2 = arith.constant 2 : index
  %rot2 = tensor_ext.rotate %arg0, %c2 : tensor<16xf32>, index
  %result2 = arith.muli %rot2, %row2 : f32

  %row3 = tensor.extract_slice %cst_0[3, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c3 = arith.constant 3 : index
  %rot3 = tensor_ext.rotate %arg0, %c3 : tensor<16xf32>, index
  %result3 = arith.muli %rot3, %row3 : f32

  %row4 = tensor.extract_slice %cst_0[4, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c4 = arith.constant 4 : index
  %rot4 = tensor_ext.rotate %arg0, %c4 : tensor<16xf32>, index
  %result4 = arith.muli %rot4, %row4 : f32

  %accum0 = arith.addf %result0, %result1 : tensor<16xf32>
  %accum1 = arith.addf %accum0, %result2 : tensor<16xf32>
  %accum2 = arith.addf %accum1, %result3 : tensor<16xf32>
  %accum3 = arith.addf %accum2, %result4 : tensor<16xf32>

  return %accum3 : tensor<16xf32>
}

// Step 1
func.func @simple_sum(%arg0: tensor<16xf32>) -> tensor<16xf32> {
    %cst_0 = arith.constant dense<"0x5036CB3D584F72BFBA00FA3DBF82CB3FBF6FFB3F6D8B66BDAE8AA13EBF5F023FC2D49C3FCCA8D6BD532AA23F522F40BE1AD4EABE79B7B8BE37B836BF1C591EBEED693F3E27116D3D0DBFF0BE726237BF9C8203BF4DF072BFAF6CACBD83868D3F8523E03DD65AFDBE15A656BE8B94383DC5DE023F4A69D73E989532BE66736C3E647E8E3FAA05383F79DF193FE1645E3F24B92ABEC166A93E615C2DC0497814BD07ED413DD757033F1923163D76727CBEC759C83FF01E2F3D23B418BFABF141BE1C7029BF32109FBF4E00073FA4569FBD7F70C5BE8D4BDF3F473F593F911CAB3F13E9853E590DF63EC24284BEADBB19BF37CE383FEB0713BDD8C9243F63FE853EBEE1923FC956703F29DA10BEB0863BBF733F6C3FBF4AEABDE32D25BF4BC424BE016DA2BEC4280CBF374FFD3D755B6F3F9B9C1BBECBACC6BD6CAA17BE26F7803F83F258BEADE2DCBE1C9693BDD15A1FC07CE7DA3E9FD976BFDF71D0BD7A020C3FD73A6F3E8EA7EABEB9F2A3BED185903E4C08633DCA2E0EBF21AE853F68822ABF77DDA1BFEE8F443E12360BBF97BE063E1F83C13FB809763E382D6CBE6509A73E2D0268BE74C317BE4597B5BB6294083F195E3E3E28F39CBC3C11793F7BFA0F3FD7EDB93C3EF9903FEEFCFBBD94A451BF0284113ECD4C10BF2DD392BD95E499BEEBC9613EBEB947BE576920BF8D0700BF90944FBDE8A4C23FBE51FABE34128B3E309239C090A07CBF051EBDBEE4AA0B3FF339193FC88265BF9C4FECB8EE54DB3EEFFC3CBF870B93BE6A4E0F3ED998223F511F9DBF8D844E3F47B452BEA3B655BF842D833E7803133FAE500E3F0C8726BE1B19E13C6B2BABBE4BF853BED6E0493E695FA93E3402CB3EEC66B9BEACE7A1BF8E44723F2791AF3D2A0A763EAB2F1C3EB0C3163FCDB2E83E598190BFA2AD41BEA1F5FA3EC202C5BE8D53EB3DCDCA91BEA695923EC68B41BE4072EE3F79CC633C665C36BFF31C79BE4CA4BDBFCC272F3FD1DB2ABFDC29103F369C0D3F1A15F63E6E31C9BEA1078D3EBE94AABE387D02BF1937CB3F50F054BF570AFE3D1039C43DCE54193F5129963F7AE739BE2B3A19BF5D971B3FCC190A3F65AB74BF1CDB073F40F376BF5A0439BF3C3297BDF615053D553A37BF161EB23E961D7C3E8FB21CBF9ABE19C074A657BF6C0AC33F198BD9BE1091853EECD986BF022E55BE47C021BE4D87BDBE1FD4A7BE75BF7FBE7D4EB63F6EC745BF4FDC1F3E5FEE0ABD36CD1B3FECACB53E3D09BD3D0FDF2E3DA75C0DBFED900CBEAE4E853DE4A9393EBD0E8D3EA96AA03E3640A63F1EFEF83E0042113E3DCF823EB562A1BD1EC09EBF99D43DBE88925B3EF1F9953EBDA0BABC12C739BD19464BBFE147C3BE3CB9E83EDDD4C93E8D9F843D55B69FBF1936893F4C661B3FEC98153FD9A115C0EA77253E85E451BFA19AA4BEFDA50DBB6E8E23BFE5F4E1BE"> : tensor<16x16xf32>

  %row0 = tensor.extract_slice %cst_0[0, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c0 = arith.constant 0 : index
  %rot0 = tensor_ext.rotate %arg0, %c0 : tensor<16xf32>, index
  %result0 = arith.muli %rot0, %row0 : f32

  %row1 = tensor.extract_slice %cst_0[1, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c1 = arith.constant 1 : index
  %rot1 = tensor_ext.rotate %arg0, %c1 : tensor<16xf32>, index
  %result1 = arith.muli %rot1, %row1 : f32

  %row2 = tensor.extract_slice %cst_0[2, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c2 = arith.constant 2 : index
  %rot2 = tensor_ext.rotate %arg0, %c2 : tensor<16xf32>, index
  %result2 = arith.muli %rot2, %row2 : f32

  %row3 = tensor.extract_slice %cst_0[3, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c3 = arith.constant 3 : index
  %rot3 = tensor_ext.rotate %arg0, %c3 : tensor<16xf32>, index
  %result3 = arith.muli %rot3, %row3 : f32

  %row4 = tensor.extract_slice %cst_0[4, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c4 = arith.constant 4 : index
  %cminus4 = arith.constant -4 : i32
  %ct_rot4 = tensor_ext.rotate %row4, %cminus4 : tensor<16xf32>, index
  // %rot4 = tensor_ext.rotate %arg0, %c4 : tensor<16xf32>, index
  %mul4 = arith.muli %ct_rot4, %arg0 : f32
  %result4 = tensor_ext.rotate %mul4, %c4 : tensor<16xf32>, index

  %accum0 = arith.addf %result0, %result1 : tensor<16xf32>
  %accum1 = arith.addf %accum0, %result2 : tensor<16xf32>
  %accum2 = arith.addf %accum1, %result3 : tensor<16xf32>
  %accum3 = arith.addf %accum2, %result4 : tensor<16xf32>

  return %accum3 : tensor<16xf32>
}

// Step 2
func.func @simple_sum(%arg0: tensor<16xf32>) -> tensor<16xf32> {
    %cst_0 = arith.constant dense<"0x5036CB3D584F72BFBA00FA3DBF82CB3FBF6FFB3F6D8B66BDAE8AA13EBF5F023FC2D49C3FCCA8D6BD532AA23F522F40BE1AD4EABE79B7B8BE37B836BF1C591EBEED693F3E27116D3D0DBFF0BE726237BF9C8203BF4DF072BFAF6CACBD83868D3F8523E03DD65AFDBE15A656BE8B94383DC5DE023F4A69D73E989532BE66736C3E647E8E3FAA05383F79DF193FE1645E3F24B92ABEC166A93E615C2DC0497814BD07ED413DD757033F1923163D76727CBEC759C83FF01E2F3D23B418BFABF141BE1C7029BF32109FBF4E00073FA4569FBD7F70C5BE8D4BDF3F473F593F911CAB3F13E9853E590DF63EC24284BEADBB19BF37CE383FEB0713BDD8C9243F63FE853EBEE1923FC956703F29DA10BEB0863BBF733F6C3FBF4AEABDE32D25BF4BC424BE016DA2BEC4280CBF374FFD3D755B6F3F9B9C1BBECBACC6BD6CAA17BE26F7803F83F258BEADE2DCBE1C9693BDD15A1FC07CE7DA3E9FD976BFDF71D0BD7A020C3FD73A6F3E8EA7EABEB9F2A3BED185903E4C08633DCA2E0EBF21AE853F68822ABF77DDA1BFEE8F443E12360BBF97BE063E1F83C13FB809763E382D6CBE6509A73E2D0268BE74C317BE4597B5BB6294083F195E3E3E28F39CBC3C11793F7BFA0F3FD7EDB93C3EF9903FEEFCFBBD94A451BF0284113ECD4C10BF2DD392BD95E499BEEBC9613EBEB947BE576920BF8D0700BF90944FBDE8A4C23FBE51FABE34128B3E309239C090A07CBF051EBDBEE4AA0B3FF339193FC88265BF9C4FECB8EE54DB3EEFFC3CBF870B93BE6A4E0F3ED998223F511F9DBF8D844E3F47B452BEA3B655BF842D833E7803133FAE500E3F0C8726BE1B19E13C6B2BABBE4BF853BED6E0493E695FA93E3402CB3EEC66B9BEACE7A1BF8E44723F2791AF3D2A0A763EAB2F1C3EB0C3163FCDB2E83E598190BFA2AD41BEA1F5FA3EC202C5BE8D53EB3DCDCA91BEA695923EC68B41BE4072EE3F79CC633C665C36BFF31C79BE4CA4BDBFCC272F3FD1DB2ABFDC29103F369C0D3F1A15F63E6E31C9BEA1078D3EBE94AABE387D02BF1937CB3F50F054BF570AFE3D1039C43DCE54193F5129963F7AE739BE2B3A19BF5D971B3FCC190A3F65AB74BF1CDB073F40F376BF5A0439BF3C3297BDF615053D553A37BF161EB23E961D7C3E8FB21CBF9ABE19C074A657BF6C0AC33F198BD9BE1091853EECD986BF022E55BE47C021BE4D87BDBE1FD4A7BE75BF7FBE7D4EB63F6EC745BF4FDC1F3E5FEE0ABD36CD1B3FECACB53E3D09BD3D0FDF2E3DA75C0DBFED900CBEAE4E853DE4A9393EBD0E8D3EA96AA03E3640A63F1EFEF83E0042113E3DCF823EB562A1BD1EC09EBF99D43DBE88925B3EF1F9953EBDA0BABC12C739BD19464BBFE147C3BE3CB9E83EDDD4C93E8D9F843D55B69FBF1936893F4C661B3FEC98153FD9A115C0EA77253E85E451BFA19AA4BEFDA50DBB6E8E23BFE5F4E1BE"> : tensor<16x16xf32>

  %row0 = tensor.extract_slice %cst_0[0, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c0 = arith.constant 0 : index
  %rot0 = tensor_ext.rotate %arg0, %c0 : tensor<16xf32>, index
  %result0 = arith.muli %rot0, %row0 : f32

  %row1 = tensor.extract_slice %cst_0[1, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c1 = arith.constant 1 : index
  %rot1 = tensor_ext.rotate %arg0, %c1 : tensor<16xf32>, index
  %result1 = arith.muli %rot1, %row1 : f32

  %row2 = tensor.extract_slice %cst_0[2, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c2 = arith.constant 2 : index
  %rot2 = tensor_ext.rotate %arg0, %c2 : tensor<16xf32>, index
  %result2 = arith.muli %rot2, %row2 : f32

  %row3 = tensor.extract_slice %cst_0[3, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c3 = arith.constant 3 : index
  %rot3 = tensor_ext.rotate %arg0, %c3 : tensor<16xf32>, index
  %result3 = arith.muli %rot3, %row3 : f32

  %row4 = tensor.extract_slice %cst_0[4, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %c4 = arith.constant 4 : index
  %cminus4 = arith.constant -4 : i32
  %ct_rot4 = tensor_ext.rotate %row4, %cminus4 : tensor<16xf32>, index
  // %rot4 = tensor_ext.rotate %arg0, %c4 : tensor<16xf32>, index
  %mul4 = arith.muli %ct_rot4, %arg0 : f32
  %result4 = tensor_ext.rotate %mul4, %c4 : tensor<16xf32>, index

  // ...

  %row8 = tensor.extract_slice %cst_0[8, 0] [1, 16] [1, 1] : tensor<16x16xf32> to tensor<16xf32>
  %ct_rot8 = tensor_ext.rotate %row8, %cminus4 : tensor<16xf32>, index
  %mul8 = arith.muli %ct_rot8, %arg0 : f32
  %result8 = tensor_ext.rotate %mul8, %c4 : tensor<16xf32>, index

  %accum0 = arith.addf %result0, %result1 : tensor<16xf32>
  %accum1 = arith.addf %accum0, %result2 : tensor<16xf32>
  %accum2 = arith.addf %accum1, %result3 : tensor<16xf32>
  %accum3 = arith.addf %accum2, %result4 : tensor<16xf32>
  // ...
  %accum7 = arith.addf %accum7, %result8 : tensor<16xf32>

  return %accum3 : tensor<16xf32>
}



// Passes to add:
// 1. Identify baby step + giant step rotations
// 2. Fold rotation into plaintext encoding
