<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.113.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Getting Started | HEIR</title><meta name=description content="Getting HEIR Using a pre-built nightly binary HEIR releases a nightly binary for Linux x86-64. This is intended for testing compiler passes and not for production use.
wget https://github.com/google/heir/releases/download/nightly/heir-opt chmod +x heir-opt ./heir-opt --help Then you can run the examples below, replacing bazel run //tools:heir-opt -- with ./heir-opt. HEIR also publishes heir-translate and heir-lsp in the same way.
Running the nightly binary from a notebook We publish an ipython extension heir-play that can be used in Jupyter or Colab notebooks."><meta property="og:title" content="Getting Started"><meta property="og:description" content="Getting HEIR Using a pre-built nightly binary HEIR releases a nightly binary for Linux x86-64. This is intended for testing compiler passes and not for production use.
wget https://github.com/google/heir/releases/download/nightly/heir-opt chmod +x heir-opt ./heir-opt --help Then you can run the examples below, replacing bazel run //tools:heir-opt -- with ./heir-opt. HEIR also publishes heir-translate and heir-lsp in the same way.
Running the nightly binary from a notebook We publish an ipython extension heir-play that can be used in Jupyter or Colab notebooks."><meta property="og:type" content="article"><meta property="og:url" content="https://heir.dev/docs/getting_started/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-04-08T15:03:13+00:00"><meta itemprop=name content="Getting Started"><meta itemprop=description content="Getting HEIR Using a pre-built nightly binary HEIR releases a nightly binary for Linux x86-64. This is intended for testing compiler passes and not for production use.
wget https://github.com/google/heir/releases/download/nightly/heir-opt chmod +x heir-opt ./heir-opt --help Then you can run the examples below, replacing bazel run //tools:heir-opt -- with ./heir-opt. HEIR also publishes heir-translate and heir-lsp in the same way.
Running the nightly binary from a notebook We publish an ipython extension heir-play that can be used in Jupyter or Colab notebooks."><meta itemprop=dateModified content="2025-04-08T15:03:13+00:00"><meta itemprop=wordCount content="1987"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started"><meta name=twitter:description content="Getting HEIR Using a pre-built nightly binary HEIR releases a nightly binary for Linux x86-64. This is intended for testing compiler passes and not for production use.
wget https://github.com/google/heir/releases/download/nightly/heir-opt chmod +x heir-opt ./heir-opt --help Then you can run the examples below, replacing bazel run //tools:heir-opt -- with ./heir-opt. HEIR also publishes heir-translate and heir-lsp in the same way.
Running the nightly binary from a notebook We publish an ipython extension heir-play that can be used in Jupyter or Colab notebooks."><link rel=preload href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css as=style><link href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body class=td-page><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="32" fill="#fff" fill-opacity=".01"/><path d="M18.6889 10.124l7.7916 5.0511 2.6263-1.6684-2.6146-1.6779-7.8033-4.96754 2.8526 1.84162L18.6889 10.124z" fill="#efcf6f"/><path d="M29.1185 6.86125 18.6979.13981 16.06 1.79876 26.4922 8.52025l2.6263-1.659z" fill="#efcf6f"/><path d="M8.2405 6.74134 5.60033 5.07291 3.05751 6.79935 5.67334 8.49344 8.2405 6.74134z" fill="#ee958a"/><path d="M10.8697 8.49344 8.2405 10.124v3.3995l5.2049-3.3348-2.5757-1.69526z" fill="#ee958a"/><path d="M5.67334 8.49344 3.05751 6.79935 3.03318 23.4932l2.64016 1.6897V8.49344z" fill="#a32e24"/><path d="M29.1185 6.86126 26.4922 8.52025V11.8288l2.6263-1.6401V6.86126z" fill="#d38041"/><path d="M21.5415 8.70288 18.6889 6.86126V10.124l2.8526-1.42112z" fill="#d38041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M8.2405 6.74134V10.124v3.3995l5.2049-3.3348V3.58723l2.6145-1.7885L16.1123 11.8484V18.467l-2.6158 1.6181L13.4574 13.5235 10.849 15.1694 8.2405 16.8152v6.678L5.67334 25.1829V8.49344L8.2405 6.74134z" fill="#dd583b"/><path d="M13.4965 20.0851 13.4574 13.5235 10.849 15.1694 10.8077 18.467l2.6888 1.6181z" fill="#a32e24"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.4454 3.58723V10.1887L10.8697 8.49344 10.9293 1.79873l2.5161 1.7885z" fill="#a32e24"/><path d="M16.0599 1.79873 13.4454.13981 10.9293 1.79873l2.5161 1.7885 2.6145-1.7885z" fill="#ee958a"/><path d="M16.06 1.79876 16.0793 5.52165 16.1123 11.8484V18.467l2.5766-1.6518V13.4696 10.124 6.86126l7.8033 4.96754V8.52025L16.06 1.79876z" fill="#e5ad11"/><path d="M18.6889 16.8152 16.1123 18.467l10.3682 6.7159V21.8372l-7.7916-5.022z" fill="#e5ad11"/><path d="M26.4805 15.1751 18.6889 10.124v3.3456l2.7505 1.7641 5.0411 3.2333V15.1751z" fill="#e5ad11"/><path d="M29.1068 13.5067l-2.6263 1.6684V18.467l2.6263-1.6518V13.5067z" fill="#d48041"/><path d="M29.1185 20.0851l-2.638 1.7521v3.3457l2.6263-1.6897L29.1185 20.0851z" fill="#d48041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.4805 21.8372l-7.7916-5.022 2.7505-1.5815 5.0411 3.2333 2.638 1.6181-2.638 1.7521z" fill="#efcf6f"/><path d="M18.6889 13.4696v3.3456l2.7505-1.5815-2.7505-1.7641z" fill="#d48041"/><path d="M20.1621 26.5165l-4.2015-2.7017-4.2015-2.7016L11.7108 23.8491l6.3384 4.0776 2.1129 1.3512V26.5165z" fill="#395aad"/><path d="M7.49852 23.8491v2.6674l8.41958 5.4439V29.2779L7.49852 23.8491z" fill="#276e3a"/><path d="M9.57951 22.4781l-2.08099 1.371 8.41958 5.4288 2.1311-1.3512-6.3384-4.0776-2.13129-1.371z" fill="#add284"/><path d="M24.3747 26.5165V23.8491L22.174 22.8377l-2.0054.9665 2.1815 1.3793 2.0246 1.333z" fill="#395aad"/><path d="M18.0492 19.7061l2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#395aad"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.1621 18.4432l-2.0415-.596-2.1581.596-2.1017 1.3349-2.1017 1.3351 2.1012 1.3511 6.3018 4.0522 2.188-1.333-2.1815-1.3793 2.0054-.9665 2.2007 1.0114 2.0995-1.329-2.0811-1.4069L22.3501 21.1371l-.1752-1.4237L22.174 19.7061l-2.0119-1.2629zm-2.1129 1.2629 2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#9ec4e0"/><path d="M26.4742 22.5201l-2.0995 1.329v2.6674l2.1289-1.3305L26.4742 22.5201z" fill="#4285f4"/><path d="M20.1621 26.5165v2.7614l2.188-1.3512V25.1835l-2.188 1.333z" fill="#4285f4"/><path d="M15.9181 29.2779v2.6825l2.1311-1.3708V27.9267l-2.1311 1.3512z" fill="#4e9c68"/></svg></span><span class=navbar-brand__name>HEIR</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/><span>Home</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/google/heir/ target=_blank rel=noopener><span>GitHub</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ title="HEIR: Homomorphic Encryption Intermediate Representation" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Home</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ title=Documentation class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docs><span>Docs</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsgetting_started-li><a href=/docs/getting_started/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docsgetting_started><span class=td-sidebar-nav-active-item>Getting Started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontributing-li><a href=/docs/contributing/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributing><span>Contributing to HEIR</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsdevelopment-li><a href=/docs/development/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdevelopment><span>Development</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorials-li><a href=/docs/tutorials/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorials><span>Tutorials and Talks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsresearch_with_heir-li><a href=/docs/research_with_heir/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsresearch_with_heir><span>Research with HEIR</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdesign-li><a href=/docs/design/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdesign><span>Design</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdesignmanagement-li><a href=/docs/design/management/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdesignmanagement><span>Ciphertext Management</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdesigndo_transformation-li><a href=/docs/design/do_transformation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdesigndo_transformation><span>Data-oblivious Transformations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdesignsecret-li><a href=/docs/design/secret/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdesignsecret><span>Secret</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdesignsimd-li><a href=/docs/design/simd/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdesignsimd><span>SIMD Optimizations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdesignrelinearization_ilp-li><a href=/docs/design/relinearization_ilp/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdesignrelinearization_ilp><span>Optimizing relinearization</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspipelines-li><a href=/docs/pipelines/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docspipelines><span>Pipelines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsdialects-li><a href=/docs/dialects/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docsdialects><span>Dialects</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsbgv-li><a href=/docs/dialects/bgv/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsbgv><span>BGV</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectscggi-li><a href=/docs/dialects/cggi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectscggi><span>CGGI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsckks-li><a href=/docs/dialects/ckks/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsckks><span>CKKS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectscomb-li><a href=/docs/dialects/comb/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectscomb><span>Comb</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsjaxite-li><a href=/docs/dialects/jaxite/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsjaxite><span>Jaxite</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsjaxiteword-li><a href=/docs/dialects/jaxiteword/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsjaxiteword><span>JaxiteWord</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectslattigo-li><a href=/docs/dialects/lattigo/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectslattigo><span>Lattigo</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectslwe-li><a href=/docs/dialects/lwe/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectslwe><span>LWE</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsmgmt-li><a href=/docs/dialects/mgmt/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsmgmt><span>Mgmt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsmodarith-li><a href=/docs/dialects/modarith/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsmodarith><span>ModArith</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsopenfhe-li><a href=/docs/dialects/openfhe/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsopenfhe><span>Openfhe</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectspolynomial-li><a href=/docs/dialects/polynomial/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectspolynomial><span>Polynomial</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsrandom-li><a href=/docs/dialects/random/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsrandom><span>Random</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectsrns-li><a href=/docs/dialects/rns/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectsrns><span>RNS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectssecret-li><a href=/docs/dialects/secret/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectssecret><span>Secret</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectstensorext-li><a href=/docs/dialects/tensorext/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectstensorext><span>TensorExt</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectstfherust-li><a href=/docs/dialects/tfherust/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectstfherust><span>TfheRust</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdialectstfherustbool-li><a href=/docs/dialects/tfherustbool/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docsdialectstfherustbool><span>TfheRustBool</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspasses-li><a href=/docs/passes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docspasses><span>Passes</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-community-li><a href=/community/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-community><span>Community</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-search-li><a href=/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-search><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/google/heir/tree/main/docs/content/en/docs/getting_started.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/google/heir/edit/main/docs/content/en/docs/getting_started.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/google/heir/new/main/docs/content/en/docs/getting_started.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/google/heir/issues/new?title=Getting%20Started" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a id=print href=https://heir.dev/docs/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#getting-heir>Getting HEIR</a><ul><li><a href=#using-a-pre-built-nightly-binary>Using a pre-built nightly binary</a></li><li><a href=#running-the-nightly-binary-from-a-notebook>Running the nightly binary from a notebook</a></li><li><a href=#building-from-source>Building From Source</a></li></ul></li><li><a href=#using-heir>Using HEIR</a><ul><li><a href=#run-the-dot-product-example>Run the <code>dot-product</code> example</a></li><li><a href=#optional-run-a-custom-heir-opt-pipeline>Optional: Run a custom <code>heir-opt</code> pipeline</a></li><li><a href=#optional-graphviz-visualization-of-the-ir>Optional: Graphviz visualization of the IR</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://heir.dev/docs/>Docs</a></li><li class="breadcrumb-item active" aria-current=page>Getting Started</li></ol></nav><div class=td-content><h1>Getting Started</h1><header class=article-meta></header><h2 id=getting-heir>Getting HEIR</h2><h3 id=using-a-pre-built-nightly-binary>Using a pre-built nightly binary</h3><p>HEIR releases a <a href=https://github.com/google/heir/releases/tag/nightly>nightly</a>
binary for Linux x86-64. This is intended for testing compiler passes and not
for production use.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/google/heir/releases/download/nightly/heir-opt
</span></span><span style=display:flex><span>chmod +x heir-opt
</span></span><span style=display:flex><span>./heir-opt --help
</span></span></code></pre></div><p>Then you can run the examples below, replacing <code>bazel run //tools:heir-opt --</code>
with <code>./heir-opt</code>. HEIR also publishes <code>heir-translate</code> and <code>heir-lsp</code> in the
same way.</p><h3 id=running-the-nightly-binary-from-a-notebook>Running the nightly binary from a notebook</h3><p>We publish an ipython extension <a href=https://pypi.org/project/heir-play/>heir-play</a>
that can be used in Jupyter or Colab notebooks.</p><pre tabindex=0><code>%pip install heir-play
%load_ext heir_play
</code></pre><p>This will download the nightly release binaries to the system the notebook
server is running on, then:</p><pre tabindex=0><code>%%heir_opt --flag1 --flag2

# MLIR code here
</code></pre><p>Runs <code>heir-opt</code> with the given command line flags on the MLIR code in the cell.</p><p>A cell magic is also available for <code>heir-translate</code> as <code>%%heir_translate</code>.</p><h3 id=building-from-source>Building From Source</h3><h4 id=prerequisites>Prerequisites</h4><ul><li><a href=https://git-scm.com/>Git</a></li><li>A C++ compiler and linker (<a href=https://clang.llvm.org/>clang</a> and
<a href=https://lld.llvm.org/>lld</a> are recommended).</li><li>Bazel via <a href=https://github.com/bazelbuild/bazelisk>bazelisk</a>, or version
<code>>=5.5</code></li><li>See <a href=https://heir.dev/docs/development>Development</a> for additional
prerequisites for active development</li></ul><details><summary>Detailed Instructions</summary>
The first two requirements are frequently pre-installed
or can be installed via the system package manager.
For example, on Ubuntu, these can be installed with<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sudo apt-get install clang lld
</span></span></code></pre></div><p>You can download the latest Bazelisk release, e.g., for linux-amd64 (see the
<a href=https://github.com/bazelbuild/bazelisk/releases/latest>Bazelisk Release Page</a>
for a list of available binaries):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -c https://github.com/bazelbuild/bazelisk/releases/latest/download/bazelisk-linux-amd64
</span></span><span style=display:flex><span>mv bazelisk-linux-amd64 bazel
</span></span><span style=display:flex><span>chmod +x bazel
</span></span></code></pre></div><p>You will then likely want to move <code>bazel</code> to a location on your PATH, or add its
location to your PATH, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir ~/bin
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export PATH=$PATH:~/bin&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>mv bazel ~/bin/bazel
</span></span></code></pre></div><p>Note that on linux systems, your OS user must <strong>not</strong> be <code>root</code> as bazel might
refuse to work if run as root.</p></details><h4 id=clone-and-build-the-project>Clone and build the project</h4><p>You can clone and build HEIR from the terminal as described below. Please see
<a href=https://heir.dev/docs/development>Development</a> for information on IDE
configuration if you want to use an IDE to build HEIR.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:google/heir.git <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>cd</span> heir
</span></span><span style=display:flex><span>bazel build @heir//tools:heir-opt
</span></span></code></pre></div><p>Some passes in this repository require Yosys as a dependency
(<code>--yosys-optimizer</code>). If you would like to skip Yosys and ABC compilation to
speed up builds, use the following build setting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel build --//:enable_yosys<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> --build_tag_filters<span style=color:#ce5c00;font-weight:700>=</span>-yosys @heir//tools:heir-opt
</span></span></code></pre></div><h4 id=optional-run-the-tests>Optional: Run the tests</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> @heir//...
</span></span></code></pre></div><p>Like above, run the following to skip tests that depend on Yosys:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> --//:enable_yosys<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> --test_tag_filters<span style=color:#ce5c00;font-weight:700>=</span>-yosys @heir//...
</span></span></code></pre></div><h2 id=using-heir>Using HEIR</h2><h3 id=run-the-dot-product-example>Run the <code>dot-product</code> example</h3><p>The <code>dot-product</code> program computes the dot product of two length-8 vectors of
16-bit integers (<code>i16</code> in MLIR parlance). This example will showcase the OpenFHE
backend by manually calling the relevant compiler passes and setting up a C++
harness to call into the HEIR-generated functions.</p><p>Note: other backends are similar, but the different backends are in varying
stages of development.</p><p>The input program is in <code>tests/Examples/common/dot_product_8.mlir</code>. Support for
standard input languages like <code>C</code> and <code>C++</code> are currently experimental at best,
but eventually we would use an MLIR-based tool to convert an input language to
MLIR like in that file. The program is below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0_si16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>8</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%iter</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_si16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%iter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>For an introduction to MLIR syntax, see the
<a href=https://mlir.llvm.org/docs/LangRef/>official docs</a> or
<a href=https://www.jeremykun.com/2023/08/10/mlir-running-and-testing-a-lowering/>this blog post</a>.</p><p>Now we run the <code>heir-opt</code> command to optimize and compile the program.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--mlir-to-bgv<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;ciphertext-degree=8&#39;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--scheme-to-openfhe<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;entry-function=dot_product&#39;</span>  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#000>$PWD</span>/tests/Examples/common/dot_product_8.mlir &gt; output.mlir
</span></span></code></pre></div><p>This produces a file in the <code>openfhe</code> exit dialect (part of HEIR).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1005037682689_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1005037682689</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1032955396097_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1032955396097</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1095233372161_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1095233372161</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#polynomial_evaluation_encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L0_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L1_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1032955396097_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L2_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1032955396097_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1005037682689_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L0_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L0_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L1_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L1_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L2_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L0_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L0_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L1_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L1_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L2_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L0_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L0_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L1_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L1_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L2_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L2_D3_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L0_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L0_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L1_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L1_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L1_1 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L1_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L2_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L2_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L2_D3_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L2_D3_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_no_relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_D3_
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_D3_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mod_reduce <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>make_packed_plaintext <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_pt_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_plain <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_pt_L1_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>reinterpret_application_data <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_ to <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_1
</span></span><span style=display:flex><span>    <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mod_reduce <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Next, we use the <code>heir-translate</code> tool to run code generation for the OpenFHE
<code>pke</code> API.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke-header --openfhe-include-type<span style=color:#ce5c00;font-weight:700>=</span>source-relative <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.h
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke --openfhe-include-type<span style=color:#ce5c00;font-weight:700>=</span>source-relative <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.cpp
</span></span></code></pre></div><p>The <code>openfhe-include-type</code> indicates which include path for OpenFHE is used. It
has three possible values: <code>install-relative</code>, <code>source-relative</code> and <code>embedded</code>.
In this example we use <code>source-relative</code> as we are compiling against an
(unoptimized) OpenFHE managed by bazel in HEIR source. To compile against an
installed (and possibly optimized) OpenFHE, you could use <code>install-relative</code> and
compile it on your own. Or you could just put the generated file in OpenFHE
source directory <code>src/pke/examples</code> and let OpenFHE find and compile it for you
with the <code>embedded</code> option.</p><p>The results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.h
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CCParamsT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CCParams</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CryptoContextBGVRNS</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v18</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v19</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v20</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v32</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v38</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.cpp
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v4</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMultNoRelin</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v5</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Relinearize</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v4</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v6</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v8</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v11</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v12</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>ModReduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>v3_filled_n</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetCryptoParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetElementParams</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetRingDimension</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>v3_filled</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>clear</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3_filled_n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>v3_filled_n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push_back</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>size</span><span style=color:#000;font-weight:700>()]);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v13</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>MakePackedPlaintext</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v14</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMult</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v13</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v15</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v16</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v15</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v17</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>ModReduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v16</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>v17</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v29</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v34</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v36</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v38</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>At this point we can compile the program as we would a normal OpenFHE program.
Note that the above two files just contain the compiled function and
encryption/decryption helpers, and does not include any code that provides
specific inputs or calls these functions.</p><p>Next we&rsquo;ll create a harness that provides sample inputs, encrypts them, runs the
compiled function, and decrypts the result. Once you have the generated header
and cpp files, you can do this with any build system. We will use bazel for
consistency.</p><p>Create a file called <code>BUILD</code> in the same directory as the header and cpp files
above, with the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-BUILD data-lang=BUILD><span style=display:flex><span><span style=color:#8f5902;font-style:italic># A library build target that encapsulates the HEIR-generated code.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_library</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>hdrs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.h&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># An executable build target that contains your main function and links</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># against the above.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_binary</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;dot_product_main.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;:dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:core&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Where <code>dot_product_main.cpp</code> is a new file containing</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;cstdint&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;vector&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;heir_output.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>KeyPair</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>keyPair</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cryptoContext</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>KeyGen</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg0</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>240</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg0Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg1Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>outputEncrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0Encrypted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1Encrypted</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>outputEncrypted</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                                              <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Expected: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Actual: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Then run and show the results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bazel run dot_product_main
</span></span><span style=display:flex><span>Expected: <span style=color:#0000cf;font-weight:700>240</span>
</span></span><span style=display:flex><span>Actual: <span style=color:#0000cf;font-weight:700>240</span>
</span></span></code></pre></div><h3 id=optional-run-a-custom-heir-opt-pipeline>Optional: Run a custom <code>heir-opt</code> pipeline</h3><p>HEIR comes with two central binaries, <code>heir-opt</code> for running optimization passes
and dialect conversions, and <code>heir-translate</code> for backend code generation. To
see the list of available passes in each one, run the binary with <code>--help</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- --help
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --help
</span></span></code></pre></div><p>Once you&rsquo;ve chosen a pass or <code>--pass-pipeline</code> to run, execute it on the desired
file. For example, you can run a test file through <code>heir-opt</code> to see its output.
Note that when the binary is run via <code>bazel</code>, you must pass absolute paths to
input files. You can also access the underlying binary at
<code>bazel-bin/tools/heir-opt</code>, provided it has already been built.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --secret-to-cggi -cse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#000>$PWD</span>/tests/Dialect/Secret/Conversions/secret_to_cggi/add_one.mlir
</span></span></code></pre></div><p>To convert an existing lit test to a <code>bazel run</code> command for manual tweaking and
introspection (e.g., adding <code>--debug</code> or <code>--mlir-print-ir-after-all</code> to see how
he IR changes with each pass), use <code>python scripts/lit_to_bazel.py</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># after pip installing requirements-dev.txt</span>
</span></span><span style=display:flex><span>python scripts/lit_to_bazel.py tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div><p>Which outputs</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run --noallow_analysis_cache_discard //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--secretize --wrap-generic --canonicalize --cse --full-loop-unroll <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--insert-rotate --cse --canonicalize --collapse-insertion-chains <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--canonicalize --cse /path/to/heir/tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div><h3 id=optional-graphviz-visualization-of-the-ir>Optional: Graphviz visualization of the IR</h3><p>Getting a visualization of the IR during optimization/transformation might help
you understand what is going on more easily.</p><p>Still taking the <code>dot_product_8.mlir</code> as an example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run --ui_event_filters<span style=color:#ce5c00;font-weight:700>=</span>-info,-debug,-warning,-stderr,-stdout --noshow_progress --logging<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> //tools:heir-opt -- --wrap-generic --heir-simd-vectorizer <span style=color:#000>$PWD</span>/tests/Examples/common/dot_product_8.mlir --view-op-graph 2&gt; dot_product_8.dot
</span></span><span style=display:flex><span>dot -Tpdf dot_product_8.dot &gt; dot_product_8.pdf
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># open pdf in your favorite pdf viewer</span>
</span></span></code></pre></div><p>The diagram is also shown below. It demonstrates that the HEIR SIMD vectorizer
would vectorize the dot-product program (<code>tensor&lt;8xi16></code>) then use
rotate-and-reduce technique to compute the sum.</p><figure><a href=/images/dot_product_8.svg><img src=/images/dot_product_8.svg></a></figure><div class="text-muted mt-5 pt-3 border-top">Last modified April 8, 2025: <a href=https://github.com/google/heir/commit/707fab6c986063c2c15a159fc1c30978e8dc86c8>fix building without yosys enabled (707fab6c)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/google/heir aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 The HEIR Authors All Rights Reserved</span>
<span class=ms-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.027d75d71824837bee74c12a7806c5fe51249c1ca7accc27553a251a75cdb3a4.js integrity="sha256-An111xgkg3vudMEqeAbF/lEknBynrMwnVTolGnXNs6Q=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>