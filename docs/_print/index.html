<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.113.0"><link rel=canonical type=text/html href=https://heir.dev/docs/><link rel=alternate type=application/rss+xml href=https://heir.dev/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Documentation | HEIR</title><meta name=description content><meta property="og:title" content="Documentation"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://heir.dev/docs/"><meta itemprop=name content="Documentation"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Documentation"><meta name=twitter:description content><link rel=preload href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css as=style><link href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="32" fill="#fff" fill-opacity=".01"/><path d="M18.6889 10.124l7.7916 5.0511 2.6263-1.6684-2.6146-1.6779-7.8033-4.96754 2.8526 1.84162L18.6889 10.124z" fill="#efcf6f"/><path d="M29.1185 6.86125 18.6979.13981 16.06 1.79876 26.4922 8.52025l2.6263-1.659z" fill="#efcf6f"/><path d="M8.2405 6.74134 5.60033 5.07291 3.05751 6.79935 5.67334 8.49344 8.2405 6.74134z" fill="#ee958a"/><path d="M10.8697 8.49344 8.2405 10.124v3.3995l5.2049-3.3348-2.5757-1.69526z" fill="#ee958a"/><path d="M5.67334 8.49344 3.05751 6.79935 3.03318 23.4932l2.64016 1.6897V8.49344z" fill="#a32e24"/><path d="M29.1185 6.86126 26.4922 8.52025V11.8288l2.6263-1.6401V6.86126z" fill="#d38041"/><path d="M21.5415 8.70288 18.6889 6.86126V10.124l2.8526-1.42112z" fill="#d38041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M8.2405 6.74134V10.124v3.3995l5.2049-3.3348V3.58723l2.6145-1.7885L16.1123 11.8484V18.467l-2.6158 1.6181L13.4574 13.5235 10.849 15.1694 8.2405 16.8152v6.678L5.67334 25.1829V8.49344L8.2405 6.74134z" fill="#dd583b"/><path d="M13.4965 20.0851 13.4574 13.5235 10.849 15.1694 10.8077 18.467l2.6888 1.6181z" fill="#a32e24"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.4454 3.58723V10.1887L10.8697 8.49344 10.9293 1.79873l2.5161 1.7885z" fill="#a32e24"/><path d="M16.0599 1.79873 13.4454.13981 10.9293 1.79873l2.5161 1.7885 2.6145-1.7885z" fill="#ee958a"/><path d="M16.06 1.79876 16.0793 5.52165 16.1123 11.8484V18.467l2.5766-1.6518V13.4696 10.124 6.86126l7.8033 4.96754V8.52025L16.06 1.79876z" fill="#e5ad11"/><path d="M18.6889 16.8152 16.1123 18.467l10.3682 6.7159V21.8372l-7.7916-5.022z" fill="#e5ad11"/><path d="M26.4805 15.1751 18.6889 10.124v3.3456l2.7505 1.7641 5.0411 3.2333V15.1751z" fill="#e5ad11"/><path d="M29.1068 13.5067l-2.6263 1.6684V18.467l2.6263-1.6518V13.5067z" fill="#d48041"/><path d="M29.1185 20.0851l-2.638 1.7521v3.3457l2.6263-1.6897L29.1185 20.0851z" fill="#d48041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.4805 21.8372l-7.7916-5.022 2.7505-1.5815 5.0411 3.2333 2.638 1.6181-2.638 1.7521z" fill="#efcf6f"/><path d="M18.6889 13.4696v3.3456l2.7505-1.5815-2.7505-1.7641z" fill="#d48041"/><path d="M20.1621 26.5165l-4.2015-2.7017-4.2015-2.7016L11.7108 23.8491l6.3384 4.0776 2.1129 1.3512V26.5165z" fill="#395aad"/><path d="M7.49852 23.8491v2.6674l8.41958 5.4439V29.2779L7.49852 23.8491z" fill="#276e3a"/><path d="M9.57951 22.4781l-2.08099 1.371 8.41958 5.4288 2.1311-1.3512-6.3384-4.0776-2.13129-1.371z" fill="#add284"/><path d="M24.3747 26.5165V23.8491L22.174 22.8377l-2.0054.9665 2.1815 1.3793 2.0246 1.333z" fill="#395aad"/><path d="M18.0492 19.7061l2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#395aad"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.1621 18.4432l-2.0415-.596-2.1581.596-2.1017 1.3349-2.1017 1.3351 2.1012 1.3511 6.3018 4.0522 2.188-1.333-2.1815-1.3793 2.0054-.9665 2.2007 1.0114 2.0995-1.329-2.0811-1.4069L22.3501 21.1371l-.1752-1.4237L22.174 19.7061l-2.0119-1.2629zm-2.1129 1.2629 2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#9ec4e0"/><path d="M26.4742 22.5201l-2.0995 1.329v2.6674l2.1289-1.3305L26.4742 22.5201z" fill="#4285f4"/><path d="M20.1621 26.5165v2.7614l2.188-1.3512V25.1835l-2.188 1.333z" fill="#4285f4"/><path d="M15.9181 29.2779v2.6825l2.1311-1.3708V27.9267l-2.1311 1.3512z" fill="#4e9c68"/></svg></span><span class=navbar-brand__name>HEIR</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/><span>Home</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/google/heir/ target=_blank rel=noopener><span>GitHub</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-a2e0f2893b70992c6087c2b17584ff57>Getting Started</a></li><li>2: <a href=#pg-05b7a8e562e0a482b29460c121776963>Contributing to HEIR</a></li><li>3: <a href=#pg-1bf07101845de6da98f1c948b82c5ce0>Development</a></li><li>4: <a href=#pg-e62e32c8f8aaa5c7325bea5a1b00e345>Tutorials and Talks</a></li><li>5: <a href=#pg-439f0d1f88fc52920f9828a37ce073a8>Design</a></li><ul><li>5.1: <a href=#pg-bddfea9d49299ca5edc4a07ea06fcc23>Data-oblivious Transformations</a></li><li>5.2: <a href=#pg-76ae4da46c68c5cd44ad0ecf5d69993f>Secret</a></li><li>5.3: <a href=#pg-05018faa55dd802660a3ea38b8f7fb69>SIMD Optimizations</a></li><li>5.4: <a href=#pg-cd22aa05be277ba6c2e2f8f083706b51>Optimizing relinearization</a></li></ul><li>6: <a href=#pg-db9ac78ce08367ea2b7db8c1412049b6>Pipelines</a></li><li>7: <a href=#pg-590f1588f601079eeacfc7cb11dc5115>Dialects</a></li><ul><li>7.1: <a href=#pg-7a2d769a54237b8d0845fe32a6451c2b>BGV</a></li><li>7.2: <a href=#pg-5f74537b9610a2b3f8ddf498be3d47b0>CGGI</a></li><li>7.3: <a href=#pg-818a3660f61ebf5859b5c98635beacc8>CKKS</a></li><li>7.4: <a href=#pg-80cc312dd83f43a069330083f04eb4f2>Comb</a></li><li>7.5: <a href=#pg-df73b993320a0b803398dca1b5f7c3cd>Jaxite</a></li><li>7.6: <a href=#pg-c5dda3cb8e694541eacbee638af7317d>LWE</a></li><li>7.7: <a href=#pg-75945813f3978b67fb0398cc4f17cb8b>ModArith</a></li><li>7.8: <a href=#pg-e397c035ea096bd861aadf40d3fccd0a>Openfhe</a></li><li>7.9: <a href=#pg-b18fea903e4651113f5317788f1491e1>Polynomial</a></li><li>7.10: <a href=#pg-c9ea40a8d17399f57cdd3c18b53cedef>Random</a></li><li>7.11: <a href=#pg-aeae60b865ac85372556b396a5a052ce>RNS</a></li><li>7.12: <a href=#pg-f7ffac8ba93b73b8a62e185ec8643d63>Secret</a></li><li>7.13: <a href=#pg-ca9ddb02db7c0683037407c6f9eb1f2a>TensorExt</a></li><li>7.14: <a href=#pg-678c1db0f9b2ed4c9d43b790f890bea0>TfheRust</a></li><li>7.15: <a href=#pg-d46d9ee8aeb1f8889ca7cfc9a061a7cc>TfheRustBool</a></li></ul><li>8: <a href=#pg-19aafd690c3a7edde7a9c3e1fbaf737f>Passes</a></li></ul><div class=content><p>This section is where the HEIR documentation lives.</p></div></div><div class=td-content><h1 id=pg-a2e0f2893b70992c6087c2b17584ff57>1 - Getting Started</h1><h2 id=getting-heir>Getting HEIR</h2><h3 id=using-a-pre-built-nightly-binary>Using a pre-built nightly binary</h3><p>HEIR releases a <a href=https://github.com/google/heir/releases/tag/nightly>nightly</a>
binary for Linux x86-64. This is intended for testing compiler passes and not
for production use.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/google/heir/releases/download/nightly/heir-opt
</span></span><span style=display:flex><span>chmod +x heir-opt
</span></span><span style=display:flex><span>./heir-opt --help
</span></span></code></pre></div><p>Then you can run the examples below, replacing <code>bazel run //tools:heir-opt --</code>
with <code>./heir-opt</code>. HEIR also publishes <code>heir-translate</code> and <code>heir-lsp</code> in the
same way.</p><h3 id=running-the-nightly-binary-from-a-notebook>Running the nightly binary from a notebook</h3><p>We publish an ipython extension <a href=https://pypi.org/project/heir-play/>heir-play</a>
that can be used in Jupyter or Colab notebooks.</p><pre tabindex=0><code>%pip install heir-play
%load_ext heir_play
</code></pre><p>This will download the nightly release binaries to the system the notebook
server is running on, then:</p><pre tabindex=0><code>%%heir_opt --flag1 --flag2

# MLIR code here
</code></pre><p>Runs <code>heir-opt</code> with the given command line flags on the MLIR code in the cell.</p><p>A cell magic is also available for <code>heir-translate</code> as <code>%%heir_translate</code>.</p><h3 id=building-from-source>Building From Source</h3><h4 id=prerequisites>Prerequisites</h4><ul><li><a href=https://git-scm.com/>Git</a></li><li>A C++ compiler and linker (<a href=https://clang.llvm.org/>clang</a> and
<a href=https://lld.llvm.org/>lld</a> are recommended).</li><li>Bazel via <a href=https://github.com/bazelbuild/bazelisk>bazelisk</a>, or version
<code>>=5.5</code></li><li>See <a href=https://heir.dev/docs/development>Development</a> for additional
prerequisites for active development</li></ul><details><summary>Detailed Instructions</summary>
The first two requirements are frequently pre-installed
or can be installed via the system package manager.
For example, on Ubuntu, these can be installed with<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sudo apt-get install clang lld
</span></span></code></pre></div><p>You can download the latest Bazelisk release, e.g., for linux-amd64 (see the
<a href=https://github.com/bazelbuild/bazelisk/releases/latest>Bazelisk Release Page</a>
for a list of available binaries):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -c https://github.com/bazelbuild/bazelisk/releases/latest/download/bazelisk-linux-amd64
</span></span><span style=display:flex><span>mv bazelisk-linux-amd64 bazel
</span></span><span style=display:flex><span>chmod +x bazel
</span></span></code></pre></div><p>You will then likely want to move <code>bazel</code> to a location on your PATH, or add its
location to your PATH, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir ~/bin
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export PATH=$PATH:~/bin&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>mv bazel ~/bin/bazel
</span></span></code></pre></div><p>Note that on linux systems, your OS user must <strong>not</strong> be <code>root</code> as bazel might
refuse to work if run as root.</p></details><h4 id=clone-and-build-the-project>Clone and build the project</h4><p>You can clone and build HEIR from the terminal as described below. Please see
<a href=https://heir.dev/docs/development>Development</a> for information on IDE
configuration if you want to use an IDE to build HEIR.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:google/heir.git <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>cd</span> heir
</span></span><span style=display:flex><span>bazel build @heir//tools:heir-opt
</span></span></code></pre></div><p>Some passes in this repository require Yosys as a dependency
(<code>--yosys-optimizer</code>). If you would like to skip Yosys and ABC compilation to
speed up builds, use the following build setting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel build --//:enable_yosys<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> @heir//tools:heir-opt
</span></span></code></pre></div><h4 id=optional-run-the-tests>Optional: Run the tests</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> @heir//...
</span></span></code></pre></div><p>Like above, run the following to skip tests that depend on Yosys:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> --//:enable_yosys<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> --test_tag_filters<span style=color:#ce5c00;font-weight:700>=</span>-yosys @heir//...
</span></span></code></pre></div><h2 id=using-heir>Using HEIR</h2><h3 id=run-the-dot-product-example>Run the <code>dot-product</code> example</h3><p>The <code>dot-product</code> program computes the dot product of two length-8 vectors of
16-bit integers (<code>i16</code> in MLIR parlance). This example will showcase the OpenFHE
backend by manually calling the relevant compiler passes and setting up a C++
harness to call into the HEIR-generated functions.</p><p>Note: other backends are similar, but the different backends are in varying
stages of development.</p><p>The input program is in <code>tests/Examples/openfhe/dot_product_8.mlir</code>. Support for
standard input languages like <code>C</code> and <code>C++</code> are currently experimental at best,
but eventually we would use an MLIR-based tool to convert an input language to
MLIR like in that file. The program is below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0_si16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>8</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%iter</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_si16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%iter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>For an introduction to MLIR syntax, see the
<a href=https://mlir.llvm.org/docs/LangRef/>official docs</a> or
<a href=https://www.jeremykun.com/2023/08/10/mlir-running-and-testing-a-lowering/>this blog post</a>.</p><p>Now we run the <code>heir-opt</code> command to optimize and compile the program.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--mlir-to-openfhe-bgv<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;entry-function=dot_product ciphertext-degree=8&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#000>$PWD</span>/tests/Examples/openfhe/dot_product_8.mlir &gt; output.mlir
</span></span></code></pre></div><p>This produces a file in the <code>openfhe</code> exit dialect (part of HEIR). The raw
output is rather verbose, and an abbreviated version is shown below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>tensor_ct =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;...,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>scalar_ct =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;...,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>mul_ct =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;...,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>tensor_plaintext =</span> lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;...,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>scalar_ct <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_no_relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>mul_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>mul_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>index</span>_cast <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> to <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>index</span>_cast <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> to <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>index</span>_cast <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> to <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>rlwe_encode <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#lwe.polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#_polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>463187969</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ideal=</span><span style=color:#000>#_polynomial.polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_plaintext
</span></span><span style=display:flex><span>    <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_plain <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_plaintext<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>index</span>_cast <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> to <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%14</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000>%15</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>reinterpret_underlying_type <span style=color:#000>%14</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct to <span style=color:#000;font-weight:700>!</span>scalar_ct
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%15</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>scalar_ct
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span><span style=color:#204a87;font-weight:700>tensor</span>_ct
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>scalar_ct<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Next, we use the <code>heir-translate</code> tool to run code generation for the OpenFHE
<code>pke</code> API.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke-header <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.h
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.cpp
</span></span></code></pre></div><p>The results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.h
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v29</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v34</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v36</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.cpp
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>size_t</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>size_t</span> <span style=color:#000>v4</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>size_t</span> <span style=color:#000>v5</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>size_t</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMultNoRelin</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Relinearize</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>static_cast</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v9</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v11</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>v12</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>static_cast</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v4</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v13</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v12</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v14</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v13</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>v15</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>static_cast</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v16</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v15</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v17</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v16</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v18</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v18_cast</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>begin</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v18</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>end</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v18</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v19</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>MakePackedPlaintext</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v18_cast</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v20</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMult</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v17</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v19</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>v21</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>static_cast</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v6</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v22</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v20</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v21</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v23</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v22</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>v23</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v29</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v34</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v36</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>At this point we can compile the program as we would a normal OpenFHE program.
Note that the above two files just contain the compiled function and
encryption/decryption helpers, and does not include any code that provides
specific inputs or calls these functions.</p><p>Next we&rsquo;ll create a harness that provides sample inputs, encrypts them, runs the
compiled function, and decrypts the result. Once you have the generated header
and cpp files, you can do this with any build system. We will use bazel for
consistency.</p><p>Create a file called <code>BUILD</code> in the same directory as the header and cpp files
above, with the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-BUILD data-lang=BUILD><span style=display:flex><span><span style=color:#8f5902;font-style:italic># A library build target that encapsulates the HEIR-generated code.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_library</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>hdrs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.h&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># An executable build target that contains your main function and links</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># against the above.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_binary</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;dot_product_main.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;:dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:core&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Where <code>dot_product_main.cpp</code> is a new file containing</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;cstdint&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;vector&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34; // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;heir_output.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>KeyPair</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>keyPair</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cryptoContext</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>KeyGen</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int32_t</span> <span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cryptoContext</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetCryptoParameters</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>                  <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetElementParams</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>                  <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetCyclotomicOrder</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>/</span>
</span></span><span style=display:flex><span>              <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>arg0Vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>arg1Vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>240</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// TODO(#645): support cyclic repetition in add-client-interface
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push_back</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arg0Vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push_back</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arg1Vals</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg0Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg1Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>outputEncrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0Encrypted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1Encrypted</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>outputEncrypted</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                                              <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Expected: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Actual: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Then run and show the results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bazel run dot_product_main
</span></span><span style=display:flex><span>Expected: <span style=color:#0000cf;font-weight:700>240</span>
</span></span><span style=display:flex><span>Actual: <span style=color:#0000cf;font-weight:700>240</span>
</span></span></code></pre></div><h3 id=optional-run-a-custom-heir-opt-pipeline>Optional: Run a custom <code>heir-opt</code> pipeline</h3><p>HEIR comes with two central binaries, <code>heir-opt</code> for running optimization passes
and dialect conversions, and <code>heir-translate</code> for backend code generation. To
see the list of available passes in each one, run the binary with <code>--help</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- --help
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --help
</span></span></code></pre></div><p>Once you&rsquo;ve chosen a pass or <code>--pass-pipeline</code> to run, execute it on the desired
file. For example, you can run a test file through <code>heir-opt</code> to see its output.
Note that when the binary is run via <code>bazel</code>, you must pass absolute paths to
input files. You can also access the underlying binary at
<code>bazel-bin/tools/heir-opt</code>, provided it has already been built.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --secret-to-cggi -cse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#000>$PWD</span>/tests/Dialect/Secret/Conversions/secret_to_cggi/add_one.mlir
</span></span></code></pre></div><p>To convert an existing lit test to a <code>bazel run</code> command for manual tweaking and
introspection (e.g., adding <code>--debug</code> or <code>--mlir-print-ir-after-all</code> to see how
he IR changes with each pass), use <code>python scripts/lit_to_bazel.py</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># after pip installing requirements-dev.txt</span>
</span></span><span style=display:flex><span>python scripts/lit_to_bazel.py tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div><p>Which outputs</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run --noallow_analysis_cache_discard //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--secretize<span style=color:#ce5c00;font-weight:700>=</span>entry-function<span style=color:#ce5c00;font-weight:700>=</span>box_blur --wrap-generic --canonicalize --cse --full-loop-unroll <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--insert-rotate --cse --canonicalize --collapse-insertion-chains <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--canonicalize --cse /path/to/heir/tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-05b7a8e562e0a482b29460c121776963>2 - Contributing to HEIR</h1><p>There are several ways to contribute to HEIR, including:</p><ul><li>Discussing high-level designs and questions on HEIR&rsquo;s
<a href=https://github.com/google/heir/discussions>discussions page</a></li><li>Improving or expanding HEIR&rsquo;s documentation</li><li>Contributing to HEIR&rsquo;s <a href=https://github.com/google/heir>code-base</a></li><li>Discuss project direction at HEIR&rsquo;s
<a href=https://heir.dev/community/>Working Group meetings</a></li></ul><h2 id=ways-to-contribute>Ways to contribute</h2><p>We welcome pull requests, and have tagged issues for newcomers:</p><ul><li><a href="https://github.com/google/heir/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">Good first issue</a></li><li><a href="https://github.com/google/heir/issues?q=is%3Aissue+is%3Aopen+label%3A%22contributions+welcome%22">Contributions welcome</a></li><li><a href=https://github.com/google/heir/labels/research%20synthesis>Research synthesis</a>:
determine what parts of recent FHE research papers can or should be ported to
HEIR.</li></ul><p>For new proposals, please open a GitHub
<a href=https://github.com/google/heir/issues>issue</a> or start a
<a href=https://github.com/google/heir/discussions>discussion</a> for feedback.</p><h2 id=contributing-code-to-heir>Contributing code to HEIR</h2><p>The following steps should look familiar to typical workflows for pull request
contributions. Feel free to consult
<a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests>GitHub Help</a>
if you need more information using pull requests. HEIR-specific processes begin
at the <a href=#pull-request-review-flow>pull request review stage</a>.</p><h3 id=setup>Setup</h3><ol><li><p>Fork the HEIR repository by clicking the <strong>Fork</strong> button on the
<a href=https://github.com/google/heir>repository page</a>. This creates a copy of the
HEIR repository on your own GitHub account, where you can make changes.</p><details><summary>Setting up git to work with fork and upstream remotes.</summary>
If you have cloned your fork, you will want to
add the HEIR repository as an upstream remote:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git remote add upstream https://www.github.com/google/heir
</span></span></code></pre></div><p>Alternatively, if you have cloned the main HEIR repo, you can add your fork
as a remote like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git remote rename origin upstream
</span></span><span style=display:flex><span>git remote add origin https://www.github.com/&lt;USERNAME&gt;/heir
</span></span></code></pre></div><p>Either way, you will want to create a development branch for your change:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git checkout -b name-of-change
</span></span></code></pre></div><p>In the remainder of this document, we will assume <code>origin</code> is your fork, and
<code>upstream</code> is the main HEIR repo.</p></details></li><li><p>See <a href=https://heir.dev/docs/development/>Development</a> for information on
installing developer dependencies, building and running tests, and adding new
dialects or passes.</p></li><li><p>Sign the
<a href=https://cla.developers.google.com/about>Contributor License Agreement</a>
(CLA). If you are working on HEIR as part of your employment, you might have
to instead sign a Corporate CLA. See more
<a href=https://github.com/google/heir/blob/main/CONTRIBUTING.md#sign-our-contributor-license-agreement>here</a>.</p></li></ol><h3 id=preparing-a-pull-request>Preparing a pull request</h3><ol><li><p>Sync your changes against the upstream HEIR repository, i.e., make sure your
contributions are (re)based of the most recent <code>upstream/main</code> commit.</p></li><li><p>Check HEIR&rsquo;s lint and style checks by running the following from the top of
the repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> pre-commit run --all
</span></span></code></pre></div></li><li><p>Make sure tests are passing with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> bazel <span style=color:#204a87>test</span> @heir//...
</span></span></code></pre></div></li><li><p>Once you are ready with your change, create a commit, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git add change.cpp
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;Detailed commit message&#34;</span>
</span></span><span style=display:flex><span>git push --set-upstream origin name-of-change
</span></span></code></pre></div></li></ol><h3 id=pull-request-review-flow>Pull request review flow</h3><ol><li><strong>New PR</strong>:</li></ol><ul><li>When a new PR is submitted, it is inspected for quality requirements, such as
the CLA requirement, and a sufficient PR description.</li><li>If the PR passes checks, we assign a reviewer. If not, we request additional
changes to ensure the PR passes CI checks.</li></ul><ol start=2><li><strong>Review</strong></li></ol><ul><li>A reviewer will check the PR and potentially request additional changes.</li><li>If a change is needed, the contributor is requested to make a suggested
change. Please make changes with additional commits to your PR, to ensure that
the reviewer can easily see the diff.</li><li>If all looks good, the reviewer will approve the PR.</li><li>This cycle repeats itself until the PR is approved.</li></ul><ol start=3><li><strong>Approved</strong></li></ol><ul><li><strong>At this stage, you must squash your commits into a single commit.</strong></li><li>Once the PR is approved, a GitHub workflow will
<a href=https://github.com/google/heir/blob/main/.github/workflows/pr_review.yml>check</a>
your PR for multiple commits. You may use the <code>git rebase -i</code> to squash the
commits. Pull requests must consist of a single git commit before merging.</li></ul><ol start=4><li><strong>Pull Ready</strong></li></ol><ul><li>Once the PR is squashed into a single git commit, a maintainer will apply the
<code>pull ready</code> label.</li><li>This initiates the internal code migration and presubmits.</li><li>After the internal process is finished, the commit will be added to <code>main</code> and
the PR closed as merged by that commit.</li></ul><h3 id=internal-review-details>Internal review details</h3><p>This diagram summarizes the GitHub/Google code synchronization process. This is
largely automated by a Google-owned system called
<a href=https://github.com/google/copybara>Copybara</a>, the configuration for which is
Google-internal. This system treats the Google-internal version of HEIR as the
source of truth, and applies specified transformation rules to copy internal
changes to GitHub and integrate external PRs internally.</p><p>Notable aspects:</p><ul><li>The final merged code may differ slightly from a PR. The changes are mainly to
support stricter internal requirements for BUILD files that we cannot
reproduce externally due to minor differences between Google&rsquo;s internal build
systems and bazel that we don&rsquo;t know how to align. Sometimes they will also
include additional code quality fixes suggested by internal static analyzers
that do not exist outside of Google.</li><li>Due to the above, signed commits with internal modifications will not maintain
valid signatures after merging, which labels the commit with a warning.</li><li>You will see various actions taken on GitHub that include <code>copybara</code> in the
name, such as changes that originate from Google engineers doing various
approved migrations (e.g., migrating HEIR to support changes in MLIR or
abseil).</li></ul><figure><a href=/images/heir-copybara.png><img src=/images/heir-copybara.png></a><figcaption><h4>A diagram summarizing the copybara flow for HEIR internally to Google</h4></figcaption></figure><h3 id=why-bother-with-copybara>Why bother with Copybara?</h3><p>tl;dr: Automatic syncing with upstream MLIR and associated code migration.</p><p>Until HEIR has a formal governance structure in place, Google
engineersspecifically Asra Ali, Shruthi Gorantala, and Jeremy Kunare the
codebase stewards. Because the project is young and the team is small, we want
to reduce our workload. One important aspect of that is keeping up to date with
the upstream MLIR project and incorporating bug fixes and new features into
HEIR. Google also wishes to stay up to date with MLIR and LLVM, and so it has
tooling devoted to integrating new MLIR changes into Google&rsquo;s monorepo every few
hours. As part of that rotation, a set of approved internal projects that depend
on MLIR (like TensorFlow) are patched to support breaking changes in MLIR. HEIR
is one of those approved projects.</p><p>As shown in the previous section, the cost of this is that no change can go into
HEIR without at least two Googlers approving it, and the project is held to a
specific set of code quality standards, namely Google&rsquo;s. We acknowledge these
quirks, and look forward to the day when HEIR is useful enough and important
enough that we can revisit this governance structure with the community.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1bf07101845de6da98f1c948b82c5ce0>3 - Development</h1><h2 id=ide-configuration-vs-code>IDE Configuration (VS Code)</h2><p>While a wide variety of IDEs and editors can be used for HEIR development, we
currently only provide support for <a href=https://code.visualstudio.com/>VSCode</a>.</p><h3 id=setup>Setup</h3><p>For the best experience, we recommend following these steps:</p><ul><li><p>Install the
<a href="https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-mlir">MLIR</a>,
<a href="https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-clangd">clangd</a>
and
<a href="https://marketplace.visualstudio.com/items?itemName=BazelBuild.vscode-bazel">Bazel</a>
extensions</p></li><li><p>Install and rename Buildifier:</p><p>You can download the latest Buildifier release, e.g., for linux-amd64 (see the
<a href=https://github.com/bazelbuild/buildtools/releases/latest/>Bazelisk Release Page</a>
for a list of available binaries):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -c https://github.com/bazelbuild/buildtools/releases/latest/download/buildifier-linux-amd64
</span></span><span style=display:flex><span>mv buildifier-linux-amd64 buildifier
</span></span><span style=display:flex><span>chmod +x buildifier
</span></span></code></pre></div><p>Just as with bazel, you will want to move this somewhere on your PATH, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir ~/bin
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export PATH=$PATH:~/bin&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>mv buildifier ~/bin/buildifier
</span></span></code></pre></div><p>VS Code should automatically detect buildifier. If this is not successful, you
can manually set the &ldquo;Buildifier Executable&rdquo; setting for the Bazel extension
(<code>bazel.buildifierExecutable</code>).</p></li><li><p>Disable the
<a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++ (aka &lsquo;cpptools&rsquo;)</a>
extension (either completely, or in the current workspace).</p></li><li><p>Add the following snippet to your VS Code user settings found in
.vscode/settings.json to enable autocomplete based on the
compile_commands.json file.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:#4e9a06>&#34;clangd.arguments&#34;</span><span style=color:#a40000>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--compile-commands-dir=${workspaceFolder}/&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--completion-style=detailed&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--query-driver=**&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span><span style=color:#a40000>,</span>
</span></span></code></pre></div></li><li><p>To generate the <code>compile_commands.json</code> file, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bazel run @hedron_compile_commands//:refresh_all
</span></span></code></pre></div><p>This will need to be regenerated every time you want tooling to see new
<code>BUILD</code> file changes.</p><p>If you encounter errors like <code>*.h.inc</code> not found, or syntax errors inside
these files, you may need to build those targets and then re-run the
<code>refresh_all</code> command above.</p></li><li><p>It might be necesssary to add the path to your buildifier to VSCode, though it
should be auto-detected.</p><ul><li>Open the heir folder in VSCode</li><li>Go to &lsquo;Settings&rsquo; and set it on the &lsquo;Workspace&rsquo;</li><li>Search for &ldquo;Bazel Buildifier Executable&rdquo;</li><li>Once you find it, write <code>[home-directory]/bin/buildifier</code> for your specific
[home-directory].</li></ul></li></ul><h3 id=building-testing-running-and-debugging-with-vscode>Building, Testing, Running and Debugging with VSCode</h3><h4 id=building>Building</h4><ol><li>Open the &ldquo;Explorer&rdquo; (File Overview) in the left panel.</li><li>Find &ldquo;Bazel Build Targets&rdquo; towards the bottom of the &ldquo;Explorer&rdquo; panel and
click the dropdown button.</li><li>Unfold the heir folder</li><li>Right-click on &ldquo;//tools&rdquo; and click the &ldquo;Build Package Recursively&rdquo; option</li></ol><h4 id=testing>Testing</h4><ol><li>Open the &ldquo;Explorer&rdquo; (File Overview) in the left panel.</li><li>Find &ldquo;Bazel Build Targets&rdquo; towards the bottom of the &ldquo;Explorer&rdquo; panel and
click the dropdown button.</li><li>Unfold the heir folder</li><li>Right-click on &ldquo;//test&rdquo; and click the &ldquo;Test Package Recursively&rdquo; option</li></ol><h4 id=running-and-debugging>Running and Debugging</h4><ol><li><p>Create a <code>launch.json</code> file in the <code>.vscode</code> folder, changing the <code>"name"</code>
and <code>"args"</code> as required:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;0.2.0&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;configurations&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Debug Secret-&gt;BGV&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;preLaunchTask&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;build&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;lldb&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;request&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;launch&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;program&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}/bazel-bin/tools/heir-opt&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;--secret-to-bgv&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;--debug&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${workspaceFolder}/tests/secret_to_bgv/ops.mlir&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;relativePathBase&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;sourceMap&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;proc/self/cwd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;/proc/self/cwd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>You can add as many different configurations as necessary.</p></li><li><p>Add Breakpoints to your program as desired.</p></li><li><p>Open the Run/Debug panel on the left, select the desired configuration and
run/debug it.</p></li></ol><ul><li>Note that you might have to hit &ldquo;Enter&rdquo; to proceed past the Bazel build. It
might take several seconds between hitting &ldquo;Enter&rdquo; and the debug terminal
opening.</li></ul><h2 id=tips-for-working-with-bazel>Tips for working with Bazel</h2><h3 id=avoiding-rebuilds>Avoiding rebuilds</h3><p>Bazel is notoriously fickle when it comes to deciding whether a full rebuild is
necessary, which is bad for HEIR because rebuilding LLVM from scratch takes 15
minutes or more.</p><p>The main things that cause a rebuild are:</p><ul><li>A change to the command-line flags passed to bazel, e.g., <code>-c opt</code> vs <code>-c dbg</code>
for optimization level and debug symbols.</li><li>A change to the <code>.bazelrc</code> that implicitly causes a flag change. Note HEIR has
its own project-specific <code>.bazelrc</code> in the root directory.</li><li>A change to relevant command-line variables, such as <code>PATH</code>, which is avoided
by the <code>incompatible_strict_action_env</code> flag. Note activating a python
virtualenv triggers a <code>PATH</code> change.</li></ul><p>Bazel compilation flags are set by default in the project root&rsquo;s <code>.bazelrc</code> in
such a way as to avoid rebuilds during development as much as possible. This
includes setting <code>-c dbg</code> and <code>--incompatible_strict_action_env</code>.</p><h3 id=pointing-heir-to-a-local-clone-of-llvm-project>Pointing HEIR to a local clone of <code>llvm-project</code></h3><p>Occasionally changes in HEIR will need to be made in tandem with upstream
changes in MLIR. In particular, we occasionally find upstream bugs that only
occur with HEIR passes, and we are the primary owners/users of the upstream
<code>polynomial</code> dialect.</p><p>To tell <code>bazel</code> to use a local clone of <code>llvm-project</code> instead of a pinned
commit hash, replace <code>bazel/import_llvm.bzl</code> with the following file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; bazel/import_llvm.bzl <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Provides the repository macro to import LLVM.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>def import_llvm(name):
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;&#34;&#34;Imports LLVM.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    native.new_local_repository(
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name = name,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        # this BUILD file is intentionally empty, because the LLVM project
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        # internally contains a set of bazel BUILD files overlaying the project.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        build_file_content = &#34;# empty&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        path = &#34;/path/to/llvm-project&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    )
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The next <code>bazel build</code> will require a full rebuild if the checked-out LLVM
commit differs from the pinned commit hash in <code>bazel/import_llvm.bzl</code>.</p><p>Note that you cannot reuse the LLVM CMake build artifacts in the bazel build.
Based on what you&rsquo;re trying to do, this may require some extra steps.</p><ul><li>If you just want to run existing MLIR and HEIR tests against local
<code>llvm-project</code> changes, you can run the tests from HEIR using
<code>bazel test @llvm-project//mlir/...:all</code>. New <code>lit</code> tests can be added in
<code>llvm-project</code>&rsquo;s existing directories and tested this way without a rebuild.</li><li>If you add new CMake targets in <code>llvm-project</code>, then to incorporate them into
HEIR you need to add new bazel targets in
<code>llvm-project/utils/bazel/llvm-project-overlay/mlir/BUILD.bazel</code>. This is
required if, for example, a new dialect or pass is added in MLIR upstream.</li></ul><p>Send any upstream changes to HEIR-relevant MLIR files to @j2kun (Jeremy Kun) who
has LLVM commit access and can also suggest additional MLIR reviewers.</p><h2 id=tips-for-building-dependencies--useful-external-libraries>Tips for building dependencies / useful external libraries</h2><h3 id=mlir>MLIR</h3><p>Instructions for building MLIR can be found on the
<a href=https://mlir.llvm.org/getting_started/>Getting started</a> page of the MLIR
website. The instructions there seem to work as written (tested on Ubuntu
22.04). However, the command shown in <code>Unix-like compile/testing:</code> may require a
large amount of RAM. If building on a system with 16GB of RAM or less, and if
you don&rsquo;t plan to target GPUs, you may want to replace the line</p><pre tabindex=0><code>   -DLLVM_TARGETS_TO_BUILD=&#34;Native;NVPTX;AMDGPU&#34; \
</code></pre><p>with</p><pre tabindex=0><code>   -DLLVM_TARGETS_TO_BUILD=&#34;Native&#34; \
</code></pre><h3 id=openfhe>OpenFHE</h3><p>A simple way to build OpenFHE is to follow the instructions in the
<a href=https://github.com/openfheorg/openfhe-configurator>openfhe-configurator</a>
repository. This allows to build the library with or without support for the
Intel <a href=https://github.com/intel/hexl>HEXL library</a>. First, clone the repository
and configure it using:</p><pre tabindex=0><code>git clone https://github.com/openfheorg/openfhe-configurator.git
cd openfhe-configurator
scripts/configure.sh
</code></pre><p>You will be asked whether to stage a vanilla OpenFHE build or add support for
HEXL. You can then build the library using</p><pre tabindex=0><code>./scripts/build-openfhe-development.sh
</code></pre><p>The build may fail on systems with less than 32GB or RAM due to parallel
compilation. You can disable it by editing
<code>./scripts/build-openfhe-development.sh</code> and replacing</p><pre tabindex=0><code>make -j || abort &#34;Build of openfhe-development failed.&#34;
</code></pre><p>with</p><pre tabindex=0><code>make || abort &#34;Build of openfhe-development failed.&#34;
</code></pre><p>Compilation will be significantly slower but should then take less than 8GB of
memory.</p><h2 id=creating-a-new-pass>Creating a New Pass</h2><p>The <code>scripts/templates</code> folder contains Python scripts to create boilerplate for
new conversion or (dialect-specific) transform passes. These should be used when
the tablegen files containing existing pass definitions in the expected
filepaths are not already present. Otherwise, you should modify the existing
tablegen files directly.</p><h3 id=conversion-pass>Conversion Pass</h3><p>To create a new conversion pass, run a command similar to the following:</p><pre tabindex=0><code>python scripts/templates/templates.py new_conversion_pass \
--source_dialect_name=CGGI \
--source_dialect_namespace=cggi \
--source_dialect_mnemonic=cggi \
--target_dialect_name=TfheRust \
--target_dialect_namespace=tfhe_rust \
--target_dialect_mnemonic=tfhe_rust
</code></pre><p>In order to build the resulting code, you must fix the labeled <code>FIXME</code>s in the
type converter and the op conversion patterns.</p><h3 id=transform-passes>Transform Passes</h3><p>To create a transform or rewrite pass that operates on a dialect, run a command
similar to the following:</p><pre tabindex=0><code>python scripts/templates/templates.py new_dialect_transform \
--pass_name=ForgetSecrets \
--pass_flag=forget-secrets \
--dialect_name=Secret \
--dialect_namespace=secret \
--force=false
</code></pre><p>If the transform does not operate from and to a specific dialect, use</p><pre tabindex=0><code>python scripts/templates/templates.py new_transform \
--pass_name=ForgetSecrets \
--pass_flag=forget-secrets \
--force=false
</code></pre><h2 id=pre-commit>Pre-Commit</h2><p>We use <a href=https://pre-commit.com/>pre-commit</a> to manage a series of git
pre-commit hooks for the project; for example, each time you commit code, the
hooks will make sure that your C++ is formatted properly. If your code isn&rsquo;t,
the hook will format it, so when you try to commit the second time you&rsquo;ll get
past the hook.</p><p>All hooks are defined in <code>.pre-commit-config.yaml</code>. To install these hooks, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install -r requirements-dev.txt
</span></span></code></pre></div><p>Then install the hooks to run automatically on <code>git commit</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pre-commit install
</span></span></code></pre></div><p>To run them manually, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pre-commit run --all-files
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e62e32c8f8aaa5c7325bea5a1b00e345>4 - Tutorials and Talks</h1><p>A list of tutorials by the HEIR community. To add to this list, open an issue or
submit a pull request
<a href=https://github.com/google/heir/blob/main/docs/content/en/docs/tutorials.md>on GitHub</a>.</p><h2 id=talks>Talks</h2><ul><li><a href="https://www.youtube.com/watch?v=kqDFdKUTNA4">HEIR: A foundation for FHE compilers (FHE.org 2023-10 meetup)</a></li><li><a href="https://www.youtube.com/watch?v=ne5D_kqlxYg&amp;list=PLnbmMskCVh1fZy00EZQnFSezctvwYmlRM&amp;index=4">How to Write Optimizations in HEIR (FHE.org 2024 conference tutorial)</a>
(<a href="https://docs.google.com/presentation/d/1zRgrkWgLn4FxAWWDTQb8KnS-pqtUbST1AIR8bT_a-E8/edit?usp=sharing">slides</a>)</li></ul><h2 id=mlir-tutorials>MLIR tutorials</h2><ul><li><a href=https://github.com/j2kun/mlir-tutorial/>MLIR for Beginners by Jeremy Kun</a></li></ul><h2 id=fhe-math>FHE math</h2><ul><li><a href=https://jeremykun.com/2022/12/28/estimating-the-security-of-ring-learning-with-errors-rlwe/>Estimating the Security of Ring Learning With Errors by Cathie Yun</a></li><li><a href=https://jeremykun.com/2022/08/29/key-switching-in-lwe/>Key Switching in LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2022/07/16/modulus-switching-in-lwe/>Modulus Switching in LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2022/12/09/negacyclic-polynomial-multiplication/>Negacyclic Polynomial Multiplication by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2023/02/27/sample-extraction-from-rlwe-to-lwe/>Sample Extraction from RLWE to LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2021/12/11/the-gadget-decomposition-in-fhe/>The Gadget Decomposition in FHE by Jeremy Kun</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-439f0d1f88fc52920f9828a37ce073a8>5 - Design</h1><p>This section contains documentation on the high level design of the project.
Readers are intended to have basic familiarity with MLIR and FHE.</p></div><div class=td-content><h1 id=pg-bddfea9d49299ca5edc4a07ea06fcc23>5.1 - Data-oblivious Transformations</h1><p>A data-oblivious program is one that decouples data input from program
execution. Such programs exhibit control-flow and memory access patterns that
are independent of their input(s). This programming model, when applied to
encrypted data, is necessary for expressing FHE programs. There are 3 major
transformations applied to convert a conventional program into a data-oblivious
program:</p><h3 id=1-if-transformation>(1) If-Transformation</h3><p>If-operations conditioned on inputs create data-dependent control-flow in
programs. <code>scf.if</code> operations should at least define a &rsquo;then&rsquo; region (true path)
and always terminate with <code>scf.yield</code> even when <code>scf.if</code> doesn&rsquo;t produce a
result. To convert a data-dependent <code>scf.if</code> operation to an equivalent set of
data-oblivious operations in MLIR, we hoist all safely speculatable operations
in the <code>scf.if</code> operation and convert the <code>scf.yield</code> operation to an
<code>arith.select</code> operation. The following code snippet demonstrates an application
of this transformation.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying If-transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: %input is used as a condition causing a data-dependent branch
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span><span style=color:#a40000>`</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying If-transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(){</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We implement a <code>ConvertIfToSelect</code> pass that transforms operations with
secret-input conditions and with only Pure operations (i.e., operations that
have no memory side effect and are speculatable) in their body. <strong>This
transformation cannot be applied to operations when side effects are present in
only one of the two regions.</strong> Although possible, we currently do not support
transformations for operations where both regions have operations with matching
side effects. When side effects are present, the pass fails.</p><h3 id=2-loop-transformation>(2) Loop-Transformation</h3><p>Loop statements with input-dependent conditions (bounds) and number of
iterations introduce data-dependent branches that violate data-obliviousness. To
convert such loops into a data-oblivious version, we replace input-dependent
conditionals (bounds) with static input-independent parameters (e.g. defining a
constant upper bound), and early-exits with update operations where the value
returned from the loop is selectively updated using conditional predication. In
MLIR, loops are expressed using either <code>affine.for</code>, <code>scf.for</code> or <code>scf.while</code>
operations.</p><blockquote><p>[!NOTE] Early exiting from loops is not supported in <code>scf</code> and <code>affine</code>, so
early exits are not supported in this pipeline. TODO(#922): support early
exits</p></blockquote><ul><li><code>affine.for</code>: This operation lends itself well to expressing data oblivious
programs because it requires constant loop bounds, eliminating input-dependent
limits.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span> <span style=color:#000>%sum_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0.0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span> <span style=color:#8f5902;font-style:italic>// The for-loop&#39;s bound is a fixed constant
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>10</span> step <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%sum_iter</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%sum_0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%t</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%buffer</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1024x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%sum_next</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addf <span style=color:#000>%sum_iter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>   affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%sum_next</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span> <span style=color:#000;font-weight:700>...</span>
</span></span></code></pre></div><ul><li><code>scf.for</code>: In contrast to affine.for, scf.for does allow input-dependent
conditionals which does not adhere to data-obliviousness constraints. A
solution to this could be to either have the programmer or the compiler
specify an input-independent upper bound so we can transform the loop to use
this upper bound and also carefully update values returned from the for-loop
using conditional predication. Our current solution to this is for the
programmer to add the lower bound and worst case upper bound in the static
affine loop&rsquo;s <code>attributes</code> list.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%value</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: for-loop uses %inputIndex as upper bound which causes a secret-dependent control-flow
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%begin</span> to <span style=color:#000>%inputIndex</span> step <span style=color:#000>%step_value</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%value</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Build for-loop using lower and upper values from the `attributes` list
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to  step <span style=color:#0000cf;font-weight:700>32</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%agr1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iv</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%newOutput</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%output</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%newOutput</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><code>scf.while</code>: This operation represents a generic while/do-while loop that
keeps iterating as long as a condition is met. An input-dependent while
condition introduces a data-dependent control flow that violates
data-oblivious constraints. For this transformation, the programmer needs to
add the <code>max_iter</code> attribute that describes the maximum number of iterations
the loop runs which we then use the value to build our static <code>affine.for</code>
loop.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}){</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>while <span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Violation: scf.while uses %cond whose value depends on %input
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    scf<span style=color:#000;font-weight:700>.</span>condition<span style=color:#000;font-weight:700>(</span><span style=color:#000>%cond</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> do <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mul</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%mul</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}){</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%begin</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Replace while-loop with a for-loop with a constant bound %MAX_ITER
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%0</span> to <span style=color:#000>%16</span> step <span style=color:#000>%step_value</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%iter_arg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mul</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%iter_arg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%mul</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%output</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=3-access-transformation>(3) Access-Transformation</h3><p>Input-dependent memory access cause data-dependent memory footprints. A naive
data-oblivious solution to this maybe doing read-write operations over the
entire data structure while only performing the desired save/update operation
for the index of interest. For simplicity, we only look at load/store operations
for tensors as they are well supported structures in high-level MLIR likely
emitted by most frontends. We drafted the following non-SIMD approach for this
transformation and defer SIMD optimizations to the <code>heir-simd-vectorizer</code> pass:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying Access Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: tensor.extract loads value at %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%newValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extractedValue</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: tensor.insert stores value at %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%newValue</span> into <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Non-SIMD Access Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%i_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%dummyValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg</span><span style=color:#000;font-weight:700>=</span> <span style=color:#000>%dummyValue</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 1. Check if %i matches %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 2. Extract value at %i
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 3. If %i matches %inputIndex, select %value extracted in (2), else select %dummyValue
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 4. Yield selected value
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%selected</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%dummyValue</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%selected</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%newValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extractedValue</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 1. Check if %i matches the %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 2. Insert %newValue and produce %newTensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 3. If %i matches %inputIndex, select %newTensor, else select input tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 4. Yield final tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%newTensor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%value</span> into <span style=color:#000>%inputArg</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%finalTensor</span><span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%newTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%finalTensor</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=more-notes-on-these-transformations>More notes on these transformations</h3><p>These 3 transformations have a cascading behavior where transformations can be
applied progressively to achieve a data-oblivious program. The order of the
transformations goes as follows:</p><ul><li><em>Access-Transformation</em> (change data-dependent tensor accesses (reads-writes)
to use <code>affine.for</code> and <code>scf.if</code> operations) -> <em>Loop-Transformation</em> (change
data-dependent loops to use constant bounds and condition the loop&rsquo;s yield
results with <code>scf.if</code> operation) -> <em>If-Transformation</em> (substitute
data-dependent conditionals with <code>arith.select</code> operation).</li><li>Besides that, when we apply non-SIMD Access-Transformation on multiple
data-dependent tensor read-write operations over the same tensor, we can
benefit from upstream affine transformations over the resulting multiple
affine loops produced by the Access-Transformation to fuse these loops.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-76ae4da46c68c5cd44ad0ecf5d69993f>5.2 - Secret</h1><p>The <a href=https://heir.dev/docs/dialects/secret/><code>secret</code> dialect</a> contains types
and operations to represent generic computations on secret data. It is intended
to be a high-level entry point for the HEIR compiler, agnostic of any particular
FHE scheme.</p><p>Most prior FHE compiler projects design their IR around a specific FHE scheme,
and provide dedicated IR types for the secret analogues of existing data types,
and/or dedicated operations on secret data types. For example, the Concrete
compiler has <code>!FHE.eint&lt;32></code> for an encrypted 32-bit integer, and <code>add_eint</code> and
similar ops. HECO has <code>!fhe.secret&lt;T></code> that models a generic secret type, but
similarly defines <code>fhe.add</code> and <code>fhe.multiply</code>, and other projects are similar.</p><p>The problem with this approach is that it is difficult to incorporate the apply
upstream canonicalization and optimization passes to these ops. For example, the
<code>arith</code> dialect in MLIR has
<a href=https://sourcegraph.com/github.com/llvm/llvm-project@0ab3f160c4bff1c7d57c046b95ab8c5035ae986f/-/blob/mlir/lib/Dialect/Arith/IR/ArithCanonicalization.td>canonicalization patterns</a>
that must be replicated to apply to FHE analogues. One of the goals of HEIR is
to reuse as much upstream infrastructure as possible, and so this led us to
design the <code>secret</code> dialect to have both generic types and generic computations.
Thus, the <code>secret</code> dialect has two main parts: a <code>secret&lt;T></code> type that wraps any
other MLIR type <code>T</code>, and a <code>secret.generic</code> op that lifts any computation on
cleartext to the &ldquo;corresponding&rdquo; computation on secret data types.</p><h2 id=overview-with-bgv-style-lowering-pipeline>Overview with BGV-style lowering pipeline</h2><p>Here is an example of a program that uses <code>secret</code> to lift a dot product
computation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0_i16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>8</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The operands to the <code>generic</code> op are the secret data types, and the op contains
a single region, whose block arguments are the corresponding cleartext data
values. Then the region is free to perform any computation, and the values
passed to <code>secret.yield</code> are lifted back to <code>secret</code> types. Note that
<code>secret.generic</code> is not isolated from its enclosing scope, so one may refer to
cleartext SSA values without adding them as generic operands and block
arguments.</p><p>Clearly <code>secret.generic</code> does not actually do anything. It is not decrypting
data. It is merely describing the operation that one wishes to apply to the
secret data in more familiar terms. It is a structural operation, primarily used
to demarcate which operations involve secret operands and have secret results,
and group them for later optimization. The benefit of this is that one can write
optimization passes on types and ops that are not aware of <code>secret</code>, and they
will naturally match on the bodies of <code>generic</code> ops.</p><p>For example, here is what the above dot product computation looks like after
applying the <code>-cse -canonicalize -heir-simd-vectorizer</code> passes, the
implementations of which do not depend on <code>secret</code> or <code>generic</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%7</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The canonicalization patterns for <code>secret.generic</code> apply a variety of
simplifications, such as:</p><ul><li>Removing any unused or non-secret arguments and return values.</li><li>Hoisting operations in the body of a <code>generic</code> that only depend on cleartext
values to the enclosing scope.</li><li>Removing any <code>generic</code> ops that use no secrets at all.</li></ul><p>These can be used together with the
<a href=https://heir.dev/docs/passes/secretpasses/#-secret-distribute-generic><code>secret-distribute-generic</code> pass</a>
to split an IR that contains a large <code>generic</code> op into <code>generic</code> ops that
contain a single op, which can then be lowered to a particular FHE scheme
dialect with dedicated ops. This makes lowering easier because it gives direct
access to the secret version of each type that is used as input to an individual
op.</p><p>As an example, a single-op secret might look like this (taken from the larger
example below. Note the use of a cleartext from the enclosing scope, and the
proximity of the secret type to the op to be lowered.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span></code></pre></div><p>For a larger example, applying <code>--secret-distribute-generic --canonicalize</code> to
the IR above:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>And then lowering it to <code>bgv</code> with <code>--secret-to-bgv="poly-mod-degree=8"</code> (the
pass option matches the tensor size, but it is an unrealistic FHE polynomial
degree used here just for demonstration purposes). Note type annotations on ops
are omitted for brevity.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>463187969</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ideal=</span><span style=color:#000>#_polynomial.polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ty1 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding=</span><span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params=</span><span style=color:#000>#params</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type=</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ty2 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding=</span><span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params=</span><span style=color:#000>#params</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type=</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ty1<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ty1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>ty2 <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>mul <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>from_basis =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>to_basis =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c7</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%8</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=differences-for-cggi-style-pipeline>Differences for CGGI-style pipeline</h2><p>The <code>tosa-to-boolean-tfhe</code> and related pipelines add a few additional steps. The
main goal here is to apply a hardware circuit optimizer to blocks of standard
MLIR code (inside <code>secret.generic</code> ops) which converts the computation to an
optimized boolean circuit with a desired set of gates. Only then is
<code>-secret-distribute-generic</code> applied to split the ops up and lower them to the
<code>cggi</code> dialect. In particular, because passing an IR through the circuit
optimizer requires unrolling all loops, one useful thing you might want to do is
to optimize only the <em>body</em> of a for loop nest.</p><p>To accomplish this, we have two additional mechanisms. One is the pass option
<code>ops-to-distribute</code> for <code>-secret-distribute-generic</code>, which allows the user to
specify a list of ops that <code>generic</code> should be split across, and all others left
alone. Specifying <code>affine.for</code> here will pass <code>generic</code> through the <code>affine.for</code>
loop, but leave its body intact. This can also be used with the <code>-unroll-factor</code>
option to the <code>-yosys-optimizer</code> pass to partially unroll a loop nest and pass
the partially-unrolled body through the circuit optimizer.</p><p>The other mechanism is the <code>secret.separator</code> op, which is a purely structural
op that demarcates the boundary of a subset of a block that should be jointly
optimized in the circuit optimizer.</p><p>For example, the following <code>tosa</code> ops lower to multiple linalg instructions, and
hence multiple for loops, that we want to pass to a circuit optimizer as a unit.
The <code>secret.separator</code> ops surrounding the op are preserved through the
lowering.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.const&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>value =</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5438</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5515</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-1352</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-1500</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-4152</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-84</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3396</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1981</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5581</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-6964</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3407</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-7217</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.const&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>value =</span> dense<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>-9</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-54</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>57</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>71</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>104</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>115</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>98</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>99</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-26</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-82</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>68</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>95</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>86</span><span style=color:#000;font-weight:700>]]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.fully_connected&#34;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>quantization_info =</span> <span style=color:#000>#tosa.conv_quant</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>input_zp =</span> <span style=color:#0000cf;font-weight:700>-128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>weight_zp =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>After running <code>--tosa-to-boolean-tfhe</code> and dumping the IR after the linalg ops
are lowered to loops, we can see the <code>secret.separator</code> ops enclose the lowered
ops, with the exception of some pure ops that are speculatively executed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>,</span> strided<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#a40000>?</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>],</span> offset<span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c</span><span style=color:#0000cf;font-weight:700>-128</span><span style=color:#f57900>_i32 =</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>-128</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>get_global <span style=color:#000>@__constant_16xi32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>get_global <span style=color:#000>@__constant_16x1xi8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>,</span> strided<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#a40000>?</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>],</span> offset<span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subi <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span><span style=color:#0000cf;font-weight:700>-128</span>_i32 <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>dealloc <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We decided to use the <code>separator</code> op over a few alternatives:</p><ul><li>Grouping by <code>secret.generic</code>: these <code>tosa</code> ops must be bufferized, but
<code>secret</code> types cannot participate in bufferization (see the Limitations
section).</li><li>Grouping by basic blocks: <code>secret.generic</code> is a single-block op with a yield
terminator, and grouping by blocks would require us to change this.</li><li>Grouping by regions: SSA values generated by a region are not visible to the
enclosing scope, so we would need to have the region-bearing op return values,
which is tedious to organize.</li><li>Attaching attributes to ops that should be grouped together: this would not be
preserved by upstream lowerings and optimization passes.</li></ul><h2 id=generic-operands><code>generic</code> operands</h2><p><code>secret.generic</code> takes any SSA values as legal operands. They may be <code>secret</code>
types or non-secret. Canonicalizing <code>secret.generic</code> removes non-secret operands
and leaves them to be referenced via the enclosing scope (<code>secret.generic</code> is
not <code>IsolatedFromAbove</code>).</p><p>This may be unintuitive, as one might expect that only secret types are valid
arguments to <code>secret.generic</code>, and that a verifier might assert non-secret args
are not present.</p><p>However, we allow non-secret operands because it provides a convenient scope
encapsulation mechanism, which is useful for the <code>--yosys-optimizer</code> pass that
runs a circuit optimizer on individual <code>secret.generic</code> ops and needs to have
access to all SSA values used as inputs. The following passes are related to
this functionality:</p><ul><li><code>secret-capture-generic-ambient-scope</code></li><li><code>secret-generic-absorb-constants</code></li><li><code>secret-extract-generic-body</code></li></ul><p>Due to the canonicalization rules for <code>secret.generic</code>, anyone using these
passes as an IR organization mechanism must be sure not to canonicalize before
accomplishing the intended task.</p><h2 id=limitations>Limitations</h2><h3 id=bufferization>Bufferization</h3><p>Secret types cannot participate in bufferization passes. In particular,
<code>-one-shot-bufferize</code> hard-codes the notion of tensor and memref types, and so
it cannot currently operate on <code>secret&lt;tensor&lt;...>></code> or <code>secret&lt;memref&lt;...>></code>
types, which prevents us from implementing a bufferization interface for
<code>secret.generic</code>. This was part of the motivation to introduce
<code>secret.separator</code>, because <code>tosa</code> ops like a fully connected neural network
layer lower to multiple linalg ops, and these ops need to be bufferized before
they can be lowered further. However, we want to keep the lowered ops grouped
together for circuit optimization (e.g., fusing transposes and constant weights
into the optimized layer), but because of this limitation, we can&rsquo;t simply wrap
the <code>tosa</code> ops in a <code>secret.generic</code> (bufferization would fail).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-05018faa55dd802660a3ea38b8f7fb69>5.3 - SIMD Optimizations</h1><p>HEIR includes a SIMD (Single Instruction, Multiple Data) optimizer which is
designed to exploit the restricted SIMD parallelism most (Ring-LWE-based) FHE
schemes support (also commonly known as &ldquo;packing&rdquo; or &ldquo;batching&rdquo;). Specifically,
HEIR incorporates the &ldquo;automated batching&rdquo; optimizations (among many other
things) from the <a href=https://github.com/MarbleHE/HECO>HECO</a> compiler. The
following will assume basic familiarity with the FHE SIMD paradigm and the
high-level goals of the optimization, and we refer to the associated HECO
<a href=https://www.usenix.org/system/files/usenixsecurity23-viand.pdf>paper</a>,
<a href=https://www.usenix.org/system/files/sec23_slides_viand.pdf>slides</a>,
<a href="https://www.youtube.com/watch?v=SP3C6gLWIS4">talk</a> and additional resources on
the
<a href=https://www.usenix.org/conference/usenixsecurity23/presentation/viand>Usenix'23 website</a>
for an introduction to the topic. This documentation will mostly focus on
describing how the optimization is realized in HEIR (which differs somewhat from
the original implementation) and how the optimization is intended to be used in
an overall end-to-end compilation pipeline.</p><h2 id=representing-fhe-simd-operations>Representing FHE SIMD Operations</h2><p>Following the design principle of maintaining programs in standard MLIR dialects
as long as possible (cf. the design rationale behind the
<a href=https://heir.dev/docs/design/secret/>Secret Dialect</a>), HEIR uses the MLIR
<a href=https://mlir.llvm.org/docs/Dialects/TensorOps/><code>tensor</code> dialect</a> and
<a href=https://mlir.llvm.org/docs/Traits/#elementwisemappable>ElementwiseMappable</a>
operations from the MLIR
<a href=https://mlir.llvm.org/docs/Dialects/ArithOps/><code>arith</code> dialect</a> to represent HE
SIMD operations.</p><p>We do introduce the HEIR-specific
<a href=https://heir.dev/docs/dialects/tensorext/#tensor_extrotate-heirtensor_extrotateop><code>tensor_ext.rotate</code></a>
operation, which represents a cyclical left-rotation of a tensor. Note that, as
the current SIMD vectorizer only supports one-dimensional tensors, the semantics
of this operation on multi-dimensional tensors are not (currently) defined.</p><p>For example, the common &ldquo;rotate-and-reduce&rdquo; pattern which results in each
element containing the sum/product/etc of the original vector can be expressed
as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%tensor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>from_elements</span> <span style=color:#000>%i1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i8</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>The <code>%cN</code> and <code>%iN</code>, which are defined as <code>%cN = arith.constant N : index</code> and
<code>%iN = arith.constant N : i16</code>, respectively, have been omitted for readability.</p><h2 id=intended-usage>Intended Usage</h2><p>The <code>-heir-simd-vectorizer</code> pipeline transforms a program consisting of loops
and index-based accesses into tensors (e.g., <code>tensor.extract</code> and
<code>tensor.insert</code>) into one consisting of SIMD operations (including rotations) on
entire tensors. While its implementation does not depend on any FHE-specific
details or even the Secret dialect, this transformation is likely only useful
when lowering a high-level program to an arithmetic-circuit-based FHE scheme
(e.g., B/FV, BGV, or CKKS). The <code>-mlir-to-openfhe-bgv</code> pipeline demonstrates the
intended flow: augmenting a high-level program with <code>secret</code> annotations, then
applying the SIMD optimization (and any other high-level optimizations) before
lowering to BGV operations and then exiting to OpenFHE.</p><blockquote><p><strong>Warning</strong> The current SIMD vectorizer pipeline supports only one-dimensional
tensors. As a workaround, one could reshape all multi-dimensional tensors into
one-dimensional tensors, but MLIR/HEIR currently do not provide a pass to
automate this process.</p></blockquote><p>Since the optimization is based on heuristics, the resulting program might not
be optimal or could even be worse than a trivial realization that does not use
ciphertext packing. However, well-structured programs generally lower to
reasonable batched solutions, even if they do not achieve optimal batching
layouts. For common operations such as matrix-vector or matrix-matrix
multiplications, state-of-the-art approaches require advanced packing schemes
that might map elements into the ciphertext vector in non-trivial ways (e.g.,
diagonal-major and/or replicated). The current SIMD vectorizer will never change
the arrangement of elements inside an input tensor and therefore cannot produce
the optimal approaches for these operations.</p><p>Note, that the SIMD batching optimization is different from, and significantly
more complex than, the Straight Line Vectorizer (<code>-straight-line-vectorize</code>
pass), which simply groups
<a href=https://mlir.llvm.org/docs/Traits/#elementwisemappable>ElementwiseMappable</a>
operations that agree in operation name and operand/result types into
vectorized/tensorized versions.</p><h2 id=implementation>Implementation</h2><p>Below, we give a brief overview over the implementation, with the goal of both
improving maintainability/extensibility of the SIMD vectorizer and allowing
advanced users to better understand why a certain program is transformed in the
way it is.</p><h3 id=components>Components</h3><p>The <code>-heir-simd-vectorizer</code> pipeline uses a combination of standard MLIR passes
(<a href=https://mlir.llvm.org/docs/Passes/#-canonicalize><code>-canonicalize</code></a>,
<a href=https://mlir.llvm.org/docs/Passes/#-cse><code>-cse</code></a>,
<a href=https://mlir.llvm.org/docs/Passes/#-sccp><code>-sccp</code></a>) and custom HEIR passes.
Some of these
(<a href=https://heir.dev/docs/passes/applyfolderspasses/#-apply-folders><code>-apply-folders</code></a>,
<a href=https://heir.dev/docs/passes/fullloopunrollpasses/#-full-loop-unroll><code>-full-loop-unroll</code></a>)
might have applications outside the SIMD optimization, while others
(<a href=https://heir.dev/docs/passes/tensorextpasses/#-insert-rotate><code>-insert-rotate</code></a>,
<a href=https://heir.dev/docs/passes/tensorextpasses/#-collapse-insertion-chains><code>-collapse-insertion-chains</code></a>
and
<a href=https://heir.dev/docs/passes/tensorextpasses/#-rotate-and-reduce><code>-rotate-and-reduce</code></a>)
are very specific to the FHE SIMD optimization. In addition, the passes make use
of the <code>RotationAnalysis</code> and <code>TargetSlotAnalysis</code> analyses.</p><h3 id=high-level-flow>High-Level Flow</h3><ul><li><p><strong>Loop Unrolling</strong> (<code>-full-loop-unroll</code>): The implementation currently begins
by unrolling all loops in the program to simplify the later passes. See
<a href=https://github.com/google/heir/issues/589>#589</a> for a discussion on how this
could be avoided.</p></li><li><p><strong>Canonicalization</strong> (<code>-apply-folders -canonicalize</code>): As the
rotation-specific passes are very strict about the structure of the IR they
operate on, we must first simplify away things such as tensors of constant
values. For performance reasons (c.f. comments in the
<code>heirSIMDVectorizerPipelineBuilder</code> function in <code>heir-opt.cpp</code>), this must be
done by first applying
<a href=https://mlir.llvm.org/docs/Canonicalization/#canonicalizing-with-the-fold-method>folds</a>
before applying the full
<a href=https://mlir.llvm.org/docs/Canonicalization/>canonicalization</a>.</p></li><li><p><strong>Main SIMD Rewrite</strong> (<code>-insert-rotate -cse -canonicalize -cse</code>): This pass
rewrites arithmetic operations over <code>tensor.extract</code>-ed operands into SIMD
operations over the entire tensor, rotating the (full-tensor) operands so that
the correct elements interact. For example, it will rewrite the following
snippet (which computes <code>t2[4] = t0[3] + t1[5]</code>)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%t0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#a40000>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>insert</span> <span style=color:#000>%2</span> <span style=color:#a40000>in</span><span style=color:#204a87;font-weight:700>to</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%t0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c31</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>i.e., rotating <code>t0</code> down by one (31 = -1 (mod 32)) and <code>t1</code> up by one to bring
the elements at index 3 and 5, respectively, to the &ldquo;target&rdquo; index 4. The pass
uses the <code>TargetSlotAnalysis</code> to identify the appropriate target index (or
ciphertext &ldquo;slot&rdquo; in FHE-speak). See <a href=#insert-rotate-pass>Insert Rotate Pass</a>
below for more details. This pass is roughly equivalent to the <code>-batching</code>
pass in the original HECO implementation.</p><p>Doing this rewrite by itself does not represent an optimization, but if we
consider what happens to the corresponding code for other indices (e.g.,
<code>t2[5] = t0[4] + t1[6]</code>), we see that the pass transforms expressions with the
same relative index offsets into the exact same set of rotations/SIMD
operations, so the following
<a href=https://en.wikipedia.org/wiki/Common_subexpression_elimination>Common Subexpression Elimination (CSE)</a>
will remove redundant computations. We apply CSE twice, once directly (which
creates new opportunities for canonicalization and folding) and then again
after that canonicalization. See
<a href=#tensorext-canonicalization>TensorExt Canonicalization</a> for a description of
the rotation-specific canonocalization patterns).</p></li><li><p><strong>Cleanup of Redundant Insert/Extract</strong>
(<code>-collapse-insertion-chains -sccp -canonicalize -cse</code>): Because the
<code>-insert-rotate</code> pass maintains the consistency of the IR, it emits a
<code>tensor.extract</code> operation after the SIMD operation and uses that to replace
the original operation (which is valid, as both produce the desired scalar
result). As a consequence, the generated code for the snippet above is
actually trailed by a (redundant) extract/insert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>insert</span> <span style=color:#000>%extracted</span> <span style=color:#a40000>in</span><span style=color:#204a87;font-weight:700>to</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In real code, this might generate a long series of such extraction/insertion
operations, all extracting from the same (due to CSE) tensor and inserting
into the same output tensor. Therefore, the <code>-collapse-insertion-chains</code> pass
searches for such chains over entire tensors and collapses them. It supports
not just chains where the indices match perfectly, but any chain where the
relative offset is consistent across the tensor, issuing a rotation to realize
the offset (if the offset is zero, the canonicalization will remove the
redundant rotation). Note, that in HECO, insertion/extraction is handled
differently, as HECO features a <code>combine</code> operation modelling not just simple
insertions (<code>combine(%t0#j, %t1)</code>) but also more complex operations over
slices of tensors (<code>combine(%t0#[i,j], %t1)</code>). As a result, the equivalent
pass in HECO (<code>-combine-simplify</code>) instead joins different <code>combine</code>
operations, and a later fold removes <code>combines</code> that replace the entire target
tensor. See issue <a href=https://github.com/google/heir/issues/512>#512</a> for a
discussion on why the <code>combine</code> operation is a more powerful framework and
what would be necessary to port it to HEIR.</p></li><li><p><strong>Applying Rotate-and-Reduce Patterns</strong>
(<code>-rotate-and-reduce -sccp -canonicalize -cse</code>): The rotate and reduce pattern
(see <a href=#representing-fhe-simd-operations>Representing FHE SIMD Operations</a> for
an example) is an important aspect of accelerating SIMD-style operations in
FHE, but it does not follow automatically from the batching rewrites applied
so far. As a result, the <code>-rotate-and-reduce</code> pass needs to search for
sequences of arithmetic operations that correspond to the full folding of a
tensor, i.e., patterns such as <code>t[0]+(t[1]+(t[2]+t[3]+(...)))</code>, which
currently uses a backwards search through the IR, but could be achieved more
efficiently through a data flow analysis (c.f. issue
<a href=https://github.com/google/heir/issues/523>#532</a>). In HECO, rotate-and-reduce
is handled differently, by identifying sequences of compatible operations
prior to batching and rewriting them to &ldquo;n-ary&rdquo; operations. However, this
approach requires non-standard arithmetic operations and is therefore not
suitable for use in HEIR. However, there is likely still an opportunity to
make the patterns in HEIR more robust/general (e.g., support constant scalar
operands in the fold, or support non-full-tensor folds). See issue
<a href=https://github.com/google/heir/issues/522>#522</a> for ideas on how to make the
HEIR pattern more robust/more general.</p></li></ul><h3 id=insert-rotate-pass>Insert Rotate Pass</h3><p>TODO(#721): Write a detailed description of the rotation insertion pass and the
associated target slot analysis.</p><h3 id=tensorext-canonicalization>TensorExt Canonicalization</h3><p>The
<a href=https://heir.dev/docs/dialects/tensorext/>TensorExt (<code>tensor_ext</code>) Dialect</a>
includes a series of canonicalization rules that are essential to making
automatically generated rotation code efficient:</p><ul><li><p>Rotation by zero: <code>rotate %t, 0</code> folds away to <code>%t</code></p></li><li><p>Cyclical wraparound: <code>rotate %t, k</code> for $k > t.size$ can be simplified to
<code>rotate %t, (k mod t.size)</code></p></li><li><p>Sequential rotation: <code>%0 = rotate %t, k</code> followed by <code>%1 = rotate %0, l</code> is
simplified to <code>rotate %t (k+l)</code></p></li><li><p>Extraction: <code>%0 = rotate %t, k</code> followed by <code>%1 = tensor.extract %0[l]</code> is
simplified to <code>tensor.extract %t[k+l]</code></p></li><li><p>Binary Arithmetic Ops: where both operands to a binary <code>arith</code> operation are
rotations by the same amount, the rotation can be performed only once, on the
result. For Example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div><p>can be simplified to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%t2</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span></code></pre></div></li><li><p><em>Sandwiched</em> Binary Arithmetic Ops: If a rotation follows a binary <code>arith</code>
operation which has rotation as its operands, the post-arith operation can be
moved forward. For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>y</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>z</span>
</span></span></code></pre></div><p>can be simplified to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#a40000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>y</span> <span style=color:#a40000>+</span> <span style=color:#a40000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div></li><li><p>Single-Use Arithmetic Ops: Finally, there is a pair of rules that do not
eliminate rotations, but move rotations up in the IR, which can help in
exposing further canonicalization and/or CSE opportunities. These only apply
to <code>arith</code> operations with a single use, as they might otherwise increase the
total number of rotations. For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%t2</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>l</span>
</span></span></code></pre></div><p>can be equivalently rewritten as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#a40000>k+l</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>l</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div><p>and a similar pattern exists for situations where the rotation is the rhs
operand of the arithmetic operation.</p></li></ul><p>Note that the index computations in the patterns above (e.g., <code>k+l</code>,
<code>k mod t.size</code> are realized via emitting <code>arith</code> operations. However, for
constant/compile-time-known indices, these will be subsequently constant-folded
away by the canonicalization pass.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cd22aa05be277ba6c2e2f8f083706b51>5.4 - Optimizing relinearization</h1><p>This document outlines the integer linear program model used in the
<a href=https://heir.dev/docs/passes/optimizerelinearizationpasses/#-optimize-relinearization><code>optimize-relinearization</code></a>
pass.</p><h2 id=background>Background</h2><p>In vector/arithmetic FHE, RLWE ciphertexts often have the form $\mathbf{c} =
(c_0, c_1)$, where the details of how $c_0$ and $c_1$ are computed depend on the
specific scheme. However, in most of these schemes, the process of decryption
can be thought of as taking a dot product between the vector $\mathbf{c}$ and a
vector $(1, s)$ containing the secret key $s$ (followed by rounding).</p><p>In such schemes, the homomorphic multiplication of two ciphertexts $\mathbf{c}
= (c_0, c_1)$ and $\mathbf{d} = (d_0, d_1)$ produces a ciphertext $\mathbf{f}
= (f_0, f_1, f_2)$. This triple can be decrypted by taking a dot product with
$(1, s, s^2)$.</p><p>With this in mind, each RLWE ciphertext $\mathbf{c}$ has an associated <em>key
basis</em>, which is the vector $\mathbf{s_c}$ whose dot product with $\mathbf{c}$
decrypts it.</p><p>Usually a larger key basis is undesirable. For one, operations in a higher key
basis are more expensive and have higher rates of noise growth. Repeated
multiplications exponentially increase the length of the key basis. So to avoid
this, an operation called <em>relinearization</em> was designed that converts a
ciphertext from a given key basis back to $(1, s)$. Doing this requires a set of
<em>relinearization keys</em> to be provided by the client and stored by the server.</p><p>In general, key bases can be arbitrary. Rotation of an RLWE ciphertext by a
shift of $k$, for example, first applies the automorphism $x \mapsto x^k$. This
converts the key basis from $(1, s)$ to $(1, s^k)$, and more generally maps $(1,
s, s^2, \dots, s^d) \mapsto (1, s^k, s^{2k}, \dots, s^{kd})$. Most FHE
implementations post-compose this automorphism with a key switching operation to
return to the linear basis $(1, s)$. Similarly, multiplication can be defined
for two key bases $(1, s^n)$ and $(1, s^m)$ (with $n &lt; m$) to produce a key
basis $(1, s^n, s^m, s^{n+m})$. By a combination of multiplications and
rotations (without ever relinearizing or key switching), ciphertexts with a
variety of strange key bases can be produced.</p><p>Most FHE implementations do not permit wild key bases because each key switch
and relinearization operation (for each choice of key basis) requires additional
secret key material to be stored by the server. Instead, they often enforce that
rotation has key-switching built in, and multiplication relinearizes by default.</p><p>That said, many FHE implementations do allow for the relinearization operation
to be deferred. A useful such situation is when a series of independent
multiplications are performed, and the results are added together. Addition can
operate in any key basis (though all inputs must have the same key basis), and
so the relinearization op that follows each multiplication can be deferred until
after the additions are complete, at which point there is only one
relinearization to perform. This technique is usually called <em>lazy
relinearization</em>. It has the benefit of avoiding expensive relinearization
operations, as well as reducing noise growth, as relinearization adds noise to
the ciphertext, which can further reduce the need for bootstrapping.</p><p>In much of the literature, lazy relinearization is applied manually. See for
example
<a href=https://eprint.iacr.org/2019/223>Blatt-Gusev-Polyakov-Rohloff-Vaikuntanathan 2019</a>
and <a href=https://eprint.iacr.org/2020/1549>Lee-Lee-Kim-Kim-No-Kang 2020</a>. In some
compiler projects, such as the <a href=https://eprint.iacr.org/2021/1505>EVA compiler</a>
relinearization is applied automatically via a heuristic, either &ldquo;eagerly&rdquo;
(immediately after each multiplication op) or &ldquo;lazily,&rdquo; deferred as late as
possible.</p><h2 id=the-optimize-relinearization-pass>The <code>optimize-relinearization</code> pass</h2><p>In HEIR, relinearization placement is implemented via a mixed-integer linear
program (ILP). It is intended to be more general than a lazy relinearization
heuristic, and certain parameter settings of the ILP reproduce lazy
relinearization.</p><p>The <code>optimize-relinearization</code> pass starts by deleting all relinearization
operations from the IR, solves the ILP, and then inserts relinearization ops
according to the solution. This implies that the input IR to the ILP has no
relinearization ops in it already.</p><h2 id=model-specification>Model specification</h2><p>The ILP model fits into a family of models that is sometimes called
&ldquo;state-dynamics&rdquo; models, in that it has &ldquo;state&rdquo; variables that track a quantity
that flows through a system, as well as &ldquo;decision&rdquo; variables that control
decisions to change the state at particular points. A brief overview of state
dynamics models can be found
<a href=https://buttondown.com/j2kun/archive/modeling-state-in-linear-programs/>here</a></p><p>In this ILP, the &ldquo;state&rdquo; value is the degree of the key basis. I.e., rather than
track the entire key basis, we assume the key basis always has the form $(1, s,
s^2, \dots, s^k)$ and track the value $k$. The index tracking state is SSA
value, and the decision variables are whether to relinearize.</p><h3 id=variables>Variables</h3><p>Define the following variables:</p><ul><li>For each operation $o$, $R_o \in { 0, 1 }$ defines the decision to
relinearize the result of operation $o$. Relinearization is applied if and
only if $R_o = 1$.</li><li>For each SSA value $v$, $\textup{KB}_v$ is a continuous variable
representing the degree of the key basis of $v$. For example, if the key basis
of a ciphertext is $(1, s)$, then $\textup{KB}_v = 1$. If $v$ is the result
of an operation $o$, $\textup{KB}_v$ is the key basis of the result of $o$
<em>after</em> relinearization has been optionally applied to it, depending on the
value of the decision variable $R_o$.</li><li>For each SSA value $v$ that is an operation result, $\textup{KB}^{br}_v$ is
a continuous variable whose value represents the key basis degree of $v$
<em>before</em> relinearization is applied (<code>br</code> = &ldquo;before relin&rdquo;). These SSA values
are mainly for <em>after</em> the model is solved and relinearization operations need
to be inserted into the IR. Here, type conflicts require us to reconstruct the
key basis degree, and saving the values allows us to avoid recomputing the
values.</li></ul><p>Each of the key-basis variables is bounded from above by a parameter
<code>MAX_KEY_BASIS_DEGREE</code> that can be used to impose hard limits on the key basis
size, which may be required if generating code for a backend that does not
support operations over generalized key bases.</p><h3 id=objective>Objective</h3><p>The objective is to minimize the number of relinearization operations, i.e.,
$\min \sum_o R_o$.</p><p>TODO(#1018): update docs when objective is generalized.</p><h3 id=constraints>Constraints</h3><p>The simple constraints are as follows:</p><ul><li>Initial key basis degree: For each block argument, $\textup{KB}_v$ is fixed
to equal the <code>dimension</code> parameter on the RLWE ciphertext type.</li><li>Operand agreement: For each operation with operand SSA values $v_1, \dots,
v_k$, $\textup{KB}_{v_1} = \dots = \textup{KB}_{v_k}$, i.e., all key
basis inputs must match.</li><li>Special linearized ops: <code>bgv.rotate</code> and <code>func.return</code> require linearized
inputs, i.e., $\textup{KB}_{v_i} = 1$ for all inputs $v_i$ to these
operations.</li><li>Before relinearization key basis: for each operation $o$ with operands $v_1,
\dots, v_k$, constrain $\textup{KB}^{br}_{\textup{result}(o)} =
f(\textup{KB}_{v_1}, \dots, \textup{KB}_{v_k})$, where $f$ is a
statically known linear function. For multiplication $f$ it addition, and for
all other ops it is the projection onto any input, since multiplication is the
only op that increases the degree, and all operands are constrained to have
equal degree.</li></ul><p>The remaining constraints control the dynamics of how the key basis degree
changes as relinearizations are inserted.</p><p>They can be thought of as implementing this (non-linear) constraint for each
operation $o$:</p><p>\[ \textup{KB}_{\textup{result}(o)} = \begin{cases}
\textup{KB}^{br}_{\textup{result(o)}} & \text{ if } R_o = 0 \ 1 & \text{
if } R_o = 1 \end{cases} \]</p><p>Note that $\textup{KB}^{br}_{\textup{result}(o)}$ is constrained by one of
the simple constraints to be a linear expression containing key basis variables
for the operands of $o$. The conditional above cannot be implemented directly in
an ILP. Instead, one can implement it via four constraints that effectively
linearize (in the sense of making non-linear constraints linear) the multiplexer
formula</p><p>\[ \textup{KB}_{\textup{result}(o)} = (1 - R_o) \cdot
\textup{KB}^{br}_{\textup{result}(o)} + R_o \cdot 1 \]</p><p>(Note the above is not linear because in includes the product of two variables.)
The four constraints are:</p><p>\[ \begin{aligned} \textup{KB}_\textup{result}(o) &\geq \textup{ R}_o
\\
\textup{KB}\_\textup{result}(o) &\leq 1 + C(1  \textup{R}_o)
\\
\textup{KB}_\textup{result}(o) &\geq
\textup{KB}^{br}_{\textup{result}(o)}  C \textup{ R}_o
\\
\textup{KB}_\textup{result}(o) &\leq
\textup{KB}^{br}_{\textup{result}(o)} + C \textup{ R}_o \\
\end{aligned}
\]</p><p>Here $C$ is a constant that can be set to any value larger than
<code>MAX_KEY_BASIS_DEGREE</code>. We set it to 100.</p><p>Setting $R_o = 0$ makes constraints 1 and 2 trivially satisfied, while
constraints 3 and 4 enforce the equality $\textup{KB}_{\textup{result}(o)} =
\textup{KB}^{br}_{\textup{result}(o)}$. Likewise, setting $R_o = 1$ makes
constraints 3 and 4 trivially satisfied, while constraints 1 and 2 enforce the
equality $\textup{KB}_{\textup{result}(o)} = 1$.</p><h2 id=notes>Notes</h2><ul><li>ILP performance scales roughly with the number of integer variables. The
formulation above only requires the decision variable to be integer, and the
initialization and constraints effectively force the key basis variables to be
integer. As a result, the solve time of the above ILP should scale with the
number of ciphertext-handling ops in the program.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-db9ac78ce08367ea2b7db8c1412049b6>6 - Pipelines</h1><h2 id=heir-opt><code>heir-opt</code></h2><h3 id=--heir-simd-vectorizer><code>--heir-simd-vectorizer</code></h3><p>Run scheme-agnostic passes to convert FHE programs that operate on scalar types
to equivalent programs that operate on vectors.</p><p>This pass is intended to process FHE programs that are known to be good for
SIMD, but a specific FHE scheme has not yet been chosen. It expects to handle
<code>arith</code> ops operating on <code>tensor</code> types (with or without <code>secret.generic</code>).</p><p>The pass unrolls all loops, then applies a series of passes that convert scalar
operations on tensor elements to SIMD operations on full tensors. This uses the
FHE computational model common to BGV, BFV, and CKKS, in which data is packed in
polynomial ciphertexts, interpreted as vectors of individual data elements, and
arithmetic can be applied across entire ciphertexts, with some limited support
for rotations via automorphisms of the underlying ring.</p><p>Along the way, this pipeline applies heuristic optimizations to minimize the
number of rotations needed, relying on the implicit cost model that rotations
are generally expensive. The specific set of passes can be found in
<code>tools/heir-opt.cpp</code> where the pipeline is defined.</p><h3 id=--heir-tosa-to-arith><code>--heir-tosa-to-arith</code></h3><p>Lowers a TOSA MLIR model to <code>func</code>, <code>arith</code>, and <code>memref</code>.</p><p>Lowers from TOSA through <code>linalg</code> and <code>affine</code>, and converts all tensors to
memrefs. Fully unrolls all loops, and forwards stores to subsequent loads
whenever possible. The output is suitable as an input to
<code>heir-translate --emit-verilog</code>. Retains <code>affine.load</code> and <code>affine.store</code> ops
that cannot be removed (e.g., reading from the input and writing to the output,
or loading from a memref with a variable index).</p><p>The pass pipeline assumes that the input is a valid TOSA MLIR model with
stripped quantized types. The
<a href=https://iree.dev/guides/ml-frameworks/tflite>iree-import-tflite</a> tool can
lower a TFLite FlatBuffer to textual MLIR with <code>--output-format=mlir-ir</code>. See
<a href=https://github.com/google/heir/blob/main/tests/Emitter/verilog/hello_world.tosa.mlir>hello_world.tosa.mlir</a>
for an example.</p><h3 id=--yosys-optimizer><code>--yosys-optimizer</code></h3><p>Uses Yosys to booleanize and optimize MLIR functions.</p><p>This pass pipeline requires inputs to be in standard MLIR (<code>arith</code>, <code>affine</code>,
<code>func</code>, <code>memref</code>). The pass imports the model to Yosys and runs passes to
booleanize the circuit and then uses ABC to perform optimizations. We use
standard LUT 3 cells. THe output of this pass includes <code>arith</code> constants and
<code>comb.truth_table</code> ops.</p><p>The pass requires that the environment variable <code>HEIR_ABC_BINARY</code> contains the
location of the ABC binary and that <code>HEIR_YOSYS_SCRIPTS_DIR</code> contains the
location of the Yosys&rsquo; techlib files that are needed to execute the path.</p><p>This pass can be disabled by defining <code>HEIR_NO_YOSYS</code>; this will avoid Yosys
library and ABC binary compilation, and avoid registration of this pass.</p><h3 id=--tosa-to-boolean-tfhe><code>--tosa-to-boolean-tfhe</code></h3><p>This is an experimental pipeline for end-to-end private inference.</p><p>Converts a TOSA MLIR model to tfhe_rust dialect defined by HEIR. It converts a
tosa model to optimized boolean circuit using Yosys ABC optimizations. The
resultant optimized boolean circuit in comb dialect is then converted to cggi
and then to tfhe_rust exit dialect. This pipeline can be used with
heir-translate &ndash;emit-tfhe-rust to generate code for
<a href=https://docs.zama.ai/tfhe-rs><code>tfhe-rs</code></a> FHE library.</p><p>The pass requires that the environment variable <code>HEIR_ABC_BINARY</code> contains the
location of the ABC binary and that <code>HEIR_YOSYS_SCRIPTS_DIR</code> contains the
location of the Yosys&rsquo; techlib files that are needed to execute the path.</p><h2 id=heir-translate><code>heir-translate</code></h2><h3 id=--emit-tfhe-rust><code>--emit-tfhe-rust</code></h3><p>Code generation for the <a href=https://docs.zama.ai/tfhe-rs><code>tfhe-rs</code></a> FHE library.
The library is based on the CGGI cryptosystem, and so this pass is most useful
when paired with lowerings from the <code>cggi</code> dialect.</p><p>The version of <code>tfhe-rs</code> supported is defined in the
<a href=https://github.com/google/heir/tree/main/tests/Examples/tfhe_rust/Cargo.toml>end to end <code>tfhe_rust</code> tests</a>.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>sks =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>server_key
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>lut =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>lookup_table
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>eui3 =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>eui3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%sks</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3 <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%v1</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>apply_lookup_table <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%v2</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%v3</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>scalar_left_shift <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%v4</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>apply_lookup_table <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%v4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tfhe</span>::<span style=color:#000>shortint</span>::<span style=color:#000>prelude</span>::<span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>pub</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>test_apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v9</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>ServerKey</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v10</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>LookupTableOwned</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v11</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>Ciphertext</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>Ciphertext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v4</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v5</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>unchecked_add</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v4</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v6</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v7</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scalar_left_shift</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v6</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v8</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note, the chosen variable names are arbitrary, and the resulting program still
must be integrated with a larger Rust program.</p><h3 id=--emit-verilog><code>--emit-verilog</code></h3><p>Code generation for verilog from <code>arith</code> and <code>memref</code>. Expects a single top
level <code>func.func</code> op as the entry point, which is converted to the output
verilog module.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sge<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>shrsi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>shrui <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%out</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>trunci <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> to <span style=color:#204a87;font-weight:700>i8</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%out</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-verilog data-lang=verilog><span style=display:flex><span><span style=color:#204a87;font-weight:700>module</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>input</span> <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>output</span> <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>_out_</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v5</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v6</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v7</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v8</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v9</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#000>v10</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v11</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v12</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v13</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v14</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v4</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v5</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{{</span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>]}},</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>v5</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v11</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v12</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v13</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v14</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v12</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>_out_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v14</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>endmodule</span>
</span></span></code></pre></div><h3 id=--emit-metadata><code>--emit-metadata</code></h3><p>Prints a json object describing the function signatures. Used for code
generation after <code>--emit-verilog</code>.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>80x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;functions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;params&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;index&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;memref&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;element_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;integer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                  <span style=color:#204a87;font-weight:700>&#34;is_signed&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#204a87;font-weight:700>&#34;width&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;shape&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;return_types&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;memref&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;element_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;integer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;is_signed&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;width&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;shape&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}]</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-590f1588f601079eeacfc7cb11dc5115>7 - Dialects</h1><p>This section contains the reference documentation for all of the dialects
defined in HEIR.</p></div><div class=td-content><h1 id=pg-7a2d769a54237b8d0845fe32a6451c2b>7.1 - BGV</h1><h1 id=bgv-dialect>&lsquo;bgv&rsquo; Dialect</h1><p>The BGV dialect defines the types and operations of the BGV cryptosystem.</p><h2 id=bgv-ops>BGV ops</h2><h3 id=bgvadd-heirbgvaddop><code>bgv.add</code> (heir::bgv::AddOp)</h3><p><em>Addition operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.add` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvadd_plain-heirbgvaddplainop><code>bgv.add_plain</code> (heir::bgv::AddPlainOp)</h3><p><em>Addition operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.add_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvextract-heirbgvextractop><code>bgv.extract</code> (heir::bgv::ExtractOp)</h3><p><em>Extract the i-th element of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.extract` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>While this operation is costly to compute in FHE, we represent it so we can
implement efficient lowerings and folders.</p><p>This op can be implemented as a plaintext multiplication with a one-hot
vector and a rotate into the zero-th index.</p><p>An extraction op&rsquo;s input ciphertext type is asserted to have an <code>underlying_type</code>
corresponding to a ranked tensor type, and this op&rsquo;s return type is
inferred to have the <code>underlying_type</code> corresponding to the element type of
that tensor type.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>offset</code></td><td>signless integer or index</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvmodulus_switch-heirbgvmodulusswitchop><code>bgv.modulus_switch</code> (heir::bgv::ModulusSwitchOp)</h3><p><em>Lower the modulus level of the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.modulus_switch` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>to_ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvmul-heirbgvmulop><code>bgv.mul</code> (heir::bgv::MulOp)</h3><p><em>Multiplication operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.mul` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvmul_plain-heirbgvmulplainop><code>bgv.mul_plain</code> (heir::bgv::MulPlainOp)</h3><p><em>Multiplication operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.mul_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvnegate-heirbgvnegateop><code>bgv.negate</code> (heir::bgv::NegateOp)</h3><p><em>Negate the coefficients of the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.negate` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvrelinearize-heirbgvrelinearizeop><code>bgv.relinearize</code> (heir::bgv::RelinearizeOp)</h3><p><em>Relinearize the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.relinearize` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>This op takes integer array attributes <code>from_basis</code> and <code>to_basis</code> that are
used to indicate the key basis from which and to which the ciphertext is
encrypted against. A ciphertext is canonically encrypted against key basis
<code>(1, s)</code>. After a multiplication, its size will increase and the basis will be
<code>(1, s, s^2)</code>. The array that represents the key basis is constructed by
listing the powers of <code>s</code> at each position of the array. For example, <code>(1, s, s^2)</code> corresponds to <code>[0, 1, 2]</code>, while <code>(1, s^2)</code> corresponds to <code>[0, 2]</code>.</p><p>Traits: <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>from_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>to_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvrotate-heirbgvrotateop><code>bgv.rotate</code> (heir::bgv::RotateOp)</h3><p><em>Rotate the coefficients of the ciphertext using a Galois automorphism.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.rotate` operands attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvsub-heirbgvsubop><code>bgv.sub</code> (heir::bgv::SubOp)</h3><p><em>Subtraction operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.sub` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=bgvsub_plain-heirbgvsubplainop><code>bgv.sub_plain</code> (heir::bgv::SubPlainOp)</h3><p><em>Subtraction operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.sub_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-5f74537b9610a2b3f8ddf498be3d47b0>7.2 - CGGI</h1><h1 id=cggi-dialect>&lsquo;cggi&rsquo; Dialect</h1><p>A dialect for types and operations in the CGGI cryptosystem</p><h2 id=cggi-attributes>CGGI attributes</h2><h3 id=cggiboolgatesattr>CGGIBoolGatesAttr</h3><p>An attribute containing an array of strings to store bool gates</p><p>Syntax:</p><pre tabindex=0><code>#cggi.cggi_bool_gates&lt;
  ::llvm::ArrayRef&lt;::mlir::heir::cggi::CGGIBoolGateEnumAttr&gt;   # gates
&gt;
</code></pre><pre><code>This attributes stores a list of integer identifiers for Boolean gates.
</code></pre><p>Uses following mapping:
AND_GATE = 0;
NAND_GATE = 1;
OR_GATE = 2;
NOR_GATE = 3;
XOR_GATE = 4;
XNOR_GATE = 5;
NOT_GATE = 6;</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>gates</td><td style=text-align:center><code>::llvm::ArrayRef&lt;::mlir::heir::cggi::CGGIBoolGateEnumAttr></code></td><td></td></tr></tbody></table><h3 id=cggiparamsattr>CGGIParamsAttr</h3><p>Syntax:</p><pre tabindex=0><code>#cggi.cggi_params&lt;
  ::mlir::heir::lwe::RLWEParamsAttr,   # rlweParams
  unsigned,   # bsk_noise_variance
  unsigned,   # bsk_gadget_base_log
  unsigned,   # bsk_gadget_num_levels
  unsigned,   # ksk_noise_variance
  unsigned,   # ksk_gadget_base_log
  unsigned   # ksk_gadget_num_levels
&gt;
</code></pre><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rlweParams</td><td style=text-align:center><code>::mlir::heir::lwe::RLWEParamsAttr</code></td><td></td></tr><tr><td style=text-align:center>bsk_noise_variance</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>bsk_gadget_base_log</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>bsk_gadget_num_levels</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>ksk_noise_variance</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>ksk_gadget_base_log</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>ksk_gadget_num_levels</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h2 id=cggi-ops>CGGI ops</h2><h3 id=cggiand-heircggiandop><code>cggi.and</code> (heir::cggi::AndOp)</h3><p><em>Logical AND of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.and` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggilut2-heircggilut2op><code>cggi.lut2</code> (heir::cggi::Lut2Op)</h3><p><em>A lookup table on two inputs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut2` operands attr-dict `:` qualified(type($output))
</code></pre><p>An op representing a lookup table applied to some number <code>n</code> of ciphertexts
encrypting boolean input bits.</p><p>Over cleartext bits <code>a, b, c</code>, using <code>n = 3</code> for example, the operation
computed by this function can be interpreted as</p><pre tabindex=0><code>  truth_table &gt;&gt; {c, b, a}
</code></pre><p>where <code>{c, b, a}</code> is the unsigned 3-bit integer with bits <code>c, b, a</code> from most
significant bit to least-significant bit. The input are combined into a
single ciphertext input to the lookup table using products with plaintexts
and sums.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>b</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>a</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggilut3-heircggilut3op><code>cggi.lut3</code> (heir::cggi::Lut3Op)</h3><p><em>A lookup table on three inputs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut3` operands attr-dict `:` qualified(type($output))
</code></pre><p>An op representing a lookup table applied to some number <code>n</code> of ciphertexts
encrypting boolean input bits.</p><p>Over cleartext bits <code>a, b, c</code>, using <code>n = 3</code> for example, the operation
computed by this function can be interpreted as</p><pre tabindex=0><code>  truth_table &gt;&gt; {c, b, a}
</code></pre><p>where <code>{c, b, a}</code> is the unsigned 3-bit integer with bits <code>c, b, a</code> from most
significant bit to least-significant bit. The input are combined into a
single ciphertext input to the lookup table using products with plaintexts
and sums.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>c</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>b</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>a</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggilut_lincomb-heircggilutlincombop><code>cggi.lut_lincomb</code> (heir::cggi::LutLinCombOp)</h3><p><em>A variadic-input lookup table with inputs prepared via linear combination.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut_lincomb` operands attr-dict `:` type($output)
</code></pre><p>An op representing a lookup table applied to an arbitrary number of
input ciphertexts, which are combined according to a static linear
combination attached to the op.</p><p>The user must ensure the chosen linear combination does not bleed error
bits into the message space according to the underlying ciphertext&rsquo;s
encoding attributes. E.g., a bit_field_encoding with 3 cleartext bits
cannot be multiplied by 16.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.bit_field_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.lwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>7917</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ciphertext =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>lwe_params =</span> <span style=color:#000>#params</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>lut_lincomb <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>coefficients =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>lookup_table =</span> <span style=color:#0000cf;font-weight:700>68</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ciphertext
</span></span></code></pre></div><p>Represents applying the lut</p><pre tabindex=0><code>  68 &gt;&gt; (1 * c0 + 2 * c1 + 3 * c2 + 2 * c3)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=cggimulti_lut_lincomb-heircggimultilutlincombop><code>cggi.multi_lut_lincomb</code> (heir::cggi::MultiLutLinCombOp)</h3><p><em>A multi-output version of lut_lincomb with one LUT per output.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.multi_lut_lincomb` operands attr-dict `:` functional-type($inputs, $outputs)
</code></pre><p>An op representing multiple lookup tables applied to a shared input, which
is prepared via a static linear combination. This is equivalent to
<code>cggi.lut_lincomb</code>, but where the linear combination is given to multiple
lookup tables, each producing a separate output.</p><p>This can be achieved by a special implementation of blind rotate in the CGGI
scheme. See <a href=https://ieeexplore.ieee.org/document/10413195>AutoHoG</a>.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.bit_field_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.lwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>7917</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ciphertext =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>lwe_params =</span> <span style=color:#000>#params</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>multi_lut_lincomb <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>coefficients =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>lookup_tables =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>68</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>70</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Represents applying the following LUTs. Performance-wise, this is
comparable to applying a single LUT to a linear combination.</p><pre tabindex=0><code>x = (1 * c0 + 2 * c1 + 3 * c2 + 2 * c3)
return (
  (68 &gt;&gt; x) &amp; 1,
  (70 &gt;&gt; x) &amp; 1,
  (4 &gt;&gt; x) &amp; 1,
  (8 &gt;&gt; x) &amp; 1
)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>lookup_tables</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of A type for LWE ciphertexts</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>outputs</code></td><td>variadic of A type for LWE ciphertexts</td></tr></tbody></table><h3 id=cgginand-heircgginandop><code>cggi.nand</code> (heir::cggi::NandOp)</h3><p><em>Logical NAND of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.nand` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cgginor-heircgginorop><code>cggi.nor</code> (heir::cggi::NorOp)</h3><p><em>Logical NOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.nor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cgginot-heircgginotop><code>cggi.not</code> (heir::cggi::NotOp)</h3><p><em>Logical NOT of two ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.not` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggior-heircggiorop><code>cggi.or</code> (heir::cggi::OrOp)</h3><p><em>Logical OR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.or` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggipacked_lut3-heircggipackedlut3op><code>cggi.packed_lut3</code> (heir::cggi::PackedLut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.packed_lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_tables</code></td><td>::mlir::ArrayAttr</td><td>Array of integers</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>b</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>c</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggipacked_gates-heircggipackedop><code>cggi.packed_gates</code> (heir::cggi::PackedOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.packed_gates` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Operation to where different Boolean gates are executed pairwise between elements of two ciphertext arrays.</p><p>For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>packed_gates <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>gates =</span> <span style=color:#000>#cggi.cggi_gate</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;and&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xor&#34;</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>applies an &ldquo;and&rdquo; gate to the first elements of %a and %b and an xor gate to the
second elements.</p><p>Mapping is defined in the BooleanGates.td file.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>gates</code></td><td>::mlir::heir::cggi::CGGIBoolGatesAttr</td><td>An attribute containing an array of strings to store bool gates</td></tr></table><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggixnor-heircggixnorop><code>cggi.xnor</code> (heir::cggi::XNorOp)</h3><p><em>Logical XNOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.xnor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=cggixor-heircggixorop><code>cggi.xor</code> (heir::cggi::XorOp)</h3><p><em>Logical XOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.xor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h2 id=cggi-additional-definitions>CGGI additional definitions</h2><h3 id=affinemapattr>AffineMapAttr</h3><p>An Attribute containing an AffineMap object</p><p>Syntax:</p><pre tabindex=0><code>affine-map-attribute ::= `affine_map` `&lt;` affine-map `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>AffineMap</code></td><td></td></tr></tbody></table><h3 id=arrayattr>ArrayAttr</h3><p>A collection of other Attribute values</p><p>Syntax:</p><pre tabindex=0><code>array-attribute ::= `[` (attribute-value (`,` attribute-value)*)? `]`
</code></pre><p>An array attribute is an attribute that represents a collection of attribute
values.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;Attribute></code></td><td></td></tr></tbody></table><h3 id=densearrayattr>DenseArrayAttr</h3><p>A dense array of integer or floating point elements.</p><p>A dense array attribute is an attribute that represents a dense array of
primitive element types. Contrary to DenseIntOrFPElementsAttr this is a
flat unidimensional array which does not have a storage optimization for
splat. This allows to expose the raw array through a C++ API as
<code>ArrayRef&lt;T></code> for compatible types. The element type must be bool or an
integer or float whose bitwidth is a multiple of 8. Bool elements are stored
as bytes.</p><p>This is the base class attribute. Access to C++ types is intended to be
managed through the subclasses <code>DenseI8ArrayAttr</code>, <code>DenseI16ArrayAttr</code>,
<code>DenseI32ArrayAttr</code>, <code>DenseI64ArrayAttr</code>, <code>DenseF32ArrayAttr</code>,
and <code>DenseF64ArrayAttr</code>.</p><p>Syntax:</p><pre tabindex=0><code>dense-array-attribute ::= `array` `&lt;` (integer-type | float-type)
                                      (`:` tensor-literal)? `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>.,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>.&gt;</span>
</span></span></code></pre></div><p>When a specific subclass is used as argument of an operation, the
declarative assembly will omit the type and print directly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>size</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>::llvm::ArrayRef&lt;char></code></td><td>64-bit aligned storage for dense array elements</td></tr></tbody></table><h3 id=denseintorfpelementsattr>DenseIntOrFPElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of integer or floating-point values</p><p>Syntax:</p><pre tabindex=0><code>tensor-literal ::= integer-literal | float-literal | bool-literal | [] | [tensor-literal (, tensor-literal)* ]
dense-intorfloat-elements-attribute ::= `dense` `&lt;` tensor-literal `&gt;` `:`
                                        ( tensor-type | vector-type )
</code></pre><p>A dense int-or-float elements attribute is an elements attribute containing
a densely packed vector or tensor of integer or floating-point values. The
element type of this attribute is required to be either an <code>IntegerType</code> or
a <code>FloatType</code>.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of integer values.
dense&lt;10&gt; : tensor&lt;2xi32&gt;
// A tensor of 2 float32 elements.
dense&lt;[10.0, 11.0]&gt; : tensor&lt;2xf32&gt;
</code></pre><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>ArrayRef&lt;char></code></td><td></td></tr></tbody></table><h3 id=denseresourceelementsattr>DenseResourceElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array backed by a resource</p><p>Syntax:</p><pre tabindex=0><code>dense-resource-elements-attribute ::=
  `dense_resource` `&lt;` resource-handle `&gt;` `:` shaped-type
</code></pre><p>A dense resource elements attribute is an elements attribute backed by a
handle to a builtin dialect resource containing a densely packed array of
values. This class provides the low-level attribute, which should only be
interacted with in very generic terms, actual access to the underlying
resource data is intended to be managed through one of the subclasses, such
as; <code>DenseBoolResourceElementsAttr</code>, <code>DenseUI64ResourceElementsAttr</code>,
<code>DenseI32ResourceElementsAttr</code>, <code>DenseF32ResourceElementsAttr</code>,
<code>DenseF64ResourceElementsAttr</code>, etc.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;example.user_op&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr =</span> dense_resource<span style=color:#000;font-weight:700>&lt;</span>blob1<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#a40000>-#</span>
</span></span><span style=display:flex><span>dialect_resources<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    builtin<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      blob1<span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;0x08000000010000000000000002000000000000000300000000000000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#a40000>#-</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawHandle</td><td style=text-align:center><code>DenseResourceElementsHandle</code></td><td></td></tr></tbody></table><h3 id=densestringelementsattr>DenseStringElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of strings</p><p>Syntax:</p><pre tabindex=0><code>dense-string-elements-attribute ::= `dense` `&lt;` attribute-value `&gt;` `:`
                                    ( tensor-type | vector-type )
</code></pre><p>A dense string elements attribute is an elements attribute containing a
densely packed vector or tensor of string values. There are no restrictions
placed on the element type of this attribute, enabling the use of dialect
specific string types.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of strings.
dense&lt;&#34;example&#34;&gt; : tensor&lt;2x!foo.string&gt;
// A tensor of 2 string elements.
dense&lt;[&#34;example1&#34;, &#34;example2&#34;]&gt; : tensor&lt;2x!foo.string&gt;
</code></pre><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>ArrayRef&lt;StringRef></code></td><td></td></tr></tbody></table><h3 id=dictionaryattr>DictionaryAttr</h3><p>An dictionary of named Attribute values</p><p>Syntax:</p><pre tabindex=0><code>dictionary-attribute ::= `{` (attribute-entry (`,` attribute-entry)*)? `}`
</code></pre><p>A dictionary attribute is an attribute that represents a sorted collection of
named attribute values. The elements are sorted by name, and each name must be
unique within the collection.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr_name =</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>int_attr =</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attr name&#34;</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;NamedAttribute></code></td><td></td></tr></tbody></table><h3 id=floatattr>FloatAttr</h3><p>An Attribute containing a floating-point value</p><p>Syntax:</p><pre tabindex=0><code>float-attribute ::= (float-literal (`:` float-type)?)
                  | (hexadecimal-literal `:` float-type)
</code></pre><p>A float attribute is a literal attribute that represents a floating point
value of the specified <a href=#floating-point-types>float type</a>. It can be
represented in the hexadecimal form where the hexadecimal value is
interpreted as bits of the underlying binary representation. This form is
useful for representing infinity and NaN floating point values. To avoid
confusion with integer attributes, hexadecimal literals <em>must</em> be followed
by a float type to define a float attribute.</p><p>Examples:</p><pre tabindex=0><code>42.0         // float attribute defaults to f64 type
42.0 : f32   // float attribute of f32 type
0x7C00 : f16 // positive infinity
0x7CFF : f16 // NaN (one of possible values)
42 : f32     // Error: expected integer type
</code></pre><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::APFloat</code></td><td></td></tr></tbody></table><h3 id=integerattr>IntegerAttr</h3><p>An Attribute containing a integer value</p><p>Syntax:</p><pre tabindex=0><code>integer-attribute ::= (integer-literal ( `:` (index-type | integer-type) )?)
                      | `true` | `false`
</code></pre><p>An integer attribute is a literal attribute that represents an integral
value of the specified integer or index type. <code>i1</code> integer attributes are
treated as <code>boolean</code> attributes, and use a unique assembly format of either
<code>true</code> or <code>false</code> depending on the value. The default type for non-boolean
integer attributes, if a type is not specified, is signless 64-bit integer.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span>    <span style=color:#8f5902;font-style:italic>// : i64 is implied here.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>true  <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>false <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span></code></pre></div><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>APInt</code></td><td></td></tr></tbody></table><h3 id=integersetattr>IntegerSetAttr</h3><p>An Attribute containing an IntegerSet object</p><p>Syntax:</p><pre tabindex=0><code>integer-set-attribute ::= `affine_set` `&lt;` integer-set `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_set<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span>d0 <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters-11>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>IntegerSet</code></td><td></td></tr></tbody></table><h3 id=opaqueattr>OpaqueAttr</h3><p>An opaque representation of another Attribute</p><p>Syntax:</p><pre tabindex=0><code>opaque-attribute ::= dialect-namespace `&lt;` attr-data `&gt;`
</code></pre><p>Opaque attributes represent attributes of non-registered dialects. These are
attribute represented in their raw string form, and can only usefully be
tested for attribute equality.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#dialect</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;opaque attribute data&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-12>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>dialectNamespace</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>attrData</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=sparseelementsattr>SparseElementsAttr</h3><p>An opaque representation of a multi-dimensional array</p><p>Syntax:</p><pre tabindex=0><code>sparse-elements-attribute ::= `sparse` `&lt;` attribute-value `,`
                              attribute-value `&gt;` `:`
                              ( tensor-type | vector-type )
</code></pre><p>A sparse elements attribute is an elements attribute that represents a
sparse vector or tensor object. This is where very few of the elements are
non-zero.</p><p>The attribute uses COO (coordinate list) encoding to represent the sparse
elements of the elements attribute. The indices are stored via a 2-D tensor
of 64-bit integer elements with shape [N, ndims], which specifies the
indices of the elements in the sparse tensor that contains non-zero values.
The element values are stored via a 1-D tensor with shape [N], that supplies
the corresponding values for the indices.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>sparse<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This represents the following tensor:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///  [[1, 0, 0, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 5, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 0, 0]]
</span></span></span></code></pre></div><h4 id=parameters-13>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>indices</td><td style=text-align:center><code>DenseIntElementsAttr</code></td><td></td></tr><tr><td style=text-align:center>values</td><td style=text-align:center><code>DenseElementsAttr</code></td><td></td></tr></tbody></table><h3 id=stringattr>StringAttr</h3><p>An Attribute containing a string</p><p>Syntax:</p><pre tabindex=0><code>string-attribute ::= string-literal (`:` type)?
</code></pre><p>A string attribute is an attribute that represents a string literal value.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;An important string&#34;</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;string with a type&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>string
</span></span></code></pre></div><h4 id=parameters-14>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=symbolrefattr>SymbolRefAttr</h3><p>An Attribute containing a symbolic reference to an Operation</p><p>Syntax:</p><pre tabindex=0><code>symbol-ref-attribute ::= symbol-ref-id (`::` symbol-ref-id)*
</code></pre><p>A symbol reference attribute is a literal attribute that represents a named
reference to an operation that is nested within an operation with the
<code>OpTrait::SymbolTable</code> trait. As such, this reference is given meaning by
the nearest parent operation containing the <code>OpTrait::SymbolTable</code> trait. It
may optionally contain a set of nested references that further resolve to a
symbol nested within a different symbol table.</p><p><strong>Rationale:</strong> Identifying accesses to global data is critical to
enabling efficient multi-threaded compilation. Restricting global
data access to occur through symbols and limiting the places that can
legally hold a symbol reference simplifies reasoning about these data
accesses.</p><p>See <a href=../SymbolsAndSymbolTables.md><code>Symbols And SymbolTables</code></a> for more
information.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>@flat_reference</span>
</span></span><span style=display:flex><span><span style=color:#000>@parent_reference</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>@nested_reference</span>
</span></span></code></pre></div><h4 id=parameters-15>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rootReference</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>nestedReferences</td><td style=text-align:center><code>::llvm::ArrayRef&lt;FlatSymbolRefAttr></code></td><td></td></tr></tbody></table><h3 id=typeattr>TypeAttr</h3><p>An Attribute containing a Type</p><p>Syntax:</p><pre tabindex=0><code>type-attribute ::= type
</code></pre><p>A type attribute is an attribute that represents a
<a href=#type-system>type object</a>.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>type
</span></span></code></pre></div><h4 id=parameters-16>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=unitattr>UnitAttr</h3><p>An Attribute value of <code>unit</code> type</p><p>Syntax:</p><pre tabindex=0><code>unit-attribute ::= `unit`
</code></pre><p>A unit attribute is an attribute that represents a value of <code>unit</code> type. The
<code>unit</code> type allows only one value forming a singleton set. This attribute
value is used to represent attributes that only have meaning from their
existence.</p><p>One example of such an attribute could be the <code>swift.self</code> attribute. This
attribute indicates that a function parameter is the self/context parameter.
It could be represented as a <a href=#boolean-attribute>boolean attribute</a>(true or
false), but a value of false doesn&rsquo;t really bring any value. The parameter
either is the self/context or it isn&rsquo;t.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute defined with the `unit` value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@verbose_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>dialectName.unitAttr =</span> unit<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute in an attribute dictionary can also be defined without
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span>dialectName<span style=color:#000;font-weight:700>.</span>unitAttr<span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=stridedlayoutattr>StridedLayoutAttr</h3><p>An Attribute representing a strided layout of a shaped type</p><p>Syntax:</p><pre tabindex=0><code>strided-layout-attribute ::= `strided` `&lt;` `[` stride-list `]`
                             (`,` `offset` `:` dimension)? `&gt;`
stride-list ::= /*empty*/
              | dimension (`,` dimension)*
dimension ::= decimal-literal | `?`
</code></pre><p>A strided layout attribute captures layout information of the memref type in
the canonical form. Specifically, it contains a list of <em>strides</em>, one for
each dimension. A stride is the number of elements in the linear storage
one must step over to reflect an increment in the given dimension. For
example, a <code>MxN</code> row-major contiguous shaped type would have the strides
<code>[N, 1]</code>. The layout attribute also contains the <em>offset</em> from the base
pointer of the shaped type to the first effectively accessed element,
expressed in terms of the number of contiguously stored elements.</p><p>Strides must be positive and the offset must be non-negative. Both the
strides and the offset may be <em>dynamic</em>, i.e. their value may not be known
at compile time. This is expressed as a <code>?</code> in the assembly syntax and as
<code>ShapedType::kDynamic</code> in the code. Stride and offset values
must satisfy the constraints above at runtime, the behavior is undefined
otherwise.</p><p>See [Dialects/Builtin.md#memreftype](MemRef type) for more information.</p><h4 id=parameters-17>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>offset</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>strides</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td>array of strides (64-bit integer)</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-818a3660f61ebf5859b5c98635beacc8>7.3 - CKKS</h1><h1 id=ckks-dialect>&lsquo;ckks&rsquo; Dialect</h1><p>The CKKS dialect defines the types and operations of the CKKS cryptosystem.</p><h2 id=ckks-ops>CKKS ops</h2><h3 id=ckksadd-heirckksaddop><code>ckks.add</code> (heir::ckks::AddOp)</h3><p><em>Addition operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.add` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksadd_plain-heirckksaddplainop><code>ckks.add_plain</code> (heir::ckks::AddPlainOp)</h3><p><em>Addition operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.add_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksextract-heirckksextractop><code>ckks.extract</code> (heir::ckks::ExtractOp)</h3><p><em>Extract the i-th element of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.extract` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>While this operation is costly to compute in FHE, we represent it so we can
implement efficient lowerings and folders.</p><p>This op can be implemented as a plaintext multiplication with a one-hot
vector and a rotate into the zero-th index.</p><p>An extraction op&rsquo;s input ciphertext type is asserted to have an <code>underlying_type</code>
corresponding to a ranked tensor type, and this op&rsquo;s return type is
inferred to have the <code>underlying_type</code> corresponding to the element type of
that tensor type.</p><p>Traits: <code>SameOperandsAndResultRings</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>offset</code></td><td>signless integer or index</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksmul-heirckksmulop><code>ckks.mul</code> (heir::ckks::MulOp)</h3><p><em>Multiplication operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.mul` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksmul_plain-heirckksmulplainop><code>ckks.mul_plain</code> (heir::ckks::MulPlainOp)</h3><p><em>Multiplication operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.mul_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksnegate-heirckksnegateop><code>ckks.negate</code> (heir::ckks::NegateOp)</h3><p><em>Negate the coefficients of the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.negate` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksrelinearize-heirckksrelinearizeop><code>ckks.relinearize</code> (heir::ckks::RelinearizeOp)</h3><p><em>Relinearize the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.relinearize` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>This op takes integer array attributes <code>from_basis</code> and <code>to_basis</code> that are
used to indicate the key basis from which and to which the ciphertext is
encrypted against. A ciphertext is canonically encrypted against key basis
<code>(1, s)</code>. After a multiplication, its size will increase and the basis will be
<code>(1, s, s^2)</code>. The array that represents the key basis is constructed by
listing the powers of <code>s</code> at each position of the array. For example, <code>(1, s, s^2)</code> corresponds to <code>[0, 1, 2]</code>, while <code>(1, s^2)</code> corresponds to <code>[0, 2]</code>.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>from_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>to_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksrescale-heirckksrescaleop><code>ckks.rescale</code> (heir::ckks::RescaleOp)</h3><p><em>Rescales the ciphertext, which is the CKKS version of modulus switching in BGV/BFV.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.rescale` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>to_ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckksrotate-heirckksrotateop><code>ckks.rotate</code> (heir::ckks::RotateOp)</h3><p><em>Rotate the coefficients of the ciphertext using a Galois automorphism.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.rotate` operands attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckkssub-heirckkssubop><code>ckks.sub</code> (heir::ckks::SubOp)</h3><p><em>Subtraction operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.sub` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=ckkssub_plain-heirckkssubplainop><code>ckks.sub_plain</code> (heir::ckks::SubPlainOp)</h3><p><em>Subtraction operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.sub_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertextInput</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintextInput</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-80cc312dd83f43a069330083f04eb4f2>7.4 - Comb</h1><h1 id=comb-dialect>&lsquo;comb&rsquo; Dialect</h1><p>Types and operations for comb dialect</p><p>This dialect defines the <code>comb</code> dialect, which is intended to be a generic
representation of combinational logic outside of a particular use-case.</p><h2 id=operations>Operations</h2><h3 id=combadd-heircombaddop><code>comb.add</code> (heir::comb::AddOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.add` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comband-heircombandop><code>comb.and</code> (heir::comb::AndOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.and` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combconcat-heircombconcatop><code>comb.concat</code> (heir::comb::ConcatOp)</h3><p><em>Concatenate a variadic list of operands together.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.concat` $inputs attr-dict `:` qualified(type($inputs))
</code></pre><p>See the comb rationale document for details on operand ordering.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combextract-heircombextractop><code>comb.extract</code> (heir::comb::ExtractOp)</h3><p><em>Extract a range of bits into a smaller value, lowBit specifies the lowest bit included.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.extract` $input `from` $lowBit attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lowBit</code></td><td>::mlir::IntegerAttr</td><td>32-bit signless integer attribute</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combicmp-heircombicmpop><code>comb.icmp</code> (heir::comb::ICmpOp)</h3><p><em>Compare two integer values</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.icmp` (`bin` $twoState^)? $predicate $lhs `,` $rhs attr-dict `:` qualified(type($lhs))
</code></pre><p>This operation compares two integers using a predicate. If the predicate is
true, returns 1, otherwise returns 0. This operation always returns a one
bit wide result.</p><pre tabindex=0><code>    %r = comb.icmp eq %a, %b : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::heir::comb::ICmpPredicateAttr</td><td>hw.icmp comparison predicate</td></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless integer</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combinv-heircombinvop><code>comb.inv</code> (heir::comb::InvOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.inv` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmul-heircombmulop><code>comb.mul</code> (heir::comb::MulOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mul` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmux-heircombmuxop><code>comb.mux</code> (heir::comb::MuxOp)</h3><p><em>Return one or the other operand depending on a selector bit</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mux` (`bin` $twoState^)? $cond `,` $trueValue `,` $falseValue  attr-dict `:` qualified(type($result))
</code></pre><pre tabindex=0><code>  %0 = mux %pred, %tvalue, %fvalue : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-6>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cond</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>trueValue</code></td><td>any type</td></tr><tr><td style=text-align:center><code>falseValue</code></td><td>any type</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>any type</td></tr></tbody></table><h3 id=combnand-heircombnandop><code>comb.nand</code> (heir::comb::NandOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nand` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-7>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combnor-heircombnorop><code>comb.nor</code> (heir::comb::NorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-8>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combor-heircomborop><code>comb.or</code> (heir::comb::OrOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.or` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-9>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combparity-heircombparityop><code>comb.parity</code> (heir::comb::ParityOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.parity` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-10>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combreplicate-heircombreplicateop><code>comb.replicate</code> (heir::comb::ReplicateOp)</h3><p><em>Concatenate the operand a constant number of times</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.replicate` $input attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combtruth_table-heircombtruthtableop><code>comb.truth_table</code> (heir::comb::TruthTableOp)</h3><p><em>Return a true/false based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.truth_table` $inputs `-&gt;` $lookupTable attr-dict
</code></pre><pre tabindex=0><code>  %a = ... : i1
  %b = ... : i1
  %0 = comb.truth_table %a, %b -&gt; 6 : ui4
</code></pre><p>This operation assumes that the lookup table is described as an integer of
2^n bits to fully specify the table. Inputs are sorted MSB -> LSB from left
to right and the offset into <code>lookupTable</code> is computed from them. The
integer containing the truth table value&rsquo;s LSB is the output for the input
&ldquo;all false&rdquo;, and the MSB is the output for the input &ldquo;all true&rdquo;.</p><p>No difference from array_get into an array of constants except for xprop
behavior. If one of the inputs is unknown, but said input doesn&rsquo;t make a
difference in the output (based on the lookup table) the result should not
be &lsquo;x&rsquo; &ndash; it should be the well-known result.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-11>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookupTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 1-bit signless integer</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combxnor-heircombxnorop><code>comb.xnor</code> (heir::comb::XNorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xnor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-12>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combxor-heircombxorop><code>comb.xor</code> (heir::comb::XorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-13>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h2 id=enums>Enums</h2><h3 id=icmppredicate>ICmpPredicate</h3><p>hw.icmp comparison predicate</p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>eq</td><td style=text-align:center><code>0</code></td><td>eq</td></tr><tr><td style=text-align:center>ne</td><td style=text-align:center><code>1</code></td><td>ne</td></tr><tr><td style=text-align:center>slt</td><td style=text-align:center><code>2</code></td><td>slt</td></tr><tr><td style=text-align:center>sle</td><td style=text-align:center><code>3</code></td><td>sle</td></tr><tr><td style=text-align:center>sgt</td><td style=text-align:center><code>4</code></td><td>sgt</td></tr><tr><td style=text-align:center>sge</td><td style=text-align:center><code>5</code></td><td>sge</td></tr><tr><td style=text-align:center>ult</td><td style=text-align:center><code>6</code></td><td>ult</td></tr><tr><td style=text-align:center>ule</td><td style=text-align:center><code>7</code></td><td>ule</td></tr><tr><td style=text-align:center>ugt</td><td style=text-align:center><code>8</code></td><td>ugt</td></tr><tr><td style=text-align:center>uge</td><td style=text-align:center><code>9</code></td><td>uge</td></tr><tr><td style=text-align:center>ceq</td><td style=text-align:center><code>10</code></td><td>ceq</td></tr><tr><td style=text-align:center>cne</td><td style=text-align:center><code>11</code></td><td>cne</td></tr><tr><td style=text-align:center>weq</td><td style=text-align:center><code>12</code></td><td>weq</td></tr><tr><td style=text-align:center>wne</td><td style=text-align:center><code>13</code></td><td>wne</td></tr></tbody></table><h2 id=comb-types>Comb types</h2><h2 id=comb-ops>Comb ops</h2><h3 id=combadd-heircombaddop-1><code>comb.add</code> (heir::comb::AddOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.add` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-14>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comband-heircombandop-1><code>comb.and</code> (heir::comb::AndOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.and` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-15>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combconcat-heircombconcatop-1><code>comb.concat</code> (heir::comb::ConcatOp)</h3><p><em>Concatenate a variadic list of operands together.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.concat` $inputs attr-dict `:` qualified(type($inputs))
</code></pre><p>See the comb rationale document for details on operand ordering.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combextract-heircombextractop-1><code>comb.extract</code> (heir::comb::ExtractOp)</h3><p><em>Extract a range of bits into a smaller value, lowBit specifies the lowest bit included.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.extract` $input `from` $lowBit attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-16>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lowBit</code></td><td>::mlir::IntegerAttr</td><td>32-bit signless integer attribute</td></tr></table><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combicmp-heircombicmpop-1><code>comb.icmp</code> (heir::comb::ICmpOp)</h3><p><em>Compare two integer values</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.icmp` (`bin` $twoState^)? $predicate $lhs `,` $rhs attr-dict `:` qualified(type($lhs))
</code></pre><p>This operation compares two integers using a predicate. If the predicate is
true, returns 1, otherwise returns 0. This operation always returns a one
bit wide result.</p><pre tabindex=0><code>    %r = comb.icmp eq %a, %b : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-17>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::heir::comb::ICmpPredicateAttr</td><td>hw.icmp comparison predicate</td></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless integer</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combinv-heircombinvop-1><code>comb.inv</code> (heir::comb::InvOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.inv` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-18>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-21>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmul-heircombmulop-1><code>comb.mul</code> (heir::comb::MulOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mul` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-19>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-22>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-22>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmux-heircombmuxop-1><code>comb.mux</code> (heir::comb::MuxOp)</h3><p><em>Return one or the other operand depending on a selector bit</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mux` (`bin` $twoState^)? $cond `,` $trueValue `,` $falseValue  attr-dict `:` qualified(type($result))
</code></pre><pre tabindex=0><code>  %0 = mux %pred, %tvalue, %fvalue : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-20>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-23>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cond</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>trueValue</code></td><td>any type</td></tr><tr><td style=text-align:center><code>falseValue</code></td><td>any type</td></tr></tbody></table><h4 id=results-23>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>any type</td></tr></tbody></table><h3 id=combnand-heircombnandop-1><code>comb.nand</code> (heir::comb::NandOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nand` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-21>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-24>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-24>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combnor-heircombnorop-1><code>comb.nor</code> (heir::comb::NorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-22>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-25>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-25>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combor-heircomborop-1><code>comb.or</code> (heir::comb::OrOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.or` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-23>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-26>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-26>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combparity-heircombparityop-1><code>comb.parity</code> (heir::comb::ParityOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.parity` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-24>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-27>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-27>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combreplicate-heircombreplicateop-1><code>comb.replicate</code> (heir::comb::ReplicateOp)</h3><p><em>Concatenate the operand a constant number of times</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.replicate` $input attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-28>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-28>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combtruth_table-heircombtruthtableop-1><code>comb.truth_table</code> (heir::comb::TruthTableOp)</h3><p><em>Return a true/false based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.truth_table` $inputs `-&gt;` $lookupTable attr-dict
</code></pre><pre tabindex=0><code>  %a = ... : i1
  %b = ... : i1
  %0 = comb.truth_table %a, %b -&gt; 6 : ui4
</code></pre><p>This operation assumes that the lookup table is described as an integer of
2^n bits to fully specify the table. Inputs are sorted MSB -> LSB from left
to right and the offset into <code>lookupTable</code> is computed from them. The
integer containing the truth table value&rsquo;s LSB is the output for the input
&ldquo;all false&rdquo;, and the MSB is the output for the input &ldquo;all true&rdquo;.</p><p>No difference from array_get into an array of constants except for xprop
behavior. If one of the inputs is unknown, but said input doesn&rsquo;t make a
difference in the output (based on the lookup table) the result should not
be &lsquo;x&rsquo; &ndash; it should be the well-known result.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-25>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookupTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-29>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 1-bit signless integer</td></tr></tbody></table><h4 id=results-29>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combxnor-heircombxnorop-1><code>comb.xnor</code> (heir::comb::XNorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xnor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-26>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-30>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-30>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combxor-heircombxorop-1><code>comb.xor</code> (heir::comb::XorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-27>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-31>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-31>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-df73b993320a0b803398dca1b5f7c3cd>7.5 - Jaxite</h1><h1 id=jaxite-dialect>&lsquo;jaxite&rsquo; Dialect</h1><p>The <code>jaxite</code> dialect is an exit dialect for generating py code against the jaxite library API,
using the jaxite parameters and encoding scheme.</p><p>See <a href=https://github.com/google/jaxite>https://github.com/google/jaxite</a></p><h2 id=jaxite-types>Jaxite types</h2><h3 id=paramstype>ParamsType</h3><p>The jaxite security params required to perform homomorphic operations.</p><p>Syntax: <code>!jaxite.params</code></p><h3 id=pmaplut3tupletype>PmapLut3TupleType</h3><p>A tuple of pmap_lut3 args.</p><p>Syntax: <code>!jaxite.pmap_lut3_tuple</code></p><h3 id=serverkeysettype>ServerKeySetType</h3><p>The jaxite server key set required to perform homomorphic operations.</p><p>Syntax: <code>!jaxite.server_key_set</code></p><h2 id=jaxite-ops>Jaxite ops</h2><h3 id=jaxiteconstant-heirjaxiteconstantop><code>jaxite.constant</code> (heir::jaxite::ConstantOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.constant` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for LWE ciphertexts</td></tr></tbody></table><h3 id=jaxitelut3_args-heirjaxitelut3argsop><code>jaxite.lut3_args</code> (heir::jaxite::Lut3ArgsOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.lut3_args` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function is generating tuples for pmap_lut3.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>b</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>c</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>truth_table</code></td><td>8-bit signless integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A tuple of pmap_lut3 args.</td></tr></tbody></table><h3 id=jaxitelut3-heirjaxitelut3op><code>jaxite.lut3</code> (heir::jaxite::Lut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function can be
interpreted as</p><p>truth_table &#187; {c, b, a}</p><p>where {c, b, a} is the unsigned 3-bit integer with bits c, b, a from most
significant bit to least-significant bit.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>b</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>c</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>truth_table</code></td><td>8-bit signless integer</td></tr><tr><td style=text-align:center><code>serverKeySet</code></td><td>The jaxite server key set required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for LWE ciphertexts</td></tr></tbody></table><h3 id=jaxitepmap_lut3-heirjaxitepmaplut3op><code>jaxite.pmap_lut3</code> (heir::jaxite::PmapLut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.pmap_lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function is a bacthed Lut3Op.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lut3_args</code></td><td>pmap_lut3_tuples</td></tr><tr><td style=text-align:center><code>serverKeySet</code></td><td>The jaxite server key set required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c5dda3cb8e694541eacbee638af7317d>7.6 - LWE</h1><h2 id=lwe-attributes>LWE attributes</h2><h3 id=plaintextencodingattr>PlaintextEncodingAttr</h3><p>Syntax: <code>#lwe.plaintext_encoding</code></p><h3 id=applicationdataattr>ApplicationDataAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.application_data&lt;
  mlir::Type,   # message_type
  Attribute   # overflow
&gt;
</code></pre><p>An attribute describing the semantics of the underlying application data.</p><p>The <code>messageType</code> parameter is used to describe the type and bits of the
original application data, e.g. i1, i32, f32. This type is later mapped
into the plaintext space of an FHE scheme by embedding, scaling, or other
techniques.</p><p>This attribute also contains information about the overflow semantics of the
data in the application. By default, we assume that the application program
was written so that the overflow is not expected and the overflow attribute
can can be <code>no_overflow</code>. For LWE-based CGGI ciphertexts, the overflow
attribute will usually be <code>preserve_overflow</code>, since messages will overflow
into padding bits.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>message_type</td><td style=text-align:center><code>mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>overflow</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=bitfieldencodingattr>BitFieldEncodingAttr</h3><p>An attribute describing encoded LWE plaintexts using bit fields.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.bit_field_encoding&lt;
  unsigned,   # cleartext_start
  unsigned   # cleartext_bitwidth
&gt;
</code></pre><p>A bit field encoding of an integer describes which contiguous region
of bits a small integer occupies within a larger integer.</p><p>The data describing the encoding consists of the starting bit positions of
the cleartext bit field and its width, where the LSB is bit 0 and the MSB
is bit <code>bit_width-1</code>. So the above example would have starting bit <code>30</code> and
width <code>3</code>. The bits not specified for the message have semantics defined
by the scheme or lowering.</p><p>Note that this encoding does not specify the underlying bit width of the
plaintext space. This is left for lowerings to decide.</p><p>The presence of this attribute as the <code>encoding</code> attribute of a tensor
indicates that the tensor is an LWE ciphertext.</p><p><strong>Example (CGGI):</strong></p><pre tabindex=0><code>#encoding = #lwe.bit_field_encoding&lt;cleartext_start=30, cleartext_bitwidth=3&gt;
!plaintext = !lwe.lwe_plaintext&lt;encoding = #encoding&gt;

%0 = arith.constant 4 : i3
%1 = lwe.encode %0 { encoding = #encoding }: i3 to !plaintext
</code></pre><p>The above represents an LWE plaintext encoding the 3-bit cleartext 4 as an
LWE ciphertext in a 32-bit integer, with a single bit of padding at the MSB.
This corresponds to the following, where 0 denotes a 0 bit, <code>b</code> denotes a
bit of the cleartext, <code>n</code> denotes a bit reserved for noise, and <code>|</code> is a
visual aid to show where the bit fields begin and end.</p><pre tabindex=0><code>   0|bbb|nn...n
MSB^          ^LSB
</code></pre><p><strong>Example (BGV):</strong></p><p>Note: BGV uses the RLWE encodings, but they have the same bit-field encoding
attributes as here. So this example serves mainly to show how this attribute
can be used to specify storing bits in the LSB of a plaintext.</p><pre tabindex=0><code>#encoding = #lwe.bit_field_encoding&lt;cleartext_start=4, cleartext_bitwidth=4&gt;
!plaintext = !lwe.lwe_plaintext&lt;encoding = #encoding&gt;

%0 = arith.constant 9 : i4
%1 = lwe.encode %0 { encoding = #encoding }: i4 to !plaintext
</code></pre><p>The above represents an LWE plaintext encoding a 4-bit cleartext as an
LWE ciphertext in the least-significant bits of a larger integer.
This corresponds to the following.</p><pre tabindex=0><code>   nn...n|bbbb
MSB^         ^LSB
</code></pre><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cleartext_start</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>cleartext_bitwidth</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=ciphertextspaceattr>CiphertextSpaceAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.ciphertext_space&lt;
  ::mlir::heir::polynomial::RingAttr,   # ring
  ::mlir::heir::lwe::LweEncryptionType,   # encryption_type
  unsigned   # size
&gt;
</code></pre><p>An attribute describing the ciphertext space and the transformation from
plaintext space to ciphertext space of an FHE scheme.</p><p>The ciphertext space information includes the ring attribute, describing the
space that the ciphertext elements belong to. The ring attribute contains a
coefficient type attribute that describes the semantics of the coefficient.
For example, a ring modulo $1 + x^1024$ with coefficients modulo $q =
298374$ will be described as</p><pre tabindex=0><code>!ideal = !polynomial.int_polynomial&lt;1 + x**1024&gt;
!cmod = !mod_arith.mod_arith&lt;modulus=298374 : i64&gt;
#ring = #polynomial.ring&lt;coefficientType = !cmod, modulus = !ideal&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = #encryption_type&gt;
</code></pre><p>Ciphertexts using an RNS representation for $q$ will use an RNS type in
their ring&rsquo;s coefficient type attribute.</p><p>// TODO(#1085): Validate syntax of polynomial ring after coefficientType changes.</p><pre tabindex=0><code>!ideal = !polynomial.int_polynomial&lt;1 + x**1024&gt;
!limb1 = !mod_arith.mod_arith&lt;modulus=2251799814045697 : i64&gt;
!limb2 = !mod_arith.mod_arith&lt;modulus=65537 : i64&gt;
#rns_mod = !rns.rns&lt;!limb1, !limb2&gt;
#ring = #polynomial.ring&lt;coefficientType = #rns_mod, modulus = #ideal&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = #encryption_type&gt;
</code></pre><p>Scalar LWE ciphertexts (like those used in CGGI) use an ideal polynomial of
degree 1, $x$. CGGI ciphertexts will typically use a power of two modulus
and may use a native integer type for its coefficient modulus.</p><pre tabindex=0><code>!ideal = !polynomial.int_polynomial&lt;1 + x**1024&gt;
#ring = #polynomial.ring&lt;coefficientType = i32, modulus = #ideal&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = #encryption_type&gt;
</code></pre><p>The ciphertext encoding info is used to describe the way the plaintext data
is encoded into the ciphertext (in the MSB, LSB, or mixed).</p><p>The <code>size</code> parameter is used to describe the number of polynomials
comprising the ciphertext. This is typically 2 for RLWE ciphertexts that
are made up of an $(a, b)$ pair and greater than 2 for LWE instances. For
example, after an RLWE multiplication of two size 2 ciphertexts,
the ciphertext&rsquo;s size will be 3.</p><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr><tr><td style=text-align:center>encryption_type</td><td style=text-align:center><code>::mlir::heir::lwe::LweEncryptionType</code></td><td></td></tr><tr><td style=text-align:center>size</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=coefficientencodingattr>CoefficientEncodingAttr</h3><p>An encoding of cleartexts directly as coefficients.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.coefficient_encoding&lt;
  unsigned   # scaling_factor
&gt;
</code></pre><p>A coefficient encoding of a list of integers asserts that the coefficients
of the polynomials contain the integers, with the same semantics as
<code>constant_coefficient_encoding</code> for per-coefficient encodings.</p><p>A <code>scaling_factor</code> is optionally applied on the scalar when converting from
a rounded floating point to an integer.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.coefficient_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=constantcoefficientencodingattr>ConstantCoefficientEncodingAttr</h3><p>An encoding of a scalar in the constant coefficient</p><p>Syntax:</p><pre tabindex=0><code>#lwe.constant_coefficient_encoding&lt;
  unsigned   # scaling_factor
&gt;
</code></pre><p>An encoding of a single scalar into the constant coefficient of the plaintext.</p><p>All other coefficients of the plaintext are set to be zero. This encoding is
used to encode scalar LWE ciphertexts where the plaintext space is viewed
as a polynomial ring modulo <code>x</code>.</p><p>The scalar is first multiplied by the <code>scaling_factor</code> and then rounded to
the nearest integer before encoding into the plaintext coefficient.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.constant_coefficient_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=fullcrtpackingencodingattr>FullCRTPackingEncodingAttr</h3><p>An encoding of cleartexts via CRT slots.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.full_crt_packing_encoding&lt;
  unsigned   # scaling_factor
&gt;
</code></pre><p>This encoding maps a list of integers via the Chinese Remainder Theorem (CRT) into the plaintext space.</p><p>Given a ring with irreducible ideal polynomial <code>f(x)</code> and coefficient
modulus <code>q</code>, <code>f(x)</code> can be decomposed modulo <code>q</code> into a direct product of
lower-degree polynomials. This allows full SIMD-style homomorphic operations
across the slots formed from each factor.</p><p>This attribute can only be used in the context of on full CRT packing, where
the polynomial <code>f(x)</code> splits completely (into linear factors) and the number
of slots equals the degree of <code>f(x)</code>. This happens when <code>q</code> is prime and <code>q = 1 mod n</code>.</p><p>A <code>scaling_factor</code> is optionally applied on the scalar when converting from
a rounded floating point to an integer.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.full_crt_packing_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=inversecanonicalencodingattr>InverseCanonicalEncodingAttr</h3><p>An encoding of cleartexts via the inverse canonical embedding.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.inverse_canonical_encoding&lt;
  unsigned   # scaling_factor
&gt;
</code></pre><p>Let $n$ be the degree of the polynomials in the plaintext space. An
&ldquo;inverse_canonical_encoding&rdquo; of a list of real or complex values
$v_1, \dots, v_{n/2}$ is (almost) the inverse of the following decoding
map.</p><p>Define a map $\tau_N$ that maps a polynomial $p \in \mathbb{Z}[x] / (x^N + 1)
\to \mathbb{C}^{N/2}$ by evaluating it at the following $N/2$ points,
where $\omega = e^{2 \pi i / 2N}$ is the primitive $2N$th root of unity:</p><p>[
\omega, \omega^3, \omega^5, \dots, \omega^{N-1}
]</p><p>Then the complete decoding operation is $\textup{Decode}(p) =
(1/\Delta)\tau_N(p)$, where $\Delta$ is a scaling parameter and $\tau_N$ is
the truncated canonical embedding above. The encoding operation is the
inverse of the decoding operation, with some caveats explained below.</p><p>The map $\tau_N$ is derived from the so-called <em>canonical embedding</em>
$\tau$, though in the standard canonical embedding, we evaluate at all odd
powers of the root of unity, $\omega, \omega^3, \dots, \omega^{2N-1}$. For
polynomials in the slightly larger space $\mathbb{R}[x] / (x^N + 1)$, the
image of the canonical embedding is the subspace $H \subset \mathbb{C}^N$
defined by tuples $(z_1, \dots, z_N)$ such that $\overline{z_i} =
\overline{z_{N-i+1}}$. Note that this property holds because polynomial
evaluation commutes with complex conjugates, and the second half of the
roots of unity evaluate are complex conjugates of the first half. The
converse, that any such tuple with complex conjugate symmetry has an
inverse under $\tau$ with all real coefficients, makes $\tau$ is a
bijection onto $H$. $\tau$ and its inverse are explicitly computable as
discrete Fourier Transforms.</p><p>Because of the symmetry in canonical embedding for real polynomials, inputs
to this encoding can be represented as a list of $N/2$ complex points, with
the extra symmetric structure left implicit. $\tau_N$ and its inverse can
also be explicitly computed without need to expand the vectors to length
$N$.</p><p>The rounding step is required to invert the decoding because, while
cleartexts must be (implicitly) in the subspace $H$, they need not be the
output of $\tau_N$ for an <em>integer</em> polynomial. The rounding step ensures
we can use integer polynomial plaintexts for the FHE operations. There are
multiple rounding mechanisms, and this attribute does not specify which is
used, because in theory two ciphertexts that have used different roundings
are still compatible, though they may have different noise growth patterns.</p><p>The scaling parameter $\Delta$ is specified by the <code>scaling_factor</code>, which
are applied coefficient-wise using the same semantics as the
<code>constant_coefficient_encoding</code>.</p><p>A typical flow for the CKKS scheme using this encoding would be to apply an
inverse FFT operation to invert the canonical embedding to be a polynomial
with real coefficients, then encrypt scale the resulting polynomial&rsquo;s
coefficients according to the scaling parameters, then round to get integer
coefficients.</p><p>Example:</p><pre tabindex=0><code>#canonical_encoding = #lwe.inverse_canonical_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=keyattr>KeyAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.key&lt;
  int   # slot_index
&gt;
</code></pre><p>An attribute describing the key with which the message is currently
encrypted.</p><p>The key attribute describes the key with which the message is currently
encrypted and decryption can be performed. For example, if the decryption of
a ciphertext $c = (c_0(x), c_1(x))$ is performed by computing the inner
product $(c_0(x), c_1(x)) \cdot (1, s(x))$ then the key is $(1, s(x))$.</p><p>The <code>slot_index</code> describes the key after using a Galois automorphism to
rotate the plaintext slots by <code>slot_index</code>. This will correspond to an
action $\phi_k: x \rightarrow x^k$ for some <code>k</code> that depends on the
structure of the Galois group for the chosen scheme parameters. The
corresponding key will have a new basis $(1, s(x^(k)))$.</p><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>slot_index</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h3 id=lweparamsattr>LWEParamsAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.lwe_params&lt;
  IntegerAttr,   # cmod
  unsigned   # dimension
&gt;
</code></pre><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cmod</td><td style=text-align:center><code>IntegerAttr</code></td><td></td></tr><tr><td style=text-align:center>dimension</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=moduluschainattr>ModulusChainAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.modulus_chain&lt;
  ::llvm::ArrayRef&lt;mlir::IntegerAttr&gt;,   # elements
  int   # current
&gt;
</code></pre><p>An attribute describing the elements of the modulus chain of an RLWE scheme.</p><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elements</td><td style=text-align:center><code>::llvm::ArrayRef&lt;mlir::IntegerAttr></code></td><td></td></tr><tr><td style=text-align:center>current</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h3 id=nooverflowattr>NoOverflowAttr</h3><p>An attribute informing that application data never overflows.</p><p>Syntax: <code>#lwe.no_overflow</code></p><p>This attribute informs lowerings that a program is written so that the message data
will never overflow beyond the message type.</p><p>// FIXME: Have a separate WraparoundOverflow, which lowers the same as NoOverflow?</p><h3 id=plaintextspaceattr>PlaintextSpaceAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.plaintext_space&lt;
  ::mlir::heir::polynomial::RingAttr,   # ring
  Attribute   # encoding
&gt;
</code></pre><p>An attribute describing the plaintext space and the transformation from
application data to plaintext space of an FHE scheme.</p><p>The plaintext space information is the ring structure, which contains the
plaintext modulus $t$, which may be a power of two in the case of CGGI
ciphertexts, or a prime power for RLWE. LWE ciphertexts use the
ideal polynomial of degree 1 $x$. The plaintext modulus used in LWE-based
CGGI plaintexts describes the full message space $\mathbb{Z}_p$ including
the padding bits. The application data info attribute describes the space
$\mathbb{Z}_p&rsquo;$ where $p&rsquo; &lt; p$ that the underlying message belongs to.</p><p>For RLWE schemes, this will include the type of encoding of application data
integers to a plaintext space <code>Z_p[X]/X^N + 1</code>. This may be a constant
coefficient encoding, CRT-based packing for SIMD semantics, or other slot
packing. When using full CRT packing, the ring must split into linear
factors. The CKKS scheme will also include attributes describing the complex
encoding, including the scaling factor, which will change after
multiplication and rescaling.</p><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=preserveoverflowattr>PreserveOverflowAttr</h3><p>An attribute informing that application data overflows in the message type.</p><p>Syntax: <code>#lwe.preserve_overflow</code></p><p>This attribute informs lowerings that a program is written so that the message data
may overflow beyond the message type.</p><h3 id=rlweparamsattr>RLWEParamsAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.rlwe_params&lt;
  unsigned,   # dimension
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><p>An attribute describing classical RLWE parameters:</p><ul><li><code>dimension</code>: the number of polynomials used in an RLWE sample, analogous
to LWEParams.dimension.</li><li><code>ring</code>: the polynomial ring to use.</li></ul><h4 id=parameters-11>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>dimension</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr></tbody></table><h3 id=unspecifiedbitfieldencodingattr>UnspecifiedBitFieldEncodingAttr</h3><p>An attribute describing unspecified bit field encodings.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.unspecified_bit_field_encoding&lt;
  unsigned   # cleartext_bitwidth
&gt;
</code></pre><p>See LWE_BitFieldEncoding for a description of bit field encodings.</p><p>This attribute describes an unspecified bit field encoding; this is where
the starting bit position of the cleartext bit field is unspecified, but its
width is fixed. A noise growth analysis should be performed to determine the
optimal amount of bits needed for noise and padding to specify the bit field
encodings starting bit position.</p><p>Example:</p><pre tabindex=0><code>#lwe_encoding = #lwe.unspecified_bit_field_encoding&lt;cleartext_bitwidth=3&gt;
%lwe_ciphertext = arith.constant &lt;[1,2,3,4]&gt; : tensor&lt;4xi32, #lwe_encoding&gt;
</code></pre><h4 id=parameters-12>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cleartext_bitwidth</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=inversecanonicalembeddingencodingattr>InverseCanonicalEmbeddingEncodingAttr</h3><p>An attribute describing encoded RLWE plaintexts via the rounded inverse canonical embedding.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.inverse_canonical_embedding_encoding&lt;
  unsigned,   # cleartext_start
  unsigned   # cleartext_bitwidth
&gt;
</code></pre><p>Let $n$ be the degree of the polynomials in the plaintext space. An
&ldquo;inverse canonical embedding encoding&rdquo; of a list of real or complex values
$v_1, \dots, v_{n/2}$ is (almost) the inverse of the following decoding
map.</p><p>Define a map $\tau_N$ that maps a polynomial $p \in \mathbb{Z}[x] / (x^N + 1)
\to \mathbb{C}^{N/2}$ by evaluating it at the following $N/2$ points,
where $\omega = e^{2 \pi i / 2N}$ is the primitive $2N$th root of unity:</p><p>[
\omega, \omega^3, \omega^5, \dots, \omega^{N-1}
]</p><p>Then the complete decoding operation is $\textup{Decode}(p) =
(1/\Delta)\tau_N(p)$, where $\Delta$ is a scaling parameter and $\tau_N$ is
the truncated canonical embedding above. The encoding operation is the
inverse of the decoding operation, with some caveats explained below.</p><p>The map $\tau_N$ is derived from the so-called <em>canonical embedding</em>
$\tau$, though in the standard canonical embedding, we evaluate at all odd
powers of the root of unity, $\omega, \omega^3, \dots, \omega^{2N-1}$. For
polynomials in the slightly larger space $\mathbb{R}[x] / (x^N + 1)$, the
image of the canonical embedding is the subspace $H \subset \mathbb{C}^N$
defined by tuples $(z_1, \dots, z_N)$ such that $\overline{z_i} =
\overline{z_{N-i+1}}$. Note that this property holds because polynomial
evaluation commutes with complex conjugates, and the second half of the
roots of unity evaluate are complex conjugates of the first half. The
converse, that any such tuple with complex conjugate symmetry has an
inverse under $\tau$ with all real coefficients, makes $\tau$ is a
bijection onto $H$. $\tau$ and its inverse are explicitly computable as
discrete Fourier Transforms.</p><p>Because of the symmetry in canonical embedding for real polynomials, inputs
to this encoding can be represented as a list of $N/2$ complex points, with
the extra symmetric structure left implicit. $\tau_N$ and its inverse can
also be explicitly computed without need to expand the vectors to length
$N$.</p><p>The rounding step is required to invert the decoding because, while
cleartexts must be (implicitly) in the subspace $H$, they need not be the
output of $\tau_N$ for an <em>integer</em> polynomial. The rounding step ensures
we can use integer polynomial plaintexts for the FHE operations. There are
multiple rounding mechanisms, and this attribute does not specify which is
used, because in theory two ciphertexts that have used different roundings
are still compatible, though they may have different noise growth patterns.</p><p>The scaling parameter $\Delta$ is specified by the <code>cleartext_start</code> and
<code>cleartext_bitwidth</code> parameters, which are applied coefficient-wise using
the same semantics as the <code>bit_field_encoding</code>.</p><p>This attribute can be used in multiple ways:</p><ul><li>On a <code>poly.poly</code>, it asserts that the polynomial has been transformed
from a coefficient list using the canonical embedding.</li><li>On a tensor of <code>poly.poly</code>, it asserts that the tensor is an RLWE
ciphertext for some RLWE scheme that supports the approximate embedding
encoding.</li></ul><p>A typical flow for the CKKS scheme using this encoding would be to apply an
inverse FFT operation to invert the canonical embedding to be a polynomial
with real coefficients, then encrypt scale the resulting polynomial&rsquo;s
coefficients according to the scaling parameters, then round to get integer
coefficients.</p><p>Example:</p><pre tabindex=0><code>#generator = #poly.polynomial&lt;1 + x**1024&gt;
#ring = #poly.ring&lt;cmod=65536, ideal=#generator&gt;
#lwe_encoding = #lwe.polynomial_evaluation_encoding&lt;cleartext_start=30, cleartext_bitwidth=3&gt;

%evals = arith.constant &lt;[1, 2, 4, 5]&gt; : tensor&lt;4xi16&gt;
%poly1 = poly.intt %evals : tensor&lt;4xi16, #ring&gt; -&gt; !poly.poly&lt;#ring, #eval_encoding&gt;
%poly2 = poly.intt %evals : tensor&lt;4xi16, #ring&gt; -&gt; !poly.poly&lt;#ring, #eval_encoding&gt;
%rlwe_ciphertext = tensor.from_elements %poly1, %poly2 : tensor&lt;2x!poly.poly&lt;#ring, #eval_encoding&gt;&gt;
</code></pre><p>See <code>bit_field_encoding</code> for the definition of the <code>cleartext_start</code> and
<code>cleartext_bitwidth</code> fields.</p><h4 id=parameters-13>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cleartext_start</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>cleartext_bitwidth</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=polynomialcoefficientencodingattr>PolynomialCoefficientEncodingAttr</h3><p>An attribute describing encoded RLWE plaintexts via coefficients.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.polynomial_coefficient_encoding&lt;
  unsigned,   # cleartext_start
  unsigned   # cleartext_bitwidth
&gt;
</code></pre><p>A coefficient encoding of a list of integers asserts that the coefficients
of the polynomials contain the cleartexts, with the same semantics as
<code>bit_field_encoding</code> for per-coefficient encodings.</p><p>The presence of this attribute as the <code>encoding</code> attribute of a tensor of
<code>poly.poly</code> indicates that the tensor is an RLWE ciphertext for some RLWE
scheme that supports the coefficient encoding.</p><p>See <code>bit_field_encoding</code> for the definition of the <code>cleartext_start</code> and
<code>cleartext_bitwidth</code> fields.</p><p>Example:</p><pre tabindex=0><code>#generator = #poly.polynomial&lt;1 + x**1024&gt;
#ring = #poly.ring&lt;cmod=65536, ideal=#generator&gt;
#coeff_encoding = #lwe.polynomial_coefficient_encoding&lt;cleartext_start=15, cleartext_bitwidth=4&gt;

%poly1 = poly.from_tensor %coeffs1 : tensor&lt;10xi16&gt; -&gt; !poly.poly&lt;#ring&gt;
%poly2 = poly.from_tensor %coeffs2 : tensor&lt;10xi16&gt; -&gt; !poly.poly&lt;#ring&gt;
%rlwe_ciphertext = tensor.from_elements %poly1, %poly2 : tensor&lt;2x!poly.poly&lt;#ring&gt;, #coeff_encoding&gt;
</code></pre><h4 id=parameters-14>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cleartext_start</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>cleartext_bitwidth</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=polynomialevaluationencodingattr>PolynomialEvaluationEncodingAttr</h3><p>An attribute describing encoded RLWE plaintexts via evaluations at fixed points.</p><p>Syntax:</p><pre tabindex=0><code>#lwe.polynomial_evaluation_encoding&lt;
  unsigned,   # cleartext_start
  unsigned   # cleartext_bitwidth
&gt;
</code></pre><p>A &ldquo;evaluation encoding&rdquo; of a list of integers $(v_1, \dots, v_n)$ asserts
that $f(x_1 ) = v_1, \dots, f(x_n) = v_n$ for some implicit, but fixed and
distinct choice of inputs $x_i$. The encoded values are also scaled by a
scale factor, having the same semantics as <code>bit_field_encoding</code>, but
applied entry-wise (to either the coefficient or evaluation representation).</p><p>This attribute can be used in multiple ways:</p><ul><li>On a <code>poly.poly</code>, it asserts that the polynomial has been transformed
from an evaluation tensor.</li><li>On a tensor of <code>poly.poly</code>, it asserts that the tensor is an RLWE
ciphertext for some RLWE scheme that supports the evaluation encoding.</li></ul><p>A typical workflow for the BFV/BGV schemes using this encoding would be
to apply a INTT operation to the input list of cleartexts to convert from
evaluation form to coefficient form, then encrypt the resulting polynomial
in coefficient form, then apply NTT back to the evaluation form for faster
multiplication of ciphertexts.</p><p>The points chosen are fixed to be the powers of a primitive root of unity
of the coefficient ring of the plaintext space, which allows one to use
NTT/INTT to tansform quickly between the coefficient and evaluation forms.</p><p>Example:</p><pre tabindex=0><code>#generator = #poly.polynomial&lt;1 + x**1024&gt;
// note that the cmod should be chosen so as to ensure a primitive root of
// unity exists in the multiplicative group (Z / cmod Z)^*
#ring = #poly.ring&lt;cmod=65536, ideal=#generator&gt;
#lwe_encoding = #lwe.polynomial_evaluation_encoding&lt;cleartext_start=30, cleartext_bitwidth=3&gt;

%evals = arith.constant &lt;[1, 2, 4, 5]&gt; : tensor&lt;4xi16&gt;
%poly1 = poly.intt %evals : tensor&lt;4xi16, #ring&gt; -&gt; !poly.poly&lt;#ring, #eval_encoding&gt;
%poly2 = poly.intt %evals : tensor&lt;4xi16, #ring&gt; -&gt; !poly.poly&lt;#ring, #eval_encoding&gt;
%rlwe_ciphertext = tensor.from_elements %poly1, %poly2 : tensor&lt;2x!poly.poly&lt;#ring, #eval_encoding&gt;&gt;
</code></pre><p>See <code>bit_field_encoding</code> for the definition of the <code>cleartext_start</code> and
<code>cleartext_bitwidth</code> fields.</p><h4 id=parameters-15>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>cleartext_start</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>cleartext_bitwidth</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h2 id=lwe-types>LWE types</h2><h3 id=lweciphertexttype>LWECiphertextType</h3><p>A type for LWE ciphertexts</p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_ciphertext&lt;
  ::mlir::Attribute,   # encoding
  LWEParamsAttr   # lwe_params
&gt;
</code></pre><p>A type for LWE ciphertexts.</p><p>This type keeps track of the plaintext integer encoding for the LWE
Ciphertext to ensure proper decoding after decryption. It also keeps track
of the ring where the LWE ciphertext is defined, which provides information
on the ciphertext shape and the ring operations used in LWE operations.</p><h4 id=parameters-16>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>::mlir::Attribute</code></td><td></td></tr><tr><td style=text-align:center>lwe_params</td><td style=text-align:center><code>LWEParamsAttr</code></td><td></td></tr></tbody></table><h3 id=lweplaintexttype>LWEPlaintextType</h3><p>A type for LWE plaintexts</p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_plaintext&lt;
  ::mlir::Attribute   # encoding
&gt;
</code></pre><p>A type for LWE plaintexts.</p><p>This type keeps track of the plaintext integer encoding for the LWE
plaintext before it is encrypted.</p><h4 id=parameters-17>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>::mlir::Attribute</code></td><td></td></tr></tbody></table><h3 id=newlweciphertexttype>NewLWECiphertextType</h3><p>A ciphertext type</p><p>Syntax:</p><pre tabindex=0><code>!lwe.new_lwe_ciphertext&lt;
  ApplicationDataAttr,   # application_data
  PlaintextSpaceAttr,   # plaintext_space
  CiphertextSpaceAttr,   # ciphertext_space
  KeyAttr,   # key
  ModulusChainAttr   # modulus_chain
&gt;
</code></pre><p>An LWE ciphertext will always contain the application data, plaintext space,
ciphertext space, and key information.</p><p>A modulus chain is optionally specified for parameter choices in RLWE
schemes that use more than one of modulus. When no modulus chain is
specified, the ciphertext modulus is always the ciphertext ring&rsquo;s
coefficient modulus.</p><h4 id=parameters-18>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>application_data</td><td style=text-align:center><code>ApplicationDataAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintext_space</td><td style=text-align:center><code>PlaintextSpaceAttr</code></td><td></td></tr><tr><td style=text-align:center>ciphertext_space</td><td style=text-align:center><code>CiphertextSpaceAttr</code></td><td></td></tr><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>modulus_chain</td><td style=text-align:center><code>ModulusChainAttr</code></td><td></td></tr></tbody></table><h3 id=newlweplaintexttype>NewLWEPlaintextType</h3><p>A plaintext type</p><p>Syntax:</p><pre tabindex=0><code>!lwe.new_lwe_plaintext&lt;
  ApplicationDataAttr,   # application_data
  PlaintextSpaceAttr   # plaintext_space
&gt;
</code></pre><h4 id=parameters-19>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>application_data</td><td style=text-align:center><code>ApplicationDataAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintext_space</td><td style=text-align:center><code>PlaintextSpaceAttr</code></td><td></td></tr></tbody></table><h3 id=newlwepublickeytype>NewLWEPublicKeyType</h3><p>A public key for LWE</p><p>Syntax:</p><pre tabindex=0><code>!lwe.new_lwe_public_key&lt;
  KeyAttr,   # key
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><h4 id=parameters-20>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr></tbody></table><h3 id=newlwesecretkeytype>NewLWESecretKeyType</h3><p>A secret key for LWE</p><p>Syntax:</p><pre tabindex=0><code>!lwe.new_lwe_secret_key&lt;
  KeyAttr,   # key
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><h4 id=parameters-21>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr></tbody></table><h3 id=rlweciphertexttype>RLWECiphertextType</h3><p>A type for RLWE ciphertexts</p><p>Syntax:</p><pre tabindex=0><code>!lwe.rlwe_ciphertext&lt;
  ::mlir::Attribute,   # encoding
  RLWEParamsAttr,   # rlwe_params
  Type   # underlying_type
&gt;
</code></pre><h4 id=parameters-22>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>::mlir::Attribute</code></td><td></td></tr><tr><td style=text-align:center>rlwe_params</td><td style=text-align:center><code>RLWEParamsAttr</code></td><td></td></tr><tr><td style=text-align:center>underlying_type</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=rlweplaintexttype>RLWEPlaintextType</h3><p>A type for RLWE plaintexts</p><p>Syntax:</p><pre tabindex=0><code>!lwe.rlwe_plaintext&lt;
  ::mlir::Attribute,   # encoding
  ::mlir::heir::polynomial::RingAttr,   # ring
  Type   # underlying_type
&gt;
</code></pre><h4 id=parameters-23>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>::mlir::Attribute</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr><tr><td style=text-align:center>underlying_type</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=rlwepublickeytype>RLWEPublicKeyType</h3><p>A public key for RLWE</p><p>Syntax:</p><pre tabindex=0><code>!lwe.rlwe_public_key&lt;
  RLWEParamsAttr   # rlwe_params
&gt;
</code></pre><h4 id=parameters-24>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rlwe_params</td><td style=text-align:center><code>RLWEParamsAttr</code></td><td></td></tr></tbody></table><h3 id=rlwesecretkeytype>RLWESecretKeyType</h3><p>A secret key for RLWE</p><p>Syntax:</p><pre tabindex=0><code>!lwe.rlwe_secret_key&lt;
  RLWEParamsAttr   # rlwe_params
&gt;
</code></pre><h4 id=parameters-25>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rlwe_params</td><td style=text-align:center><code>RLWEParamsAttr</code></td><td></td></tr></tbody></table><h2 id=lwe-ops>LWE ops</h2><h3 id=lweadd-heirlweaddop><code>lwe.add</code> (heir::lwe::AddOp)</h3><p><em>Add two LWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.add` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for LWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for LWE ciphertexts</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for LWE ciphertexts</td></tr></tbody></table><h3 id=lweencode-heirlweencodeop><code>lwe.encode</code> (heir::lwe::EncodeOp)</h3><p><em>Encode an integer to yield an LWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.encode` $plaintext attr-dict `:` qualified(type($plaintext)) `to` qualified(type($output))
</code></pre><p>Encode an integer to yield an LWE plaintext.</p><p>This op uses a an encoding attribute to encode the bits of the integer into
an LWE plaintext value that can then be encrypted.</p><p>Examples:</p><pre tabindex=0><code>%Y = lwe.encode %value {encoding = #enc}: i1 to !lwe.lwe_plaintext&lt;encoding = #enc&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>encoding</code></td><td>::mlir::Attribute</td><td>An attribute describing encoded LWE plaintexts using bit fields. or An attribute describing unspecified bit field encodings.</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for LWE plaintexts</td></tr></tbody></table><h3 id=lwemul_scalar-heirlwemulscalarop><code>lwe.mul_scalar</code> (heir::lwe::MulScalarOp)</h3><p><em>Multiply an LWE ciphertext by a scalar</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.mul_scalar` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td>ciphertext-like</td></tr><tr><td style=text-align:center><code>scalar</code></td><td>integer</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=lweradd-heirlweraddop><code>lwe.radd</code> (heir::lwe::RAddOp)</h3><p><em>Add two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.radd` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=lwerlwe_decode-heirlwerlwedecodeop><code>lwe.rlwe_decode</code> (heir::lwe::RLWEDecodeOp)</h3><p><em>Decode an RLWE plaintext to an underlying type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_decode` $input attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>encoding</code></td><td>::mlir::Attribute</td><td>An attribute describing encoded RLWE plaintexts via coefficients. or An attribute describing encoded RLWE plaintexts via evaluations at fixed points. or An attribute describing encoded RLWE plaintexts via the rounded inverse canonical embedding.</td></tr><tr><td><code>ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like</td></tr></tbody></table><h3 id=lwerlwe_decrypt-heirlwerlwedecryptop><code>lwe.rlwe_decrypt</code> (heir::lwe::RLWEDecryptOp)</h3><p><em>Decrypt an RLWE ciphertext to a RLWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_decrypt` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Decrypt an RLWE ciphertext to yield a RLWE plaintext</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>secret_key</code></td><td>A secret key for RLWE</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h3 id=lwerlwe_encode-heirlwerlweencodeop><code>lwe.rlwe_encode</code> (heir::lwe::RLWEEncodeOp)</h3><p><em>Encode an integer to yield an RLWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_encode` $input attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Encode an integer to yield an RLWE plaintext.</p><p>This op uses a an encoding attribute to encode the bits of the integer into
an RLWE plaintext value that can then be encrypted. CKKS cleartext inputs may
be floating points, and a scaling factor described by the encoding will be
applied.</p><p>Examples:</p><pre tabindex=0><code>%Y = lwe.rlwe_encode %value {encoding = #enc, ring = #ring}: i1 to !lwe.rlwe_plaintext&lt;encoding = #enc, ring = #ring&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>encoding</code></td><td>::mlir::Attribute</td><td>An attribute describing encoded RLWE plaintexts via coefficients. or An attribute describing encoded RLWE plaintexts via evaluations at fixed points. or An attribute describing encoded RLWE plaintexts via the rounded inverse canonical embedding.</td></tr><tr><td><code>ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h3 id=lwerlwe_encrypt-heirlwerlweencryptop><code>lwe.rlwe_encrypt</code> (heir::lwe::RLWEEncryptOp)</h3><p><em>Encrypt an RLWE plaintext to a RLWE ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_encrypt` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Encrypt an RLWE plaintext to yield a RLWE ciphertext.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE plaintexts</td></tr><tr><td style=text-align:center><code>key</code></td><td>A secret key for RLWE or A public key for RLWE</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=lwermul-heirlwermulop><code>lwe.rmul</code> (heir::lwe::RMulOp)</h3><p><em>Multiplies two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rmul` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameTypeOperands</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=lwernegate-heirlwernegateop><code>lwe.rnegate</code> (heir::lwe::RNegateOp)</h3><p><em>Negate a RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rnegate` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ciphertext-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ciphertext-like</td></tr></tbody></table><h3 id=lwersub-heirlwersubop><code>lwe.rsub</code> (heir::lwe::RSubOp)</h3><p><em>Subtract two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rsub` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=lwetrivial_encrypt-heirlwetrivialencryptop><code>lwe.trivial_encrypt</code> (heir::lwe::TrivialEncryptOp)</h3><p><em>Create a trivial encryption of a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.trivial_encrypt` operands attr-dict `:`  qualified(type(operands)) `to` qualified(type(results))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>params</code></td><td>::mlir::heir::lwe::LWEParamsAttr</td><td></td></tr></table><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for LWE plaintexts</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for LWE ciphertexts</td></tr></tbody></table><h3 id=lwereinterpret_underlying_type-heirlwereinterpretunderlyingtypeop><code>lwe.reinterpret_underlying_type</code> (heir::lwe::ReinterpretUnderlyingTypeOp)</h3><p><em>A placeholder cast from one ciphertext type to another</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.reinterpret_underlying_type` $input attr-dict `:` qualified(type($input)) `to` qualified(type($output))
</code></pre><p>The <code>cast</code> op is thus used to translate <code>underlying_type</code> between
ciphertexts in particular situations , such as when lowering to an API that
does not keep track of types for you.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-75945813f3978b67fb0398cc4f17cb8b>7.7 - ModArith</h1><h2 id=modarith-attributes>ModArith attributes</h2><h3 id=affinemapattr>AffineMapAttr</h3><p>An Attribute containing an AffineMap object</p><p>Syntax:</p><pre tabindex=0><code>affine-map-attribute ::= `affine_map` `&lt;` affine-map `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>AffineMap</code></td><td></td></tr></tbody></table><h3 id=arrayattr>ArrayAttr</h3><p>A collection of other Attribute values</p><p>Syntax:</p><pre tabindex=0><code>array-attribute ::= `[` (attribute-value (`,` attribute-value)*)? `]`
</code></pre><p>An array attribute is an attribute that represents a collection of attribute
values.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;Attribute></code></td><td></td></tr></tbody></table><h3 id=densearrayattr>DenseArrayAttr</h3><p>A dense array of integer or floating point elements.</p><p>A dense array attribute is an attribute that represents a dense array of
primitive element types. Contrary to DenseIntOrFPElementsAttr this is a
flat unidimensional array which does not have a storage optimization for
splat. This allows to expose the raw array through a C++ API as
<code>ArrayRef&lt;T></code> for compatible types. The element type must be bool or an
integer or float whose bitwidth is a multiple of 8. Bool elements are stored
as bytes.</p><p>This is the base class attribute. Access to C++ types is intended to be
managed through the subclasses <code>DenseI8ArrayAttr</code>, <code>DenseI16ArrayAttr</code>,
<code>DenseI32ArrayAttr</code>, <code>DenseI64ArrayAttr</code>, <code>DenseF32ArrayAttr</code>,
and <code>DenseF64ArrayAttr</code>.</p><p>Syntax:</p><pre tabindex=0><code>dense-array-attribute ::= `array` `&lt;` (integer-type | float-type)
                                      (`:` tensor-literal)? `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>.,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>.&gt;</span>
</span></span></code></pre></div><p>When a specific subclass is used as argument of an operation, the
declarative assembly will omit the type and print directly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>size</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>::llvm::ArrayRef&lt;char></code></td><td>64-bit aligned storage for dense array elements</td></tr></tbody></table><h3 id=denseintorfpelementsattr>DenseIntOrFPElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of integer or floating-point values</p><p>Syntax:</p><pre tabindex=0><code>tensor-literal ::= integer-literal | float-literal | bool-literal | [] | [tensor-literal (, tensor-literal)* ]
dense-intorfloat-elements-attribute ::= `dense` `&lt;` tensor-literal `&gt;` `:`
                                        ( tensor-type | vector-type )
</code></pre><p>A dense int-or-float elements attribute is an elements attribute containing
a densely packed vector or tensor of integer or floating-point values. The
element type of this attribute is required to be either an <code>IntegerType</code> or
a <code>FloatType</code>.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of integer values.
dense&lt;10&gt; : tensor&lt;2xi32&gt;
// A tensor of 2 float32 elements.
dense&lt;[10.0, 11.0]&gt; : tensor&lt;2xf32&gt;
</code></pre><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>ArrayRef&lt;char></code></td><td></td></tr></tbody></table><h3 id=denseresourceelementsattr>DenseResourceElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array backed by a resource</p><p>Syntax:</p><pre tabindex=0><code>dense-resource-elements-attribute ::=
  `dense_resource` `&lt;` resource-handle `&gt;` `:` shaped-type
</code></pre><p>A dense resource elements attribute is an elements attribute backed by a
handle to a builtin dialect resource containing a densely packed array of
values. This class provides the low-level attribute, which should only be
interacted with in very generic terms, actual access to the underlying
resource data is intended to be managed through one of the subclasses, such
as; <code>DenseBoolResourceElementsAttr</code>, <code>DenseUI64ResourceElementsAttr</code>,
<code>DenseI32ResourceElementsAttr</code>, <code>DenseF32ResourceElementsAttr</code>,
<code>DenseF64ResourceElementsAttr</code>, etc.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;example.user_op&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr =</span> dense_resource<span style=color:#000;font-weight:700>&lt;</span>blob1<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#a40000>-#</span>
</span></span><span style=display:flex><span>dialect_resources<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    builtin<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      blob1<span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;0x08000000010000000000000002000000000000000300000000000000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#a40000>#-</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawHandle</td><td style=text-align:center><code>DenseResourceElementsHandle</code></td><td></td></tr></tbody></table><h3 id=densestringelementsattr>DenseStringElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of strings</p><p>Syntax:</p><pre tabindex=0><code>dense-string-elements-attribute ::= `dense` `&lt;` attribute-value `&gt;` `:`
                                    ( tensor-type | vector-type )
</code></pre><p>A dense string elements attribute is an elements attribute containing a
densely packed vector or tensor of string values. There are no restrictions
placed on the element type of this attribute, enabling the use of dialect
specific string types.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of strings.
dense&lt;&#34;example&#34;&gt; : tensor&lt;2x!foo.string&gt;
// A tensor of 2 string elements.
dense&lt;[&#34;example1&#34;, &#34;example2&#34;]&gt; : tensor&lt;2x!foo.string&gt;
</code></pre><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>ArrayRef&lt;StringRef></code></td><td></td></tr></tbody></table><h3 id=dictionaryattr>DictionaryAttr</h3><p>An dictionary of named Attribute values</p><p>Syntax:</p><pre tabindex=0><code>dictionary-attribute ::= `{` (attribute-entry (`,` attribute-entry)*)? `}`
</code></pre><p>A dictionary attribute is an attribute that represents a sorted collection of
named attribute values. The elements are sorted by name, and each name must be
unique within the collection.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr_name =</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>int_attr =</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attr name&#34;</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;NamedAttribute></code></td><td></td></tr></tbody></table><h3 id=floatattr>FloatAttr</h3><p>An Attribute containing a floating-point value</p><p>Syntax:</p><pre tabindex=0><code>float-attribute ::= (float-literal (`:` float-type)?)
                  | (hexadecimal-literal `:` float-type)
</code></pre><p>A float attribute is a literal attribute that represents a floating point
value of the specified <a href=#floating-point-types>float type</a>. It can be
represented in the hexadecimal form where the hexadecimal value is
interpreted as bits of the underlying binary representation. This form is
useful for representing infinity and NaN floating point values. To avoid
confusion with integer attributes, hexadecimal literals <em>must</em> be followed
by a float type to define a float attribute.</p><p>Examples:</p><pre tabindex=0><code>42.0         // float attribute defaults to f64 type
42.0 : f32   // float attribute of f32 type
0x7C00 : f16 // positive infinity
0x7CFF : f16 // NaN (one of possible values)
42 : f32     // Error: expected integer type
</code></pre><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::APFloat</code></td><td></td></tr></tbody></table><h3 id=integerattr>IntegerAttr</h3><p>An Attribute containing a integer value</p><p>Syntax:</p><pre tabindex=0><code>integer-attribute ::= (integer-literal ( `:` (index-type | integer-type) )?)
                      | `true` | `false`
</code></pre><p>An integer attribute is a literal attribute that represents an integral
value of the specified integer or index type. <code>i1</code> integer attributes are
treated as <code>boolean</code> attributes, and use a unique assembly format of either
<code>true</code> or <code>false</code> depending on the value. The default type for non-boolean
integer attributes, if a type is not specified, is signless 64-bit integer.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span>    <span style=color:#8f5902;font-style:italic>// : i64 is implied here.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>true  <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>false <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span></code></pre></div><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>APInt</code></td><td></td></tr></tbody></table><h3 id=integersetattr>IntegerSetAttr</h3><p>An Attribute containing an IntegerSet object</p><p>Syntax:</p><pre tabindex=0><code>integer-set-attribute ::= `affine_set` `&lt;` integer-set `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_set<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span>d0 <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>IntegerSet</code></td><td></td></tr></tbody></table><h3 id=opaqueattr>OpaqueAttr</h3><p>An opaque representation of another Attribute</p><p>Syntax:</p><pre tabindex=0><code>opaque-attribute ::= dialect-namespace `&lt;` attr-data `&gt;`
</code></pre><p>Opaque attributes represent attributes of non-registered dialects. These are
attribute represented in their raw string form, and can only usefully be
tested for attribute equality.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#dialect</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;opaque attribute data&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>dialectNamespace</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>attrData</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=sparseelementsattr>SparseElementsAttr</h3><p>An opaque representation of a multi-dimensional array</p><p>Syntax:</p><pre tabindex=0><code>sparse-elements-attribute ::= `sparse` `&lt;` attribute-value `,`
                              attribute-value `&gt;` `:`
                              ( tensor-type | vector-type )
</code></pre><p>A sparse elements attribute is an elements attribute that represents a
sparse vector or tensor object. This is where very few of the elements are
non-zero.</p><p>The attribute uses COO (coordinate list) encoding to represent the sparse
elements of the elements attribute. The indices are stored via a 2-D tensor
of 64-bit integer elements with shape [N, ndims], which specifies the
indices of the elements in the sparse tensor that contains non-zero values.
The element values are stored via a 1-D tensor with shape [N], that supplies
the corresponding values for the indices.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>sparse<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This represents the following tensor:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///  [[1, 0, 0, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 5, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 0, 0]]
</span></span></span></code></pre></div><h4 id=parameters-11>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>indices</td><td style=text-align:center><code>DenseIntElementsAttr</code></td><td></td></tr><tr><td style=text-align:center>values</td><td style=text-align:center><code>DenseElementsAttr</code></td><td></td></tr></tbody></table><h3 id=stringattr>StringAttr</h3><p>An Attribute containing a string</p><p>Syntax:</p><pre tabindex=0><code>string-attribute ::= string-literal (`:` type)?
</code></pre><p>A string attribute is an attribute that represents a string literal value.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;An important string&#34;</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;string with a type&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>string
</span></span></code></pre></div><h4 id=parameters-12>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=symbolrefattr>SymbolRefAttr</h3><p>An Attribute containing a symbolic reference to an Operation</p><p>Syntax:</p><pre tabindex=0><code>symbol-ref-attribute ::= symbol-ref-id (`::` symbol-ref-id)*
</code></pre><p>A symbol reference attribute is a literal attribute that represents a named
reference to an operation that is nested within an operation with the
<code>OpTrait::SymbolTable</code> trait. As such, this reference is given meaning by
the nearest parent operation containing the <code>OpTrait::SymbolTable</code> trait. It
may optionally contain a set of nested references that further resolve to a
symbol nested within a different symbol table.</p><p><strong>Rationale:</strong> Identifying accesses to global data is critical to
enabling efficient multi-threaded compilation. Restricting global
data access to occur through symbols and limiting the places that can
legally hold a symbol reference simplifies reasoning about these data
accesses.</p><p>See <a href=../SymbolsAndSymbolTables.md><code>Symbols And SymbolTables</code></a> for more
information.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>@flat_reference</span>
</span></span><span style=display:flex><span><span style=color:#000>@parent_reference</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>@nested_reference</span>
</span></span></code></pre></div><h4 id=parameters-13>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rootReference</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>nestedReferences</td><td style=text-align:center><code>::llvm::ArrayRef&lt;FlatSymbolRefAttr></code></td><td></td></tr></tbody></table><h3 id=typeattr>TypeAttr</h3><p>An Attribute containing a Type</p><p>Syntax:</p><pre tabindex=0><code>type-attribute ::= type
</code></pre><p>A type attribute is an attribute that represents a
<a href=#type-system>type object</a>.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>type
</span></span></code></pre></div><h4 id=parameters-14>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=unitattr>UnitAttr</h3><p>An Attribute value of <code>unit</code> type</p><p>Syntax:</p><pre tabindex=0><code>unit-attribute ::= `unit`
</code></pre><p>A unit attribute is an attribute that represents a value of <code>unit</code> type. The
<code>unit</code> type allows only one value forming a singleton set. This attribute
value is used to represent attributes that only have meaning from their
existence.</p><p>One example of such an attribute could be the <code>swift.self</code> attribute. This
attribute indicates that a function parameter is the self/context parameter.
It could be represented as a <a href=#boolean-attribute>boolean attribute</a>(true or
false), but a value of false doesn&rsquo;t really bring any value. The parameter
either is the self/context or it isn&rsquo;t.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute defined with the `unit` value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@verbose_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>dialectName.unitAttr =</span> unit<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute in an attribute dictionary can also be defined without
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span>dialectName<span style=color:#000;font-weight:700>.</span>unitAttr<span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=modarithattr>ModArithAttr</h3><p>a typed mod_arith attribute</p><p>Syntax:</p><pre tabindex=0><code>#mod_arith.int&lt;
  ::mlir::heir::mod_arith::ModArithType,   # type
  mlir::IntegerAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#attr</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>#attr_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#mod_arith.int</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-15>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::heir::mod_arith::ModArithType</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>mlir::IntegerAttr</code></td><td></td></tr></tbody></table><h3 id=stridedlayoutattr>StridedLayoutAttr</h3><p>An Attribute representing a strided layout of a shaped type</p><p>Syntax:</p><pre tabindex=0><code>strided-layout-attribute ::= `strided` `&lt;` `[` stride-list `]`
                             (`,` `offset` `:` dimension)? `&gt;`
stride-list ::= /*empty*/
              | dimension (`,` dimension)*
dimension ::= decimal-literal | `?`
</code></pre><p>A strided layout attribute captures layout information of the memref type in
the canonical form. Specifically, it contains a list of <em>strides</em>, one for
each dimension. A stride is the number of elements in the linear storage
one must step over to reflect an increment in the given dimension. For
example, a <code>MxN</code> row-major contiguous shaped type would have the strides
<code>[N, 1]</code>. The layout attribute also contains the <em>offset</em> from the base
pointer of the shaped type to the first effectively accessed element,
expressed in terms of the number of contiguously stored elements.</p><p>Strides must be positive and the offset must be non-negative. Both the
strides and the offset may be <em>dynamic</em>, i.e. their value may not be known
at compile time. This is expressed as a <code>?</code> in the assembly syntax and as
<code>ShapedType::kDynamic</code> in the code. Stride and offset values
must satisfy the constraints above at runtime, the behavior is undefined
otherwise.</p><p>See [Dialects/Builtin.md#memreftype](MemRef type) for more information.</p><h4 id=parameters-16>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>offset</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>strides</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td>array of strides (64-bit integer)</td></tr></tbody></table><h2 id=modarith-types>ModArith types</h2><h3 id=modarithtype>ModArithType</h3><p>Integer type with modular arithmetic</p><p>Syntax:</p><pre tabindex=0><code>!mod_arith.int&lt;
  ::mlir::IntegerAttr   # modulus
&gt;
</code></pre><p><code>mod_arith.int&lt;p></code> represents an element of the ring of integers modulo $p$.
The <code>modulus</code> attribute is the ring modulus, and <code>mod_arith</code> operations lower to
<code>arith</code> operations that produce results in the range <code>[0, modulus)</code>, often called
the <em>canonical representative</em>.</p><p><code>modulus</code> is specified with an integer type suffix, for example,
<code>mod_arith.int&lt;65537 : i32></code>. This corresponds to the storage type for the
modulus, and is <code>i64</code> by default.</p><p>It is required that the underlying integer type should be larger than
twice the modulus (have one extra bit of storage space) to avoid signedness
issues. For example, when <code>modulus == 2 ** 32 - 1</code>, the underlying type
for the modulus should be at least <code>i33</code>, though <code>i64</code> is a natural choice.</p><p>Passes may allow intermediate values that do not always produce a
canonical representative in <code>[0, modulus)</code>. For example, if the machine storage
type is <code>i64</code>, but the <code>modulus</code> fits within an <code>i32</code>, a lowering could
allow intermediate arithmetic values to grow to as large as an <code>i64</code> before
reducing them. However, all passes must ensure that values used outside
the local scope (e.g., function return values or arguments to calls to linked
functions) are appropriately reduced to the canonical representative.
<code>modulus</code> is the modulus the arithmetic working with.</p><p>Examples:</p><pre tabindex=0><code>!Zp1 = !mod_arith.int&lt;7&gt; // implicitly being i64
!Zp2 = !mod_arith.int&lt;65537 : i32&gt;
!Zp3 = !mod_arith.int&lt;536903681 : i64&gt;
</code></pre><h4 id=parameters-17>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>modulus</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr></tbody></table><h2 id=modarith-ops>ModArith ops</h2><h3 id=mod_arithadd-heirmod_arithaddop><code>mod_arith.add</code> (heir::mod_arith::AddOp)</h3><p><em>Modular addition operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.add` operands attr-dict `:` type($output)
</code></pre><p>Computes modular addition.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithbarrett_reduce-heirmod_arithbarrettreduceop><code>mod_arith.barrett_reduce</code> (heir::mod_arith::BarrettReduceOp)</h3><p><em>Compute the first step of the Barrett reduction.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.barrett_reduce` operands attr-dict `:` qualified(type($input))
</code></pre><p>Let $q$ denote a statically known modulus and $b = 4^{w}$, where $w$ is the
smallest bit-width that contains the range $[0, q)$. The Barrett reduce
operation computes <code>barret_reduce x = x - floor(x * floor(b / q) / b) * q</code>.</p><p>Given $0 &lt;= x &lt; q^2$, then this will compute $(x \mod q)$ or $(x \mod q) + q$.</p><p>Traits: <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>modulus</code></td><td>::mlir::IntegerAttr</td><td>arbitrary integer attribute</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like</td></tr></tbody></table><h3 id=mod_arithconstant-heirmod_arithconstantop><code>mod_arith.constant</code> (heir::mod_arith::ConstantOp)</h3><p><em>Define a constant value via an attribute.</em></p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> mod_arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>value</code></td><td>::mlir::heir::mod_arith::ModArithAttr</td><td>a typed mod_arith attribute</td></tr></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>Integer type with modular arithmetic</td></tr></tbody></table><h3 id=mod_arithencapsulate-heirmod_arithencapsulateop><code>mod_arith.encapsulate</code> (heir::mod_arith::EncapsulateOp)</h3><p><em>Encapsulate an integer into a mod_arith type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.encapsulate` operands attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>mod_arith.encapsulate</code> converts the integer to be of mod_arith type.</p><p>It is required that the bitwidth of the input integer type is the same
as that of the storage type of the output mod_arith type.</p><p>Examples:</p><pre tabindex=0><code>mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
mod_arith.encapsulate %c1 : i64 -&gt; mod_arith.int&lt;65537&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithextract-heirmod_arithextractop><code>mod_arith.extract</code> (heir::mod_arith::ExtractOp)</h3><p><em>Extract the integer stored inside mod_arith type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.extract` operands attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>mod_arith.extract</code> extracts the integer inside the mod_arith type.</p><p>It is required that the bitwidth of the output integer type is the same
as that of the storage type of the input mod_arith type.</p><p>Examples:</p><pre tabindex=0><code>%m0 = mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
%m1 = mod_arith.encapsulate %c1 : i64 -&gt; mod_arith.int&lt;65537&gt;
%c2 = mod_arith.extract %m0 : mod_arith.int&lt;65537 : i32&gt; -&gt; i32
%c3 = mod_arith.extract %m1 : mod_arith.int&lt;65537&gt; -&gt; i64
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like</td></tr></tbody></table><h3 id=mod_arithmac-heirmod_arithmacop><code>mod_arith.mac</code> (heir::mod_arith::MacOp)</h3><p><em>Modular multiplication-and-accumulation operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.mac` operands attr-dict `:` type($output)
</code></pre><p><code>mod_arith.mac x, y, z</code> computes $(x * y) + z$</p><p>Unless otherwise specified, the operation assumes all inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>acc</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithmul-heirmod_arithmulop><code>mod_arith.mul</code> (heir::mod_arith::MulOp)</h3><p><em>Modular multiplication operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.mul` operands attr-dict `:` type($output)
</code></pre><p>Computes modular multiplication.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithreduce-heirmod_arithreduceop><code>mod_arith.reduce</code> (heir::mod_arith::ReduceOp)</h3><p><em>Reduce the mod arith type to its canonical representative</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.reduce` operands attr-dict `:` type($output)
</code></pre><p><code>mod_arith.reduce x</code> produces $y$, the canonical representative in $[0, q)$
such that $x \equiv y \mod q$.</p><p>Examples:</p><pre tabindex=0><code>%c0 = arith.constant 65538 : i32
%m0 = mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
// mod_arith.extract %m0 produces 65538
%m1 = mod_arith.reduce %m0 : mod_arith.int&lt;65537: i32&gt;
// mod_arith.extract %m1 produces 1
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithsubifge-heirmod_arithsubifgeop><code>mod_arith.subifge</code> (heir::mod_arith::SubIfGEOp)</h3><p><em>Compute (x >= y) ? x - y : x.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.subifge` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless-integer-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like</td></tr></tbody></table><h3 id=mod_arithsub-heirmod_arithsubop><code>mod_arith.sub</code> (heir::mod_arith::SubOp)</h3><p><em>Modular subtraction operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.sub` operands attr-dict `:` type($output)
</code></pre><p>Computes modular subtraction.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-e397c035ea096bd861aadf40d3fccd0a>7.8 - Openfhe</h1><h1 id=openfhe-dialect>&lsquo;openfhe&rsquo; Dialect</h1><p>The <code>openfhe</code> dialect is an exit dialect for generating c++ code against the OpenFHE library API.</p><p>See <a href=https://github.com/openfheorg/openfhe-development>https://github.com/openfheorg/openfhe-development</a></p><h2 id=openfhe-types>Openfhe types</h2><h3 id=ccparamstype>CCParamsType</h3><p>The CCParams required to create CryptoContext.</p><p>Syntax: <code>!openfhe.cc_params</code></p><h3 id=cryptocontexttype>CryptoContextType</h3><p>The CryptoContext required to perform homomorphic operations in OpenFHE.</p><p>Syntax: <code>!openfhe.crypto_context</code></p><h3 id=evalkeytype>EvalKeyType</h3><p>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</p><p>Syntax: <code>!openfhe.eval_key</code></p><h3 id=privatekeytype>PrivateKeyType</h3><p>The private key required to decrypt a ciphertext in OpenFHE.</p><p>Syntax: <code>!openfhe.private_key</code></p><h3 id=publickeytype>PublicKeyType</h3><p>The public key required to encrypt plaintext in OpenFHE.</p><p>Syntax: <code>!openfhe.public_key</code></p><h2 id=openfhe-ops>Openfhe ops</h2><h3 id=openfheadd-heiropenfheaddop><code>openfhe.add</code> (heir::openfhe::AddOp)</h3><p><em>OpenFHE add operation of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfheadd_plain-heiropenfheaddplainop><code>openfhe.add_plain</code> (heir::openfhe::AddPlainOp)</h3><p><em>OpenFHE add operation of a ciphertext and a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.add_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfheautomorph-heiropenfheautomorphop><code>openfhe.automorph</code> (heir::openfhe::AutomorphOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.automorph` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>evalKey</code></td><td>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhedecrypt-heiropenfhedecryptop><code>openfhe.decrypt</code> (heir::openfhe::DecryptOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.decrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h3 id=openfheencrypt-heiropenfheencryptop><code>openfhe.encrypt</code> (heir::openfhe::EncryptOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.encrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr><tr><td style=text-align:center><code>publicKey</code></td><td>The public key required to encrypt plaintext in OpenFHE.</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhegen_context-heiropenfhegencontextop><code>openfhe.gen_context</code> (heir::openfhe::GenContextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_context` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>The CCParams required to create CryptoContext.</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>context</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr></tbody></table><h3 id=openfhegen_mulkey-heiropenfhegenmulkeyop><code>openfhe.gen_mulkey</code> (heir::openfhe::GenMulKeyOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_mulkey` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h3 id=openfhegen_params-heiropenfhegenparamsop><code>openfhe.gen_params</code> (heir::openfhe::GenParamsOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_params` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>mulDepth</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>plainMod</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>The CCParams required to create CryptoContext.</td></tr></tbody></table><h3 id=openfhegen_rotkey-heiropenfhegenrotkeyop><code>openfhe.gen_rotkey</code> (heir::openfhe::GenRotKeyOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_rotkey` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>indices</code></td><td>::mlir::DenseI64ArrayAttr</td><td>i64 dense array attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h3 id=openfhekey_switch-heiropenfhekeyswitchop><code>openfhe.key_switch</code> (heir::openfhe::KeySwitchOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.key_switch` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>evalKey</code></td><td>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhelevel_reduce-heiropenfhelevelreduceop><code>openfhe.level_reduce</code> (heir::openfhe::LevelReduceOp)</h3><p><em>OpenFHE level_reduce operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.level_reduce` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhemake_ckks_packed_plaintext-heiropenfhemakeckkspackedplaintextop><code>openfhe.make_ckks_packed_plaintext</code> (heir::openfhe::MakeCKKSPackedPlaintextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.make_ckks_packed_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of floating-point or integer values</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h3 id=openfhemake_packed_plaintext-heiropenfhemakepackedplaintextop><code>openfhe.make_packed_plaintext</code> (heir::openfhe::MakePackedPlaintextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.make_packed_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h3 id=openfhemod_reduce-heiropenfhemodreduceop><code>openfhe.mod_reduce</code> (heir::openfhe::ModReduceOp)</h3><p><em>OpenFHE mod_reduce operation of a ciphertext. (used only for BGV/CKKS)</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mod_reduce` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhemul_const-heiropenfhemulconstop><code>openfhe.mul_const</code> (heir::openfhe::MulConstOp)</h3><p><em>OpenFHE mul operation of a ciphertext and a constant.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_const` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>constant</code></td><td>64-bit signless integer</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhemul_no_relin-heiropenfhemulnorelinop><code>openfhe.mul_no_relin</code> (heir::openfhe::MulNoRelinOp)</h3><p><em>OpenFHE mul operation of two ciphertexts without relinearization.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_no_relin` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhemul-heiropenfhemulop><code>openfhe.mul</code> (heir::openfhe::MulOp)</h3><p><em>OpenFHE mul operation of two ciphertexts with relinearization.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhemul_plain-heiropenfhemulplainop><code>openfhe.mul_plain</code> (heir::openfhe::MulPlainOp)</h3><p><em>OpenFHE mul operation of a ciphertext and a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td>A type for RLWE plaintexts</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhenegate-heiropenfhenegateop><code>openfhe.negate</code> (heir::openfhe::NegateOp)</h3><p><em>OpenFHE negate operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.negate` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfherelin-heiropenfherelinop><code>openfhe.relin</code> (heir::openfhe::RelinOp)</h3><p><em>OpenFHE relinearize operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.relin` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfherot-heiropenfherotop><code>openfhe.rot</code> (heir::openfhe::RotOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.rot` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>index</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhesquare-heiropenfhesquareop><code>openfhe.square</code> (heir::openfhe::SquareOp)</h3><p><em>OpenFHE square operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.square` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h3 id=openfhesub-heiropenfhesubop><code>openfhe.sub</code> (heir::openfhe::SubOp)</h3><p><em>OpenFHE sub operation of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A type for RLWE ciphertexts</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A type for RLWE ciphertexts</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b18fea903e4651113f5317788f1491e1>7.9 - Polynomial</h1><h2 id=polynomial-attributes>Polynomial attributes</h2><h3 id=affinemapattr>AffineMapAttr</h3><p>An Attribute containing an AffineMap object</p><p>Syntax:</p><pre tabindex=0><code>affine-map-attribute ::= `affine_map` `&lt;` affine-map `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>AffineMap</code></td><td></td></tr></tbody></table><h3 id=arrayattr>ArrayAttr</h3><p>A collection of other Attribute values</p><p>Syntax:</p><pre tabindex=0><code>array-attribute ::= `[` (attribute-value (`,` attribute-value)*)? `]`
</code></pre><p>An array attribute is an attribute that represents a collection of attribute
values.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;Attribute></code></td><td></td></tr></tbody></table><h3 id=densearrayattr>DenseArrayAttr</h3><p>A dense array of integer or floating point elements.</p><p>A dense array attribute is an attribute that represents a dense array of
primitive element types. Contrary to DenseIntOrFPElementsAttr this is a
flat unidimensional array which does not have a storage optimization for
splat. This allows to expose the raw array through a C++ API as
<code>ArrayRef&lt;T></code> for compatible types. The element type must be bool or an
integer or float whose bitwidth is a multiple of 8. Bool elements are stored
as bytes.</p><p>This is the base class attribute. Access to C++ types is intended to be
managed through the subclasses <code>DenseI8ArrayAttr</code>, <code>DenseI16ArrayAttr</code>,
<code>DenseI32ArrayAttr</code>, <code>DenseI64ArrayAttr</code>, <code>DenseF32ArrayAttr</code>,
and <code>DenseF64ArrayAttr</code>.</p><p>Syntax:</p><pre tabindex=0><code>dense-array-attribute ::= `array` `&lt;` (integer-type | float-type)
                                      (`:` tensor-literal)? `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>.,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>.&gt;</span>
</span></span></code></pre></div><p>When a specific subclass is used as argument of an operation, the
declarative assembly will omit the type and print directly:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>size</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>::llvm::ArrayRef&lt;char></code></td><td>64-bit aligned storage for dense array elements</td></tr></tbody></table><h3 id=denseintorfpelementsattr>DenseIntOrFPElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of integer or floating-point values</p><p>Syntax:</p><pre tabindex=0><code>tensor-literal ::= integer-literal | float-literal | bool-literal | [] | [tensor-literal (, tensor-literal)* ]
dense-intorfloat-elements-attribute ::= `dense` `&lt;` tensor-literal `&gt;` `:`
                                        ( tensor-type | vector-type )
</code></pre><p>A dense int-or-float elements attribute is an elements attribute containing
a densely packed vector or tensor of integer or floating-point values. The
element type of this attribute is required to be either an <code>IntegerType</code> or
a <code>FloatType</code>.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of integer values.
dense&lt;10&gt; : tensor&lt;2xi32&gt;
// A tensor of 2 float32 elements.
dense&lt;[10.0, 11.0]&gt; : tensor&lt;2xf32&gt;
</code></pre><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawData</td><td style=text-align:center><code>ArrayRef&lt;char></code></td><td></td></tr></tbody></table><h3 id=denseresourceelementsattr>DenseResourceElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array backed by a resource</p><p>Syntax:</p><pre tabindex=0><code>dense-resource-elements-attribute ::=
  `dense_resource` `&lt;` resource-handle `&gt;` `:` shaped-type
</code></pre><p>A dense resource elements attribute is an elements attribute backed by a
handle to a builtin dialect resource containing a densely packed array of
values. This class provides the low-level attribute, which should only be
interacted with in very generic terms, actual access to the underlying
resource data is intended to be managed through one of the subclasses, such
as; <code>DenseBoolResourceElementsAttr</code>, <code>DenseUI64ResourceElementsAttr</code>,
<code>DenseI32ResourceElementsAttr</code>, <code>DenseF32ResourceElementsAttr</code>,
<code>DenseF64ResourceElementsAttr</code>, etc.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;example.user_op&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr =</span> dense_resource<span style=color:#000;font-weight:700>&lt;</span>blob1<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#a40000>-#</span>
</span></span><span style=display:flex><span>dialect_resources<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    builtin<span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      blob1<span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;0x08000000010000000000000002000000000000000300000000000000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#a40000>#-</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>rawHandle</td><td style=text-align:center><code>DenseResourceElementsHandle</code></td><td></td></tr></tbody></table><h3 id=densestringelementsattr>DenseStringElementsAttr</h3><p>An Attribute containing a dense multi-dimensional array of strings</p><p>Syntax:</p><pre tabindex=0><code>dense-string-elements-attribute ::= `dense` `&lt;` attribute-value `&gt;` `:`
                                    ( tensor-type | vector-type )
</code></pre><p>A dense string elements attribute is an elements attribute containing a
densely packed vector or tensor of string values. There are no restrictions
placed on the element type of this attribute, enabling the use of dialect
specific string types.</p><p>Examples:</p><pre tabindex=0><code>// A splat tensor of strings.
dense&lt;&#34;example&#34;&gt; : tensor&lt;2x!foo.string&gt;
// A tensor of 2 string elements.
dense&lt;[&#34;example1&#34;, &#34;example2&#34;]&gt; : tensor&lt;2x!foo.string&gt;
</code></pre><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>ArrayRef&lt;StringRef></code></td><td></td></tr></tbody></table><h3 id=dictionaryattr>DictionaryAttr</h3><p>An dictionary of named Attribute values</p><p>Syntax:</p><pre tabindex=0><code>dictionary-attribute ::= `{` (attribute-entry (`,` attribute-entry)*)? `}`
</code></pre><p>A dictionary attribute is an attribute that represents a sorted collection of
named attribute values. The elements are sorted by name, and each name must be
unique within the collection.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>attr_name =</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#f57900>int_attr =</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;string attr name&#34;</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;string attribute&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::ArrayRef&lt;NamedAttribute></code></td><td></td></tr></tbody></table><h3 id=floatattr>FloatAttr</h3><p>An Attribute containing a floating-point value</p><p>Syntax:</p><pre tabindex=0><code>float-attribute ::= (float-literal (`:` float-type)?)
                  | (hexadecimal-literal `:` float-type)
</code></pre><p>A float attribute is a literal attribute that represents a floating point
value of the specified <a href=#floating-point-types>float type</a>. It can be
represented in the hexadecimal form where the hexadecimal value is
interpreted as bits of the underlying binary representation. This form is
useful for representing infinity and NaN floating point values. To avoid
confusion with integer attributes, hexadecimal literals <em>must</em> be followed
by a float type to define a float attribute.</p><p>Examples:</p><pre tabindex=0><code>42.0         // float attribute defaults to f64 type
42.0 : f32   // float attribute of f32 type
0x7C00 : f16 // positive infinity
0x7CFF : f16 // NaN (one of possible values)
42 : f32     // Error: expected integer type
</code></pre><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::APFloat</code></td><td></td></tr></tbody></table><h3 id=integerattr>IntegerAttr</h3><p>An Attribute containing a integer value</p><p>Syntax:</p><pre tabindex=0><code>integer-attribute ::= (integer-literal ( `:` (index-type | integer-type) )?)
                      | `true` | `false`
</code></pre><p>An integer attribute is a literal attribute that represents an integral
value of the specified integer or index type. <code>i1</code> integer attributes are
treated as <code>boolean</code> attributes, and use a unique assembly format of either
<code>true</code> or <code>false</code> depending on the value. The default type for non-boolean
integer attributes, if a type is not specified, is signless 64-bit integer.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10</span>    <span style=color:#8f5902;font-style:italic>// : i64 is implied here.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>true  <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>false <span style=color:#8f5902;font-style:italic>// A bool, i.e. i1, value.
</span></span></span></code></pre></div><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>APInt</code></td><td></td></tr></tbody></table><h3 id=integersetattr>IntegerSetAttr</h3><p>An Attribute containing an IntegerSet object</p><p>Syntax:</p><pre tabindex=0><code>integer-set-attribute ::= `affine_set` `&lt;` integer-set `&gt;`
</code></pre><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_set<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span>d0 <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>IntegerSet</code></td><td></td></tr></tbody></table><h3 id=opaqueattr>OpaqueAttr</h3><p>An opaque representation of another Attribute</p><p>Syntax:</p><pre tabindex=0><code>opaque-attribute ::= dialect-namespace `&lt;` attr-data `&gt;`
</code></pre><p>Opaque attributes represent attributes of non-registered dialects. These are
attribute represented in their raw string form, and can only usefully be
tested for attribute equality.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#dialect</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;opaque attribute data&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>dialectNamespace</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>attrData</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=sparseelementsattr>SparseElementsAttr</h3><p>An opaque representation of a multi-dimensional array</p><p>Syntax:</p><pre tabindex=0><code>sparse-elements-attribute ::= `sparse` `&lt;` attribute-value `,`
                              attribute-value `&gt;` `:`
                              ( tensor-type | vector-type )
</code></pre><p>A sparse elements attribute is an elements attribute that represents a
sparse vector or tensor object. This is where very few of the elements are
non-zero.</p><p>The attribute uses COO (coordinate list) encoding to represent the sparse
elements of the elements attribute. The indices are stored via a 2-D tensor
of 64-bit integer elements with shape [N, ndims], which specifies the
indices of the elements in the sparse tensor that contains non-zero values.
The element values are stored via a 1-D tensor with shape [N], that supplies
the corresponding values for the indices.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>sparse<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This represents the following tensor:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///  [[1, 0, 0, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 5, 0],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>///   [0, 0, 0, 0]]
</span></span></span></code></pre></div><h4 id=parameters-11>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>ShapedType</code></td><td></td></tr><tr><td style=text-align:center>indices</td><td style=text-align:center><code>DenseIntElementsAttr</code></td><td></td></tr><tr><td style=text-align:center>values</td><td style=text-align:center><code>DenseElementsAttr</code></td><td></td></tr></tbody></table><h3 id=stringattr>StringAttr</h3><p>An Attribute containing a string</p><p>Syntax:</p><pre tabindex=0><code>string-attribute ::= string-literal (`:` type)?
</code></pre><p>A string attribute is an attribute that represents a string literal value.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#4e9a06>&#34;An important string&#34;</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;string with a type&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>string
</span></span></code></pre></div><h4 id=parameters-12>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr></tbody></table><h3 id=symbolrefattr>SymbolRefAttr</h3><p>An Attribute containing a symbolic reference to an Operation</p><p>Syntax:</p><pre tabindex=0><code>symbol-ref-attribute ::= symbol-ref-id (`::` symbol-ref-id)*
</code></pre><p>A symbol reference attribute is a literal attribute that represents a named
reference to an operation that is nested within an operation with the
<code>OpTrait::SymbolTable</code> trait. As such, this reference is given meaning by
the nearest parent operation containing the <code>OpTrait::SymbolTable</code> trait. It
may optionally contain a set of nested references that further resolve to a
symbol nested within a different symbol table.</p><p><strong>Rationale:</strong> Identifying accesses to global data is critical to
enabling efficient multi-threaded compilation. Restricting global
data access to occur through symbols and limiting the places that can
legally hold a symbol reference simplifies reasoning about these data
accesses.</p><p>See <a href=../SymbolsAndSymbolTables.md><code>Symbols And SymbolTables</code></a> for more
information.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>@flat_reference</span>
</span></span><span style=display:flex><span><span style=color:#000>@parent_reference</span><span style=color:#000;font-weight:700>::</span><span style=color:#000>@nested_reference</span>
</span></span></code></pre></div><h4 id=parameters-13>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>rootReference</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>nestedReferences</td><td style=text-align:center><code>::llvm::ArrayRef&lt;FlatSymbolRefAttr></code></td><td></td></tr></tbody></table><h3 id=typeattr>TypeAttr</h3><p>An Attribute containing a Type</p><p>Syntax:</p><pre tabindex=0><code>type-attribute ::= type
</code></pre><p>A type attribute is an attribute that represents a
<a href=#type-system>type object</a>.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span>dialect<span style=color:#000;font-weight:700>.</span>type
</span></span></code></pre></div><h4 id=parameters-14>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=unitattr>UnitAttr</h3><p>An Attribute value of <code>unit</code> type</p><p>Syntax:</p><pre tabindex=0><code>unit-attribute ::= `unit`
</code></pre><p>A unit attribute is an attribute that represents a value of <code>unit</code> type. The
<code>unit</code> type allows only one value forming a singleton set. This attribute
value is used to represent attributes that only have meaning from their
existence.</p><p>One example of such an attribute could be the <code>swift.self</code> attribute. This
attribute indicates that a function parameter is the self/context parameter.
It could be represented as a <a href=#boolean-attribute>boolean attribute</a>(true or
false), but a value of false doesn&rsquo;t really bring any value. The parameter
either is the self/context or it isn&rsquo;t.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute defined with the `unit` value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@verbose_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>dialectName.unitAttr =</span> unit<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A unit attribute in an attribute dictionary can also be defined without
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the value specifier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_form</span><span style=color:#000;font-weight:700>()</span> attributes <span style=color:#000;font-weight:700>{</span>dialectName<span style=color:#000;font-weight:700>.</span>unitAttr<span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=floatpolynomialattr>FloatPolynomialAttr</h3><p>an attribute containing a single-variable polynomial with double precision floating point coefficients</p><p>A polynomial attribute represents a single-variable polynomial with double
precision floating point coefficients.</p><p>The polynomial must be expressed as a list of monomial terms, with addition
or subtraction between them. The choice of variable name is arbitrary, but
must be consistent across all the monomials used to define a single
attribute. The order of monomial terms is arbitrary, each monomial degree
must occur at most once.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.float_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1.5</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-15>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>polynomial</td><td style=text-align:center><code>FloatPolynomial</code></td><td></td></tr></tbody></table><h3 id=intpolynomialattr>IntPolynomialAttr</h3><p>an attribute containing a single-variable polynomial with integer coefficients</p><p>A polynomial attribute represents a single-variable polynomial with integer
coefficients, which is used to define the modulus of a <code>RingAttr</code>, as well
as to define constants and perform constant folding for <code>polynomial</code> ops.</p><p>The polynomial must be expressed as a list of monomial terms, with addition
or subtraction between them. The choice of variable name is arbitrary, but
must be consistent across all the monomials used to define a single
attribute. The order of monomial terms is arbitrary, each monomial degree
must occur at most once.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-16>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>polynomial</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomial</code></td><td></td></tr></tbody></table><h3 id=primitiverootattr>PrimitiveRootAttr</h3><p>an attribute containing an integer and its degree as a root of unity</p><p>Syntax:</p><pre tabindex=0><code>#polynomial.primitive_root&lt;
  ::mlir::IntegerAttr,   # value
  ::mlir::IntegerAttr   # degree
&gt;
</code></pre><p>A primitive root attribute stores an integer root <code>value</code> and an integer
<code>degree</code>, corresponding to a primitive root of unity of the given degree in
an unspecified ring.</p><p>This is used as an attribute on <code>polynomial.ntt</code> and <code>polynomial.intt</code> ops
to specify the root of unity used in lowering the transform.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.primitive_root</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>value=</span><span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> degree <span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-17>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr><tr><td style=text-align:center>degree</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr></tbody></table><h3 id=ringattr>RingAttr</h3><p>an attribute specifying a polynomial ring</p><p>Syntax:</p><pre tabindex=0><code>#polynomial.ring&lt;
  Type,   # coefficientType
  ::mlir::heir::polynomial::IntPolynomialAttr   # polynomialModulus
&gt;
</code></pre><p>A ring describes the domain in which polynomial arithmetic occurs. The ring
attribute in <code>polynomial</code> represents the more specific case of polynomials
with a single indeterminate; whose coefficients can be represented by
another MLIR type (<code>coefficientType</code>).</p><p>All semantics pertaining to arithmetic in the ring must be owned by the
coefficient type. For example, if the polynomials are with integer
coefficients taken modulo a prime $p$, then <code>coefficientType</code> must be a
type that represents integers modulo $p$, such as <code>mod_arith&lt;p></code>.</p><p>Additionally, a polynomial ring may specify a <code>polynomialModulus</code>, which
converts polynomial arithmetic to the analogue of modular integer
arithmetic, where each polynomial is represented as its remainder when
dividing by the modulus. For single-variable polynomials, a polynomial
modulus is always specified via a single polynomial.</p><p>An expressive example is polynomials with i32 coefficients, whose
coefficients are taken modulo <code>2**32 - 5</code>, with a polynomial modulus of
<code>x**1024 - 1</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly_mod</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>-1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly_mod</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>:</span> polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In this case, the value of a polynomial is always &ldquo;converted&rdquo; to a
canonical form by applying repeated reductions by setting <code>x**1024 = 1</code>
and simplifying.</p><h4 id=parameters-18>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>coefficientType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>polynomialModulus</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=typedfloatpolynomialattr>TypedFloatPolynomialAttr</h3><p>a typed float_polynomial</p><p>Syntax:</p><pre tabindex=0><code>#polynomial.typed_float_polynomial&lt;
  ::mlir::Type,   # type
  ::mlir::heir::polynomial::FloatPolynomialAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> float<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1.4</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>#poly_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_float_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1.4</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span></code></pre></div><h4 id=parameters-19>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::heir::polynomial::FloatPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=typedintpolynomialattr>TypedIntPolynomialAttr</h3><p>a typed int_polynomial</p><p>Syntax:</p><pre tabindex=0><code>#polynomial.typed_int_polynomial&lt;
  ::mlir::Type,   # type
  ::mlir::heir::polynomial::IntPolynomialAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1 x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>#poly_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1 x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span></code></pre></div><h4 id=parameters-20>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=stridedlayoutattr>StridedLayoutAttr</h3><p>An Attribute representing a strided layout of a shaped type</p><p>Syntax:</p><pre tabindex=0><code>strided-layout-attribute ::= `strided` `&lt;` `[` stride-list `]`
                             (`,` `offset` `:` dimension)? `&gt;`
stride-list ::= /*empty*/
              | dimension (`,` dimension)*
dimension ::= decimal-literal | `?`
</code></pre><p>A strided layout attribute captures layout information of the memref type in
the canonical form. Specifically, it contains a list of <em>strides</em>, one for
each dimension. A stride is the number of elements in the linear storage
one must step over to reflect an increment in the given dimension. For
example, a <code>MxN</code> row-major contiguous shaped type would have the strides
<code>[N, 1]</code>. The layout attribute also contains the <em>offset</em> from the base
pointer of the shaped type to the first effectively accessed element,
expressed in terms of the number of contiguously stored elements.</p><p>Strides must be positive and the offset must be non-negative. Both the
strides and the offset may be <em>dynamic</em>, i.e. their value may not be known
at compile time. This is expressed as a <code>?</code> in the assembly syntax and as
<code>ShapedType::kDynamic</code> in the code. Stride and offset values
must satisfy the constraints above at runtime, the behavior is undefined
otherwise.</p><p>See [Dialects/Builtin.md#memreftype](MemRef type) for more information.</p><h4 id=parameters-21>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>offset</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>strides</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td>array of strides (64-bit integer)</td></tr></tbody></table><h2 id=polynomial-types>Polynomial types</h2><h3 id=polynomialtype>PolynomialType</h3><p>An element of a polynomial ring.</p><p>Syntax:</p><pre tabindex=0><code>!polynomial.polynomial&lt;
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><p>A type for polynomials in a polynomial quotient ring.</p><h4 id=parameters-22>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td>an attribute specifying a polynomial ring</td></tr></tbody></table><h2 id=polynomial-ops>Polynomial ops</h2><h3 id=polynomialadd-heirpolynomialaddop><code>polynomial.add</code> (heir::polynomial::AddOp)</h3><p><em>Addition operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.add` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial addition on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// add two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialconstant-heirpolynomialconstantop><code>polynomial.constant</code> (heir::polynomial::ConstantOp)</h3><p><em>Define a constant polynomial via an attribute.</em></p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>int_poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>int_poly_ty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>float_poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> float<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1.3e06</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>float_poly_ty
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>value</code></td><td>::mlir::Attribute</td><td>a typed float_polynomial or a typed int_polynomial</td></tr></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialfrom_tensor-heirpolynomialfromtensorop><code>polynomial.from_tensor</code> (heir::polynomial::FromTensorOp)</h3><p><em>Creates a polynomial from integer coefficients stored in a tensor.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.from_tensor` $input attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>polynomial.from_tensor</code> creates a polynomial value from a tensor of coefficients.
The input tensor must list the coefficients in degree-increasing order.</p><p>The input one-dimensional tensor may have size at most the degree of the
ring&rsquo;s polynomialModulus generator polynomial, with smaller dimension implying that
all higher-degree terms have coefficient zero.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%two</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>from_elements <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%five</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>from_tensor <span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialintt-heirpolynomialinttop><code>polynomial.intt</code> (heir::polynomial::INTTOp)</h3><p><em>Computes the reverse integer Number Theoretic Transform (NTT).</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.intt` $input attr-dict `:` qualified(type($input)) `-&gt;` type($output)
</code></pre><p><code>polynomial.intt</code> computes the reverse integer Number Theoretic Transform
(INTT) on the input tensor. This is the inverse operation of the
<code>polynomial.ntt</code> operation.</p><p>The input tensor is interpreted as a point-value representation of the
output polynomial at powers of a primitive <code>n</code>-th root of unity (see
<code>polynomial.ntt</code>). The ring of the polynomial is taken from the required
encoding attribute of the tensor.</p><p>The choice of primitive root may be optionally specified.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>root</code></td><td>::mlir::heir::polynomial::PrimitiveRootAttr</td><td>an attribute containing an integer and its degree as a root of unity</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialleading_term-heirpolynomialleadingtermop><code>polynomial.leading_term</code> (heir::polynomial::LeadingTermOp)</h3><p><em>Compute the leading term of the polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.leading_term` operands attr-dict `:` type($input) `-&gt;` `(` type($degree) `,` type($coefficient) `)`
</code></pre><p>The degree of a polynomial is the largest $k$ for which the coefficient
<code>a_k</code> of <code>x^k</code> is nonzero. The leading term is the term <code>a_k * x^k</code>, which
this op represents as a pair of results. The first is the degree <code>k</code> as an
index, and the second is the coefficient, whose type matches the
coefficient type of the polynomial&rsquo;s ring attribute.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>leading_term <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>degree</code></td><td>index</td></tr><tr><td style=text-align:center><code>coefficient</code></td><td>any type</td></tr></tbody></table><h3 id=polynomialmonic_monomial_mul-heirpolynomialmonicmonomialmulop><code>polynomial.monic_monomial_mul</code> (heir::polynomial::MonicMonomialMulOp)</h3><p><em>Multiply a polynomial by a monic monomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.monic_monomial_mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Multiply a polynomial by a monic monomial, meaning a polynomial of the form
<code>1 * x^k</code> for an index operand <code>k</code>.</p><p>In some special rings of polynomials, such as a ring of polynomials
modulo <code>x^n - 1</code>, <code>monomial_mul</code> can be interpreted as a cyclic shift of
the coefficients of the polynomial. For some rings, this results in
optimized lowerings that involve rotations and rescaling of the
coefficients of the input.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>monomialDegree</code></td><td>index</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialmonomial-heirpolynomialmonomialop><code>polynomial.monomial</code> (heir::polynomial::MonomialOp)</h3><p><em>Create a polynomial that consists of a single monomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.monomial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Construct a polynomial that consists of a single monomial term, from its
degree and coefficient as dynamic inputs.</p><p>The coefficient type of the output polynomial&rsquo;s ring attribute must match
the <code>coefficient</code> input type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%deg</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1023</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>monomial <span style=color:#000>%five</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%deg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>coefficient</code></td><td>any type</td></tr><tr><td style=text-align:center><code>degree</code></td><td>index</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialmul-heirpolynomialmulop><code>polynomial.mul</code> (heir::polynomial::MulOp)</h3><p><em>Multiplication operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.mul` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial multiplication on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// multiply two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>mul <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialmul_scalar-heirpolynomialmulscalarop><code>polynomial.mul_scalar</code> (heir::polynomial::MulScalarOp)</h3><p><em>Multiplication by a scalar of the field.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.mul_scalar` operands attr-dict `:` type($polynomial) `,` type($scalar)
</code></pre><p>Multiplies the polynomial operand&rsquo;s coefficients by a given scalar value.
The <code>scalar</code> input must have the same type as the polynomial ring&rsquo;s
coefficientType.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// multiply two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>mul_scalar <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>polynomial</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>scalar</code></td><td>any type</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialntt-heirpolynomialnttop><code>polynomial.ntt</code> (heir::polynomial::NTTOp)</h3><p><em>Computes point-value tensor representation of a polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.ntt` $input attr-dict `:` qualified(type($input)) `-&gt;` type($output)
</code></pre><p><code>polynomial.ntt</code> computes the forward integer Number Theoretic Transform
(NTT) on the input polynomial. It returns a tensor containing a point-value
representation of the input polynomial. The output tensor has shape equal
to the degree of the ring&rsquo;s <code>polynomialModulus</code>. The polynomial&rsquo;s RingAttr
is embedded as the encoding attribute of the output tensor.</p><p>Given an input polynomial <code>F(x)</code> over a ring whose <code>polynomialModulus</code> has
degree <code>n</code>, and a primitive <code>n</code>-th root of unity <code>omega_n</code>, the output is
the list of $n$ evaluations</p><p><code>f[k] = F(omega[n]^k) ; k = {0, ..., n-1}</code></p><p>The choice of primitive root may be optionally specified.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>root</code></td><td>::mlir::heir::polynomial::PrimitiveRootAttr</td><td>an attribute containing an integer and its degree as a root of unity</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h3 id=polynomialsub-heirpolynomialsubop><code>polynomial.sub</code> (heir::polynomial::SubOp)</h3><p><em>Subtraction operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.sub` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial subtraction on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// subtract two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>sub <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialto_tensor-heirpolynomialtotensorop><code>polynomial.to_tensor</code> (heir::polynomial::ToTensorOp)</h3><p><em>Creates a tensor containing the coefficients of a polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.to_tensor` $input attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>polynomial.to_tensor</code> creates a dense tensor value containing the
coefficients of the input polynomial. The output tensor contains the
coefficients in degree-increasing order.</p><p>Operations that act on the coefficients of a polynomial, such as extracting
a specific coefficient or extracting a range of coefficients, should be
implemented by composing <code>to_tensor</code> with the relevant <code>tensor</code> dialect
ops.</p><p>The output tensor has shape equal to the degree of the polynomial ring
attribute&rsquo;s polynomialModulus, including zeroes.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%two</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>from_elements <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%five</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>from_tensor <span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%tensor</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>to_tensor <span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1024x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of any type values</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c9ea40a8d17399f57cdd3c18b53cedef>7.10 - Random</h1><h2 id=random-types>Random types</h2><h3 id=distributiontype>DistributionType</h3><p>A random distribution type</p><p>Syntax:</p><pre tabindex=0><code>!random.distribution&lt;
  ::mlir::heir::random::Distribution   # distribution_type
&gt;
</code></pre><p>A generic type, representing a specific random distribution type of either
uniform or gaussian as an attribute ($distribution_type).</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>distribution_type</td><td style=text-align:center><code>::mlir::heir::random::Distribution</code></td><td></td></tr></tbody></table><h3 id=prngtype>PRNGType</h3><p>A pseudorandom number generator type</p><p>Syntax: <code>!random.prng</code></p><p>A type that provides pseudorandom number generator.</p><h2 id=random-ops>Random ops</h2><h3 id=randomdiscrete_gaussian_distribution-heirrandomdiscretegaussiandistributionop><code>random.discrete_gaussian_distribution</code> (heir::random::DiscreteGaussianDistributionOp)</h3><p><em>Initializes the Discrete Gaussian Distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.discrete_gaussian_distribution` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Initializes the Discrete Gaussian Distribution. The distribution is
initialized with a mean and a standard deviation and pseudorandom generator
that provides the source of the randomness.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>mean</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr><tr><td><code>stddev</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value whose value is non-negative</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A random distribution type</td></tr></tbody></table><h3 id=randomdiscrete_uniform_distribution-heirrandomdiscreteuniformdistributionop><code>random.discrete_uniform_distribution</code> (heir::random::DiscreteUniformDistributionOp)</h3><p><em>Initializes the Discrete Uniform Distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.discrete_uniform_distribution` $input `{` `range` `=` `[` $min `,` $max `]` `}` attr-dict `:` `(` qualified(type($input)) `)` `-&gt;` type($output)
</code></pre><p>Initializes the Discrete Uniform Distribution. The distribution is
initialized with a minimum and a maximum value and pseudo random generator
that provides the source of the randomness. The distribution is inclusive of
the minimum and exclusive of the maximum.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>min</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr><tr><td><code>max</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A random distribution type</td></tr></tbody></table><h3 id=randominit_prng-heirrandominitop><code>random.init_prng</code> (heir::random::InitOp)</h3><p><em>Initializes the pseudorandom number generator with a seed.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.init_prng` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Initializes the PRNG with a seed. The seed is dynamically provided due to
protocols that agree on shared randomness. The PRNG is used to initialized
the random distributions such as the discrete gaussian distribution and the
discrete uniform distribution. This initialization also takes as input a
number of bits that are generated for each number value sampled (num_bits).
For instance, a num_bits of 32 will mean that distributions will generate a
32-bit integer value. We expect that the seed initialization is done statically
and globally once per thread for all distributions; however, if multiple threads are
generating randomness, then seed initialization should be done per thread;
otherwise there is no guarantee of consistent behavior. Thread safety is so
far not considered.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>num_bits</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>seed</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h3 id=randomsample-heirrandomsampleop><code>random.sample</code> (heir::random::SampleOp)</h3><p><em>Samples from a distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.sample` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Samples from the distribution to obtain a random value
or tensor of values.</p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A random distribution type</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-aeae60b865ac85372556b396a5a052ce>7.11 - RNS</h1><h2 id=rns-types>RNS types</h2><h3 id=rnstype>RNSType</h3><p>A residue number system representation</p><p>Syntax:</p><pre tabindex=0><code>!rns.rns&lt;
  ::llvm::ArrayRef&lt;mlir::Type&gt;   # basisTypes
&gt;
</code></pre><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>basisTypes</td><td style=text-align:center><code>::llvm::ArrayRef&lt;mlir::Type></code></td><td></td></tr></tbody></table><h2 id=rns-ops>RNS ops</h2><h2 id=rns-additional-definitions>RNS additional definitions</h2><h1 id=typeinterface-definitions>TypeInterface definitions</h1><h2 id=rnsbasistypeinterface-rnsbasistypeinterface>RNSBasisTypeInterface (<code>RNSBasisTypeInterface</code>)</h2><p>This interface is required for a type to be used as a parameter
to an <code>rns</code> type.</p><h3 id=methods>Methods:</h3><h4 id=iscompatiblewith><code>isCompatibleWith</code></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>isCompatibleWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>mlir</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Type</span> <span style=color:#000>otherRnsBasisType</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>Returns true if this type is compatible with another type in the
same RNS basis. In particular, the set of types used for a single
RNS basis are never equal as types, but instead have some common
attribute that must be checked here. For example, an RNS type where
the basis types are polynomials would return true if the two types
are both polynomial types, even if they have different coefficient
moduli.</p><p>Another example is using mod arith types as the basis types, where
by the nature of chinese reminder theorem, it is required that
the modulus of them must be mutually coprime.</p><p><code>isCompatibleWith</code> must be commutative, in the sense
that <code>type1.isCompatibleWith(type2)</code> if and only if
<code>type2.isCompatibleWith(type1)</code>.</p><p>NOTE: This method <em>must</em> be implemented by the user.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f7ffac8ba93b73b8a62e185ec8643d63>7.12 - Secret</h1><h1 id=secret-dialect>&lsquo;secret&rsquo; Dialect</h1><p>Secret is a dialect for computations that operate on encrypted data.</p><p>Secret is intended to serve as a scheme-agnostic front-end for the HEIR
ecosystem of dialects. It is supposed to be fully interoperable with the
rest of MLIR via secret.generic, while lower-level HEIR dialects would have
custom types for arithmetic on secret integers of various bit widths.</p><h2 id=secret-types>Secret types</h2><h3 id=secrettype>SecretType</h3><p>A secret value</p><p>Syntax:</p><pre tabindex=0><code>!secret.secret&lt;
  Type   # valueType
&gt;
</code></pre><p>A generic wrapper around another MLIR type, representing an encrypted value
but not specifying the manner of encryption. This is useful in HEIR because
the compiler may choose various details of the FHE scheme based on the
properties of the input program, the backend target hardware, and cost
models of the various passes.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>valueType</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h2 id=secret-ops>Secret ops</h2><h3 id=secretcast-heirsecretcastop><code>secret.cast</code> (heir::secret::CastOp)</h3><p><em>A placeholder cast from one secret type to another</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.cast` $input attr-dict `:` qualified(type($input)) `to` qualified(type($output))
</code></pre><p>A <code>cast</code> operation represents a type cast from one secret type to another,
that is used to enable the intermixing of various equivalent secret types
before a lower-level FHE scheme has been chosen.</p><p>For example, <code>secret.cast</code> can be used to convert a <code>secret&lt;i8></code> to a
<code>secret&lt;tensor&lt;8xi1>></code> as a compatibility layer between boolean and
non-boolean parts of a program. The pass that later lowers the IR to
specific FHE schemes would need to replace these casts with appropriate
scheme-specific operations, and it is left to those later passes to
determine which casts are considered valid.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>cast <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%result2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>cast <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#204a87;font-weight:700>i4</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A secret value</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A secret value</td></tr></tbody></table><h3 id=secretconceal-heirsecretconcealop><code>secret.conceal</code> (heir::secret::ConcealOp)</h3><p><em>Convert a non-secret value into a secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.conceal` $cleartext attr-dict `:` type($cleartext) `-&gt;` type($output)
</code></pre><p>Convert a value to a secret containing the same value.</p><p>This op represents a scheme-agnostic encryption operation, as well as a
&ldquo;trivial encryption&rdquo; operation which is needed for some FHE schemes. This
op is also useful for type materialization in the dialect conversion
framework.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>conceal <span style=color:#000>%value</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cleartext</code></td><td>any type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A secret value</td></tr></tbody></table><h3 id=secretgeneric-heirsecretgenericop><code>secret.generic</code> (heir::secret::GenericOp)</h3><p><em>Lift a plaintext computation to operate on secrets.</em></p><p><code>secret.generic</code> lifts a plaintext computation to operate on one or more
secrets. The lifted computation is represented as a region containing a
single block terminated by <code>secret.yield</code>. The arguments of the <code>secret.generic</code>
may include one or more <code>!secret.secret</code> types. The arguments of the block
in the op&rsquo;s body correspond to the underlying plaintext types of the secrets.</p><p><code>secret.generic</code> is not isolated from above, so you may directly reference
values in the enclosing scope. This is required to support using
<code>secret.generic</code> inside of ops with <code>AffineScope</code>, while having the body
of the generic use the induction variables defined by the affine scope.</p><p>Basic examples:</p><p>Add two secret integers together</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>Add a secret value with a plaintext value. I.e., not all arguments to the
op need be secret.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>The same as above, but the plaintext op is not passed through the basic
block.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%y</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>Traits: <code>SingleBlockImplicitTerminator&lt;YieldOp></code>, <code>SingleBlock</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>results</code></td><td>variadic of any type</td></tr></tbody></table><h3 id=secretreveal-heirsecretrevealop><code>secret.reveal</code> (heir::secret::RevealOp)</h3><p><em>Convert a secret value into a non-secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.reveal` $input attr-dict `:` type($input) `-&gt;` type($cleartext)
</code></pre><p>Convert a secret into a non-secret containing the same value.</p><p>This op represents a scheme-agnostic decryption operation. This op is also
useful for target materialization in the dialect conversion framework.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>reveal <span style=color:#000>%secret_value</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A secret value</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cleartext</code></td><td>any type</td></tr></tbody></table><h3 id=secretseparator-heirsecretseparatorop><code>secret.separator</code> (heir::secret::SeparatorOp)</h3><p><em>Convert a non-secret value into a secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.separator` attr-dict ($inputs^ `:` type($inputs))?
</code></pre><p>This operation is used as a separation boundary between logical subunits of
the module. This is used in conjunction with
<code>--secret-distribute-generic=distribute-through=secret.separator</code> to break a
generic around these separators and allow for optimization passses to
analyze and optimize the sub-units locally.</p><p>In order to allow bufferization of modules with this operation, we must
register a (bogus) memory effect that also prevents this operation from
being trivially dead during operation folding.</p><p>This operation also accepts operands, which act as boundaries between the
logical units. This enforces separation of memref and affine optimizations
between the subunits, preventing optimizations from removing the operand and
combining the two separated regions. The operand can be thought of as an
return value of the logical subunit.</p><p>Interfaces: <code>MemoryEffectOpInterface (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{MemoryEffects::Write on ::mlir::SideEffects::DefaultResource}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h3 id=secretyield-heirsecretyieldop><code>secret.yield</code> (heir::secret::YieldOp)</h3><p><em>Secret yield operation</em></p><p><code>secret.yield</code> is a special terminator operation for blocks inside regions
in <code>secret</code> generic ops. It returns the cleartext value of the
corresponding private computation to the immediately enclosing <code>secret</code>
generic op.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>HasParent&lt;GenericOp></code>, <code>ReturnLike</code>, <code>Terminator</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code>, <code>RegionBranchTerminatorOpInterface</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>values</code></td><td>variadic of any type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-ca9ddb02db7c0683037407c6f9eb1f2a>7.13 - TensorExt</h1><h2 id=tensorext-attributes>TensorExt attributes</h2><h3 id=simdpackingattr>SIMDPackingAttr</h3><p>An attribute describing the SIMD packing of a tensor.</p><p>Syntax:</p><pre tabindex=0><code>#tensor_ext.simd_packing&lt;
  ::mlir::DenseI64ArrayAttr,   # in
  ::mlir::DenseI64ArrayAttr,   # padding
  ::mlir::DenseI64ArrayAttr,   # out
  int64_t   # padding_value
&gt;
</code></pre><p>This attribute is used as the encoding attribute on a tensor. It describes
the transformations that were applied to an input tensor to pack it into the
given tensor.</p><p>The <code>in</code> attribute describes the shape of the original tensor.
The following transformations are applied to the input tensor.</p><ol><li><p>Padding is applied first. The <code>padding</code> attribute is an array with the
same size as the input tensor shape. Padding is applied at the end of
the array using the <code>padding_value</code> attribute (default zero). The
result after zero padding should be a power of two.</p></li><li><p>The padded result is replicated or split to fill the output tensor
shape.</p></li></ol><p>For example,</p><pre tabindex=0><code>#packing = #tensor_ext.simd_packing&lt;
  in = [7],
  padding = [1],
  padding_value = 0,
  out = [16],
&gt;
</code></pre><p>may be used on a tensor type like</p><pre tabindex=0><code>tensor&lt;1x16xi32, #packing&gt;
</code></pre><p>If the original tensor had values <code>[1, 2, 3, 4, 5, 6, 7]</code> then a tensor with
this attribute contains the data <code>[1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0]</code>.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>in</td><td style=text-align:center><code>::mlir::DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>padding</td><td style=text-align:center><code>::mlir::DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>out</td><td style=text-align:center><code>::mlir::DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>padding_value</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h2 id=tensorext-ops>TensorExt ops</h2><h3 id=tensor_extrotate-heirtensor_extrotateop><code>tensor_ext.rotate</code> (heir::tensor_ext::RotateOp)</h3><p><em>Rotate a tensor some number of indices left.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.rotate` operands attr-dict `:` qualified(type($tensor)) `,` type($shift)
</code></pre><p>This op represents a left-rotation of a tensor by given number of indices.
Negative shift values are interpreted as right-rotations.</p><p>This corresponds to the <code>rotate</code> operation in arithmetic FHE schemes like
BGV.</p><p>This operation&rsquo;s current behavior allows rotating multi-dimensional tensors
by rotating along the tensor&rsquo;s only non-unit dimension. This assumes the
tensor is packed along the non-unit dimension.</p><p>// In the future, the op will be adjusted to support rotations of general
// multi-dimensional tensors with a vector of rotation indices for each
// dimension. The lowering will implement the correct operations to rotate
// the tensor along the indices given its packing.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>tensor</code></td><td>tensor of any type values</td></tr><tr><td style=text-align:center><code>shift</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tensor of any type values</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-678c1db0f9b2ed4c9d43b790f890bea0>7.14 - TfheRust</h1><h1 id=tfhe_rust-dialect>&rsquo;tfhe_rust&rsquo; Dialect</h1><p>The <code>thfe_rust</code> dialect is an exit dialect for generating rust code against the tfhe-rs library API,
using the shortint parameters and encoding scheme.</p><p>See <a href=https://github.com/zama-ai/tfhe-rs>https://github.com/zama-ai/tfhe-rs</a></p><h2 id=tfherust-types>TfheRust types</h2><h3 id=encryptedint8type>EncryptedInt8Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type</p><p>Syntax: <code>!tfhe_rust.ei8</code></p><h3 id=encryptedint16type>EncryptedInt16Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type</p><p>Syntax: <code>!tfhe_rust.ei16</code></p><h3 id=encryptedint32type>EncryptedInt32Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type</p><p>Syntax: <code>!tfhe_rust.ei32</code></p><h3 id=encryptedint64type>EncryptedInt64Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type</p><p>Syntax: <code>!tfhe_rust.ei64</code></p><h3 id=encryptedint128type>EncryptedInt128Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type</p><p>Syntax: <code>!tfhe_rust.ei128</code></p><h3 id=encryptedint256type>EncryptedInt256Type</h3><p>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</p><p>Syntax: <code>!tfhe_rust.ei256</code></p><h3 id=encrypteduint2type>EncryptedUInt2Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type</p><p>Syntax: <code>!tfhe_rust.eui2</code></p><h3 id=encrypteduint3type>EncryptedUInt3Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type</p><p>Syntax: <code>!tfhe_rust.eui3</code></p><h3 id=encrypteduint4type>EncryptedUInt4Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type</p><p>Syntax: <code>!tfhe_rust.eui4</code></p><h3 id=encrypteduint8type>EncryptedUInt8Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type</p><p>Syntax: <code>!tfhe_rust.eui8</code></p><h3 id=encrypteduint10type>EncryptedUInt10Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type</p><p>Syntax: <code>!tfhe_rust.eui10</code></p><h3 id=encrypteduint12type>EncryptedUInt12Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type</p><p>Syntax: <code>!tfhe_rust.eui12</code></p><h3 id=encrypteduint14type>EncryptedUInt14Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type</p><p>Syntax: <code>!tfhe_rust.eui14</code></p><h3 id=encrypteduint16type>EncryptedUInt16Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type</p><p>Syntax: <code>!tfhe_rust.eui16</code></p><h3 id=encrypteduint32type>EncryptedUInt32Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type</p><p>Syntax: <code>!tfhe_rust.eui32</code></p><h3 id=encrypteduint64type>EncryptedUInt64Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type</p><p>Syntax: <code>!tfhe_rust.eui64</code></p><h3 id=encrypteduint128type>EncryptedUInt128Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type</p><p>Syntax: <code>!tfhe_rust.eui128</code></p><h3 id=encrypteduint256type>EncryptedUInt256Type</h3><p>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type</p><p>Syntax: <code>!tfhe_rust.eui256</code></p><h3 id=lookuptabletype>LookupTableType</h3><p>A univariate lookup table used for programmable bootstrapping.</p><p>Syntax: <code>!tfhe_rust.lookup_table</code></p><h3 id=serverkeytype>ServerKeyType</h3><p>The short int server key required to perform homomorphic operations.</p><p>Syntax: <code>!tfhe_rust.server_key</code></p><h2 id=tfherust-ops>TfheRust ops</h2><h3 id=tfhe_rustapply_lookup_table-heirtfhe_rustapplylookuptableop><code>tfhe_rust.apply_lookup_table</code> (heir::tfhe_rust::ApplyLookupTableOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.apply_lookup_table` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>input</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr><tr><td style=text-align:center><code>lookupTable</code></td><td>A univariate lookup table used for programmable bootstrapping.</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h3 id=tfhe_rustcreate_trivial-heirtfhe_rustcreatetrivialop><code>tfhe_rust.create_trivial</code> (heir::tfhe_rust::CreateTrivialOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.create_trivial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>value</code></td><td>integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h3 id=tfhe_rustgenerate_lookup_table-heirtfhe_rustgeneratelookuptableop><code>tfhe_rust.generate_lookup_table</code> (heir::tfhe_rust::GenerateLookupTableOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.generate_lookup_table` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>truthTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lookupTable</code></td><td>A univariate lookup table used for programmable bootstrapping.</td></tr></tbody></table><h3 id=tfhe_rustscalar_left_shift-heirtfhe_rustscalarleftshiftop><code>tfhe_rust.scalar_left_shift</code> (heir::tfhe_rust::ScalarLeftShiftOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.scalar_left_shift` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr><tr><td style=text-align:center><code>shiftAmount</code></td><td>8-bit integer</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h3 id=tfhe_rustadd-heirtfhe_rustaddop><code>tfhe_rust.add</code> (heir::tfhe_rust::AddOp)</h3><p><em>Arithmetic add of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h3 id=tfhe_rustbitand-heirtfhe_rustbitandop><code>tfhe_rust.bitand</code> (heir::tfhe_rust::BitAndOp)</h3><p><em>Logical AND of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.bitand` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h3 id=tfhe_rustsub-heirtfhe_rustsubop><code>tfhe_rust.sub</code> (heir::tfhe_rust::SubOp)</h3><p><em>Arithmetic sub of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-d46d9ee8aeb1f8889ca7cfc9a061a7cc>7.15 - TfheRustBool</h1><h1 id=tfhe_rust_bool-dialect>&rsquo;tfhe_rust_bool&rsquo; Dialect</h1><p>The <code>tfhe_rust_bool</code> dialect is an exit dialect for generating rust code against the tfhe-rs library API,
using the boolean parameter set.</p><p>See <a href=https://github.com/zama-ai/tfhe-rs>https://github.com/zama-ai/tfhe-rs</a></p><h2 id=tfherustbool-attributes>TfheRustBool attributes</h2><h3 id=tfherustboolgatesattr>TfheRustBoolGatesAttr</h3><p>An Attribute containing an array of strings to store bool gates</p><p>Syntax:</p><pre tabindex=0><code>#tfhe_rust_bool.tfhe_rust_bool_gates&lt;
  ::llvm::ArrayRef&lt;::mlir::heir::tfhe_rust_bool::TfheRustBoolGateEnumAttr&gt;   # gates
&gt;
</code></pre><p>This attributes stores a list of integer identifiers for Boolean gates.</p><p>Uses following mapping:
AND_GATE = 0;
NAND_GATE = 1;
OR_GATE = 2;
NOR_GATE = 3;
XOR_GATE = 4;
XNOR_GATE = 5;
NOT_GATE = 6;</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>gates</td><td style=text-align:center><code>::llvm::ArrayRef&lt;::mlir::heir::tfhe_rust_bool::TfheRustBoolGateEnumAttr></code></td><td></td></tr></tbody></table><h2 id=tfherustbool-types>TfheRustBool types</h2><h3 id=encryptedbooltype>EncryptedBoolType</h3><p>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</p><p>Syntax: <code>!tfhe_rust_bool.eb</code></p><h3 id=packedserverkeytype>PackedServerKeyType</h3><p>The Belfort packed API boolean server key.</p><p>Syntax: <code>!tfhe_rust_bool.server_key_enum</code></p><h3 id=serverkeytype>ServerKeyType</h3><p>The boolean server key required to perform homomorphic operations.</p><p>Syntax: <code>!tfhe_rust_bool.server_key</code></p><h2 id=tfherustbool-ops>TfheRustBool ops</h2><h3 id=tfhe_rust_boolcreate_trivial-heirtfhe_rust_boolcreatetrivialop><code>tfhe_rust_bool.create_trivial</code> (heir::tfhe_rust_bool::CreateTrivialOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.create_trivial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>tfhe rust bool server key</td></tr><tr><td style=text-align:center><code>value</code></td><td>1-bit signless integer</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h3 id=tfhe_rust_booland-heirtfhe_rust_boolandop><code>tfhe_rust_bool.and</code> (heir::tfhe_rust_bool::AndOp)</h3><p><em>Logical AND of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.and` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolmux-heirtfhe_rust_boolmuxop><code>tfhe_rust_bool.mux</code> (heir::tfhe_rust_bool::MuxOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.mux` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>cnd</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h3 id=tfhe_rust_boolnand-heirtfhe_rust_boolnandop><code>tfhe_rust_bool.nand</code> (heir::tfhe_rust_bool::NandOp)</h3><p><em>Logical NAND of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.nand` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolnor-heirtfhe_rust_boolnorop><code>tfhe_rust_bool.nor</code> (heir::tfhe_rust_bool::NorOp)</h3><p><em>Logical NOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.nor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolnot-heirtfhe_rust_boolnotop><code>tfhe_rust_bool.not</code> (heir::tfhe_rust_bool::NotOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.not` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>input</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolor-heirtfhe_rust_boolorop><code>tfhe_rust_bool.or</code> (heir::tfhe_rust_bool::OrOp)</h3><p><em>Logical OR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.or` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolgates_packed-heirtfhe_rust_boolpackedop><code>tfhe_rust_bool.gates_packed</code> (heir::tfhe_rust_bool::PackedOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.gates_packed` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Operation to where different Boolean gates are executed pairwise between elements of two ciphertext arrays.</p><p>For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>packed_gates <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>gates =</span> <span style=color:#000>#tfhe_rust_bool.tfhe_rust_bool_gates</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>server_key<span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>applies an &ldquo;and&rdquo; gate to the first elements of %a and %b and an xor gate to the
second elements.</p><p>Mapping is defined in the BooleanGates.td file.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>gates</code></td><td>::mlir::heir::tfhe_rust_bool::TfheRustBoolGatesAttr</td><td>An Attribute containing an array of strings to store bool gates</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolxnor-heirtfhe_rust_boolxnorop><code>tfhe_rust_bool.xnor</code> (heir::tfhe_rust_bool::XnorOp)</h3><p><em>Logical XNOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.xnor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolxor-heirtfhe_rust_boolxorop><code>tfhe_rust_bool.xor</code> (heir::tfhe_rust_bool::XorOp)</h3><p><em>Logical XOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.xor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h2 id=tfherustbool-additional-definitions>TfheRustBool additional definitions</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-19aafd690c3a7edde7a9c3e1fbaf737f>8 - Passes</h1><h3 id=-align-tensor-sizes><code>-align-tensor-sizes</code></h3><p><em>Resize tensors into tensors with a fixed size final dimension</em></p><p>This pass resizes input tensors with arbitrary sizes into
tensors with whose final dimensions has a fixed size. All input tensors are
required to be one-dimensional. The <code>--size</code> option specifies the size of the
final dimension of the output tensors, and is required to be a power of two.</p><p>To align the tensors in the input IR, the pass first zero pads the input to
the nearest power of two before replicating or splitting it into the output
shape determined by <code>size</code>. The resulting transformation is described in a
<code>SIMDPackingAttr</code> encoding attribute on the final tensor.</p><p>For example, with <code>size=16</code>,a tensor with 7 elements will be zero-padded to 8
elements, and then replicated twice to fill a tensor with size 16. The
<code>SIMDPackingAttr</code> will encode the input shape, the number of elements that
were zero-padded, and the output shape.</p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>7x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#tensor_ext.simd_packing</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>in =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>padding =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>out =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]&gt;&gt;</span>
</span></span></code></pre></div><p>A tensor with 30 elements will be zero padded with 2 elements and split into
two tensors of size 16.</p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>30x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#tensor_ext.simd_packing</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>in =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>padding =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>out =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]&gt;&gt;</span>
</span></span></code></pre></div><p>Note that this pass does not insert any new operations like <code>reshape</code>, but
rather transforms the IR to use tensors with a fixed dimension. This pass may
be used to align the sizes of tensors that represent plaintexts and
ciphertexts in RLWE schemes that support SIMD slots and operations.</p><h4 id=options>Options</h4><pre tabindex=0><code>-size : Power of two size of the final dimension of the output tensors.
</code></pre><h3 id=-apply-folders><code>-apply-folders</code></h3><p><em>Apply all folding patterns from canonicalize</em></p><p>This pass applies all registered folding patterns greedily to the input IR.
This is useful when running a full canonicalize is too slow, but applying
folders before canonicalize is sufficient to simplify the IR for later
passes, or even sufficient to then subsequently run a full canonicalize pass.</p><p>This is used to prepare an IR for <code>insert-rotate</code> after fully unrolling
loops.</p><h3 id=-bgv-to-lwe><code>-bgv-to-lwe</code></h3><p><em>Lower <code>bgv</code> to <code>lwe</code> dialect.</em></p><p>This pass lowers the <code>bgv</code> dialect to <code>lwe</code> dialect.</p><h3 id=-bgv-to-openfhe><code>-bgv-to-openfhe</code></h3><p><em>Lower <code>bgv</code> to <code>openfhe</code> dialect.</em></p><p>This pass lowers the <code>bgv</code> dialect to <code>Openfhe</code> dialect.</p><h3 id=-cggi-boolean-vectorize><code>-cggi-boolean-vectorize</code></h3><p><em>Group different logic gates with the packed API</em></p><p>This pass groups independent logic gates into a single call of the packed
operations. Pass is based on the straight-line-vectorizer, but is fundamentally different.
This pass combines any type of boolean gates and is not restricted to combining the same type of gate operand.</p><p>Pass is intended for the <code>FPT</code> tfhe-rs API, where <code>packed_gates</code> function get a
the boolean gates are passed as a string vector and a left and right vector of ciphertexts.
Each boolean gates specified in <code>gates</code> is then applied element wise.</p><pre tabindex=0><code>let outputs_ct = fpga_key.packed_gates(&amp;gates, &amp;ref_to_ct_lefts, &amp;ref_to_ct_rights);
</code></pre><h4 id=options-1>Options</h4><pre tabindex=0><code>-parallelism : Parallelism factor for batching. 0 is infinite parallelism
</code></pre><h3 id=-cggi-set-default-parameters><code>-cggi-set-default-parameters</code></h3><p><em>Set default parameters for CGGI ops</em></p><p>This pass adds default parameters to all CGGI ops as <code>cggi_params</code> named
attributes, overriding any existing attribute set with that name.</p><p>This pass is primarily for testing purposes, and as a parameter provider
before a proper parameter selection mechanism is added. This pass should not
be used in production.</p><p>The specific parameters are hard-coded in
<code>lib/Dialect/CGGI/Transforms/SetDefaultParameters.cpp</code>.</p><h3 id=-cggi-to-jaxite><code>-cggi-to-jaxite</code></h3><p><em>Lower <code>cggi</code> to <code>jaxite</code> dialect.</em></p><h3 id=-cggi-to-tfhe-rust-bool><code>-cggi-to-tfhe-rust-bool</code></h3><p><em>Lower <code>cggi</code> to <code>tfhe_rust_bool</code> dialect.</em></p><h3 id=-cggi-to-tfhe-rust><code>-cggi-to-tfhe-rust</code></h3><p><em>Lower <code>cggi</code> to <code>tfhe_rust</code> dialect.</em></p><h3 id=-ckks-to-openfhe><code>-ckks-to-openfhe</code></h3><p><em>Lower <code>ckks</code> to <code>openfhe</code> dialect.</em></p><p>This pass lowers the <code>ckks</code> dialect to <code>Openfhe</code> dialect.</p><h3 id=-collapse-insertion-chains><code>-collapse-insertion-chains</code></h3><p><em>Collapse chains of extract/insert ops into rotate ops when possible</em></p><p>This pass is a cleanup pass for <code>insert-rotate</code>. That pass sometimes leaves
behind a chain of insertion operations like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted</span> into <span style=color:#000>%dest</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c6</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_0</span> into <span style=color:#000>%inserted</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_2</span> into <span style=color:#000>%inserted_1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_28</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_29</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_28</span> into <span style=color:#000>%inserted_27</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c15</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>yield <span style=color:#000>%inserted_29</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In many cases, this chain will insert into every index of the <code>dest</code> tensor,
and the extracted values all come from consistently aligned indices of the same
source tensor. In this case, the chain can be collapsed into a single <code>rotate</code>.</p><p>Each index used for insertion or extraction must be constant; this may
require running <code>--canonicalize</code> or <code>--sccp</code> before this pass to apply
folding rules (use <code>--sccp</code> if you need to fold constant through control flow).</p><h3 id=-convert-elementwise-to-affine><code>-convert-elementwise-to-affine</code></h3><p><em>This pass lowers ElementwiseMappable operations to Affine loops.</em></p><p>This pass lowers ElementwiseMappable operations over tensors
to affine loop nests that instead apply the operation to the underlying scalar values.</p><p>Usage:
&lsquo;&ndash;convert-elementwise-to-affine=convert-ops=arith.mulf '
restrict conversion to mulf op from arith dialect.</p><p>&lsquo;&ndash;convert-elementwise-to-affine=convert-ops=arith.addf,arith.divf convert-dialects=bgv&rsquo;
restrict conversion to addf and divf ops from arith dialect and all of the ops in bgv dialect.</p><p>&ndash;convert-elementwise-to-affine=convert-dialects=arith
restrict conversion to arith dialect so ops only from arith dialect is processed.</p><p>&ndash;convert-elementwise-to-affine=convert-ops=arith.addf,arith.mulf
restrict conversion only to these two ops - addf and mulf - from arith dialect.</p><h4 id=options-2>Options</h4><pre tabindex=0><code>-convert-ops      : comma-separated list of ops to run this pass on 
-convert-dialects : comma-separated list of dialects to run this pass on 
</code></pre><h3 id=-convert-if-to-select><code>-convert-if-to-select</code></h3><p><em>Convert scf.if operations on secret conditions to arith.select operations.</em></p><p>Conversion for If-operations that evaluate secret condition to alternative select operations.</p><h3 id=-convert-polynomial-mul-to-ntt><code>-convert-polynomial-mul-to-ntt</code></h3><p><em>Rewrites polynomial operations to their NTT equivalents</em></p><p>Applies a rewrite pattern to convert polynomial multiplication to the
equivalent using the number-theoretic transforms (NTT) when possible.</p><p>Polynomial multiplication can be rewritten as polynomial.NTT
on each operand, followed by modulo elementwise multiplication of the
point-value representation and then the inverse-NTT back to coefficient
representation.</p><h3 id=-convert-secret-extract-to-static-extract><code>-convert-secret-extract-to-static-extract</code></h3><p><em>Convert <code>tensor.extract</code> operations on secret index to static extract operations.</em></p><p>Converts <code>tensor.extract</code> operations that read value at secret index to alternative static <code>tensor.extract</code> operations that extracts value at each index and conditionally selects the value extracted at the secret index.</p><p>Note: Running this pass alone does not result in a data-oblivious program; we have to run the <code>--convert-if-to-select</code> pass to the resulting program to convert the secret-dependent If-operation to a Select-operation.</p><p>Example input:
<code>mlir func.func @main(%secretTensor: !secret.secret&lt;tensor&lt;32xi16>>, %secretIndex: !secret.secret&lt;index>)) -> !secret.secret&lt;i16> { ... %0 = secret.generic ins(%secretTensor, %secretIndex : !secret.secret&lt;tensor&lt;32xi16>>, !secret.secret&lt;index>) { ^bb0(%tensor: tensor&lt;32xi16>, %index: index): // Violation: tensor.extract loads value at secret index %extractedValue = tensor.extract %tensor[%index] : tensor&lt;16xi32> ... }</code></p><pre><code>Output:
```mlir
func.func @main(%secretTensor: !secret.secret&lt;tensor&lt;32xi16&gt;&gt;, %secretIndex: !secret.secret&lt;index&gt;)) -&gt; !secret.secret&lt;i16&gt; {
  ...
  %0 = secret.generic ins(%secretTensor, %secretIndex : !secret.secret&lt;tensor&lt;32xi16&gt;&gt;, !secret.secret&lt;index&gt;) {
  ^bb0(%tensor: tensor&lt;32xi16&gt;, %index: index):
    %extractedValue = affine.for %i=0 to 16 iter_args(%arg= %dummyValue) -&gt; (i32) {
      // 1. Check if %i matches %index
      %cond = arith.cmpi eq, %i, %index : index
      // 2. Extract value at %i
      %value = tensor.extract %tensor[%i] : tensor&lt;16xi32&gt;
      // 3. If %i matches %index, yield %value extracted in (2), else yield %dummyValue
      %result = scf.if %cond -&gt; (i32) {
        scf.yield %value : i32
      } else{
        scf.yield %arg : i32
      }
      // 4. Yield result from (3)
      affine.yield %result : i32
</code></pre><p>}
&mldr;
}</p><pre><code>```
</code></pre><h3 id=-convert-secret-for-to-static-for><code>-convert-secret-for-to-static-for</code></h3><p><em>Convert secret scf.for ops to affine.for ops with constant bounds.</em></p><p>Conversion for For-operation that evaluate secret bound(s) to alternative affine For-operation with constant bound(s).</p><p>It replaces data-dependent bounds with an If-operation to check the bounds, and conditionally execute and yield values from the For-operation&rsquo;s body.
Note: Running this pass alone does not result in a data-oblivious program; we have to run the <code>--convert-if-to-select</code> pass to the resulting program to convert the secret-dependent If-operation to a Select-operation.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretLower</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%secretUpper</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretLower</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretUpper</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;){</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%lower</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%upper</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%lower</span> to <span style=color:#000>%upper</span> step <span style=color:#000>%step</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%val</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretLower</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretUpper</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;){</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%lower</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%upper</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> step <span style=color:#000>%step</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%val</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%lowerCond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sge<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%index</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%upperCond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%index</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>andi <span style=color:#000>%lowerCond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%upperCond</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if<span style=color:#000;font-weight:700>(</span><span style=color:#000>%cond</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h3 id=-convert-secret-insert-to-static-insert><code>-convert-secret-insert-to-static-insert</code></h3><p><em>Convert <code>tensor.insert</code> operations on secret index to static insert operations.</em></p><p>Converts <code>tensor.insert</code> operations that write to secret index to alternative static <code>tensor.insert</code> operations that inserts the inserted value at each index and conditionally selects the newly produced tensor that contains the value at the secret index.</p><p>Note: Running this pass alone does not result in a data-oblivious program; we have to run the <code>--convert-if-to-select</code> pass to the resulting program to convert the secret-dependent If-operation to a Select-operation.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;))</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Violation: tensor.insert writes value at secret index
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%newValue</span> into <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%index</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;))</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secretIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// 1. Check if %i matches the %index
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%index</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// 2. Insert %newValue and produce %newTensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>%newTensor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%value</span> into <span style=color:#000>%inputArg</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// 3. If %i matches %inputIndex, yield %newTensor, else yield unchanged input tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#000>%finalTensor</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%newTensor</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> else<span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// 4. Yield final tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%finalTensor</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-secret-while-to-static-for><code>-convert-secret-while-to-static-for</code></h3><p><em>Convert secret scf.while ops to affine.for ops that have constant bounds.</em></p><p>Convert scf.while with a secret condition to affine.for with constant bounds. It replaces the scf.condition operation found in the scf.while loop with an scf.if operation that conditionally executes operations in the while operation&rsquo;s body and yields values.</p><p>A &ldquo;max_iter&rdquo; attribute should be specified as part of the secret-dependent scf.while operation to successfully transform to a secret-independent affine.for operation. This attribute determines the maximum number of iterations for the new affine.for operation.</p><p>Note: Running this pass alone does not result in a data-oblivious program; we have to run the <code>--convert-if-to-select</code> pass to the resulting program to convert the secret-dependent If-operation to a Select-operation.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// C-like code
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>int main<span style=color:#000;font-weight:700>(</span>int secretInput<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  while <span style=color:#000;font-weight:700>(</span>secretInput <span style=color:#000;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>secretInput =</span> secretInput <span style=color:#000;font-weight:700>*</span> secretInput<span style=color:#a40000>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> secretInput<span style=color:#a40000>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// MLIR
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>while <span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sgt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>condition<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> do <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sgt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-tensor-to-scalars><code>-convert-tensor-to-scalars</code></h3><p><em>Effectively &lsquo;unrolls&rsquo; tensors of static shape to scalars.</em></p><p>This pass will convert a static-shaped tensor type to a TypeRange
containing product(dim) copies of the element type of the tensor.
This pass currently includes two patterns:</p><ol><li>It converts tensor.from_elements operations to
the corresponding scalar inputs.</li><li>It converts tensor.insert operations by updating the
ValueRange corresponding to the converted input and
updating it with the scalar to be inserted.</li></ol><p>It also applies folders greedily to simplify, e.g., extract(from_elements).</p><p>Note: The pass is designed to be run on an IR, where the only operations
with tensor typed operands are tensor &ldquo;management&rdquo; operations such as insert/extract,
with all other operations (e.g., arith operations) already taking (extracted) scalar inputs.
For example, an IR where elementwise operations have been converted to scalar operations via
<code>--convert-elementwise-to-affine</code>.</p><p>The pass might insert new tensor.from_elements operations or manually create the scalar ValueRange
via inserting tensor.extract operations if any operations remain that operate on tensors.
The pass currently applies irrespective of tensor size, i.e., might be very slow for large tensors.</p><p>TODO (#1023): Extend this pass to support more tensor operations, e.g., <code>tensor.slice</code></p><h4 id=options-3>Options</h4><pre tabindex=0><code>-max-size : Limits `unrolling` to tensors with at most max-size elements
</code></pre><h3 id=-expand-copy><code>-expand-copy</code></h3><p><em>Expands memref.copy ops to explicit affine loads and stores</em></p><p>This pass removes memref copy operations by expanding them to affine loads
and stores. This pass introduces affine loops over the dimensions of the
MemRef, so must be run prior to any affine loop unrolling in a pipeline.</p><p>Input</p><pre tabindex=0><code>module {
  func.func @memref_copy() {
    %alloc = memref.alloc() : memref&lt;2x3xi32&gt;
    %alloc_0 = memref.alloc() : memref&lt;2x3xi32&gt;
    memref.copy %alloc, %alloc_0 : memref&lt;1x1xi32&gt; to memref&lt;1x1xi32&gt;
  }
}
</code></pre><p>Output</p><pre tabindex=0><code>module {
  func.func @memref_copy() {
    %alloc = memref.alloc() : memref&lt;2x3xi32&gt;
    %alloc_0 = memref.alloc() : memref&lt;2x3xi32&gt;
    affine.for %arg0 = 0 to 2 {
      affine.for %arg1 = 0 to 3 {
        %1 = affine.load %alloc[%arg0, %arg1] : memref&lt;2x3xi32&gt;
        affine.store %1, %alloc_0[%arg0, %arg1] : memref&lt;2x3xi32&gt;
      }
    }
  }
}
</code></pre><p>When <code>--disable-affine-loop=true</code> is set, then the output becomes</p><pre tabindex=0><code>module {
  func.func @memref_copy() {
    %alloc = memref.alloc() : memref&lt;2x3xi32&gt;
    %alloc_0 = memref.alloc() : memref&lt;2x3xi32&gt;
    %c0 = arith.constant 0 : index
    %c1 = arith.constant 1 : index
    %c2 = arith.constant 2 : index
    %0 = affine.load %alloc[%c0, %c0] : memref&lt;2x3xi32&gt;
    affine.store %0, %alloc_0[%c0, %c0] : memref&lt;2x3xi32&gt;
    %1 = affine.load %alloc[%c0, %c1] : memref&lt;2x3xi32&gt;
    affine.store %1, %alloc_0[%c0, %c1] : memref&lt;2x3xi32&gt;
    %2 = affine.load %alloc[%c0, %c2] : memref&lt;2x3xi32&gt;
    affine.store %2, %alloc_0[%c0, %c2] : memref&lt;2x3xi32&gt;
    [...]
  }
}
</code></pre><h4 id=options-4>Options</h4><pre tabindex=0><code>-disable-affine-loop : Use this to control to disable using affine loops
</code></pre><h3 id=-extract-loop-body><code>-extract-loop-body</code></h3><p><em>Extracts logic of a loop bodies into functions.</em></p><p>This pass extracts logic in the inner body of for loops into functions.</p><p>This pass requires that tensors are lowered to memref. It expects that a
loop body contains a number of affine.load statements used as inputs to the
extracted function, and a single affine.store used as the extracted
function&rsquo;s output.</p><p>Input</p><pre tabindex=0><code>module {
  func.func @loop_body() {
    %c-128_i8 = arith.constant -128 : i8
    %c127_i8 = arith.constant 127 : i8
    %alloc_7 = memref.alloc() {alignment = 64 : i64} : memref&lt;25x20x8xi8&gt;
    affine.for %arg1 = 0 to 25 {
      affine.for %arg2 = 0 to 20 {
        affine.for %arg3 = 0 to 8 {
          %98 = affine.load %alloc_6[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
          %99 = arith.cmpi slt, %arg0, %c-128_i8 : i8
          %100 = arith.select %99, %c-128_i8, %arg0 : i8
          %101 = arith.cmpi sgt, %arg0, %c127_i8 : i8
          %102 = arith.select %101, %c127_i8, %100 : i8
          affine.store %102, %alloc_7[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
        }
      }
    }
  }
}
</code></pre><p>Output</p><pre tabindex=0><code>module {
  func.func @loop_body() {
    %alloc_7 = memref.alloc() {alignment = 64 : i64} : memref&lt;25x20x8xi8&gt;
    affine.for %arg1 = 0 to 25 {
      affine.for %arg2 = 0 to 20 {
        affine.for %arg3 = 0 to 8 {
          %98 = affine.load %alloc_6[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
          %102 = func.call @__for_loop(%98) : (i8) -&gt; i8
          affine.store %102, %alloc_7[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
        }
      }
    }
  }
  func.func private @__for_loop(%arg0: i8) -&gt; i8 {
    %c-128_i8 = arith.constant -128 : i8
    %c127_i8 = arith.constant 127 : i8
    %99 = arith.cmpi slt, %arg0, %c-128_i8 : i8
    %100 = arith.select %99, %c-128_i8, %arg0 : i8
    %101 = arith.cmpi sgt, %arg0, %c127_i8 : i8
    %102 = arith.select %101, %c127_i8, %100 : i8
    return %102 : i8
  }
}
</code></pre><h4 id=options-5>Options</h4><pre tabindex=0><code>-min-loop-size : Use this to control the minimum loop size to apply this pass
-min-body-size : Use this to control the minimum loop body size to apply this pass
</code></pre><h3 id=-forward-insert-to-extract><code>-forward-insert-to-extract</code></h3><p><em>Forward inserts to extracts within a single block</em></p><p>This pass is similar to forward-store-to-load pass where store ops
are forwarded load ops; here instead tensor.insert ops are forwarded
to tensor.extract ops.</p><p>Does not support complex control flow within a block, nor ops with
arbitrary subregions.</p><h3 id=-forward-store-to-load><code>-forward-store-to-load</code></h3><p><em>Forward stores to loads within a single block</em></p><p>This pass is a simplified version of mem2reg and similar passes.
It analyzes an operation, finding all basic blocks within that op
that have memrefs whose stores can be forwarded to loads.</p><p>Does not support complex control flow within a block, nor ops
with arbitrary subregions.</p><h3 id=-full-loop-unroll><code>-full-loop-unroll</code></h3><p><em>Fully unroll all loops</em></p><p>Scan the IR for affine.for loops and unroll them all.</p><h3 id=-insert-rotate><code>-insert-rotate</code></h3><p><em>Vectorize arithmetic FHE operations using HECO-style heuristics</em></p><p>This pass implements the SIMD-vectorization passes from the
<a href=https://arxiv.org/abs/2202.01649>HECO paper</a>.</p><p>The pass operates by identifying arithmetic operations that can be suitably
combined into a combination of cyclic rotations and vectorized operations
on tensors. It further identifies a suitable &ldquo;slot target&rdquo; for each operation
and heuristically aligns the operations to reduce unnecessary rotations.</p><p>This pass by itself does not eliminate any operations, but instead inserts
well-chosen rotations so that, for well-structured code (like unrolled affine loops),
a subsequent <code>--cse</code> and <code>--canonicalize</code> pass will dramatically reduce the IR.
As such, the pass is designed to be paired with the canonicalization patterns
in <code>tensor_ext</code>, as well as the <code>collapse-insertion-chains</code> pass, which
cleans up remaining insertion and extraction ops after the main simplifications
are applied.</p><p>Unlike HECO, this pass operates on plaintext types and tensors, along with
the HEIR-specific <code>tensor_ext</code> dialect for its cyclic <code>rotate</code> op. It is intended
to be run before lowering to a scheme dialect like <code>bgv</code>.</p><h3 id=-linalg-canonicalizations><code>-linalg-canonicalizations</code></h3><p><em>This pass canonicalizes the linalg.transpose operation of a constant into a transposed constant.</em></p><p>This pass canonicalizes the linalg.transpose operation of a constant into a
transposed constant.</p><h3 id=-linalg-to-tensor-ext><code>-linalg-to-tensor-ext</code></h3><p><em>Lower <code>linalg.matmul</code> to arith and tensor_ext dialects.</em></p><p>This pass lowers the <code>linalg.matmul</code> to a mixture of affine, tensor, and
via the Halevi-Shoup and squat matrix multiplication algorithms.</p><h3 id=-lwe-add-client-interface><code>-lwe-add-client-interface</code></h3><p><em>Add client interfaces to (R)LWE encrypted functions</em></p><p>This pass adds encrypt and decrypt functions for each compiled function in the
IR. These functions maintain the same interface as the original function,
while the compiled function may lose some of this information by the lowerings
to ciphertext types (e.g., a scalar ciphertext, when lowered through RLWE schemes,
must be encoded as a tensor).</p><h4 id=options-6>Options</h4><pre tabindex=0><code>-use-public-key          : If true, generate a client interface that uses a public key for encryption.
-one-value-per-helper-fn : If true, split encryption helpers into separate functions for each SSA value.
</code></pre><h3 id=-lwe-set-default-parameters><code>-lwe-set-default-parameters</code></h3><p><em>Set default parameters for LWE ops</em></p><p>This pass adds default parameters to all <code>lwe</code> types as the <code>lwe_params</code>
attribute, and for <code>lwe</code> ops as the <code>params</code> attribute, overriding any
existing attributes set with those names.</p><p>This pass is primarily for testing purposes, and as a parameter provider
before a proper parameter selection mechanism is added. This pass should not
be used in production.</p><p>The specific parameters are hard-coded in
<code>lib/Dialect/LWE/Transforms/SetDefaultParameters.cpp</code>.</p><h3 id=-lwe-to-polynomial><code>-lwe-to-polynomial</code></h3><p><em>Lower <code>lwe</code> to <code>polynomial</code> dialect.</em></p><p>This pass lowers the <code>lwe</code> dialect to <code>polynomial</code> dialect.</p><h3 id=-memref-global-replace><code>-memref-global-replace</code></h3><p><em>MemrefGlobalReplacePass forwards global memrefs accessors to arithmetic values</em></p><p>This pass forwards constant global MemRef values to referencing affine
loads. This pass requires that the MemRef global values are initialized as
constants and that the affine load access indices are constants (i.e. not
variadic). Unroll affine loops prior to running this pass.</p><p>MemRef removal is required to remove any memory allocations from the input
model (for example, TensorFlow models contain global memory holding model
weights) to support FHE transpilation.</p><p>Input</p><pre tabindex=0><code>module {
  memref.global &#34;private&#34; constant @__constant_8xi16 : memref&lt;2x4xi16&gt; = dense&lt;[[-10, 20, 3, 4], [5, 6, 7, 8]]&gt;
  func.func @main() -&gt; i16 {
    %c1 = arith.constant 1 : index
    %c2 = arith.constant 2 : index
    %0 = memref.get_global @__constant_8xi16 : memref&lt;2x4xi16&gt;
    %1 = affine.load %0[%c1, %c1 + %c2] : memref&lt;2x4xi16&gt;
    return %1 : i16
  }
}
</code></pre><p>Output</p><pre tabindex=0><code>module {
  func.func @main() -&gt; i16 {
    %c1 = arith.constant 1 : index
    %c2 = arith.constant 2 : index
    %c8_i16 = arith.constant 8 : i16
    return %c8_i16 : i16
  }
}
</code></pre><h3 id=-mod-arith-to-arith><code>-mod-arith-to-arith</code></h3><p><em>Lower <code>mod_arith</code> to standard <code>arith</code>.</em></p><p>This pass lowers the <code>mod_arith</code> dialect to their <code>arith</code> equivalents.</p><h3 id=-openfhe-configure-crypto-context><code>-openfhe-configure-crypto-context</code></h3><p><em>Configure the crypto context in OpenFHE</em></p><p>This pass generates helper functions to generate and configure the OpenFHE crypto context for the given function. Generating the crypto context sets the appropriate encryption parameters, while the configuration generates the necessary evaluation keys (relinearization and rotation keys).</p><p>For example, for an MLIR function <code>@my_func</code>, the generated helpers have the following signatures</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span>  <span style=color:#000>@my_func__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span>  <span style=color:#000>@my_func__configure_crypto_context</span><span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context
</span></span></code></pre></div><h4 id=options-7>Options</h4><pre tabindex=0><code>-entry-function : Default entry function name of entry function.
</code></pre><h3 id=-operation-balancer><code>-operation-balancer</code></h3><p><em>This pass balances addition and multiplication operations.</em></p><p>This pass examines a tree or graph of add and multiplication operations and
balances them to minimize the depth of the tree. This exposes better parallelization
and reducing the multiplication depth can decrease the parameters used in FHE,
which improves performance. This pass is not necessarily optimal, as there may
be intermediate computations that this pass does not optimally minimize the depth for.</p><p>The algorithm is to analyze a graph of addition operations and do a depth-first
search for the operands (from the last computed values in the graph). If there
are intermediate computations that are used more than once, then the pass
treats that computation as its own tree to balance instead of trying to minimize
the global depth of the tree.</p><p>This pass only runs on addition and multiplication operations on the arithmetic
dialect that are encapsulated inside a secret.generic.</p><p>This pass was inspired by section 2.6 of <a href=https://eprint.iacr.org/2021/1505>&lsquo;EVA Improved: Compiler and Extension
Library for CKKS&rsquo; by Chowdhary et al</a>.</p><h3 id=-optimize-relinearization><code>-optimize-relinearization</code></h3><p><em>Optimize placement of relinearization ops</em></p><p>This pass defers relinearization ops as late as possible in the IR.
This is more efficient in cases where multiplication operations are followed by
additions, such as in a dot product. Because relinearization also adds error,
deferring it can reduce the need for bootstrapping.</p><p>In this pass, we use an integer linear program to determine the optimal
relinearization strategy. It solves an ILP for each <code>func</code> op in the IR.</p><p>The assumptions of this pass include:</p><ul><li>All return values of functions must be linearized.</li><li>All ciphertext arguments to an op must have the same key basis</li><li>Rotation op inputs must have be linearized.</li></ul><p>For an ILP model specification, see the
<a href=https://heir.dev/docs/design/relinearization_ilp/>docs at the HEIR website</a>.
The model is an adaptation of the ILP described in
<a href=https://www.jeremykun.com/2023/11/15/mlir-a-global-optimization-and-dataflow-analysis>a blog post by Jeremy Kun</a>.</p><h3 id=-polynomial-to-mod-arith><code>-polynomial-to-mod-arith</code></h3><p><em>Lower <code>polynomial</code> to standard MLIR dialects.</em></p><p>This pass lowers the <code>polynomial</code> dialect to standard MLIR plus mod_arith,
including possibly ops from affine, tensor, linalg, and arith.</p><h3 id=-remove-unused-memref><code>-remove-unused-memref</code></h3><p><em>Cleanup any unused memrefs</em></p><p>Scan the IR for unused memrefs and remove them.</p><p>This pass looks for locally allocated memrefs that are never used and
deletes them. This pass can be used as a cleanup pass from other IR
simplifications that forward stores to loads.</p><h3 id=-rotate-and-reduce><code>-rotate-and-reduce</code></h3><p><em>Use a logarithmic number of rotations to reduce a tensor.</em></p><p>This pass identifies when a commutative, associative binary operation is used
to reduce all of the entries of a tensor to a single value, and optimizes the
operations by using a logarithmic number of reduction operations.</p><p>In particular, this pass identifies an unrolled set of operations of the form
(the binary ops may come in any order):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%14</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>and replaces it with a logarithmic number of <code>rotate</code> and <code>addi</code> operations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h3 id=-secret-capture-generic-ambient-scope><code>-secret-capture-generic-ambient-scope</code></h3><p><em>Capture the ambient scope used in a secret.generic</em></p><p>For each value used in the body of a <code>secret.generic</code> op, which is defined
in the ambient scope outside the <code>generic</code>, add it to the argument list of
the <code>generic</code>.</p><h3 id=-secret-distribute-generic><code>-secret-distribute-generic</code></h3><p><em>Distribute <code>generic</code> ops through their bodies.</em></p><p>Converts <code>generic</code> ops whose region contains many ops into smaller
sequences of generic ops whose regions contain a single op, dropping the
<code>generic</code> part from any resulting <code>generic</code> ops that have no
<code>secret.secret</code> inputs. If the op has associated regions, and the operands
are not secret, then the generic is distributed recursively through the
op&rsquo;s regions as well.</p><p>This pass is intended to be used as part of a front-end pipeline, where a
program that operates on a secret type annotates the input to a region as
<code>secret</code>, and then wraps the contents of the region in a single large
<code>secret.generic</code>, then uses this pass to simplify it.</p><p>The <code>distribute-through</code> option allows one to specify a comma-separated
list of op names (e.g., <code>distribute-thorugh="affine.for,scf.if"</code>), which
limits the distribution to only pass through those ops. If unset, all ops
are distributed through when possible.</p><h4 id=options-8>Options</h4><pre tabindex=0><code>-distribute-through : comma-separated list of ops that should be distributed through
</code></pre><h3 id=-secret-extract-generic-body><code>-secret-extract-generic-body</code></h3><p><em>Extract the bodies of all generic ops into functions</em></p><p>This pass extracts the body of all generic ops into functions, and
replaces the generic bodies with call ops. Used as a sub-operation in
some passes, and extracted into its own pass for testing purposes.</p><p>This pass works best when <code>--secret-generic-absorb-constants</code> is run
before it so that the extracted function contains any constants used
in the generic op&rsquo;s body.</p><h3 id=-secret-forget-secrets><code>-secret-forget-secrets</code></h3><p><em>Convert secret types to standard types</em></p><p>Drop the <code>secret&lt;...></code> type from the IR, replacing it with the contained
type and the corresponding cleartext computation.</p><h3 id=-secret-generic-absorb-constants><code>-secret-generic-absorb-constants</code></h3><p><em>Copy constants into a secret.generic body</em></p><p>For each constant value used in the body of a <code>secret.generic</code> op, which is
defined in the ambient scope outside the <code>generic</code>, add it&rsquo;s definition into
the <code>generic</code> body.</p><h3 id=-secret-generic-absorb-dealloc><code>-secret-generic-absorb-dealloc</code></h3><p><em>Copy deallocs of internal memrefs into a secret.generic body</em></p><p>For each memref allocated and used only within a body of a <code>secret.generic</code>
op, add it&rsquo;s dealloc of the memref into its <code>generic</code> body.</p><h3 id=-secret-merge-adjacent-generics><code>-secret-merge-adjacent-generics</code></h3><p><em>Merge two adjacent generics into a single generic</em></p><p>This pass merges two immedaitely sequential generics into a single
generic. Useful as a sub-operation in some passes, and extracted into
its own pass for testing purposes.</p><h3 id=-secret-to-bgv><code>-secret-to-bgv</code></h3><p><em>Lower <code>secret</code> to <code>bgv</code> dialect.</em></p><p>This pass lowers an IR with <code>secret.generic</code> blocks containing arithmetic
operations to operations on ciphertexts with the BGV dialect.</p><p>The pass assumes that the <code>secret.generic</code> regions have been distributed
through arithmetic operations so that only one ciphertext operation appears
per generic block. It also requires that <code>canonicalize</code> was run so that
non-secret values used are removed from the <code>secret.generic</code>&rsquo;s block
arguments.</p><p>The pass requires that all types are tensors of a uniform shape matching the
dimension of the ciphertext space specified my <code>poly-mod-degree</code>.</p><h4 id=options-9>Options</h4><pre tabindex=0><code>-poly-mod-degree      : Default degree of the cyclotomic polynomial modulus to use for ciphertext space.
-coefficient-mod-bits : Default number of bits of the prime coefficient modulus to use for the ciphertext space.
</code></pre><h3 id=-secret-to-cggi><code>-secret-to-cggi</code></h3><p><em>Lower <code>secret</code> to <code>cggi</code> dialect.</em></p><p>This pass lowers the <code>secret</code> dialect to <code>cggi</code> dialect.</p><h3 id=-secret-to-ckks><code>-secret-to-ckks</code></h3><p><em>Lower <code>secret</code> to <code>ckks</code> dialect.</em></p><p>This pass lowers an IR with <code>secret.generic</code> blocks containing arithmetic
operations to operations on ciphertexts with the CKKS dialect.</p><p>The pass assumes that the <code>secret.generic</code> regions have been distributed
through arithmetic operations so that only one ciphertext operation appears
per generic block. It also requires that <code>canonicalize</code> was run so that
non-secret values used are removed from the <code>secret.generic</code>&rsquo;s block
arguments.</p><p>The pass requires that all types are tensors of a uniform shape matching the
dimension of the ciphertext space specified my <code>poly-mod-degree</code>.</p><h4 id=options-10>Options</h4><pre tabindex=0><code>-poly-mod-degree      : Default degree of the cyclotomic polynomial modulus to use for ciphertext space.
-coefficient-mod-bits : Default number of bits of the prime coefficient modulus to use for the ciphertext space.
</code></pre><h3 id=-secretize><code>-secretize</code></h3><p><em>Adds secret argument attributes to entry function</em></p><p>Adds a secret.secret attribute argument to each argument in the entry
function of an MLIR module. By default, the function is <code>main</code>. This may be
overridden with the option -entry-function=top_level_func.</p><h4 id=options-11>Options</h4><pre tabindex=0><code>-entry-function : entry function of the module
</code></pre><h3 id=-straight-line-vectorize><code>-straight-line-vectorize</code></h3><p><em>A vectorizer for straight line programs.</em></p><p>This pass ignores control flow and only vectorizes straight-line programs
within a given region.</p><h4 id=options-12>Options</h4><pre tabindex=0><code>-dialect : Use this to restrict the dialect whose ops should be vectorized.
</code></pre><h3 id=-tosa-to-secret-arith><code>-tosa-to-secret-arith</code></h3><p><em>Lower <code>tosa.sigmoid</code> to secret arith dialects.</em></p><p>This pass lowers the <code>tosa.sigmoid</code> dialect to the polynomial approximation
-0.004 * x^3 + 0.197 * x + 0.5 (composed of arith, affine, and tensor operations).</p><p>This polynomial approximation of sigmoid only works over the range [-5, 5]
and is taken from the paper <a href=https://eprint.iacr.org/2018/462.pdf>&lsquo;Logisitic regression over encrypted data from
fully homomorphic encryption&rsquo; by Chen et al.</a>.</p><h3 id=-unroll-and-forward><code>-unroll-and-forward</code></h3><p><em>Loop unrolls and forwards stores to loads.</em></p><p>This pass processes the first function in a given module, and, starting from
the first loop, iteratively does the following:</p><ol><li>Fully unroll the loop.</li><li>Scan for load ops. For each load op with a statically-inferrable access
index:</li><li>Backtrack to the original memref alloc</li><li>Find all store ops at the corresponding index (possibly transitively
through renames/subviews of the underlying alloc).</li><li>Find the last store that occurs and forward it to the load.</li><li>If the original memref is an input memref, then forward through any
renames to make the target load load directly from the argument memref
(instead of any subviews, say)</li><li>Apply the same logic to any remaining loads not inside any for loop.</li></ol><p>This pass requires that tensors are lowered to memref, and only supports
affine loops with affine.load/store ops.</p><p>Memrefs that result from memref.get_global ops are excluded from
forwarding, even if they are loaded with a static index, and are instead
handled by memref-global-replace, which should be run after this pass.</p><h3 id=-wrap-generic><code>-wrap-generic</code></h3><p><em>Wraps regions using secret args in secret.generic bodies</em></p><p>This pass wraps function regions of <code>func.func</code> that use secret arguments in
<code>secret.generic</code> bodies.</p><p>Secret arguments are annotated using a <code>secret.secret</code> argument attribute.
This pass converts these to secret types and then inserts a <code>secret.generic</code>
body to hold the functions region. The output type is also converted to a
secret.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-yosys-optimizer><code>-yosys-optimizer</code></h3><p><em>Invoke Yosys to perform circuit optimization.</em></p><p>This pass invokes Yosys to convert an arithmetic circuit to an optimized
boolean circuit that uses the arith and comb dialects.</p><p>Note that booleanization changes the function signature: multi-bit integers
are transformed to a tensor of booleans, for example, an <code>i8</code> is converted
to <code>tensor&lt;8xi1></code>.</p><p>The optimizer will be applied to each <code>secret.generic</code> op containing
arithmetic ops that can be optimized.</p><p>Optional parameters:</p><ul><li><code>abc-fast</code>: Run the abc optimizer in &ldquo;fast&rdquo; mode, getting faster compile
time at the expense of a possibly larger output circuit.</li><li><code>unroll-factor</code>: Before optimizing the circuit, unroll loops by a given
factor. If unset, this pass will not unroll any loops.</li><li><code>print-stats</code>: Prints statistics about the optimized circuits.</li><li><code>mode={Boolean,LUT}</code>: Map gates to boolean gates or lookup table gates.</li><li><code>use-submodules</code>: Extract the body of a generic op into submodules.
Useful for large programs with generics that can be isolated. This should
not be used when distributing generics through loops to avoid index
arguments in the function body.</li></ul><h4 id=statistics>Statistics</h4><pre tabindex=0><code>total circuit size : The total circuit size for all optimized circuits, after optimization is done.
</code></pre></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/google/heir aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 The HEIR Authors All Rights Reserved</span>
<span class=ms-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.027d75d71824837bee74c12a7806c5fe51249c1ca7accc27553a251a75cdb3a4.js integrity="sha256-An111xgkg3vudMEqeAbF/lEknBynrMwnVTolGnXNs6Q=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>