<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.113.0"><link rel=canonical type=text/html href=https://heir.dev/docs/><link rel=alternate type=application/rss+xml href=https://heir.dev/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Documentation | HEIR</title><meta name=description content><meta property="og:title" content="Documentation"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://heir.dev/docs/"><meta itemprop=name content="Documentation"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Documentation"><meta name=twitter:description content><link rel=preload href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css as=style><link href=/scss/main.min.dffc1689fd83830a5fb090d38ca9680587c322008ad97c675ee0ca22e5fb10d5.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="32" fill="#fff" fill-opacity=".01"/><path d="M18.6889 10.124l7.7916 5.0511 2.6263-1.6684-2.6146-1.6779-7.8033-4.96754 2.8526 1.84162L18.6889 10.124z" fill="#efcf6f"/><path d="M29.1185 6.86125 18.6979.13981 16.06 1.79876 26.4922 8.52025l2.6263-1.659z" fill="#efcf6f"/><path d="M8.2405 6.74134 5.60033 5.07291 3.05751 6.79935 5.67334 8.49344 8.2405 6.74134z" fill="#ee958a"/><path d="M10.8697 8.49344 8.2405 10.124v3.3995l5.2049-3.3348-2.5757-1.69526z" fill="#ee958a"/><path d="M5.67334 8.49344 3.05751 6.79935 3.03318 23.4932l2.64016 1.6897V8.49344z" fill="#a32e24"/><path d="M29.1185 6.86126 26.4922 8.52025V11.8288l2.6263-1.6401V6.86126z" fill="#d38041"/><path d="M21.5415 8.70288 18.6889 6.86126V10.124l2.8526-1.42112z" fill="#d38041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M8.2405 6.74134V10.124v3.3995l5.2049-3.3348V3.58723l2.6145-1.7885L16.1123 11.8484V18.467l-2.6158 1.6181L13.4574 13.5235 10.849 15.1694 8.2405 16.8152v6.678L5.67334 25.1829V8.49344L8.2405 6.74134z" fill="#dd583b"/><path d="M13.4965 20.0851 13.4574 13.5235 10.849 15.1694 10.8077 18.467l2.6888 1.6181z" fill="#a32e24"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.4454 3.58723V10.1887L10.8697 8.49344 10.9293 1.79873l2.5161 1.7885z" fill="#a32e24"/><path d="M16.0599 1.79873 13.4454.13981 10.9293 1.79873l2.5161 1.7885 2.6145-1.7885z" fill="#ee958a"/><path d="M16.06 1.79876 16.0793 5.52165 16.1123 11.8484V18.467l2.5766-1.6518V13.4696 10.124 6.86126l7.8033 4.96754V8.52025L16.06 1.79876z" fill="#e5ad11"/><path d="M18.6889 16.8152 16.1123 18.467l10.3682 6.7159V21.8372l-7.7916-5.022z" fill="#e5ad11"/><path d="M26.4805 15.1751 18.6889 10.124v3.3456l2.7505 1.7641 5.0411 3.2333V15.1751z" fill="#e5ad11"/><path d="M29.1068 13.5067l-2.6263 1.6684V18.467l2.6263-1.6518V13.5067z" fill="#d48041"/><path d="M29.1185 20.0851l-2.638 1.7521v3.3457l2.6263-1.6897L29.1185 20.0851z" fill="#d48041"/><path fill-rule="evenodd" clip-rule="evenodd" d="M26.4805 21.8372l-7.7916-5.022 2.7505-1.5815 5.0411 3.2333 2.638 1.6181-2.638 1.7521z" fill="#efcf6f"/><path d="M18.6889 13.4696v3.3456l2.7505-1.5815-2.7505-1.7641z" fill="#d48041"/><path d="M20.1621 26.5165l-4.2015-2.7017-4.2015-2.7016L11.7108 23.8491l6.3384 4.0776 2.1129 1.3512V26.5165z" fill="#395aad"/><path d="M7.49852 23.8491v2.6674l8.41958 5.4439V29.2779L7.49852 23.8491z" fill="#276e3a"/><path d="M9.57951 22.4781l-2.08099 1.371 8.41958 5.4288 2.1311-1.3512-6.3384-4.0776-2.13129-1.371z" fill="#add284"/><path d="M24.3747 26.5165V23.8491L22.174 22.8377l-2.0054.9665 2.1815 1.3793 2.0246 1.333z" fill="#395aad"/><path d="M18.0492 19.7061l2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#395aad"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.1621 18.4432l-2.0415-.596-2.1581.596-2.1017 1.3349-2.1017 1.3351 2.1012 1.3511 6.3018 4.0522 2.188-1.333-2.1815-1.3793 2.0054-.9665 2.2007 1.0114 2.0995-1.329-2.0811-1.4069L22.3501 21.1371l-.1752-1.4237L22.174 19.7061l-2.0119-1.2629zm-2.1129 1.2629 2.1194 1.431-2.048 1.3721-2.1698-1.3721 2.0984-1.431z" fill="#9ec4e0"/><path d="M26.4742 22.5201l-2.0995 1.329v2.6674l2.1289-1.3305L26.4742 22.5201z" fill="#4285f4"/><path d="M20.1621 26.5165v2.7614l2.188-1.3512V25.1835l-2.188 1.333z" fill="#4285f4"/><path d="M15.9181 29.2779v2.6825l2.1311-1.3708V27.9267l-2.1311 1.3512z" fill="#4e9c68"/></svg></span><span class=navbar-brand__name>HEIR</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/><span>Home</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/google/heir/ target=_blank rel=noopener><span>GitHub</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-a2e0f2893b70992c6087c2b17584ff57>Getting Started</a></li><li>2: <a href=#pg-39f3813de34ce5cae320697c88e2a917>Development</a></li><ul><li>2.1: <a href=#pg-9f5c8c4879254f6e074cad11218606dc>Bazel tips</a></li><li>2.2: <a href=#pg-0f74d2ae2f254619ee015b1e9bfd1422>Boilerplate tools</a></li><li>2.3: <a href=#pg-51e47549bc26dd648b0de019093624f2>IDE configuration</a></li></ul><li>3: <a href=#pg-e62e32c8f8aaa5c7325bea5a1b00e345>Tutorials and Talks</a></li><li>4: <a href=#pg-f33468f03bdb92c1601bbed999044c76>Research with HEIR</a></li><li>5: <a href=#pg-439f0d1f88fc52920f9828a37ce073a8>Design</a></li><ul><li>5.1: <a href=#pg-b68f7af4e332a4d2b770c09ac2607bf8>Ciphertext Management</a></li><li>5.2: <a href=#pg-bddfea9d49299ca5edc4a07ea06fcc23>Data-oblivious Transformations</a></li><li>5.3: <a href=#pg-596c831179432fef68d03e056a55875c>Noise Analysis</a></li><li>5.4: <a href=#pg-76ae4da46c68c5cd44ad0ecf5d69993f>Secret</a></li><li>5.5: <a href=#pg-05018faa55dd802660a3ea38b8f7fb69>SIMD Optimizations</a></li><li>5.6: <a href=#pg-cd22aa05be277ba6c2e2f8f083706b51>Optimizing relinearization</a></li></ul><li>6: <a href=#pg-db9ac78ce08367ea2b7db8c1412049b6>Pipelines</a></li><li>7: <a href=#pg-590f1588f601079eeacfc7cb11dc5115>Dialects</a></li><ul><li>7.1: <a href=#pg-7a2d769a54237b8d0845fe32a6451c2b>BGV</a></li><li>7.2: <a href=#pg-5f74537b9610a2b3f8ddf498be3d47b0>CGGI</a></li><li>7.3: <a href=#pg-818a3660f61ebf5859b5c98635beacc8>CKKS</a></li><li>7.4: <a href=#pg-80cc312dd83f43a069330083f04eb4f2>Comb</a></li><li>7.5: <a href=#pg-df73b993320a0b803398dca1b5f7c3cd>Jaxite</a></li><li>7.6: <a href=#pg-63d08712eb5ec0da1ca62003de70e7f1>JaxiteWord</a></li><li>7.7: <a href=#pg-6857a323f6f4a36b66d9290a3b2c84fc>Lattigo</a></li><li>7.8: <a href=#pg-c5dda3cb8e694541eacbee638af7317d>LWE</a></li><li>7.9: <a href=#pg-024e5f7d26a5dfbbc21bb90c29119ca6>MathExt</a></li><li>7.10: <a href=#pg-b15a871dcca009396e70be943220c783>Mgmt</a></li><li>7.11: <a href=#pg-75945813f3978b67fb0398cc4f17cb8b>ModArith</a></li><li>7.12: <a href=#pg-e397c035ea096bd861aadf40d3fccd0a>Openfhe</a></li><li>7.13: <a href=#pg-b18fea903e4651113f5317788f1491e1>Polynomial</a></li><li>7.14: <a href=#pg-c9ea40a8d17399f57cdd3c18b53cedef>Random</a></li><li>7.15: <a href=#pg-aeae60b865ac85372556b396a5a052ce>RNS</a></li><li>7.16: <a href=#pg-f7ffac8ba93b73b8a62e185ec8643d63>Secret</a></li><li>7.17: <a href=#pg-ca9ddb02db7c0683037407c6f9eb1f2a>TensorExt</a></li><li>7.18: <a href=#pg-678c1db0f9b2ed4c9d43b790f890bea0>TfheRust</a></li><li>7.19: <a href=#pg-d46d9ee8aeb1f8889ca7cfc9a061a7cc>TfheRustBool</a></li></ul><li>8: <a href=#pg-19aafd690c3a7edde7a9c3e1fbaf737f>Passes</a></li></ul><div class=content><p>This section is where the HEIR documentation lives.</p></div></div><div class=td-content><h1 id=pg-a2e0f2893b70992c6087c2b17584ff57>1 - Getting Started</h1><h2 id=getting-heir>Getting HEIR</h2><h3 id=using-a-pre-built-nightly-binary>Using a pre-built nightly binary</h3><p>HEIR releases a <a href=https://github.com/google/heir/releases/tag/nightly>nightly</a>
binary for Linux x86-64. This is intended for testing compiler passes and not
for production use.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/google/heir/releases/download/nightly/heir-opt
</span></span><span style=display:flex><span>chmod +x heir-opt
</span></span><span style=display:flex><span>./heir-opt --help
</span></span></code></pre></div><p>Then you can run the examples below, replacing <code>bazel run //tools:heir-opt --</code>
with <code>./heir-opt</code>. HEIR also publishes <code>heir-translate</code> and <code>heir-lsp</code> in the
same way.</p><h3 id=via-pip>Via pip</h3><p>We publish a python package <a href=https://pypi.org/project/heir-py/>heir_py</a> that
includes the <code>heir-opt</code> and <code>heir-translate</code> binaries.</p><pre tabindex=0><code>python -m venv venv
source venv/bin/activate

pip install heir_py

heir-opt --help
heir-translate --help
</code></pre><h3 id=building-from-source>Building From Source</h3><h4 id=prerequisites>Prerequisites</h4><ul><li><a href=https://git-scm.com/>Git</a></li><li>A C++ compiler and linker (<a href=https://clang.llvm.org/>clang</a> and
<a href=https://lld.llvm.org/>lld</a> or a recent version of <code>gcc</code>). If you want to run
OpenFHE with parallelism (enabled by default), you&rsquo;ll also need OpenMP.</li><li>Bazel via <a href=https://github.com/bazelbuild/bazelisk>bazelisk</a>. The precise
Bazel version used is in <code>.bazelversion</code> in the repository root.</li></ul><details><summary>Detailed Instructions</summary>
The first two requirements are frequently pre-installed
or can be installed via the system package manager.
For example, on Ubuntu, these can be installed with<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sudo apt-get install clang lld libomp-dev
</span></span></code></pre></div><p>You can download the latest Bazelisk release, e.g., for linux-amd64 (see the
<a href=https://github.com/bazelbuild/bazelisk/releases/latest>Bazelisk Release Page</a>
for a list of available binaries):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -c https://github.com/bazelbuild/bazelisk/releases/latest/download/bazelisk-linux-amd64
</span></span><span style=display:flex><span>mv bazelisk-linux-amd64 bazel
</span></span><span style=display:flex><span>chmod +x bazel
</span></span></code></pre></div><p>You will then likely want to move <code>bazel</code> to a location on your PATH, or add its
location to your PATH, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/bin
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export PATH=$PATH:~/bin&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>mv bazel ~/bin/bazel
</span></span></code></pre></div><p>Note that on linux systems, your OS user must <strong>not</strong> be <code>root</code> as <code>bazel</code> might
refuse to work if run as root.</p><p>On macOS, you can install <code>bazelisk</code> via Homebrew.</p></details><h4 id=clone-and-build-the-project>Clone and build the project</h4><p>You can clone and build HEIR from the terminal as described below. Please see
<a href=https://heir.dev/docs/development>Development</a> for information on IDE
configuration if you want to use an IDE to build HEIR.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:google/heir.git <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>cd</span> heir
</span></span><span style=display:flex><span>bazel build @heir//tools:heir-opt
</span></span></code></pre></div><p>Some HEIR passes require Yosys as a dependency (<code>--yosys-optimizer</code>), which
itself adds many transitive dependencies that may not build properly on all
systems. If you would like to skip Yosys and ABC compilation, use the following
build setting:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel build --//:enable_yosys<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> --build_tag_filters<span style=color:#ce5c00;font-weight:700>=</span>-yosys @heir//tools:heir-opt
</span></span></code></pre></div><p>Adding the following to <code>.bazelrc</code> in the HEIR project root will make this the
default behavior</p><pre tabindex=0><code>common --//:enable_yosys=0
common --build_tag_filters=-yosys
</code></pre><h4 id=optional-run-the-tests>Optional: Run the tests</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> @heir//...
</span></span></code></pre></div><h2 id=using-heir>Using HEIR</h2><h3 id=run-the-dot-product-example>Run the <code>dot-product</code> example</h3><p>The <code>dot-product</code> program computes the dot product of two length-8 vectors of
16-bit integers (<code>i16</code> in MLIR parlance). This example will showcase the OpenFHE
backend by manually calling the relevant compiler passes and setting up a C++
harness to call into the HEIR-generated functions.</p><p>The input program is in <code>tests/Examples/common/dot_product_8.mlir</code>. Support for
standard input languages like <code>C</code> and <code>C++</code> are currently experimental at best,
but eventually we would use an MLIR-based tool to convert an input language to
MLIR like in that file. The program is below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0_si16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>8</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%iter</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_si16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%iter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>For an introduction to MLIR syntax, see the
<a href=https://mlir.llvm.org/docs/LangRef/>official docs</a> or
<a href=https://www.jeremykun.com/2023/08/10/mlir-running-and-testing-a-lowering/>this blog post</a>.</p><p>Now we run the <code>heir-opt</code> command to optimize and compile the program. If you
fetched a pre-built binary instead of building from source, then all commands
below should have <code>bazel run //tools:heir-opt --</code> replaced with <code>heir-opt</code>, and
similarly for <code>heir-translate</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--mlir-to-bgv<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;ciphertext-degree=8&#39;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--scheme-to-openfhe<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;entry-function=dot_product&#39;</span>  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#000>$PWD</span>/tests/Examples/common/dot_product_8.mlir &gt; output.mlir
</span></span></code></pre></div><p>This produces a file in the <code>openfhe</code> exit dialect (part of HEIR).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1005037682689_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1005037682689</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1032955396097_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1032955396097</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>Z1095233372161_i64_ =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1095233372161</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#polynomial_evaluation_encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L0_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L1_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1032955396097_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rns_L2_ =</span> <span style=color:#000;font-weight:700>!</span>rns<span style=color:#000;font-weight:700>.</span>rns<span style=color:#000;font-weight:700>&lt;!</span>Z1095233372161_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1032955396097_i64_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>Z1005037682689_i64_<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L0_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L0_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L1_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L1_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring_rns_L2_1_x8_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#000;font-weight:700>!</span>rns_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L0_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L0_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L1_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L1_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_pt_L2_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_plaintext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L0_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L0_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L1_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L1_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L2_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#rlwe_params_L2_D3_</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ring =</span> <span style=color:#000>#ring_rns_L2_1_x8_</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L0_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L0_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L1_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L1_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L1_1 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L1_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L2_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L2_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>rlwe_ct_L2_D3_ =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params =</span> <span style=color:#000>#rlwe_params_L2_D3_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_no_relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_D3_
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>relin <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_D3_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mod_reduce <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>make_packed_plaintext <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_pt_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mul_plain <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_pt_L1_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>rot <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_
</span></span><span style=display:flex><span>    <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>reinterpret_application_data <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_ to <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_1
</span></span><span style=display:flex><span>    <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> openfhe<span style=color:#000;font-weight:700>.</span>mod_reduce <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L1_1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>public_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L2_ <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>rlwe_ct_L0_<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Next, we use the <code>heir-translate</code> tool to run code generation for the OpenFHE
<code>pke</code> API.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke-header --openfhe-include-type<span style=color:#ce5c00;font-weight:700>=</span>source-relative <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.h
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --emit-openfhe-pke --openfhe-include-type<span style=color:#ce5c00;font-weight:700>=</span>source-relative <span style=color:#000>$PWD</span>/output.mlir &gt; heir_output.cpp
</span></span></code></pre></div><p>The <code>openfhe-include-type</code> indicates which include path for OpenFHE is used. It
has three possible values: <code>install-relative</code>, <code>source-relative</code> and <code>embedded</code>.
In this example we use <code>source-relative</code> as we are compiling against an
(unoptimized) OpenFHE managed by bazel in HEIR source. To compile against an
installed (and possibly optimized) OpenFHE, you could use <code>install-relative</code> and
compile it on your own. Or you could just put the generated file in OpenFHE
source directory <code>src/pke/examples</code> and let OpenFHE find and compile it for you
with the <code>embedded</code> option.</p><p>The results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.h
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34;  // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CCParamsT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CCParams</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CryptoContextBGVRNS</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v18</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v19</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v20</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v32</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v38</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// heir_output.cpp
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34;  // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>lbcrypto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CiphertextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ConstCiphertext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>CryptoContextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>EvalKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EvalKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PlaintextT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Plaintext</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PrivateKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>PublicKeyT</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PublicKey</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int64_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v4</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMultNoRelin</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v5</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Relinearize</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v4</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v6</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v8</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v11</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalAdd</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v12</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>ModReduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>v3_filled_n</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetCryptoParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetElementParams</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>GetRingDimension</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>v3_filled</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>clear</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3_filled_n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>v3_filled_n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push_back</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>size</span><span style=color:#000;font-weight:700>()]);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v13</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>MakePackedPlaintext</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v3_filled</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v14</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalMult</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>v13</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v15</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>EvalRotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v16</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v15</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>auto</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>v17</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v0</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>ModReduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>v16</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>v17</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v26</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CiphertextT</span> <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v29</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>v30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PublicKeyT</span> <span style=color:#000>v31</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int16_t</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v34</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>CiphertextT</span> <span style=color:#000>v35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v36</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>CryptoContextT</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CryptoContextT</span> <span style=color:#000>v37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PrivateKeyT</span> <span style=color:#000>v38</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>At this point we can compile the program as we would a normal OpenFHE program.
Note that the above two files just contain the compiled function and
encryption/decryption helpers, and does not include any code that provides
specific inputs or calls these functions.</p><p>Next we&rsquo;ll create a harness that provides sample inputs, encrypts them, runs the
compiled function, and decrypts the result. Once you have the generated header
and cpp files, you can do this with any build system. We will use bazel for
consistency.</p><p>Create a file called <code>BUILD</code> in the same directory as the header and cpp files
above, with the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-BUILD data-lang=BUILD><span style=display:flex><span><span style=color:#8f5902;font-style:italic># A library build target that encapsulates the HEIR-generated code.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_library</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>hdrs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;heir_output.h&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># An executable build target that contains your main function and links</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># against the above.</span>
</span></span><span style=display:flex><span><span style=color:#000>cc_binary</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dot_product_main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>srcs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;dot_product_main.cpp&#34;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deps</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;:dot_product_codegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:pke&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@openfhe//:core&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Where <code>dot_product_main.cpp</code> is a new file containing</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;cstdint&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;vector&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;src/pke/include/openfhe.h&#34;  // from @openfhe</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;heir_output.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>CryptoContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__generate_crypto_context</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>KeyPair</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DCRTPoly</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>keyPair</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cryptoContext</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>KeyGen</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cryptoContext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__configure_crypto_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg0</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>vector</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int16_t</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>arg1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int64_t</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>240</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg0Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>arg1Encrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>publicKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>outputEncrypted</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg0Encrypted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>arg1Encrypted</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dot_product__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cryptoContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>outputEncrypted</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                                              <span style=color:#000>keyPair</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>secretKey</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Expected: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>expected</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Actual: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>actual</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Then run and show the results:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bazel run dot_product_main
</span></span><span style=display:flex><span>Expected: <span style=color:#0000cf;font-weight:700>240</span>
</span></span><span style=display:flex><span>Actual: <span style=color:#0000cf;font-weight:700>240</span>
</span></span></code></pre></div><p>If you fetched a pre-built binary instead of building from source, then you will
have to use your build system of choice to compile the generated files. If you
use <code>heir_py</code>&rsquo;s <code>heir.compile</code> decorator with <code>debug=True</code>, then the compilation
commands will be printed to stdout so you can see how to compile the generated
code manually.</p><h3 id=optional-run-a-custom-heir-opt-pipeline>Optional: Run a custom <code>heir-opt</code> pipeline</h3><p>HEIR comes with two central binaries, <code>heir-opt</code> for running optimization passes
and dialect conversions, and <code>heir-translate</code> for backend code generation. To
see the list of available passes in each one, run the binary with <code>--help</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- --help
</span></span><span style=display:flex><span>bazel run //tools:heir-translate -- --help
</span></span></code></pre></div><p>Once you&rsquo;ve chosen a pass or <code>--pass-pipeline</code> to run, execute it on the desired
file. For example, you can run a test file through <code>heir-opt</code> to see its output.
Note that when the binary is run via <code>bazel</code>, you must pass absolute paths to
input files. You can also access the underlying binary at
<code>bazel-bin/tools/heir-opt</code>, provided it has already been built.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --secret-to-cggi -cse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#000>$PWD</span>/tests/Dialect/Secret/Conversions/secret_to_cggi/add_one.mlir
</span></span></code></pre></div><p>To convert an existing lit test to a <code>bazel run</code> command for manual tweaking and
introspection (e.g., adding <code>--debug</code> or <code>--mlir-print-ir-after-all</code> to see how
he IR changes with each pass), use <code>python scripts/lit_to_bazel.py</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># after pip install -r requirements.txt</span>
</span></span><span style=display:flex><span>python scripts/lit_to_bazel.py tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div><p>Which outputs</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run --noallow_analysis_cache_discard //tools:heir-opt -- <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--secretize --wrap-generic --canonicalize --cse --full-loop-unroll <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--insert-rotate --cse --canonicalize --collapse-insertion-chains <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--canonicalize --cse /path/to/heir/tests/simd/box_blur_64x64.mlir
</span></span></code></pre></div><h3 id=optional-graphviz-visualization-of-the-ir>Optional: Graphviz visualization of the IR</h3><p>Getting a visualization of the IR during optimization/transformation might help
you understand what is going on more easily.</p><p>Still taking the <code>dot_product_8.mlir</code> as an example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel run --ui_event_filters<span style=color:#ce5c00;font-weight:700>=</span>-info,-debug,-warning,-stderr,-stdout --noshow_progress --logging<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> //tools:heir-opt -- --wrap-generic --heir-simd-vectorizer <span style=color:#000>$PWD</span>/tests/Examples/common/dot_product_8.mlir --view-op-graph 2&gt; dot_product_8.dot
</span></span><span style=display:flex><span>dot -Tpdf dot_product_8.dot &gt; dot_product_8.pdf
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># open pdf in your favorite pdf viewer</span>
</span></span></code></pre></div><p>The diagram is also shown below. It demonstrates that the HEIR SIMD vectorizer
would vectorize the dot-product program (<code>tensor&lt;8xi16></code>) then use
rotate-and-reduce technique to compute the sum.</p><figure><a href=/images/dot_product_8.svg><img src=/images/dot_product_8.svg></a></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-39f3813de34ce5cae320697c88e2a917>2 - Development</h1><p>This guide and its sub-pages assume you have successfully
<a href=/docs/getting_started/#building-from-source>built the HEIR project from source</a>.</p><h2 id=contributing-code-to-heir>Contributing code to HEIR</h2><p>The following steps should look familiar to typical workflows for pull request
contributions. Feel free to consult
<a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests>GitHub Help</a>
if you need more information using pull requests. HEIR-specific processes begin
at the <a href=#pull-request-review-flow>pull request review stage</a>.</p><h3 id=setup>Setup</h3><ol><li><p>Fork the HEIR repository by clicking the <strong>Fork</strong> button on the
<a href=https://github.com/google/heir>repository page</a>. This creates a copy of the
HEIR repository on your own GitHub account, where you can make changes.</p><details><summary>Setting up git to work with fork and upstream remotes.</summary>
If you have cloned your fork, you will want to
add the HEIR repository as an upstream remote:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git remote add upstream https://www.github.com/google/heir
</span></span></code></pre></div><p>Alternatively, if you have cloned the main HEIR repo, you can add your fork
as a remote like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git remote rename origin upstream
</span></span><span style=display:flex><span>git remote add origin https://www.github.com/&lt;USERNAME&gt;/heir
</span></span></code></pre></div><p>Either way, you will want to create a development branch for your change:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git checkout -b name-of-change
</span></span></code></pre></div><p>In the remainder of this document, we will assume <code>origin</code> is your fork, and
<code>upstream</code> is the main HEIR repo.</p></details></li><li><p>Sign the
<a href=https://cla.developers.google.com/about>Contributor License Agreement</a>
(CLA). If you are working on HEIR as part of your employment, you might have
to instead sign a Corporate CLA. See more
<a href=https://github.com/google/heir/blob/main/CONTRIBUTING.md#sign-our-contributor-license-agreement>here</a>.</p></li></ol><h3 id=preparing-a-pull-request>Preparing a pull request</h3><ol><li><p>Sync your changes against the upstream HEIR repository, i.e., make sure your
contributions are (re)based of the most recent <code>upstream/main</code> commit.</p></li><li><p>Check HEIR&rsquo;s lint and style checks by running the following from the top of
the repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pre-commit run --all-files
</span></span></code></pre></div></li></ol><p>If failed, check <a href=#pre-commit>Pre-commit</a>.</p><ol><li><p>Make sure tests are passing with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel <span style=color:#204a87>test</span> //...
</span></span></code></pre></div></li><li><p>Once you are ready with your change, create a commit, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git add change.cpp
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;Detailed commit message&#34;</span>
</span></span><span style=display:flex><span>git push --set-upstream origin name-of-change
</span></span></code></pre></div></li></ol><h3 id=pull-request-review-flow>Pull request review flow</h3><ol><li><strong>New PR</strong>:</li></ol><ul><li>When a new PR is submitted, it is inspected for quality requirements, such as
the CLA requirement, and a sufficient PR description.</li><li>If the PR passes checks, we assign a reviewer. If not, we request additional
changes to ensure the PR passes CI checks.</li></ul><ol start=2><li><strong>Review</strong></li></ol><ul><li>A reviewer will check the PR and potentially request additional changes.</li><li>If a change is needed, the contributor is requested to make a suggested
change. Please make changes with additional commits to your PR, to ensure that
the reviewer can easily see the diff.</li><li>If all looks good, the reviewer will approve the PR.</li><li>This cycle repeats itself until the PR is approved.</li></ul><ol start=3><li><strong>Approved</strong></li></ol><ul><li><strong>At this stage, you must squash your commits into a single commit.</strong></li><li>Once the PR is approved, a GitHub workflow will
<a href=https://github.com/google/heir/blob/main/.github/workflows/pr_review.yml>check</a>
your PR for multiple commits. You may use the <code>git rebase -i</code> to squash the
commits. Pull requests must consist of a single git commit before merging.</li></ul><ol start=4><li><strong>Pull Ready</strong></li></ol><ul><li>Once the PR is squashed into a single git commit, a maintainer will apply the
<code>pull ready</code> label.</li><li>This initiates the internal code migration and presubmits.</li><li>After the internal process is finished, the commit will be added to <code>main</code> and
the PR closed as merged by that commit.</li></ul><h3 id=internal-review-details>Internal review details</h3><p>This diagram summarizes the GitHub/Google code synchronization process. This is
largely automated by a Google-owned system called
<a href=https://github.com/google/copybara>Copybara</a>, the configuration for which is
Google-internal. This system treats the Google-internal version of HEIR as the
source of truth, and applies specified transformation rules to copy internal
changes to GitHub and integrate external PRs internally.</p><p>Notable aspects:</p><ul><li>The final merged code may differ slightly from a PR. The changes are mainly to
support stricter internal requirements for BUILD files that we cannot
reproduce externally due to minor differences between Google&rsquo;s internal build
systems and bazel that we don&rsquo;t know how to align. Sometimes they will also
include additional code quality fixes suggested by internal static analyzers
that do not exist outside of Google.</li><li>Due to the above, signed commits with internal modifications will not maintain
valid signatures after merging, which labels the commit with a warning.</li><li>You will see various actions taken on GitHub that include <code>copybara</code> in the
name, such as changes that originate from Google engineers doing various
approved migrations (e.g., migrating HEIR to support changes in MLIR or
abseil).</li></ul><figure><a href=/images/heir-copybara.png><img src=/images/heir-copybara.png></a><figcaption><h4>A diagram summarizing the copybara flow for HEIR internally to Google</h4></figcaption></figure><h3 id=why-bother-with-copybara>Why bother with Copybara?</h3><p>tl;dr: Automatic syncing with upstream MLIR and associated code migration.</p><p>Until HEIR has a formal governance structure in place, Google
engineers—specifically Asra Ali, Shruthi Gorantala, and Jeremy Kun—are the
codebase stewards. Because the project is young and the team is small, we want
to reduce our workload. One important aspect of that is keeping up to date with
the upstream MLIR project and incorporating bug fixes and new features into
HEIR. Google also wishes to stay up to date with MLIR and LLVM, and so it has
tooling devoted to integrating new MLIR changes into Google&rsquo;s monorepo every few
hours. As part of that rotation, a set of approved internal projects that depend
on MLIR (like TensorFlow) are patched to support breaking changes in MLIR. HEIR
is one of those approved projects.</p><p>As shown in the previous section, the cost of this is that no change can go into
HEIR without at least two Googlers approving it, and the project is held to a
specific set of code quality standards, namely Google&rsquo;s. We acknowledge these
quirks, and look forward to the day when HEIR is useful enough and important
enough that we can revisit this governance structure with the community.</p><h2 id=pre-commit>Pre-Commit</h2><p>We use <a href=https://pre-commit.com/>pre-commit</a> to manage a series of git
pre-commit hooks for the project; for example, each time you commit code, the
hooks will make sure that your C++ is formatted properly. If your code isn&rsquo;t,
the hook will format it, so when you try to commit the second time you&rsquo;ll get
past the hook. Configuration for
<a href=https://github.com/codespell-project/codespell>codespell</a>, which catches
spelling mistakes, is in <code>pyproject.toml</code>.</p><p>All hooks are defined in <code>.pre-commit-config.yaml</code>. To install these hooks,
first run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install -r requirements.txt
</span></span></code></pre></div><p>You will also need to install ruby and go (e.g., <code>apt-get install ruby golang</code>)
which are used by some of the pre-commits. Note that the pre-commit environment
expects Python 3.11
(<a href=https://askubuntu.com/a/1512163>Installing python3.11 on ubuntu</a>).</p><p>Then install the hooks to run automatically on <code>git commit</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pre-commit install
</span></span></code></pre></div><p>To run them manually, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pre-commit run --all-files
</span></span></code></pre></div><h2 id=tips-for-building-dependencies--useful-external-libraries>Tips for building dependencies / useful external libraries</h2><p>Sometimes it is useful to point HEIR to external dependencies built according to
the project&rsquo;s usual build system, instead of HEIR&rsquo;s bazel overlay. For example,
to test upstream contributions to the dependency in the context of how it will
be used in HEIR.</p><h3 id=mlir>MLIR</h3><p>Instructions for building MLIR can be found on the
<a href=https://mlir.llvm.org/getting_started/>Getting started</a> page of the MLIR
website. The instructions there seem to work as written (tested on Ubuntu
22.04). However, the command shown in <code>Unix-like compile/testing:</code> may require a
large amount of RAM. If building on a system with 16GB of RAM or less, and if
you don&rsquo;t plan to target GPUs, you may want to replace the line</p><pre tabindex=0><code>   -DLLVM_TARGETS_TO_BUILD=&#34;Native;NVPTX;AMDGPU&#34; \
</code></pre><p>with</p><pre tabindex=0><code>   -DLLVM_TARGETS_TO_BUILD=&#34;Native&#34; \
</code></pre><h3 id=openfhe>OpenFHE</h3><p>A simple way to build OpenFHE is to follow the instructions in the
<a href=https://github.com/openfheorg/openfhe-configurator>openfhe-configurator</a>
repository. This allows to build the library with or without support for the
Intel <a href=https://github.com/intel/hexl>HEXL library</a> which adds AVX512 support.
First, clone the repository and configure it using:</p><pre tabindex=0><code>git clone https://github.com/openfheorg/openfhe-configurator.git
cd openfhe-configurator
scripts/configure.sh
</code></pre><p>You will be asked whether to stage a vanilla OpenFHE build or add support for
HEXL. You can then build the library using</p><pre tabindex=0><code>./scripts/build-openfhe-development.sh
</code></pre><p>The build may fail on systems with less than 32GB or RAM due to parallel
compilation. You can disable it by editing
<code>./scripts/build-openfhe-development.sh</code> and replacing</p><pre tabindex=0><code>make -j || abort &#34;Build of openfhe-development failed.&#34;
</code></pre><p>with</p><pre tabindex=0><code>make || abort &#34;Build of openfhe-development failed.&#34;
</code></pre><p>Compilation will be significantly slower but should then take less than 8GB of
memory.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9f5c8c4879254f6e074cad11218606dc>2.1 - Bazel tips</h1><h2 id=build-file-formatting>BUILD file formatting</h2><p>The <code>buildifier</code> tool can be used to format BUILD files. You can download the
latest Buildifier release from the
<a href=https://github.com/bazelbuild/buildtools/releases/latest/>Bazel Release Page</a>.
See <a href=/docs/development/ide/>IDE configuration</a> for tips on integrating this
with your IDE.</p><h2 id=avoiding-rebuilds>Avoiding rebuilds</h2><p>Bazel is notoriously fickle when it comes to deciding whether a full rebuild is
necessary, which is bad for HEIR because rebuilding LLVM from scratch takes 15
minutes or more. We try to avoid this as much as possible by setting default
options in the project root&rsquo;s <code>.bazelrc</code>.</p><p>The main things that cause a rebuild are:</p><ul><li>A change to the <code>.bazelrc</code> that implicitly causes a flag change. Note HEIR has
its own project-specific <code>.bazelrc</code> in the root directory.</li><li>A change to the command-line flags passed to bazel, e.g., <code>-c opt</code> vs <code>-c dbg</code>
for optimization level and debug symbols. The default is <code>-c dbg</code>, and you may
want to override this to optimize performance of generated code. For example,
the OpenFHE backend generates much faster code when compiled with <code>-c opt</code>.</li><li>A change to relevant command-line variables, such as <code>PATH</code>, which is avoided
by the <code>incompatible_strict_action_env</code> flag. Note activating a python
virtualenv triggers a <code>PATH</code> change. The default is
<code>incompatible_strict_action_env=true</code>, and you would override this in the
event that you want your shell&rsquo;s environment variables to change and be
inherited by bazel.</li></ul><h2 id=pointing-heir-to-a-local-clone-of-llvm-project>Pointing HEIR to a local clone of <code>llvm-project</code></h2><p>Occasionally changes in HEIR will need to be made in tandem with upstream
changes in MLIR. In particular, we occasionally find upstream bugs that only
occur with HEIR passes, and we are the primary owners/users of the upstream
<code>polynomial</code> dialect.</p><p>To tell <code>bazel</code> to use a local clone of <code>llvm-project</code> instead of a pinned
commit hash, replace <code>bazel/import_llvm.bzl</code> with the following file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat &gt; bazel/import_llvm.bzl <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;&#34;&#34;Provides the repository macro to import LLVM.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>def import_llvm(name):
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;&#34;&#34;Imports LLVM.&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    native.new_local_repository(
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name = name,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        # this BUILD file is intentionally empty, because the LLVM project
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        # internally contains a set of bazel BUILD files overlaying the project.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        build_file_content = &#34;# empty&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        path = &#34;/path/to/llvm-project&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    )
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>The next <code>bazel build</code> will require a full rebuild if the checked-out LLVM
commit differs from the pinned commit hash in <code>bazel/import_llvm.bzl</code>.</p><p>Note that you cannot reuse the LLVM CMake build artifacts in the bazel build.
Based on what you&rsquo;re trying to do, this may require some extra steps.</p><ul><li>If you just want to run existing MLIR and HEIR tests against local
<code>llvm-project</code> changes, you can run the tests from HEIR using
<code>bazel test @llvm-project//mlir/...:all</code>. New <code>lit</code> tests can be added in
<code>llvm-project</code>&rsquo;s existing directories and tested this way without a rebuild.</li><li>If you add new CMake targets in <code>llvm-project</code>, then to incorporate them into
HEIR you need to add new bazel targets in
<code>llvm-project/utils/bazel/llvm-project-overlay/mlir/BUILD.bazel</code>. This is
required if, for example, a new dialect or pass is added in MLIR upstream.</li></ul><p>Send any upstream changes to HEIR-relevant MLIR files to @j2kun (Jeremy Kun) who
has LLVM commit access and can also suggest additional MLIR reviewers.</p><h2 id=finding-the-right-dependency-targets>Finding the right dependency targets</h2><p>Whenever a new dependency is added in C++ or Tablegen, a new bazel BUILD
dependency is required, which requires finding the path to the relevant target
that provides the file you want. In HEIR the BUILD target should be defined in
the same directory as the file you want to depend on (e.g., the targets that
provide <code>foo.h</code> are in <code>BUILD</code> in the same directory), but upstream MLIR&rsquo;s bazel
layout is different.</p><p>LLVM&rsquo;s bazel overlay for MLIR is contained in a
<a href=https://github.com/llvm/llvm-project/blob/main/utils/bazel/llvm-project-overlay/mlir/BUILD.bazel>single file</a>,
and so you can manually look there to find the right target. With bazel, if you
know the filepath of interested you can also run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel query --keep_going <span style=color:#4e9a06>&#39;same_pkg_direct_rdeps(@llvm-project//mlir:&lt;path&gt;)&#39;</span>
</span></span></code></pre></div><p>where <code>&lt;path></code> is the path relative to <code>mlir/</code> in the <code>llvm-project</code> project
root. For example, to find the target that provides
<code>mlir/include/mlir/Pass/PassBase.td</code>, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel query --keep_going <span style=color:#4e9a06>&#39;same_pkg_direct_rdeps(@llvm-project//mlir:include/mlir/Pass/PassBase.td)&#39;</span>
</span></span></code></pre></div><p>And the output will be something like</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>@llvm-project//mlir:PassBaseTdFiles
</span></span></code></pre></div><p>You can find more examples and alternative queries at the
<a href=https://bazel.build/query/language#rdeps>Bazel query docs</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0f74d2ae2f254619ee015b1e9bfd1422>2.2 - Boilerplate tools</h1><p>The script <code>scripts/templates/templates.py</code> contains commands for generating new
dialects and transforms, filling in most of the boilerplate Tablegen and C++.
These commands do <strong>not</strong> add the code needed to register the new passes or
dialects in <code>heir-opt</code>.</p><p>These should be used when the tablegen files containing existing pass
definitions in the expected filepaths are not already present. Otherwise, you
must modify the existing tablegen files directly.</p><p>Run <code>python scripts/templates/templates.py --help</code> and
<code>python scripts/templates/templates.py &lt;subcommand> --help</code> for the available
commands and options.</p><h2 id=creating-a-new-pass>Creating a New Pass</h2><h3 id=general-passes>General passes</h3><p>If the pass does not operate from and to a specific dialect, use something
similar to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python scripts/templates/templates.py new_transform <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pass_name<span style=color:#ce5c00;font-weight:700>=</span>ForgetSecrets <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pass_flag<span style=color:#ce5c00;font-weight:700>=</span>forget-secrets
</span></span></code></pre></div><h3 id=dialect-transforms>Dialect Transforms</h3><p>To create a pass that operates within on a dialect, run a command similar to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python scripts/templates/templates.py new_dialect_transform <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pass_name<span style=color:#ce5c00;font-weight:700>=</span>ForgetSecrets <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pass_flag<span style=color:#ce5c00;font-weight:700>=</span>forget-secrets <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--dialect_name<span style=color:#ce5c00;font-weight:700>=</span>Secret <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--dialect_namespace<span style=color:#ce5c00;font-weight:700>=</span>secret
</span></span></code></pre></div><h3 id=conversion-pass>Conversion Pass</h3><p>To create a new conversion pass, i.e., a pass that lowers from one dialect to
another, run a command similar to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python scripts/templates/templates.py new_conversion_pass <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--source_dialect_name<span style=color:#ce5c00;font-weight:700>=</span>CGGI <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--source_dialect_namespace<span style=color:#ce5c00;font-weight:700>=</span>cggi <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--source_dialect_mnemonic<span style=color:#ce5c00;font-weight:700>=</span>cggi <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--target_dialect_name<span style=color:#ce5c00;font-weight:700>=</span>TfheRust <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--target_dialect_namespace<span style=color:#ce5c00;font-weight:700>=</span>tfhe_rust <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--target_dialect_mnemonic<span style=color:#ce5c00;font-weight:700>=</span>tfhe_rust
</span></span></code></pre></div><p>In order to build the resulting code, you must fix the labeled <code>FIXME</code>s in the
type converter and the op conversion patterns.</p><h2 id=creating-a-new-dialect>Creating a New Dialect</h2><p>To create a new dialect, run something like</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python scripts/templates/templates.py new_dialect <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--dialet_name<span style=color:#ce5c00;font-weight:700>=</span>TensorExt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--dialect_namespace<span style=color:#ce5c00;font-weight:700>=</span>tensor_ext <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--enable_attributes<span style=color:#ce5c00;font-weight:700>=</span>False <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--enable_types<span style=color:#ce5c00;font-weight:700>=</span>True <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--enable_ops<span style=color:#ce5c00;font-weight:700>=</span>True
</span></span></code></pre></div><p>Note that all <code>--enable</code> flags are <code>True</code> by default, so if you know your
dialect will not have attributes or types, you have to explicitly disable those
options.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-51e47549bc26dd648b0de019093624f2>2.3 - IDE configuration</h1><h2 id=heir-lsp>heir-lsp</h2><p>HEIR provides an LSP server that extends the MLIR LSP server with HEIR&rsquo;s
dialects.</p><p>Build the LSP binary, then move it to a location on your path or point your IDE
to <code>bazel-bin/tools/heir-lsp</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bazel build //tools:heir-lsp
</span></span><span style=display:flex><span>cp bazel-bin/tools/heir-lsp /usr/local/bin
</span></span></code></pre></div><p>Note that if you change any HEIR dialects, or if HEIR&rsquo;s dependency on MLIR
updates and the upstream MLIR has dialect changes (which happens roughly daily),
you need to rebuild <code>heir-lsp</code> for it to recognize the changes.</p><h2 id=clangd>clangd</h2><p>Most IDE configured to use clangd can be powered from a file called
<code>compile_commands.json</code>. To generate that for HEIR, run</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bazel run @hedron_compile_commands//:refresh_all
</span></span></code></pre></div><p>This will need to be regenerated when there are major <code>BUILD</code> file changes. If
you encounter errors like <code>*.h.inc</code> not found, or syntax errors inside these
files, you may need to build those targets and then re-run the <code>refresh_all</code>
command above.</p><p>Note that you will most likely also need to install the actual <code>clangd</code> language
server, e.g., <code>sudo apt-get install clangd</code> on debian/ubuntu.</p><h2 id=ibazel-file-watcher>ibazel file watcher</h2><p><a href=https://github.com/bazelbuild/bazel-watcher><code>ibazel</code></a> is a shell around
<code>bazel</code> that watches a build target for file changes and automatically rebuilds.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ibazel build //tools:heir-opt
</span></span></code></pre></div><h2 id=vs-code>VS Code</h2><p>While a wide variety of IDEs and editors can be used for HEIR development, we
currently only provide support for <a href=https://code.visualstudio.com/>VSCode</a>.</p><h3 id=setup>Setup</h3><p>For the best experience, we recommend following these steps:</p><ul><li><p>Install the
<a href="https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-mlir">MLIR</a>,
<a href="https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-clangd">clangd</a>
and
<a href="https://marketplace.visualstudio.com/items?itemName=BazelBuild.vscode-bazel">Bazel</a>
extensions</p></li><li><p>Install and rename Buildifier:</p><p>You can download the latest Buildifier release, e.g., for linux-amd64 (see the
<a href=https://github.com/bazelbuild/buildtools/releases/latest/>Bazel Release Page</a>
for a list of available binaries):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -c https://github.com/bazelbuild/buildtools/releases/latest/download/buildifier-linux-amd64
</span></span><span style=display:flex><span>mv buildifier-linux-amd64 buildifier
</span></span><span style=display:flex><span>chmod +x buildifier
</span></span></code></pre></div><p>Just as with bazel, you will want to move this somewhere on your PATH, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/bin
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;export PATH=$PATH:~/bin&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span>mv buildifier ~/bin/buildifier
</span></span></code></pre></div><p>VS Code should automatically detect buildifier. If this is not successful, you
can manually set the &ldquo;Buildifier Executable&rdquo; setting for the Bazel extension
(<code>bazel.buildifierExecutable</code>).</p></li><li><p>Disable the
<a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++ (aka &lsquo;cpptools&rsquo;)</a>
extension (either completely, or in the current workspace).</p></li><li><p>Add the following snippet to your VS Code user settings found in
.vscode/settings.json to enable autocomplete based on the
compile_commands.json file (see above).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:#4e9a06>&#34;clangd.arguments&#34;</span><span style=color:#a40000>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--compile-commands-dir=${workspaceFolder}/&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--completion-style=detailed&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--query-driver=**&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span><span style=color:#a40000>,</span>
</span></span></code></pre></div></li><li><p>For Python formatting, HEIR uses <a href=https://github.com/google/pyink>pyink</a> for
autoformatting, which is a fork of the more commonly used
<a href=https://github.com/psf/black>black</a> formatter with some patches to support
Google&rsquo;s internal style guide. To use it in VSCode, install <code>pyink</code> along with
other python utilities needed for HEIR: <code>pip install -r requirements.txt</code> and
install the
<a href="https://marketplace.visualstudio.com/items?itemName=ms-python.black-formatter">Black Formatter</a>
extension, then add the following to your VSCode user settings
(<code>.vscode/settings.json</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#4e9a06>&#34;[python]&#34;</span><span style=color:#a40000>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;editor.defaultFormatter&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ms-python.black-formatter&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>,</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;black-formatter.path&#34;</span><span style=color:#a40000>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;path/to/pyink&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div></li><li><p>It might be necessary to add the path to your buildifier to VSCode, though it
should be auto-detected.</p><ul><li>Open the heir folder in VSCode</li><li>Go to &lsquo;Settings&rsquo; and set it on the &lsquo;Workspace&rsquo;</li><li>Search for &ldquo;Bazel Buildifier Executable&rdquo;</li><li>Once you find it, write <code>[home-directory]/bin/buildifier</code> for your specific
[home-directory].</li></ul></li></ul><h3 id=building-testing-running-and-debugging-with-vscode>Building, Testing, Running and Debugging with VSCode</h3><h4 id=building>Building</h4><ol><li>Open the &ldquo;Explorer&rdquo; (File Overview) in the left panel.</li><li>Find &ldquo;Bazel Build Targets&rdquo; towards the bottom of the &ldquo;Explorer&rdquo; panel and
click the dropdown button.</li><li>Unfold the heir folder</li><li>Right-click on &ldquo;//tools&rdquo; and click the &ldquo;Build Package Recursively&rdquo; option</li></ol><h4 id=testing>Testing</h4><ol><li>Open the &ldquo;Explorer&rdquo; (File Overview) in the left panel.</li><li>Find &ldquo;Bazel Build Targets&rdquo; towards the bottom of the &ldquo;Explorer&rdquo; panel and
click the dropdown button.</li><li>Unfold the heir folder</li><li>Right-click on &ldquo;//test&rdquo; and click the &ldquo;Test Package Recursively&rdquo; option</li></ol><h4 id=running-and-debugging>Running and Debugging</h4><ol><li><p>Create a <code>launch.json</code> file in the <code>.vscode</code> folder, changing the <code>"name"</code>
and <code>"args"</code> as required:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;0.2.0&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;configurations&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Debug Secret-&gt;BGV&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;preLaunchTask&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;build&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;lldb&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;request&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;launch&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;program&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}/bazel-bin/tools/heir-opt&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;--secret-to-bgv&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;--debug&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${workspaceFolder}/tests/secret_to_bgv/ops.mlir&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;relativePathBase&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;sourceMap&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;proc/self/cwd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;/proc/self/cwd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;${workspaceFolder}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>You can add as many different configurations as necessary.</p></li><li><p>Add Breakpoints to your program as desired.</p></li><li><p>Open the Run/Debug panel on the left, select the desired configuration and
run/debug it.</p></li></ol><ul><li>Note that you might have to hit &ldquo;Enter&rdquo; to proceed past the Bazel build. It
might take several seconds between hitting &ldquo;Enter&rdquo; and the debug terminal
opening.</li></ul><h2 id=vimneovim>Vim/Neovim</h2><h3 id=misc-config>Misc config</h3><p>Filetype detection</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span># <span style=color:#000>ftdetect</span>/<span style=color:#000>mlir</span>.<span style=color:#000>vim</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>au</span> <span style=color:#000>BufRead</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>BufNewFile</span> *.<span style=color:#000>mlir</span> <span style=color:#000>setfiletype</span> <span style=color:#000>mlir</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><a href=/docs/development/bazel/#build-file-formatting>Buildifier</a> integration</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span># <span style=color:#000>ftplugin</span>/<span style=color:#000>bzl</span>.<span style=color:#000>vim</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>augroup</span> <span style=color:#000>AutoFormat</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>autocmd</span><span style=color:#000;font-weight:700>!</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>autocmd</span> <span style=color:#000>BufWritePre</span> <span style=color:#000>Neoformat</span> <span style=color:#000>buildifier</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>augroup</span> <span style=color:#000>END</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>LSP configuration (Neovim, using
<a href=https://github.com/neovim/nvim-lspconfig>nvim-lspconfig</a>)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#000>nvim_lsp</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;mlir_lsp_server&#34;</span><span style=color:#000;font-weight:700>].</span><span style=color:#000>setup</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>on_attach</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>on_attach</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>capabilities</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>capabilities</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cmd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;heir-lsp&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Tree-sitter configuration for relevant project languages</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;nvim-treesitter.configs&#39;</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>setup</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>ensure_installed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;markdown_inline&#34;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#8f5902;font-style:italic>-- for markdown in tablegen</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;mlir&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;tablegen&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;verilog&#34;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#8f5902;font-style:italic>-- for yosys</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- &lt;... other config options ...&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Telescope-alternate config (quickly jump between cc, header, and tablegen files)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;telescope-alternate&#39;</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>setup</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>mappings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pattern</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/(.*).h&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cc&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cc Test&#39;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cpp&#39;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpp Test&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].td&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;tablegen&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pattern</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/(.*).cc&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].h&#39;</span><span style=color:#000;font-weight:700>,</span>        <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;header&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cc&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cc Test&#39;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cpp&#39;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpp Test&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].td&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;tablegen&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pattern</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/(.*).cpp&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].h&#39;</span><span style=color:#000;font-weight:700>,</span>        <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;header&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cc&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;test&#39;</span><span style=color:#000;font-weight:700>,</span>     <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1]Test.cpp&#39;</span><span style=color:#000;font-weight:700>,</span>  <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;test&#39;</span><span style=color:#000;font-weight:700>,</span>     <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].td&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;tablegen&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pattern</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/(.*).td&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].h&#39;</span><span style=color:#000;font-weight:700>,</span>        <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;header&#39;</span><span style=color:#000;font-weight:700>,</span>   <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cc&#39;</span><span style=color:#000;font-weight:700>,</span>       <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cpp&#39;</span><span style=color:#000;font-weight:700>,</span>      <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>pattern</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;(.*)Test.(.*)&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;**/[1].[2]&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>label</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;implementation&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_new</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000>open_only_one_with</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;vertical_split&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><h3 id=useful-mappings>Useful mappings</h3><p>Navigate to the bazel build target for current file</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#000>vim.keymap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;n&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;&lt;leader&gt;eb&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- expand(&#34;%:p:h&#34;) gets the current filepath</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>buildfile</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>vim.fn</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>expand</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%:p:h&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#4e9a06>&#34;/BUILD&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- expand(&#34;%:t&#34;) gets the current filename with suffix.</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>vim.fn</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>expand</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%:t&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>vim.api</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nvim_command</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;botright vsplit &#34;</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>buildfile</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>vim.cmd</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;normal /&#34;</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>target</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>vim.api</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nvim_replace_termcodes</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&lt;CR&gt;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>  <span style=color:#000>vim.cmd</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;normal zz&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span> <span style=color:#000>noremap</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span> <span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div><p>Set include guards according to HEIR style guide.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#204a87;font-weight:700>local</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>build_include_guard</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- project relative filepath</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>abs_path</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>vim.fn</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>expand</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>rel_path</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>vim.fn</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fnamemodify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>abs_path</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;:~:.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- screaming case</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>upper</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>string.upper</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>rel_path</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- underscore separated</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>underscored</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>string.gsub</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>upper</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;[./]&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;_&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>-- trailing underscore</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>underscored</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#4e9a06>&#34;_&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>-- mnemonic: fi = fix include (guard)</span>
</span></span><span style=display:flex><span><span style=color:#000>vim.keymap</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;n&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;&lt;leader&gt;fi&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>buf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>vim.api</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nvim_get_current_buf</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>include_guard</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>build_include_guard</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>ifndef</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#ifndef &#34;</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>include_guard</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>define</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#define &#34;</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>include_guard</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>local</span> <span style=color:#000>endif</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#endif  // &#34;</span> <span style=color:#ce5c00;font-weight:700>..</span> <span style=color:#000>include_guard</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>vim.api</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nvim_buf_set_lines</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>buf</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>ifndef</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>define</span> <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>  <span style=color:#000>vim.api</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>nvim_buf_set_lines</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>buf</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>endif</span> <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>noremap</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span> <span style=color:#000;font-weight:700>})</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e62e32c8f8aaa5c7325bea5a1b00e345>3 - Tutorials and Talks</h1><p>A list of tutorials by the HEIR community. To add to this list, open an issue or
submit a pull request
<a href=https://github.com/google/heir/blob/main/docs/content/en/docs/tutorials.md>on GitHub</a>.</p><h2 id=talks>Talks</h2><ul><li><a href="https://www.youtube.com/watch?v=kqDFdKUTNA4">HEIR: A foundation for FHE compilers (FHE.org 2023-10 meetup)</a></li><li><a href="https://www.youtube.com/watch?v=ne5D_kqlxYg&amp;list=PLnbmMskCVh1fZy00EZQnFSezctvwYmlRM&amp;index=4">How to Write Optimizations in HEIR (FHE.org 2024 conference tutorial)</a>
(<a href="https://docs.google.com/presentation/d/1zRgrkWgLn4FxAWWDTQb8KnS-pqtUbST1AIR8bT_a-E8/edit?usp=sharing">slides</a>)</li><li><a href="https://www.youtube.com/watch?v=6JPwpTOcydM">Updates on the HEIR Compiler Project (FHE.org 2025 conference talk)</a>
(<a href="https://docs.google.com/presentation/d/1nKj0i0tyBSGUAI-tYMUDeji-EgqCj4PBrgw_NgMb3fM/edit?usp=sharing">slides</a>)</li></ul><h2 id=mlir-tutorials>MLIR tutorials</h2><ul><li><a href=https://github.com/j2kun/mlir-tutorial/>MLIR for Beginners by Jeremy Kun</a></li><li><a href="https://www.youtube.com/playlist?list=PLv9xz1VZ_qfFqpSAEgay96kxEGS81_NYq">YouTube playlist of useful MLIR talks for HEIR developers</a></li></ul><h2 id=fhe-math>FHE math</h2><ul><li><a href=https://www.jeremykun.com/2024/05/04/fhe-overview/>A High Level Technical Overview of Fully Homomorphic Encryption by Jeremy Kun</a></li><li><a href=https://www.jeremykun.com/2024/09/06/packing-matrix-vector-multiplication-in-fhe/>Packing matrix-vector multiplication in FHE by Jeremy Kun</a></li><li><a href=https://www.jeremykun.com/2024/09/02/shift-networks/>Shift Networks by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2022/12/28/estimating-the-security-of-ring-learning-with-errors-rlwe/>Estimating the Security of Ring Learning With Errors by Cathie Yun</a></li><li><a href=https://jeremykun.com/2022/08/29/key-switching-in-lwe/>Key Switching in LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2022/07/16/modulus-switching-in-lwe/>Modulus Switching in LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2022/12/09/negacyclic-polynomial-multiplication/>Negacyclic Polynomial Multiplication by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2023/02/27/sample-extraction-from-rlwe-to-lwe/>Sample Extraction from RLWE to LWE by Jeremy Kun</a></li><li><a href=https://jeremykun.com/2021/12/11/the-gadget-decomposition-in-fhe/>The Gadget Decomposition in FHE by Jeremy Kun</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f33468f03bdb92c1601bbed999044c76>4 - Research with HEIR</h1><h2 id=publications-built-on-heir>Publications built on HEIR</h2><p><a href=https://dl.acm.org/doi/10.1145/3729258>Circuit Optimization Using Arithmetic Table Lookups</a>
(PLDI 2025). Raghav Malik, Vedant Paranjape, Milind Kulkarni.</p><h2 id=doing-private-research-using-heir>Doing private research using HEIR</h2><p>Our project will be developed in an open-source GitHub repository. If you&rsquo;d like
to work on a non-public branch while still accessing the latest developments, we
recommend the following setup. This process will result in two remote
repositories: one public for submitting pull requests (PRs) to the original repo
and one private.</p><ol><li><p><strong>Fork the Repository</strong>: Fork the
<a href=https://github.com/google/heir>google/heir</a> repo to a public fork on your
GitHub repository. This should create a project at
<code>https://github.com/&lt;username>/heir</code></p></li><li><p><strong>Create a Private Repository</strong>: Create a new private repo using the
<a href=https://github.com/new>GitHub UI</a>, e.g. named <code>heir-private</code></p></li><li><p><strong>Link Your Fork to the Private Repository</strong> Couple your fork to the new
private repo</p></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --bare git@github.com:&lt;username&gt;/heir.git heir-public
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> heir-public
</span></span><span style=display:flex><span>git push --mirror git@github.com:&lt;username&gt;/heir-private.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> ..
</span></span><span style=display:flex><span>rm -rf heir-public
</span></span></code></pre></div><ol start=4><li><strong>Clone the Private Repository</strong> Now, you can clone the private repo to work
locally</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:&lt;username&gt;/heir-private.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> heir-private
</span></span></code></pre></div><ol start=5><li><strong>Add the Private Repository as a Remote to Your Public Repository</strong>
Additionally, you can add the private repo as a remote target to your public
repo. This way, the private branch will be locally available, while you can
push commits to the private repo.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> heir
</span></span><span style=display:flex><span>git remote add private git@github.com:&lt;username&gt;/heir-private.git
</span></span><span style=display:flex><span>git fetch --all
</span></span><span style=display:flex><span>git checkout private/new_branch
</span></span></code></pre></div><p>Note that using <code>git push private new_branch2</code> will push the commit/branch to
the private repo.</p><p>Once you&rsquo;re ready to publish your development work, you can push your commits to
a branch in the public repository and create a pull request.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-439f0d1f88fc52920f9828a37ce073a8>5 - Design</h1><p>HEIR is a compiler toolchain that allows the compilation of high-level programs
to equivalent programs that operate on encrypted data.</p><p>HEIR is built in the <a href=https://mlir.llvm.org/>MLIR</a> framework.</p><p>HEIR defines dialects at various layers of abstraction, from high-level
scheme-agnostic operations on secret types to low-level polynomial arithmetic.
The diagram below shows some of the core HEIR dialects, and the compilation flow
is generally from the top of the diagram downward.</p><img style=display:block;margin-left:75px;width:500px src=/images/dialect-diagram.png><p>The pages in this section describe the design of various subcomponents of HEIR.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b68f7af4e332a4d2b770c09ac2607bf8>5.1 - Ciphertext Management</h1><p>On 2025-04-17, Hongren Zheng gave a talk overview of the ciphertext management
system in the HEIR working group meeting.
<a href="https://youtu.be/HHU6rCMxZRc?si=U_ePY5emqs6e4NoV&amp;t=1631">The video can be found here</a>
and <a href=/slides/mgmt-2025-04-17.pdf>the slides can be found here</a></p><h2 id=introduction>Introduction</h2><p>To lower from user specified computation to FHE scheme operations, a compiler
must insert <em>ciphertext management</em> operations to satisfy various requirements
of the FHE scheme, like modulus switching, relinearization, and bootstrapping.
In HEIR, such operations are modeled in a scheme-agnostic way in the <code>mgmt</code>
dialect.</p><p>Taking the arithmetic pipeline as example: a program specified in high-level
MLIR dialects like <code>arith</code> and <code>linalg</code> is first transformed to an IR with only
<code>arith.addi/addf</code>, <code>arith.muli/mulf</code>, and <code>tensor_ext.rotate</code> operations. We
call this form the <em>secret arithmetic</em> IR.</p><p>Then management passes insert <code>mgmt</code> ops to support future lowerings to scheme
dialects like <code>bgv</code> and <code>ckks</code>. As different schemes have different management
requirement, they should be inserted in different styles.</p><p>We discuss each scheme below to show the design in HEIR. For RLWE schemes, we
all assume RNS instantiation.</p><h2 id=bgv>BGV</h2><p>BGV is a leveled scheme where each level has a modulus $q_i$. The level is
numbered from $0$ to $L$ where $L$ is the input level and $0$ is the output
level. The core feature of BGV is that when the magnititude of the noise becomes
large (often caused by multiplication), a modulus switching operation from level
$i$ to level $i-1$ can be inserted to reduce the noise to a &ldquo;constant&rdquo; level. In
this way, BGV can support a circuit of multiplicative depth $L$.</p><h3 id=bgv-relinearization>BGV: Relinearization</h3><p>HEIR initially inserts relinearization ops immediately after each multiplication
to keep ciphertext dimension &ldquo;linear&rdquo;. A later relinearization optimization pass
relaxes this requirement, and uses an integer linear program to decide when to
relinearize. See <a href=/docs/design/relinearization_ilp/>Optimizing Relinearization</a>
for more details.</p><h3 id=bgv-modulus-switching>BGV: Modulus switching</h3><p>There are several techniques to insert modulus switching ops.</p><p>For the example circuit <code>input -> mult -> mult -> output</code>, the insertion result
could be one of</p><ol><li><p>After multiplication: <code>input -> (mult -> ms) -> (mult -> ms) -> output</code></p></li><li><p>Before multiplication: <code>input -> (mult) -> (ms -> mult) -> (ms -> output)</code></p></li><li><p>Before multiplication (including the first multiplication):
<code>input -> (ms -> mult) -> (ms -> mult) -> (ms -> output)</code></p></li></ol><p>The first strategy is from the BGV paper, the second and third strategies are
from OpenFHE, which correspond to the <code>FLEXIBLEAUTO</code> mode and <code>FLEXIBLEAUTOEXT</code>
mode, respectively.</p><p>The first strategy is conceptually simpler, yet other policies have the
advantage of smaller noise growth. In latter policies, by delaying the modulus
switch until just before multiplication, the noise from other operations between
multiplications (like rotation/relinearization) also benefit from the noise
reduction of a modulus switch.</p><p>Note that, as multiplication has two operands, the actual circuit for the latter
two policies is <code>mult(ms(ct0), ms(ct1))</code>, whereas in the first policy the
circuit is <code>ms(mult(ct0, ct1))</code>.</p><p>The third policy has one more switching op than the others, so it will need one
more modulus.</p><p>There are also other insertion strategy like inserting it dynamically based on
current noise (see HElib) or lazy modulus switching. Those are not implemented.</p><h3 id=bgv-scale-management>BGV: Scale management</h3><p>For the original BGV scheme, it is required to have $qi \equiv 1 \pmod{t}$
where $t$ is the plaintext modulus. However in practice such requirement will
make the choice of $q_i$ too constrained. In the GHS variant, this condition is
removed, with the price of scale management needed.</p><p>Modulus switching from level $i$ to level $i-1$ is essentially dividing (with
rounding) the ciphertext by $q_i$, hence dividing the noise and payload message
inside by $q_i$. The message $m$ can often be written as $[m]_t$, the coset
representative of <code>m</code> $\mathbb{Z}/t\mathbb{Z}$. Then by dividing of $q_i$
produces a result message $[m \cdot q_i^{-1}]_t$.</p><p>Note that when $qi \equiv 1 \pmod{t}$, the result message is the same as the
original message. However, in the GHS variant this does not always hold, so we
call the introduced factor of $[q^{-1}]_t$ the <em>scale</em> of the message. HEIR
needs to record and manage it during compilation. When decrypting the scale must
be removed to obtain the right message.</p><p>Note that, for messages $m_0$ and $m_1$ of different scale $a$ and $b$, we
cannot add them directly because $[a \cdot m_0 + b \cdot m_1]_t$ does not
always equal $[m_0 + m_1]_t$. Instead we need to adjust the scale of one
message to match the other, so $[b \cdot m_0 + b \cdot m_1]_t = [b \cdot
(m_0 + m_1)]_t$. Such adjustment could be done by multiplying $m_0$ with a
constant $[b \cdot a^{-1}]_t$. This adjustment is not for free, and
increases the ciphertext noise.</p><p>As one may expect, different modulus switching insertion strategies affect
message scale differently. For $m_0$ with scale $a$ and $m_1$ with scale $b$,
the result scale would be</p><ol><li><p>After multiplication: $[ab / qi]_t$.</p></li><li><p>Before multiplication: $[a / qi \cdot b / qi]_t = [ab / (qi^2)]_t$.</p></li></ol><p>This is messy enough. To ease the burden, we can impose additional requirement:
mandate a constant scale $\Delta_i$ for all ciphertext at level $i$. This is
called the <em>level-specific scaling factor</em>. With this in mind, addition within
one level can happen without caring about the scale.</p><ol><li><p>After multiplication: $\Delta_{i-1} = [\Delta_i^2 / qi]_t$</p></li><li><p>Before multiplication: $\Delta_{i-1} = [\Delta_i^2 / (qi^2)]_t$</p></li></ol><h3 id=bgv-cross-level-operation>BGV: Cross Level Operation</h3><p>With the level-specific scaling factor, one may wonder how to perform addition
and multiplication of ciphertexts on different levels. This can be done by
adjusting the level and scale of the ciphertext at the higher level.</p><p>The level can be easily adjusted by dropping the extra limbs, and scale can be
adjusted by multiplying a constant, but because multiplying a constant will
incur additional noise, the procedure becomes the following:</p><ol><li><p>Assume the level and scale of two ciphertexts are $l_1$ and $l_2$, $s_1$ and
$s_2$ respectively. WLOG assume $l_1 > l_2$.</p></li><li><p>Drop $l_1 - l_2 - 1$ limbs for the first ciphertext to make it at level $l_2
+ 1$, if those extra limbs exist.</p></li><li><p>Adjust scale from $s_1$ to $s_2 \cdot q_{l_2 + 1}$ by multiplying $[s_2
\cdot q_{l_2 + 1} / s1]_t$ for the first ciphertext.</p></li><li><p>Modulus switch from $l_2 + 1$ to $l_2$, producing scale $s_2$ for the first
ciphertext and its noise is controlled.</p></li></ol><h3 id=bgv-implementation-in-heir>BGV: Implementation in HEIR</h3><p>In HEIR the different modulus switching policy is controlled by the pass option
for <code>--secret-insert-mgmt-bgv</code>. The pass defaults to the &ldquo;Before Multiplication&rdquo;
policy. If user wants other policy, the <code>after-mul</code> or
<code>before-mul-include-first-mul</code> option may be used. The <code>mlir-to-bgv</code> pipeline
option <code>modulus-switch-before-first-mul</code> corresponds to the latter option.</p><p>The <code>secret-insert-mgmt</code> pass is also responsible for managing cross-level
operations. However, as the scheme parameters are not generated at this point,
the concrete scale could not be instantiated so some placeholder operations are
inserted.</p><p>After the modulus switching policy is applied, the <code>generate-param-bgv</code> pass
generates scheme parameters. Optionally, user could skip this pass by manually
providing scheme parameter as an attribute at module level.</p><p>Then <code>populate-scale-bgv</code> comes into play by using the scheme parameters to
instantiate concrete scale, and turn those placeholder operations into concrete
multiplication operation.</p><h2 id=ckks>CKKS</h2><p>CKKS is a leveled scheme where each level has a modulus $q_i$. The level is
numbered from $0$ to $L$ where $L$ is the input level and $0$ is the output
level. CKKS ciphertext contains a scaled message $\Delta m$ where $\Delta$
takes some value like $2^40$ or $2^80$. After multiplication of two messages,
the scaling factor $\Delta&rsquo;$ will become larger, hence some kind of management
policy is needed in case it blows up. Contrary to BGV where modulus switching is
used for noise management, in CKKS modulus switching from level $i$ to level
$i-1$ can divide the scaling factor $\Delta$ by the modulus $q_i$.</p><p>The management of CKKS is similar to BGV above in the sense that their strategy
are the similar and uses similar code base. However, BGV scale management is
internal and users are not required to concern about it, while CKKS scale
management is visible to user as it affects the precision. One notable
difference is that, for &ldquo;Before multiplication (including the first
multiplication)&rdquo; modulus switching policy, the user input should be encoded at
$\Delta^2$ or higher, as otherwise the first modulus switching (or rescaling in
CKKS term) will rescale $\Delta$ to $1$, rendering full precision loss.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bddfea9d49299ca5edc4a07ea06fcc23>5.2 - Data-oblivious Transformations</h1><p>A data-oblivious program is one that decouples data input from program
execution. Such programs exhibit control-flow and memory access patterns that
are independent of their input(s). This programming model, when applied to
encrypted data, is necessary for expressing FHE programs. There are 3 major
transformations applied to convert a conventional program into a data-oblivious
program:</p><h3 id=1-if-transformation>(1) If-Transformation</h3><p>If-operations conditioned on inputs create data-dependent control-flow in
programs. <code>scf.if</code> operations should at least define a &rsquo;then&rsquo; region (true path)
and always terminate with <code>scf.yield</code> even when <code>scf.if</code> doesn&rsquo;t produce a
result. To convert a data-dependent <code>scf.if</code> operation to an equivalent set of
data-oblivious operations in MLIR, we hoist all safely speculatable operations
in the <code>scf.if</code> operation and convert the <code>scf.yield</code> operation to an
<code>arith.select</code> operation. The following code snippet demonstrates an application
of this transformation.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying If-transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: %input is used as a condition causing a data-dependent branch
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span><span style=color:#a40000>`</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying If-transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(){</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We implement a <code>ConvertIfToSelect</code> pass that transforms operations with
secret-input conditions and with only Pure operations (i.e., operations that
have no memory side effect and are speculatable) in their body. <strong>This
transformation cannot be applied to operations when side effects are present in
only one of the two regions.</strong> Although possible, we currently do not support
transformations for operations where both regions have operations with matching
side effects. When side effects are present, the pass fails.</p><h3 id=2-loop-transformation>(2) Loop-Transformation</h3><p>Loop statements with input-dependent conditions (bounds) and number of
iterations introduce data-dependent branches that violate data-obliviousness. To
convert such loops into a data-oblivious version, we replace input-dependent
conditionals (bounds) with static input-independent parameters (e.g. defining a
constant upper bound), and early-exits with update operations where the value
returned from the loop is selectively updated using conditional predication. In
MLIR, loops are expressed using either <code>affine.for</code>, <code>scf.for</code> or <code>scf.while</code>
operations.</p><blockquote><p>[!NOTE] Early exiting from loops is not supported in <code>scf</code> and <code>affine</code>, so
early exits are not supported in this pipeline. TODO(#922): support early
exits</p></blockquote><ul><li><code>affine.for</code>: This operation lends itself well to expressing data oblivious
programs because it requires constant loop bounds, eliminating input-dependent
limits.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span> <span style=color:#000>%sum_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0.0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span> <span style=color:#8f5902;font-style:italic>// The for-loop&#39;s bound is a fixed constant
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>10</span> step <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%sum_iter</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%sum_0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%t</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%buffer</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1024x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>%sum_next</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addf <span style=color:#000>%sum_iter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>   affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%sum_next</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span> <span style=color:#000;font-weight:700>...</span>
</span></span></code></pre></div><ul><li><code>scf.for</code>: In contrast to affine.for, scf.for does allow input-dependent
conditionals which does not adhere to data-obliviousness constraints. A
solution to this could be to either have the programmer or the compiler
specify an input-independent upper bound so we can transform the loop to use
this upper bound and also carefully update values returned from the for-loop
using conditional predication. Our current solution to this is for the
programmer to add the lower bound and worst case upper bound in the static
affine loop&rsquo;s <code>attributes</code> list.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%value</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: for-loop uses %inputIndex as upper bound which causes a secret-dependent control-flow
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%begin</span> to <span style=color:#000>%inputIndex</span> step <span style=color:#000>%step_value</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%value</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Build for-loop using lower and upper values from the `attributes` list
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to  step <span style=color:#0000cf;font-weight:700>32</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%agr1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iv</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%newOutput</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%output</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%newOutput</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><code>scf.while</code>: This operation represents a generic while/do-while loop that
keeps iterating as long as a condition is met. An input-dependent while
condition introduces a data-dependent control flow that violates
data-oblivious constraints. For this transformation, the programmer needs to
add the <code>max_iter</code> attribute that describes the maximum number of iterations
the loop runs which we then use the value to build our static <code>affine.for</code>
loop.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}){</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>while <span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Violation: scf.while uses %cond whose value depends on %input
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    scf<span style=color:#000;font-weight:700>.</span>condition<span style=color:#000;font-weight:700>(</span><span style=color:#000>%cond</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> do <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mul</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%mul</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Loop-Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}){</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%begin</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Replace while-loop with a for-loop with a constant bound %MAX_ITER
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%iv</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%0</span> to <span style=color:#000>%16</span> step <span style=color:#000>%step_value</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%iter_arg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%zero</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mul</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%iter_arg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%output</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%mul</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%iter_arg</span>
</span></span><span style=display:flex><span>    scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%output</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=3-access-transformation>(3) Access-Transformation</h3><p>Input-dependent memory access cause data-dependent memory footprints. A naive
data-oblivious solution to this maybe doing read-write operations over the
entire data structure while only performing the desired save/update operation
for the index of interest. For simplicity, we only look at load/store operations
for tensors as they are well supported structures in high-level MLIR likely
emitted by most frontends. We drafted the following non-SIMD approach for this
transformation and defer SIMD optimizations to the <code>heir-simd-vectorizer</code> pass:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Before applying Access Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: tensor.extract loads value at %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%newValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extractedValue</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Violation: tensor.insert stores value at %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%newValue</span> into <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// After applying Non-SIMD Access Transformation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%inputIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%i_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%dummyValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg</span><span style=color:#000;font-weight:700>=</span> <span style=color:#000>%dummyValue</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 1. Check if %i matches %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 2. Extract value at %i
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 3. If %i matches %inputIndex, select %value extracted in (2), else select %dummyValue
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 4. Yield selected value
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%selected</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%dummyValue</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%selected</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%newValue</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extractedValue</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c_10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span><span style=color:#000;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// 1. Check if %i matches the %inputIndex
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 2. Insert %newValue and produce %newTensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 3. If %i matches %inputIndex, select %newTensor, else select input tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// 4. Yield final tensor
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%cond</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputIndex</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%newTensor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%value</span> into <span style=color:#000>%inputArg</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%finalTensor</span><span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%newTensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%inputArg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%finalTensor</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=more-notes-on-these-transformations>More notes on these transformations</h3><p>These 3 transformations have a cascading behavior where transformations can be
applied progressively to achieve a data-oblivious program. The order of the
transformations goes as follows:</p><ul><li><em>Access-Transformation</em> (change data-dependent tensor accesses (reads-writes)
to use <code>affine.for</code> and <code>scf.if</code> operations) -> <em>Loop-Transformation</em> (change
data-dependent loops to use constant bounds and condition the loop&rsquo;s yield
results with <code>scf.if</code> operation) -> <em>If-Transformation</em> (substitute
data-dependent conditionals with <code>arith.select</code> operation).</li><li>Besides that, when we apply non-SIMD Access-Transformation on multiple
data-dependent tensor read-write operations over the same tensor, we can
benefit from upstream affine transformations over the resulting multiple
affine loops produced by the Access-Transformation to fuse these loops.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-596c831179432fef68d03e056a55875c>5.3 - Noise Analysis</h1><p>Homomorphic Encryption (HE) schemes based on Learning-With-Errors (LWE) and
Ring-LWE naturally need to deal with <em>noises</em>. HE compilers, in particular, need
to understand the noise behavior to ensure correctness and security while
pursuing efficiency and optimizaiton.</p><p>The noise analysis in HEIR has the following central task: Given an HE circuit,
analyse the noise growth for each operation. HEIR then uses noise analysis for
parameter selection, but the details of that are beyond the scope of this
document.</p><p>Noise analysis and parameter generation are still under active researching and
HEIR does not have a one-size-fits-all solution for now. Noise analyses and
(especially) parameter generation in HEIR should be viewed as experimental.
<em>There is no guarantee that they are correct or secure</em> and the HEIR authors do
not take responsibility. Please consult experts before putting them into
production.</p><h2 id=two-flavors-of-noise-analysis>Two Flavors of Noise Analysis</h2><p>Each HE ciphertext contains <em>noise</em>. A noise analysis determines a <em>bound</em> on
the noise and tracks its evolution after each HE operation. The noise should not
exceed certain bounds imposed by HE schemes.</p><p>There are two flavors of noise analyses: worst-case and average-case. Worst-case
noise analyses always track the bound, while some average-case noise analyses
use intermediate quantity like the variance to track their evolution, and derive
a bound when needed.</p><p>Currently, worst-case methods are often too conservative, while average-case
methods often give underestimation.</p><h2 id=noise-analysis-framework>Noise Analysis Framework</h2><p>HEIR implements noise analysis based on the <code>DataFlowFramework</code> in MLIR.</p><p>In the <code>DataFlowFramework</code>, the main function of an <code>Analysis</code> is
<code>visitOperation</code>, where it determines the <code>AnalysisState</code> for each SSA <code>Value</code>.
Usually it computes a transfer function deriving the <code>AnalysisState</code> for each
operation result based on the states of the operation&rsquo;s operands.</p><p>As there are various HE schemes in HEIR, the detailed transfer function is
defined by a <code>NoiseModel</code> class, which parameterizes the <code>NoiseAnalysis</code>.</p><p>The <code>AnalysisState</code>, depending on whether we are using worst-case noise model or
average-case, could be interpreted as the bound or the variance.</p><p>A typical way to use noise analysis:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;mlir/include/mlir/Analysis/DataFlow/Utils.h&#34;  // from @llvm-project</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#000>DataFlowSolver</span> <span style=color:#000>solver</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>dataflow</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>loadBaselineAnalyses</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>solver</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// load other dependent analyses
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// schemeParam and model determined by other methods
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>load</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>NoiseAnalysis</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>NoiseModel</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>schemeParam</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>model</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// run the analysis on the op
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>solver</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>initializeAndRun</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>op</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=implemented-noise-models>Implemented Noise Models</h2><p>See the <a href=/docs/passes>Passes</a> page for details. Example passes include
<code>generate-param-bgv</code> and <code>validate-noise</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-76ae4da46c68c5cd44ad0ecf5d69993f>5.4 - Secret</h1><p>The <a href=https://heir.dev/docs/dialects/secret/><code>secret</code> dialect</a> contains types
and operations to represent generic computations on secret data. It is intended
to be a high-level entry point for the HEIR compiler, agnostic of any particular
FHE scheme.</p><p>Most prior FHE compiler projects design their IR around a specific FHE scheme,
and provide dedicated IR types for the secret analogues of existing data types,
and/or dedicated operations on secret data types. For example, the Concrete
compiler has <code>!FHE.eint&lt;32></code> for an encrypted 32-bit integer, and <code>add_eint</code> and
similar ops. HECO has <code>!fhe.secret&lt;T></code> that models a generic secret type, but
similarly defines <code>fhe.add</code> and <code>fhe.multiply</code>, and other projects are similar.</p><p>The problem with this approach is that it is difficult to incorporate the apply
upstream canonicalization and optimization passes to these ops. For example, the
<code>arith</code> dialect in MLIR has
<a href=https://sourcegraph.com/github.com/llvm/llvm-project@0ab3f160c4bff1c7d57c046b95ab8c5035ae986f/-/blob/mlir/lib/Dialect/Arith/IR/ArithCanonicalization.td>canonicalization patterns</a>
that must be replicated to apply to FHE analogues. One of the goals of HEIR is
to reuse as much upstream infrastructure as possible, and so this led us to
design the <code>secret</code> dialect to have both generic types and generic computations.
Thus, the <code>secret</code> dialect has two main parts: a <code>secret&lt;T></code> type that wraps any
other MLIR type <code>T</code>, and a <code>secret.generic</code> op that lifts any computation on
cleartext to the &ldquo;corresponding&rdquo; computation on secret data types.</p><h2 id=overview-with-bgv-style-lowering-pipeline>Overview with BGV-style lowering pipeline</h2><p>Here is an example of a program that uses <code>secret</code> to lift a dot product
computation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0_i16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>8</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The operands to the <code>generic</code> op are the secret data types, and the op contains
a single region, whose block arguments are the corresponding cleartext data
values. Then the region is free to perform any computation, and the values
passed to <code>secret.yield</code> are lifted back to <code>secret</code> types. Note that
<code>secret.generic</code> is not isolated from its enclosing scope, so one may refer to
cleartext SSA values without adding them as generic operands and block
arguments.</p><p>Clearly <code>secret.generic</code> does not actually do anything. It is not decrypting
data. It is merely describing the operation that one wishes to apply to the
secret data in more familiar terms. It is a structural operation, primarily used
to demarcate which operations involve secret operands and have secret results,
and group them for later optimization. The benefit of this is that one can write
optimization passes on types and ops that are not aware of <code>secret</code>, and they
will naturally match on the bodies of <code>generic</code> ops.</p><p>For example, here is what the above dot product computation looks like after
applying the <code>-cse -canonicalize -heir-simd-vectorizer</code> passes, the
implementations of which do not depend on <code>secret</code> or <code>generic</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%7</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The canonicalization patterns for <code>secret.generic</code> apply a variety of
simplifications, such as:</p><ul><li>Removing any unused or non-secret arguments and return values.</li><li>Hoisting operations in the body of a <code>generic</code> that only depend on cleartext
values to the enclosing scope.</li><li>Removing any <code>generic</code> ops that use no secrets at all.</li></ul><p>These can be used together with the
<a href=https://heir.dev/docs/passes/secretpasses/#-secret-distribute-generic><code>secret-distribute-generic</code> pass</a>
to split an IR that contains a large <code>generic</code> op into <code>generic</code> ops that
contain a single op, which can then be lowered to a particular FHE scheme
dialect with dedicated ops. This makes lowering easier because it gives direct
access to the secret version of each type that is used as input to an individual
op.</p><p>As an example, a single-op secret might look like this (taken from the larger
example below. Note the use of a cleartext from the enclosing scope, and the
proximity of the secret type to the op to be lowered.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span></code></pre></div><p>For a larger example, applying <code>--secret-distribute-generic --canonicalize</code> to
the IR above:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>And then lowering it to <code>bgv</code> with <code>--secret-to-bgv="poly-mod-degree=8"</code> (the
pass option matches the tensor size, but it is an unrealistic FHE polynomial
degree used here just for demonstration purposes). Note type annotations on ops
are omitted for brevity.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.polynomial_evaluation_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.rlwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>463187969</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>ideal=</span><span style=color:#000>#_polynomial.polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ty1 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding=</span><span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params=</span><span style=color:#000>#params</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type=</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ty2 =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>rlwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding=</span><span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>rlwe_params=</span><span style=color:#000>#params</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>underlying_type=</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@dot_product</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ty1<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ty1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>ty2 <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>mul <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>from_basis =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>to_basis =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> bgv<span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c7</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%8</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=differences-for-cggi-style-pipeline>Differences for CGGI-style pipeline</h2><p>The <code>mlir-to-cggi</code> and related pipelines add a few additional steps. The main
goal here is to apply a hardware circuit optimizer to blocks of standard MLIR
code (inside <code>secret.generic</code> ops) which converts the computation to an
optimized boolean circuit with a desired set of gates. Only then is
<code>-secret-distribute-generic</code> applied to split the ops up and lower them to the
<code>cggi</code> dialect. In particular, because passing an IR through the circuit
optimizer requires unrolling all loops, one useful thing you might want to do is
to optimize only the <em>body</em> of a for loop nest.</p><p>To accomplish this, we have two additional mechanisms. One is the pass option
<code>ops-to-distribute</code> for <code>-secret-distribute-generic</code>, which allows the user to
specify a list of ops that <code>generic</code> should be split across, and all others left
alone. Specifying <code>affine.for</code> here will pass <code>generic</code> through the <code>affine.for</code>
loop, but leave its body intact. This can also be used with the <code>-unroll-factor</code>
option to the <code>-yosys-optimizer</code> pass to partially unroll a loop nest and pass
the partially-unrolled body through the circuit optimizer.</p><p>The other mechanism is the <code>secret.separator</code> op, which is a purely structural
op that demarcates the boundary of a subset of a block that should be jointly
optimized in the circuit optimizer.</p><p>For example, the following <code>tosa</code> ops lower to multiple linalg instructions, and
hence multiple for loops, that we want to pass to a circuit optimizer as a unit.
The <code>secret.separator</code> ops surrounding the op are preserved through the
lowering.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.const&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>value =</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5438</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5515</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-1352</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-1500</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-4152</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-84</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3396</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1981</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-5581</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-6964</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3407</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>-7217</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.const&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>value =</span> dense<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>-9</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-54</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>57</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>71</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>104</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>115</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>98</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>99</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-26</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>-82</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>68</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>95</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>86</span><span style=color:#000;font-weight:700>]]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tosa.matmul&#34;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>a_zp =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>b_zp =</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x5x3x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x6x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x5x6x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>After running <code>--mlir-to-cggi</code> and dumping the IR after the linalg ops are
lowered to loops, we can see the <code>secret.separator</code> ops enclose the lowered ops,
with the exception of some pure ops that are speculatively executed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>,</span> strided<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#a40000>?</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>],</span> offset<span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c</span><span style=color:#0000cf;font-weight:700>-128</span><span style=color:#f57900>_i32 =</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>-128</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>get_global <span style=color:#000>@__constant_16xi32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>get_global <span style=color:#000>@__constant_16x1xi8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>,</span> strided<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#a40000>?</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>],</span> offset<span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>?</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subi <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c</span><span style=color:#0000cf;font-weight:700>-128</span>_i32 <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>separator
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>dealloc <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We decided to use the <code>separator</code> op over a few alternatives:</p><ul><li>Grouping by <code>secret.generic</code>: these <code>tosa</code> ops must be bufferized, but
<code>secret</code> types cannot participate in bufferization (see the Limitations
section).</li><li>Grouping by basic blocks: <code>secret.generic</code> is a single-block op with a yield
terminator, and grouping by blocks would require us to change this.</li><li>Grouping by regions: SSA values generated by a region are not visible to the
enclosing scope, so we would need to have the region-bearing op return values,
which is tedious to organize.</li><li>Attaching attributes to ops that should be grouped together: this would not be
preserved by upstream lowerings and optimization passes.</li></ul><h2 id=generic-operands><code>generic</code> operands</h2><p><code>secret.generic</code> takes any SSA values as legal operands. They may be <code>secret</code>
types or non-secret. Canonicalizing <code>secret.generic</code> removes non-secret operands
and leaves them to be referenced via the enclosing scope (<code>secret.generic</code> is
not <code>IsolatedFromAbove</code>).</p><p>This may be unintuitive, as one might expect that only secret types are valid
arguments to <code>secret.generic</code>, and that a verifier might assert non-secret args
are not present.</p><p>However, we allow non-secret operands because it provides a convenient scope
encapsulation mechanism, which is useful for the <code>--yosys-optimizer</code> pass that
runs a circuit optimizer on individual <code>secret.generic</code> ops and needs to have
access to all SSA values used as inputs. The following passes are related to
this functionality:</p><ul><li><code>secret-capture-generic-ambient-scope</code></li><li><code>secret-generic-absorb-constants</code></li><li><code>secret-extract-generic-body</code></li></ul><p>Due to the canonicalization rules for <code>secret.generic</code>, anyone using these
passes as an IR organization mechanism must be sure not to canonicalize before
accomplishing the intended task.</p><h2 id=limitations>Limitations</h2><h3 id=bufferization>Bufferization</h3><p>Secret types cannot participate in bufferization passes. In particular,
<code>-one-shot-bufferize</code> hard-codes the notion of tensor and memref types, and so
it cannot currently operate on <code>secret&lt;tensor&lt;...>></code> or <code>secret&lt;memref&lt;...>></code>
types, which prevents us from implementing a bufferization interface for
<code>secret.generic</code>. This was part of the motivation to introduce
<code>secret.separator</code>, because <code>tosa</code> ops like a fully connected neural network
layer lower to multiple linalg ops, and these ops need to be bufferized before
they can be lowered further. However, we want to keep the lowered ops grouped
together for circuit optimization (e.g., fusing transposes and constant weights
into the optimized layer), but because of this limitation, we can&rsquo;t simply wrap
the <code>tosa</code> ops in a <code>secret.generic</code> (bufferization would fail).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-05018faa55dd802660a3ea38b8f7fb69>5.5 - SIMD Optimizations</h1><p>HEIR includes a SIMD (Single Instruction, Multiple Data) optimizer which is
designed to exploit the restricted SIMD parallelism most (Ring-LWE-based) FHE
schemes support (also commonly known as &ldquo;packing&rdquo; or &ldquo;batching&rdquo;). Specifically,
HEIR incorporates the &ldquo;automated batching&rdquo; optimizations (among many other
things) from the <a href=https://github.com/MarbleHE/HECO>HECO</a> compiler. The
following will assume basic familiarity with the FHE SIMD paradigm and the
high-level goals of the optimization, and we refer to the associated HECO
<a href=https://www.usenix.org/system/files/usenixsecurity23-viand.pdf>paper</a>,
<a href=https://www.usenix.org/system/files/sec23_slides_viand.pdf>slides</a>,
<a href="https://www.youtube.com/watch?v=SP3C6gLWIS4">talk</a> and additional resources on
the
<a href=https://www.usenix.org/conference/usenixsecurity23/presentation/viand>Usenix'23 website</a>
for an introduction to the topic. This documentation will mostly focus on
describing how the optimization is realized in HEIR (which differs somewhat from
the original implementation) and how the optimization is intended to be used in
an overall end-to-end compilation pipeline.</p><h2 id=representing-fhe-simd-operations>Representing FHE SIMD Operations</h2><p>Following the design principle of maintaining programs in standard MLIR dialects
as long as possible (cf. the design rationale behind the
<a href=https://heir.dev/docs/design/secret/>Secret Dialect</a>), HEIR uses the MLIR
<a href=https://mlir.llvm.org/docs/Dialects/TensorOps/><code>tensor</code> dialect</a> and
<a href=https://mlir.llvm.org/docs/Traits/#elementwisemappable>ElementwiseMappable</a>
operations from the MLIR
<a href=https://mlir.llvm.org/docs/Dialects/ArithOps/><code>arith</code> dialect</a> to represent HE
SIMD operations.</p><p>We do introduce the HEIR-specific
<a href=https://heir.dev/docs/dialects/tensorext/#tensor_extrotate-heirtensor_extrotateop><code>tensor_ext.rotate</code></a>
operation, which represents a cyclical left-rotation of a tensor. Note that, as
the current SIMD vectorizer only supports one-dimensional tensors, the semantics
of this operation on multi-dimensional tensors are not (currently) defined.</p><p>For example, the common &ldquo;rotate-and-reduce&rdquo; pattern which results in each
element containing the sum/product/etc of the original vector can be expressed
as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%tensor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>from_elements</span> <span style=color:#000>%i1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%i8</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>The <code>%cN</code> and <code>%iN</code>, which are defined as <code>%cN = arith.constant N : index</code> and
<code>%iN = arith.constant N : i16</code>, respectively, have been omitted for readability.</p><h2 id=intended-usage>Intended Usage</h2><p>The <code>-heir-simd-vectorizer</code> pipeline transforms a program consisting of loops
and index-based accesses into tensors (e.g., <code>tensor.extract</code> and
<code>tensor.insert</code>) into one consisting of SIMD operations (including rotations) on
entire tensors. While its implementation does not depend on any FHE-specific
details or even the Secret dialect, this transformation is likely only useful
when lowering a high-level program to an arithmetic-circuit-based FHE scheme
(e.g., B/FV, BGV, or CKKS). The <code>--mlir-to-bgv --scheme-to-openfhe</code> pipeline
demonstrates the intended flow: augmenting a high-level program with <code>secret</code>
annotations, then applying the SIMD optimization (and any other high-level
optimizations) before lowering to BGV operations and then exiting to OpenFHE.</p><blockquote><p><strong>Warning</strong> The current SIMD vectorizer pipeline supports only one-dimensional
tensors. As a workaround, one could reshape all multi-dimensional tensors into
one-dimensional tensors, but MLIR/HEIR currently do not provide a pass to
automate this process.</p></blockquote><p>Since the optimization is based on heuristics, the resulting program might not
be optimal or could even be worse than a trivial realization that does not use
ciphertext packing. However, well-structured programs generally lower to
reasonable batched solutions, even if they do not achieve optimal batching
layouts. For common operations such as matrix-vector or matrix-matrix
multiplications, state-of-the-art approaches require advanced packing schemes
that might map elements into the ciphertext vector in non-trivial ways (e.g.,
diagonal-major and/or replicated). The current SIMD vectorizer will never change
the arrangement of elements inside an input tensor and therefore cannot produce
the optimal approaches for these operations.</p><p>Note, that the SIMD batching optimization is different from, and significantly
more complex than, the Straight Line Vectorizer (<code>-straight-line-vectorize</code>
pass), which simply groups
<a href=https://mlir.llvm.org/docs/Traits/#elementwisemappable>ElementwiseMappable</a>
operations that agree in operation name and operand/result types into
vectorized/tensorized versions.</p><h2 id=implementation>Implementation</h2><p>Below, we give a brief overview over the implementation, with the goal of both
improving maintainability/extensibility of the SIMD vectorizer and allowing
advanced users to better understand why a certain program is transformed in the
way it is.</p><h3 id=components>Components</h3><p>The <code>-heir-simd-vectorizer</code> pipeline uses a combination of standard MLIR passes
(<a href=https://mlir.llvm.org/docs/Passes/#-canonicalize><code>-canonicalize</code></a>,
<a href=https://mlir.llvm.org/docs/Passes/#-cse><code>-cse</code></a>,
<a href=https://mlir.llvm.org/docs/Passes/#-sccp><code>-sccp</code></a>) and custom HEIR passes.
Some of these
(<a href=https://heir.dev/docs/passes/applyfolderspasses/#-apply-folders><code>-apply-folders</code></a>,
<a href=https://heir.dev/docs/passes/fullloopunrollpasses/#-full-loop-unroll><code>-full-loop-unroll</code></a>)
might have applications outside the SIMD optimization, while others
(<a href=https://heir.dev/docs/passes/tensorextpasses/#-insert-rotate><code>-insert-rotate</code></a>,
<a href=https://heir.dev/docs/passes/tensorextpasses/#-collapse-insertion-chains><code>-collapse-insertion-chains</code></a>
and
<a href=https://heir.dev/docs/passes/tensorextpasses/#-rotate-and-reduce><code>-rotate-and-reduce</code></a>)
are very specific to the FHE SIMD optimization. In addition, the passes make use
of the <code>RotationAnalysis</code> and <code>TargetSlotAnalysis</code> analyses.</p><h3 id=high-level-flow>High-Level Flow</h3><ul><li><p><strong>Loop Unrolling</strong> (<code>-full-loop-unroll</code>): The implementation currently begins
by unrolling all loops in the program to simplify the later passes. See
<a href=https://github.com/google/heir/issues/589>#589</a> for a discussion on how this
could be avoided.</p></li><li><p><strong>Canonicalization</strong> (<code>-apply-folders -canonicalize</code>): As the
rotation-specific passes are very strict about the structure of the IR they
operate on, we must first simplify away things such as tensors of constant
values. For performance reasons (c.f. comments in the
<code>heirSIMDVectorizerPipelineBuilder</code> function in <code>heir-opt.cpp</code>), this must be
done by first applying
<a href=https://mlir.llvm.org/docs/Canonicalization/#canonicalizing-with-the-fold-method>folds</a>
before applying the full
<a href=https://mlir.llvm.org/docs/Canonicalization/>canonicalization</a>.</p></li><li><p><strong>Main SIMD Rewrite</strong> (<code>-insert-rotate -cse -canonicalize -cse</code>): This pass
rewrites arithmetic operations over <code>tensor.extract</code>-ed operands into SIMD
operations over the entire tensor, rotating the (full-tensor) operands so that
the correct elements interact. For example, it will rewrite the following
snippet (which computes <code>t2[4] = t0[3] + t1[5]</code>)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%t0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#a40000>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>insert</span> <span style=color:#000>%2</span> <span style=color:#a40000>in</span><span style=color:#204a87;font-weight:700>to</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%t0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c31</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tensor_ext</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#a40000>inde</span><span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>addi</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>i.e., rotating <code>t0</code> down by one (31 = -1 (mod 32)) and <code>t1</code> up by one to bring
the elements at index 3 and 5, respectively, to the &ldquo;target&rdquo; index 4. The pass
uses the <code>TargetSlotAnalysis</code> to identify the appropriate target index (or
ciphertext &ldquo;slot&rdquo; in FHE-speak). See <a href=#insert-rotate-pass>Insert Rotate Pass</a>
below for more details. This pass is roughly equivalent to the <code>-batching</code>
pass in the original HECO implementation.</p><p>Doing this rewrite by itself does not represent an optimization, but if we
consider what happens to the corresponding code for other indices (e.g.,
<code>t2[5] = t0[4] + t1[6]</code>), we see that the pass transforms expressions with the
same relative index offsets into the exact same set of rotations/SIMD
operations, so the following
<a href=https://en.wikipedia.org/wiki/Common_subexpression_elimination>Common Subexpression Elimination (CSE)</a>
will remove redundant computations. We apply CSE twice, once directly (which
creates new opportunities for canonicalization and folding) and then again
after that canonicalization. See
<a href=#tensorext-canonicalization>TensorExt Canonicalization</a> for a description of
the rotation-specific canonocalization patterns).</p></li><li><p><strong>Cleanup of Redundant Insert/Extract</strong>
(<code>-collapse-insertion-chains -sccp -canonicalize -cse</code>): Because the
<code>-insert-rotate</code> pass maintains the consistency of the IR, it emits a
<code>tensor.extract</code> operation after the SIMD operation and uses that to replace
the original operation (which is valid, as both produce the desired scalar
result). As a consequence, the generated code for the snippet above is
actually trailed by a (redundant) extract/insert:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>extract</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>.</span><span style=color:#a40000>insert</span> <span style=color:#000>%extracted</span> <span style=color:#a40000>in</span><span style=color:#204a87;font-weight:700>to</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#a40000>:</span> <span style=color:#a40000>tens</span><span style=color:#204a87;font-weight:700>or</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#a40000>x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In real code, this might generate a long series of such extraction/insertion
operations, all extracting from the same (due to CSE) tensor and inserting
into the same output tensor. Therefore, the <code>-collapse-insertion-chains</code> pass
searches for such chains over entire tensors and collapses them. It supports
not just chains where the indices match perfectly, but any chain where the
relative offset is consistent across the tensor, issuing a rotation to realize
the offset (if the offset is zero, the canonicalization will remove the
redundant rotation). Note, that in HECO, insertion/extraction is handled
differently, as HECO features a <code>combine</code> operation modelling not just simple
insertions (<code>combine(%t0#j, %t1)</code>) but also more complex operations over
slices of tensors (<code>combine(%t0#[i,j], %t1)</code>). As a result, the equivalent
pass in HECO (<code>-combine-simplify</code>) instead joins different <code>combine</code>
operations, and a later fold removes <code>combines</code> that replace the entire target
tensor. See issue <a href=https://github.com/google/heir/issues/512>#512</a> for a
discussion on why the <code>combine</code> operation is a more powerful framework and
what would be necessary to port it to HEIR.</p></li><li><p><strong>Applying Rotate-and-Reduce Patterns</strong>
(<code>-rotate-and-reduce -sccp -canonicalize -cse</code>): The rotate and reduce pattern
(see <a href=#representing-fhe-simd-operations>Representing FHE SIMD Operations</a> for
an example) is an important aspect of accelerating SIMD-style operations in
FHE, but it does not follow automatically from the batching rewrites applied
so far. As a result, the <code>-rotate-and-reduce</code> pass needs to search for
sequences of arithmetic operations that correspond to the full folding of a
tensor, i.e., patterns such as <code>t[0]+(t[1]+(t[2]+t[3]+(...)))</code>, which
currently uses a backwards search through the IR, but could be achieved more
efficiently through a data flow analysis (c.f. issue
<a href=https://github.com/google/heir/issues/523>#532</a>). In HECO, rotate-and-reduce
is handled differently, by identifying sequences of compatible operations
prior to batching and rewriting them to &ldquo;n-ary&rdquo; operations. However, this
approach requires non-standard arithmetic operations and is therefore not
suitable for use in HEIR. However, there is likely still an opportunity to
make the patterns in HEIR more robust/general (e.g., support constant scalar
operands in the fold, or support non-full-tensor folds). See issue
<a href=https://github.com/google/heir/issues/522>#522</a> for ideas on how to make the
HEIR pattern more robust/more general.</p></li></ul><h3 id=insert-rotate-pass>Insert Rotate Pass</h3><p>TODO(#721): Write a detailed description of the rotation insertion pass and the
associated target slot analysis.</p><h3 id=tensorext-canonicalization>TensorExt Canonicalization</h3><p>The
<a href=https://heir.dev/docs/dialects/tensorext/>TensorExt (<code>tensor_ext</code>) Dialect</a>
includes a series of canonicalization rules that are essential to making
automatically generated rotation code efficient:</p><ul><li><p>Rotation by zero: <code>rotate %t, 0</code> folds away to <code>%t</code></p></li><li><p>Cyclical wraparound: <code>rotate %t, k</code> for $k > t.size$ can be simplified to
<code>rotate %t, (k mod t.size)</code></p></li><li><p>Sequential rotation: <code>%0 = rotate %t, k</code> followed by <code>%1 = rotate %0, l</code> is
simplified to <code>rotate %t (k+l)</code></p></li><li><p>Extraction: <code>%0 = rotate %t, k</code> followed by <code>%1 = tensor.extract %0[l]</code> is
simplified to <code>tensor.extract %t[k+l]</code></p></li><li><p>Binary Arithmetic Ops: where both operands to a binary <code>arith</code> operation are
rotations by the same amount, the rotation can be performed only once, on the
result. For Example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div><p>can be simplified to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%t2</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span></code></pre></div></li><li><p><em>Sandwiched</em> Binary Arithmetic Ops: If a rotation follows a binary <code>arith</code>
operation which has rotation as its operands, the post-arith operation can be
moved forward. For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>x</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>y</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>z</span>
</span></span></code></pre></div><p>can be simplified to</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#a40000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>y</span> <span style=color:#a40000>+</span> <span style=color:#a40000>z</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div></li><li><p>Single-Use Arithmetic Ops: Finally, there is a pair of rules that do not
eliminate rotations, but move rotations up in the IR, which can help in
exposing further canonicalization and/or CSE opportunities. These only apply
to <code>arith</code> operations with a single use, as they might otherwise increase the
total number of rotations. For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>k</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%t2</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>l</span>
</span></span></code></pre></div><p>can be equivalently rewritten as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-llvm data-lang=llvm><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#a40000>k+l</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>rotate</span> <span style=color:#000>%t2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#a40000>l</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#a40000>arith</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>add</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span>
</span></span></code></pre></div><p>and a similar pattern exists for situations where the rotation is the rhs
operand of the arithmetic operation.</p></li></ul><p>Note that the index computations in the patterns above (e.g., <code>k+l</code>,
<code>k mod t.size</code> are realized via emitting <code>arith</code> operations. However, for
constant/compile-time-known indices, these will be subsequently constant-folded
away by the canonicalization pass.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cd22aa05be277ba6c2e2f8f083706b51>5.6 - Optimizing relinearization</h1><p>This document outlines the integer linear program model used in the
<a href=https://heir.dev/docs/passes/optimizerelinearizationpasses/#-optimize-relinearization><code>optimize-relinearization</code></a>
pass.</p><h2 id=background>Background</h2><p>In vector/arithmetic FHE, RLWE ciphertexts often have the form $\mathbf{c} =
(c_0, c_1)$, where the details of how $c_0$ and $c_1$ are computed depend on the
specific scheme. However, in most of these schemes, the process of decryption
can be thought of as taking a dot product between the vector $\mathbf{c}$ and a
vector $(1, s)$ containing the secret key $s$ (followed by rounding).</p><p>In such schemes, the homomorphic multiplication of two ciphertexts $\mathbf{c}
= (c_0, c_1)$ and $\mathbf{d} = (d_0, d_1)$ produces a ciphertext $\mathbf{f}
= (f_0, f_1, f_2)$. This triple can be decrypted by taking a dot product with
$(1, s, s^2)$.</p><p>With this in mind, each RLWE ciphertext $\mathbf{c}$ has an associated <em>key
basis</em>, which is the vector $\mathbf{s_c}$ whose dot product with $\mathbf{c}$
decrypts it.</p><p>Usually a larger key basis is undesirable. For one, operations in a higher key
basis are more expensive and have higher rates of noise growth. Repeated
multiplications exponentially increase the length of the key basis. So to avoid
this, an operation called <em>relinearization</em> was designed that converts a
ciphertext from a given key basis back to $(1, s)$. Doing this requires a set of
<em>relinearization keys</em> to be provided by the client and stored by the server.</p><p>In general, key bases can be arbitrary. Rotation of an RLWE ciphertext by a
shift of $k$, for example, first applies the automorphism $x \mapsto x^k$. This
converts the key basis from $(1, s)$ to $(1, s^k)$, and more generally maps $(1,
s, s^2, \dots, s^d) \mapsto (1, s^k, s^{2k}, \dots, s^{kd})$. Most FHE
implementations post-compose this automorphism with a key switching operation to
return to the linear basis $(1, s)$. Similarly, multiplication can be defined
for two key bases $(1, s^n)$ and $(1, s^m)$ (with $n &lt; m$) to produce a key
basis $(1, s^n, s^m, s^{n+m})$. By a combination of multiplications and
rotations (without ever relinearizing or key switching), ciphertexts with a
variety of strange key bases can be produced.</p><p>Most FHE implementations do not permit wild key bases because each key switch
and relinearization operation (for each choice of key basis) requires additional
secret key material to be stored by the server. Instead, they often enforce that
rotation has key-switching built in, and multiplication relinearizes by default.</p><p>That said, many FHE implementations do allow for the relinearization operation
to be deferred. A useful such situation is when a series of independent
multiplications are performed, and the results are added together. Addition can
operate in any key basis (though depending on the backend FHE implementation&rsquo;s
details, all inputs may require the same key basis, cf.
<a href=#optional-operand-agreement>Optional operand agreement</a>), and so the
relinearization op that follows each multiplication can be deferred until after
the additions are complete, at which point there is only one relinearization to
perform. This technique is usually called <em>lazy relinearization</em>. It has the
benefit of avoiding expensive relinearization operations, as well as reducing
noise growth, as relinearization adds noise to the ciphertext, which can further
reduce the need for bootstrapping.</p><p>In much of the literature, lazy relinearization is applied manually. See for
example
<a href=https://eprint.iacr.org/2019/223>Blatt-Gusev-Polyakov-Rohloff-Vaikuntanathan 2019</a>
and <a href=https://eprint.iacr.org/2020/1549>Lee-Lee-Kim-Kim-No-Kang 2020</a>. In some
compiler projects, such as the <a href=https://eprint.iacr.org/2021/1505>EVA compiler</a>
relinearization is applied automatically via a heuristic, either &ldquo;eagerly&rdquo;
(immediately after each multiplication op) or &ldquo;lazily,&rdquo; deferred as late as
possible.</p><h2 id=the-optimize-relinearization-pass>The <code>optimize-relinearization</code> pass</h2><p>In HEIR, relinearization placement is implemented via a mixed-integer linear
program (ILP). It is intended to be more general than a lazy relinearization
heuristic, and certain parameter settings of the ILP reproduce lazy
relinearization.</p><p>The <code>optimize-relinearization</code> pass starts by deleting all relinearization
operations from the IR, solves the ILP, and then inserts relinearization ops
according to the solution. This implies that the input IR to the ILP has no
relinearization ops in it already.</p><h2 id=model-specification>Model specification</h2><p>The ILP model fits into a family of models that is sometimes called
&ldquo;state-dynamics&rdquo; models, in that it has &ldquo;state&rdquo; variables that track a quantity
that flows through a system, as well as &ldquo;decision&rdquo; variables that control
decisions to change the state at particular points. A brief overview of state
dynamics models can be found
<a href=https://buttondown.com/j2kun/archive/modeling-state-in-linear-programs/>here</a></p><p>In this ILP, the &ldquo;state&rdquo; value is the degree of the key basis. I.e., rather than
track the entire key basis, we assume the key basis always has the form $(1, s,
s^2, \dots, s^k)$ and track the value $k$. The index tracking state is SSA
value, and the decision variables are whether to relinearize.</p><h3 id=variables>Variables</h3><p>Define the following variables:</p><ul><li>For each operation $o$, $R_o \in { 0, 1 }$ defines the decision to
relinearize the result of operation $o$. Relinearization is applied if and
only if $R_o = 1$.</li><li>For each SSA value $v$, $\textup{KB}_v$ is a continuous variable
representing the degree of the key basis of $v$. For example, if the key basis
of a ciphertext is $(1, s)$, then $\textup{KB}_v = 1$. If $v$ is the result
of an operation $o$, $\textup{KB}_v$ is the key basis of the result of $o$
<em>after</em> relinearization has been optionally applied to it, depending on the
value of the decision variable $R_o$.</li><li>For each SSA value $v$ that is an operation result, $\textup{KB}^{br}_v$ is
a continuous variable whose value represents the key basis degree of $v$
<em>before</em> relinearization is applied (<code>br</code> = &ldquo;before relin&rdquo;). These SSA values
are mainly for <em>after</em> the model is solved and relinearization operations need
to be inserted into the IR. Here, type conflicts require us to reconstruct the
key basis degree, and saving the values allows us to avoid recomputing the
values.</li></ul><p>Each of the key-basis variables is bounded from above by a parameter
<code>MAX_KEY_BASIS_DEGREE</code> that can be used to impose hard limits on the key basis
size, which may be required if generating code for a backend that does not
support operations over generalized key bases.</p><h3 id=objective>Objective</h3><p>The objective is to minimize the number of relinearization operations, i.e.,
$\min \sum_o R_o$.</p><p>TODO(#1018): update docs when objective is generalized.</p><h3 id=constraints>Constraints</h3><h4 id=simple-constraints>Simple constraints</h4><p>The simple constraints are as follows:</p><ul><li>Initial key basis degree: For each block argument, $\textup{KB}_v$ is fixed
to equal the <code>dimension</code> parameter on the RLWE ciphertext type.</li><li>Special linearized ops: <code>bgv.rotate</code> and <code>func.return</code> require linearized
inputs, i.e., $\textup{KB}_{v_i} = 1$ for all inputs $v_i$ to these
operations.</li><li>Before relinearization key basis: for each operation $o$ with operands $v_1,
\dots, v_k$, constrain $\textup{KB}^{br}_{\textup{result}(o)} =
f(\textup{KB}_{v_1}, \dots, \textup{KB}_{v_k})$, where $f$ is a
statically known linear function. For multiplication $f$ it addition, and for
all other ops it is the projection onto any input, since multiplication is the
only op that increases the degree, and all operands are constrained to have
equal degree.</li></ul><h4 id=optional-operand-agreement>Optional operand agreement</h4><p>There are two versions of the model, one where the an operation requires the
input key basis degrees of each operand to be equal, and one where differing key
basis degrees are allowed.</p><p>This is an option because the model was originally implemented under the
incorrect assumption that CPU backends like OpenFHE and Lattigo require the key
basis degree operands to be equal for ops like ciphertext addition. When we
discovered this was not the case, we generalized the model to support both
cases, in case other backends do have this requirement.</p><p>When operands must have the same key basis degree, then for each operation with
operand SSA values $v_1, \dots, v_k$, we add the constraint
$\textup{KB}_{v_1} = \dots = \textup{KB}_{v_k}$, i.e., all key basis inputs
must match.</p><p>When operands may have different key basis degrees, we instead add the
constraint that each operation result key basis degree (before relinearization)
is at least as large as the max of all operand key basis degrees. For all $i$,
$\textup{KB}_{\textup{result}(o)}^{br} \geq \textup{KB}_{v_i}$. Note that
we are relying on an implicit behavior of the model to ensure that, even if the
solver chooses key basis degree variables for these op results larger than the
max of the operand degrees, the resulting optimal solution is the same.</p><p>TODO(#1018): this will change to a more principled approach when the objective
is generalized</p><h4 id=impact-of-relinearization-choices-on-key-basis-degree>Impact of relinearization choices on key basis degree</h4><p>The remaining constraints control the dynamics of how the key basis degree
changes as relinearizations are inserted.</p><p>They can be thought of as implementing this (non-linear) constraint for each
operation $o$:</p><p>\[ \textup{KB}_{\textup{result}(o)} = \begin{cases}
\textup{KB}^{br}_{\textup{result(o)}} & \text{ if } R_o = 0 \\ 1 & \text{
if } R_o = 1 \end{cases} \]</p><p>Note that $\textup{KB}^{br}_{\textup{result}(o)}$ is constrained by one of
the simple constraints to be a linear expression containing key basis variables
for the operands of $o$. The conditional above cannot be implemented directly in
an ILP. Instead, one can implement it via four constraints that effectively
linearize (in the sense of making non-linear constraints linear) the multiplexer
formula</p><p>\[ \textup{KB}_{\textup{result}(o)} = (1 - R_o) \cdot
\textup{KB}^{br}_{\textup{result}(o)} + R_o \cdot 1 \]</p><p>(Note the above is not linear because in includes the product of two variables.)
The four constraints are:</p><p>\[ \begin{aligned} \textup{KB}_\textup{result}(o) &\geq \textup{ R}_o
\\
\textup{KB}_\textup{result}(o) &\leq 1 + C(1 – \textup{R}_o)
\\
\textup{KB}_\textup{result}(o) &\geq
\textup{KB}^{br}_{\textup{result}(o)} – C \textup{ R}_o
\\
\textup{KB}_\textup{result}(o) &\leq
\textup{KB}^{br}_{\textup{result}(o)} + C \textup{ R}_o \\
\end{aligned}
\]</p><p>Here $C$ is a constant that can be set to any value larger than
<code>MAX_KEY_BASIS_DEGREE</code>. We set it to 100.</p><p>Setting $R_o = 0$ makes constraints 1 and 2 trivially satisfied, while
constraints 3 and 4 enforce the equality $\textup{KB}_{\textup{result}(o)} =
\textup{KB}^{br}_{\textup{result}(o)}$. Likewise, setting $R_o = 1$ makes
constraints 3 and 4 trivially satisfied, while constraints 1 and 2 enforce the
equality $\textup{KB}_{\textup{result}(o)} = 1$.</p><h2 id=notes>Notes</h2><ul><li>ILP performance scales roughly with the number of integer variables. The
formulation above only requires the decision variable to be integer, and the
initialization and constraints effectively force the key basis variables to be
integer. As a result, the solve time of the above ILP should scale with the
number of ciphertext-handling ops in the program.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-db9ac78ce08367ea2b7db8c1412049b6>6 - Pipelines</h1><h2 id=heir-opt><code>heir-opt</code></h2><h3 id=--heir-simd-vectorizer><code>--heir-simd-vectorizer</code></h3><p>Run scheme-agnostic passes to convert FHE programs that operate on scalar types
to equivalent programs that operate on vectors.</p><p>This pass is intended to process FHE programs that are known to be good for
SIMD, but a specific FHE scheme has not yet been chosen. It expects to handle
<code>arith</code> ops operating on <code>tensor</code> types (with or without <code>secret.generic</code>).</p><p>The pass unrolls all loops, then applies a series of passes that convert scalar
operations on tensor elements to SIMD operations on full tensors. This uses the
FHE computational model common to BGV, BFV, and CKKS, in which data is packed in
polynomial ciphertexts, interpreted as vectors of individual data elements, and
arithmetic can be applied across entire ciphertexts, with some limited support
for rotations via automorphisms of the underlying ring.</p><p>Along the way, this pipeline applies heuristic optimizations to minimize the
number of rotations needed, relying on the implicit cost model that rotations
are generally expensive. The specific set of passes can be found in
<code>tools/heir-opt.cpp</code> where the pipeline is defined.</p><h3 id=--yosys-optimizer><code>--yosys-optimizer</code></h3><p>Uses Yosys to booleanize and optimize MLIR functions.</p><p>This pass pipeline requires inputs to be in standard MLIR (<code>arith</code>, <code>affine</code>,
<code>func</code>, <code>memref</code>). The pass imports the model to Yosys and runs passes to
booleanize the circuit and then uses ABC to perform optimizations. We use
standard LUT 3 cells. THe output of this pass includes <code>arith</code> constants and
<code>comb.truth_table</code> ops.</p><p>The pass requires that the environment variable <code>HEIR_ABC_BINARY</code> contains the
location of the ABC binary and that <code>HEIR_YOSYS_SCRIPTS_DIR</code> contains the
location of the Yosys&rsquo; techlib files that are needed to execute the path.</p><p>This pass can be disabled by defining <code>HEIR_NO_YOSYS</code>; this will avoid Yosys
library and ABC binary compilation, and avoid registration of this pass.</p><h3 id=--mlir-to-cggi><code>--mlir-to-cggi</code></h3><p>Converts MLIR IR to the CGGI dialect defined by HEIR. It arithmetizes the IR and
optimizes the circuit using Yosys ABC optimizations.</p><p>The pass requires that the environment variable <code>HEIR_ABC_BINARY</code> contains the
location of the ABC binary and that <code>HEIR_YOSYS_SCRIPTS_DIR</code> contains the
location of the Yosys&rsquo; techlib files that are needed to execute the path.</p><h2 id=heir-translate><code>heir-translate</code></h2><h3 id=--emit-tfhe-rust><code>--emit-tfhe-rust</code></h3><p>Code generation for the <a href=https://docs.zama.ai/tfhe-rs><code>tfhe-rs</code></a> FHE library.
The library is based on the CGGI cryptosystem, and so this pass is most useful
when paired with lowerings from the <code>cggi</code> dialect.</p><p>The version of <code>tfhe-rs</code> supported is defined in the
<a href=https://github.com/google/heir/tree/main/tests/Examples/tfhe_rust/Cargo.toml>end to end <code>tfhe_rust</code> tests</a>.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>sks =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>server_key
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>lut =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>lookup_table
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>eui3 =</span> <span style=color:#000;font-weight:700>!</span>tfhe_rust<span style=color:#000;font-weight:700>.</span>eui3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%sks</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3 <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%v1</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>apply_lookup_table <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%v2</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%v3</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>scalar_left_shift <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>shiftAmount =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#000>%v4</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust<span style=color:#000;font-weight:700>.</span>apply_lookup_table <span style=color:#000>%sks</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%v3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%lut</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>sks<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>eui3<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lut<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%v4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>eui3
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>use</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tfhe</span>::<span style=color:#000>shortint</span>::<span style=color:#000>prelude</span>::<span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>pub</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>test_apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v9</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>ServerKey</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v10</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>LookupTableOwned</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v11</span>: <span style=color:#204a87;font-weight:700>&amp;</span><span style=color:#000>Ciphertext</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>Ciphertext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v4</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v5</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>unchecked_add</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v11</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v4</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v6</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v7</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>scalar_left_shift</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v6</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>let</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v8</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v9</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>apply_lookup_table</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v7</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>v10</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>v8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note, the chosen variable names are arbitrary, and the resulting program still
must be integrated with a larger Rust program.</p><h3 id=--emit-verilog><code>--emit-verilog</code></h3><p>Code generation for verilog from <code>arith</code> and <code>memref</code>. Expects a single top
level <code>func.func</code> op as the entry point, which is converted to the output
verilog module.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>extsi <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span> to <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sge<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>shrsi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>shrui <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%out</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>trunci <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> to <span style=color:#204a87;font-weight:700>i8</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%out</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i8</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-verilog data-lang=verilog><span style=display:flex><span><span style=color:#204a87;font-weight:700>module</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>input</span> <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>output</span> <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>_out_</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v5</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v6</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v7</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v8</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v9</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#000>v10</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v11</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v12</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v13</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>wire</span> <span style=color:#204a87;font-weight:700>signed</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>v14</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v4</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v5</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{{</span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>]}},</span> <span style=color:#000>arg1</span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v6</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v7</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>v5</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v8</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#000>v2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v11</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v10</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>v4</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v12</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v13</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v9</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>v3</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>v14</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v12</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>assign</span> <span style=color:#000>_out_</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v14</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>endmodule</span>
</span></span></code></pre></div><h3 id=--emit-metadata><code>--emit-metadata</code></h3><p>Prints a json object describing the function signatures. Used for code
generation after <code>--emit-verilog</code>.</p><p>Example input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>80x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>alignment =</span> <span style=color:#0000cf;font-weight:700>64</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x3x2x1x</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;functions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;params&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;index&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;memref&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;element_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&#34;integer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                  <span style=color:#204a87;font-weight:700>&#34;is_signed&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#204a87;font-weight:700>&#34;width&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
</span></span><span style=display:flex><span>                <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;shape&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;return_types&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;memref&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;element_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&#34;integer&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;is_signed&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&#34;width&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>8</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;shape&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}]</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-590f1588f601079eeacfc7cb11dc5115>7 - Dialects</h1><p>This section contains the reference documentation for all of the dialects
defined in HEIR.</p></div><div class=td-content><h1 id=pg-7a2d769a54237b8d0845fe32a6451c2b>7.1 - BGV</h1><h1 id=bgv-dialect>&lsquo;bgv&rsquo; Dialect</h1><p>The BGV dialect defines the types and operations of the BGV and B/FV cryptosystem.</p><p>Due to similarity with the BFV scheme, BGV dialect also represents the B/FV scheme.</p><p>The semantics of bgv dialect operations are determined by the <code>scheme.bgv</code> or <code>scheme.bfv</code>
annotation at the module level.</p><p>In B/FV mode, bgv.modulus_switch is an no-op.</p><h2 id=bgv-attributes>BGV attributes</h2><h3 id=schemeparamattr>SchemeParamAttr</h3><p><em>BGV Scheme Parameters</em></p><p>Syntax:</p><pre tabindex=0><code>#bgv.scheme_param&lt;
  int,   # logN
  DenseI64ArrayAttr,   # Q
  DenseI64ArrayAttr,   # P
  int64_t,   # plaintextModulus
  BGVEncryptionType,   # encryptionType
  BGVEncryptionTechnique   # encryptionTechnique
&gt;
</code></pre><p>This attribute is used for recording the scheme parameters for CKKS.</p><p>The attribute is a struct with the following fields:</p><ul><li><code>int</code> logN: The log of the degree of the polynomial modulus.</li><li><code>DenseI64ArrayAttr</code> Q: The array of primes in the ciphertext modulus.</li><li><code>DenseI64ArrayAttr</code> P: The array of primes in the special modulus, used for key switching.</li><li><code>int64_t</code> plaintextModulus: The plaintext modulus.</li></ul><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>logN</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>Q</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>P</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintextModulus</td><td style=text-align:center><code>int64_t</code></td><td></td></tr><tr><td style=text-align:center>encryptionType</td><td style=text-align:center><code>BGVEncryptionType</code></td><td></td></tr><tr><td style=text-align:center>encryptionTechnique</td><td style=text-align:center><code>BGVEncryptionTechnique</code></td><td></td></tr></tbody></table><h2 id=bgv-ops>BGV ops</h2><h3 id=bgvadd-heirbgvaddop><code>bgv.add</code> (heir::bgv::AddOp)</h3><p><em>Addition operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.add` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvadd_plain-heirbgvaddplainop><code>bgv.add_plain</code> (heir::bgv::AddPlainOp)</h3><p><em>Addition operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.add_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvlevel_reduce-heirbgvlevelreduceop><code>bgv.level_reduce</code> (heir::bgv::LevelReduceOp)</h3><p><em>Lower the modulus level of the ciphertext via dropping RNS limbs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.level_reduce` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvmodulus_switch-heirbgvmodulusswitchop><code>bgv.modulus_switch</code> (heir::bgv::ModulusSwitchOp)</h3><p><em>Lower the modulus level of the ciphertext via modulus switching.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.modulus_switch` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>to_ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvmul-heirbgvmulop><code>bgv.mul</code> (heir::bgv::MulOp)</h3><p><em>Multiplication operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.mul` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvmul_plain-heirbgvmulplainop><code>bgv.mul_plain</code> (heir::bgv::MulPlainOp)</h3><p><em>Multiplication operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.mul_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvnegate-heirbgvnegateop><code>bgv.negate</code> (heir::bgv::NegateOp)</h3><p><em>Negate the coefficients of the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.negate` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvrelinearize-heirbgvrelinearizeop><code>bgv.relinearize</code> (heir::bgv::RelinearizeOp)</h3><p><em>Relinearize the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.relinearize` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>This op takes integer array attributes <code>from_basis</code> and <code>to_basis</code> that are
used to indicate the key basis from which and to which the ciphertext is
encrypted against. A ciphertext is canonically encrypted against key basis
<code>(1, s)</code>. After a multiplication, its size will increase and the basis will be
<code>(1, s, s^2)</code>. The array that represents the key basis is constructed by
listing the powers of <code>s</code> at each position of the array. For example, <code>(1, s, s^2)</code> corresponds to <code>[0, 1, 2]</code>, while <code>(1, s^2)</code> corresponds to <code>[0, 2]</code>.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>from_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>to_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvrotate_cols-heirbgvrotatecolumnsop><code>bgv.rotate_cols</code> (heir::bgv::RotateColumnsOp)</h3><p><em>Rotate the columns of the coefficients of the ciphertext using a Galois automorphism.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.rotate_cols` operands attr-dict `:` qualified(type($input))
</code></pre><p>This operation rotates the columns of the coefficients of the ciphertext using a
Galois automorphism.</p><p>Often BGV scheme is instantiated with a ring of the form <code>Z_q[X]/(X^N + 1)</code> and
plaintext modulus <code>t</code> where <code>N</code> is a power of 2 and <code>t</code> is a prime number. In
this case, the plaintext slots can be viewed as a <code>2 x N/2</code> matrix where
<code>N/2</code> is the number of columns and <code>2</code> is the number of rows.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvrotate_rows-heirbgvrotaterowsop><code>bgv.rotate_rows</code> (heir::bgv::RotateRowsOp)</h3><p><em>Rotate the rows of the coefficients of the ciphertext using a Galois automorphism.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.rotate_rows` operands attr-dict `:` qualified(type($input))
</code></pre><p>This operation rotates the rows of the coefficients of the ciphertext using a
Galois automorphism.</p><p>Often BGV scheme is instantiated with a ring of the form <code>Z_q[X]/(X^N + 1)</code> and
plaintext modulus <code>t</code> where <code>N</code> is a power of 2 and <code>t</code> is a prime number. In
this case, the plaintext slots can be viewed as a <code>2 x N/2</code> matrix where
<code>N/2</code> is the number of columns and <code>2</code> is the number of rows.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvsub-heirbgvsubop><code>bgv.sub</code> (heir::bgv::SubOp)</h3><p><em>Subtraction operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.sub` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=bgvsub_plain-heirbgvsubplainop><code>bgv.sub_plain</code> (heir::bgv::SubPlainOp)</h3><p><em>Subtraction operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `bgv.sub_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h2 id=bgv-additional-definitions>BGV additional definitions</h2><h3 id=bgvencryptiontechnique>BGVEncryptionTechnique</h3><p><em>An enum attribute representing an encryption technique</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>standard</td><td style=text-align:center><code>0</code></td><td>standard</td></tr><tr><td style=text-align:center>extended</td><td style=text-align:center><code>1</code></td><td>extended</td></tr></tbody></table><h3 id=bgvencryptiontype>BGVEncryptionType</h3><p><em>An enum attribute representing an encryption method</em></p><h4 id=cases-1>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>pk</td><td style=text-align:center><code>0</code></td><td>pk</td></tr><tr><td style=text-align:center>sk</td><td style=text-align:center><code>1</code></td><td>sk</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-5f74537b9610a2b3f8ddf498be3d47b0>7.2 - CGGI</h1><h1 id=cggi-dialect>&lsquo;cggi&rsquo; Dialect</h1><p><em>A dialect for types and operations in the CGGI cryptosystem</em></p><h2 id=cggi-attributes>CGGI attributes</h2><h3 id=cggiboolgatesattr>CGGIBoolGatesAttr</h3><p><em>An attribute containing an array of strings to store bool gates</em></p><p>Syntax:</p><pre tabindex=0><code>#cggi.cggi_bool_gates&lt;
  ::llvm::ArrayRef&lt;::mlir::heir::cggi::CGGIBoolGateEnumAttr&gt;   # gates
&gt;
</code></pre><pre><code>This attributes stores a list of integer identifiers for Boolean gates.
</code></pre><p>Uses following mapping:
AND_GATE = 0;
NAND_GATE = 1;
OR_GATE = 2;
NOR_GATE = 3;
XOR_GATE = 4;
XNOR_GATE = 5;
NOT_GATE = 6;</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>gates</td><td style=text-align:center><code>::llvm::ArrayRef&lt;::mlir::heir::cggi::CGGIBoolGateEnumAttr></code></td><td></td></tr></tbody></table><h2 id=cggi-ops>CGGI ops</h2><h3 id=cggiadd-heircggiaddop><code>cggi.add</code> (heir::cggi::AddOp)</h3><p><em>Arithmetic addition of two ciphertexts. One of the two ciphertext is allowed to be a scalar, this will result in the scalar addition to a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggiand-heircggiandop><code>cggi.and</code> (heir::cggi::AndOp)</h3><p><em>Logical AND of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.and` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggicast-heircggicastop><code>cggi.cast</code> (heir::cggi::CastOp)</h3><p><em>Change the plaintext space of a CGGI ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.cast` $input attr-dict `:` type($input) `to` type($output)
</code></pre><p>&ldquo;cast&rdquo; operation to change the plaintext size of a CGGI ciphertext.
Note this operations is not a standard CGGI operation, but an mirror of the cast op implemented in TFHE-rs.</p><p>Examples:</p><pre tabindex=0><code>`cggi.cast %c0 : !lwe.lwe_ciphertext&lt;encoding = #unspecified_bit_field_encoding&gt; to !lwe.lwe_ciphertext&lt;encoding = #unspecified_bit_field_encoding1&gt;`
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultShape</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggicmp-heircggicmpop><code>cggi.cmp</code> (heir::cggi::CmpOp)</h3><p>_High level operation to check the relation of two ciphertexts.</p><ul><li>equal (mnemonic: &ldquo;eq&rdquo;; integer value: 0)</li><li>not equal (mnemonic: &ldquo;ne&rdquo;; integer value: 1)</li><li>signed less than (mnemonic: &ldquo;slt&rdquo;; integer value: 2)</li><li>signed less than or equal (mnemonic: &ldquo;sle&rdquo;; integer value: 3)</li><li>signed greater than (mnemonic: &ldquo;sgt&rdquo;; integer value: 4)</li><li>signed greater than or equal (mnemonic: &ldquo;sge&rdquo;; integer value: 5)</li><li>unsigned less than (mnemonic: &ldquo;ult&rdquo;; integer value: 6)</li><li>unsigned less than or equal (mnemonic: &ldquo;ule&rdquo;; integer value: 7)</li><li>unsigned greater than (mnemonic: &ldquo;ugt&rdquo;; integer value: 8)</li><li>unsigned greater than or equal (mnemonic: &ldquo;uge&rdquo;; integer value: 9)</li></ul><p>Note: <a href=https://mlir.llvm.org/docs/Dialects/ArithOps/#arithcmpi-arithcmpiop>https://mlir.llvm.org/docs/Dialects/ArithOps/#arithcmpi-arithcmpiop</a>
Note this operations to indirect mirror the TFHE-rs implmementation._</p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.cmp` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::arith::CmpIPredicateAttr</td><td>allowed 64-bit signless integer cases: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggicreate_trivial-heircggicreatetrivialop><code>cggi.create_trivial</code> (heir::cggi::CreateTrivialOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.create_trivial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>value</code></td><td>::mlir::Attribute</td><td>An Attribute containing a integer value or A collection of other Attribute values</td></tr></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggieq-heircggieqop><code>cggi.eq</code> (heir::cggi::EqOp)</h3><p><em>High level operation to check equality of two ciphertexts. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.eq` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggilut2-heircggilut2op><code>cggi.lut2</code> (heir::cggi::Lut2Op)</h3><p><em>A lookup table on two inputs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut2` operands attr-dict `:` qualified(type($output))
</code></pre><p>An op representing a lookup table applied to some number <code>n</code> of ciphertexts
encrypting boolean input bits.</p><p>Over cleartext bits <code>a, b, c</code>, using <code>n = 3</code> for example, the operation
computed by this function can be interpreted as</p><pre tabindex=0><code>  truth_table &gt;&gt; {c, b, a}
</code></pre><p>where <code>{c, b, a}</code> is the unsigned 3-bit integer with bits <code>c, b, a</code> from most
significant bit to least-significant bit. The input are combined into a
single ciphertext input to the lookup table using products with plaintexts
and sums.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>b</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>a</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggilut3-heircggilut3op><code>cggi.lut3</code> (heir::cggi::Lut3Op)</h3><p><em>A lookup table on three inputs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut3` operands attr-dict `:` qualified(type($output))
</code></pre><p>An op representing a lookup table applied to some number <code>n</code> of ciphertexts
encrypting boolean input bits.</p><p>Over cleartext bits <code>a, b, c</code>, using <code>n = 3</code> for example, the operation
computed by this function can be interpreted as</p><pre tabindex=0><code>  truth_table &gt;&gt; {c, b, a}
</code></pre><p>where <code>{c, b, a}</code> is the unsigned 3-bit integer with bits <code>c, b, a</code> from most
significant bit to least-significant bit. The input are combined into a
single ciphertext input to the lookup table using products with plaintexts
and sums.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>c</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>b</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>a</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggilut_lincomb-heircggilutlincombop><code>cggi.lut_lincomb</code> (heir::cggi::LutLinCombOp)</h3><p><em>A variadic-input lookup table with inputs prepared via linear combination.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.lut_lincomb` operands attr-dict `:` type($output)
</code></pre><p>An op representing a lookup table applied to an arbitrary number of
input ciphertexts, which are combined according to a static linear
combination attached to the op.</p><p>The user must ensure the chosen linear combination does not bleed error
bits into the message space according to the underlying ciphertext&rsquo;s
encoding attributes. E.g., a bit_field_encoding with 3 cleartext bits
cannot be multiplied by 16.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.bit_field_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.lwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>7917</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ciphertext =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>lwe_params =</span> <span style=color:#000>#params</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>lut_lincomb <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>coefficients =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>lookup_table =</span> <span style=color:#0000cf;font-weight:700>68</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ciphertext
</span></span></code></pre></div><p>Represents applying the lut</p><pre tabindex=0><code>  68 &gt;&gt; (1 * c0 + 2 * c1 + 3 * c2 + 2 * c3)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=cggimax-heircggimaxop><code>cggi.max</code> (heir::cggi::MaxOp)</h3><p><em>High level operation to return maximum of two ciphertexts. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.max` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggimin-heircggiminop><code>cggi.min</code> (heir::cggi::MinOp)</h3><p><em>High level operation to return minimum of two ciphertexts. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.min` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggimul-heircggimulop><code>cggi.mul</code> (heir::cggi::MulOp)</h3><p><em>Arithmetic multiplication of two ciphertexts. One of the two ciphertext is allowed to be a scalar, this will result in the scalar multiplication to a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>While CGGI does not have a native multiplication operation,
some backend targets provide a multiplication
operation that is implemented via a sequence
of other atomic CGGI ops. When lowering to
backends that do not have this, one must lower
to this op the appropriate CGGI ops.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggimulti_lut_lincomb-heircggimultilutlincombop><code>cggi.multi_lut_lincomb</code> (heir::cggi::MultiLutLinCombOp)</h3><p><em>A multi-output version of lut_lincomb with one LUT per output.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.multi_lut_lincomb` operands attr-dict `:` functional-type($inputs, $outputs)
</code></pre><p>An op representing multiple lookup tables applied to a shared input, which
is prepared via a static linear combination. This is equivalent to
<code>cggi.lut_lincomb</code>, but where the linear combination is given to multiple
lookup tables, each producing a separate output.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.bit_field_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.lwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>7917</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ciphertext =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>lwe_params =</span> <span style=color:#000>#params</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>multi_lut_lincomb <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>coefficients =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>lookup_tables =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>68</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>70</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Represents applying the following LUTs. Performance-wise, this is
comparable to applying a single LUT to a linear combination.</p><pre tabindex=0><code>x = (1 * c0 + 2 * c1 + 3 * c2 + 2 * c3)
return (
  (68 &gt;&gt; x) &amp; 1,
  (70 &gt;&gt; x) &amp; 1,
  (4 &gt;&gt; x) &amp; 1,
  (8 &gt;&gt; x) &amp; 1
)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>lookup_tables</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>outputs</code></td><td>variadic of lwe-ciphertext-like</td></tr></tbody></table><h3 id=cgginand-heircgginandop><code>cggi.nand</code> (heir::cggi::NandOp)</h3><p><em>Logical NAND of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.nand` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggineq-heircggineqop><code>cggi.neq</code> (heir::cggi::NeqOp)</h3><p><em>High level operation to check inequality of two ciphertexts. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.neq` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cgginor-heircgginorop><code>cggi.nor</code> (heir::cggi::NorOp)</h3><p><em>Logical NOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.nor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cgginot-heircgginotop><code>cggi.not</code> (heir::cggi::NotOp)</h3><p><em>Logical NOT of two ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.not` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggior-heircggiorop><code>cggi.or</code> (heir::cggi::OrOp)</h3><p><em>Logical OR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.or` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggipacked_lut3-heircggipackedlut3op><code>cggi.packed_lut3</code> (heir::cggi::PackedLut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.packed_lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-6>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_tables</code></td><td>::mlir::ArrayAttr</td><td>Array of integers</td></tr></table><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>b</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>c</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggipacked_gates-heircggipackedop><code>cggi.packed_gates</code> (heir::cggi::PackedOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.packed_gates` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Operation to where different Boolean gates are executed pairwise between elements of two ciphertext arrays.</p><p>For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>packed_gates <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>gates =</span> <span style=color:#000>#cggi.cggi_gate</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;and&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xor&#34;</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>applies an &ldquo;and&rdquo; gate to the first elements of %a and %b and an xor gate to the
second elements.</p><p>Mapping is defined in the BooleanGates.td file.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-7>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>gates</code></td><td>::mlir::heir::cggi::CGGIBoolGatesAttr</td><td>An attribute containing an array of strings to store bool gates</td></tr></table><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggiprogrammable_bootstrap-heircggiprogrammablebootstrapop><code>cggi.programmable_bootstrap</code> (heir::cggi::ProgrammableBootstrapOp)</h3><p><em>Programmable Bootstrap with a given lookup table.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.programmable_bootstrap` operands attr-dict `:` qualified(type($output))
</code></pre><p>An op representing a programmable bootstrap applied to an LWE ciphertext.</p><p>This operation evaluates a univariate function homomorphically on the
ciphertext by selecting the correct value from a lookup table. The bit size
of the lookup table integer attribute should be equal to the plaintext space
size. For example, if there ciphertext can hold 3 plaintext message bits,
then the lookup table must be represented at most by an integer with 8 bits.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-8>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookup_table</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggisshl-heircggiscalarshiftleftop><code>cggi.sshl</code> (heir::cggi::ScalarShiftLeftOp)</h3><p><em>Arithmetic shift to left of a ciphertext by an integer. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.sshl` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-9>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>shiftAmount</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-21>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggisshr-heircggiscalarshiftrightop><code>cggi.sshr</code> (heir::cggi::ScalarShiftRightOp)</h3><p><em>Arithmetic shift to the right of a ciphertext by an integer. Note this operations to mirror the TFHE-rs implmementation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.sshr` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-10>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>shiftAmount</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-22>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggicmux-heircggiselectop><code>cggi.cmux</code> (heir::cggi::SelectOp)</h3><p><em>Multiplexer operations, the <code>select</code> ciphertext will return the <code>trueCtxt</code>
if in contains a 1. In the other case, it will will return the <code>falseCtxt</code>.
Note this operations to mirror the TFHE-rs implmementation."</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.cmux` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-22>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>select</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>trueCtxt</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>falseCtxt</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-23>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggiselector_lut_lincomb-heircggiselectorlutlincombop><code>cggi.selector_lut_lincomb</code> (heir::cggi::SelectorLutLinCombOp)</h3><p><em>A multi-value version of lut_lincomb</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.selector_lut_lincomb` operands attr-dict `:` functional-type($inputs, $outputs)
</code></pre><p>An op representing a lookup table applied to a shared input, which
is prepared via a static linear combination. This is equivalent to
<code>cggi.lut_lincomb</code>, but where the linear combination is given to a
single LUT, but producing an single n-bit output.</p><p>The linear combination will select a value for a lookup table with 2^n outputs
where each output is a n-bit number.
For instance, in the case of the default i4 ciphertext, a 16 element lookup table
will be used, and the output will be a i4 number.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#encoding</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.bit_field_encoding</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cleartext_start=</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>cleartext_bitwidth=</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#params</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#lwe.lwe_params</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>cmod=</span><span style=color:#0000cf;font-weight:700>7917</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension=</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ciphertext =</span> <span style=color:#000;font-weight:700>!</span>lwe<span style=color:#000;font-weight:700>.</span>lwe_ciphertext<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>encoding =</span> <span style=color:#000>#encoding</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>lwe_params =</span> <span style=color:#000>#params</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> cggi<span style=color:#000;font-weight:700>.</span>selector_lut_lincomb <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>coefficients =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>lookup_tables =</span> array<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>ciphertext<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>ciphertext<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-11>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr><tr><td><code>lookup_tables</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr></table><h4 id=operands-23>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-24>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>outputs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggisub-heircggisubop><code>cggi.sub</code> (heir::cggi::SubOp)</h3><p><em>Subtraction of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-24>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or A ciphertext type</td></tr></tbody></table><h4 id=results-25>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=cggixnor-heircggixnorop><code>cggi.xnor</code> (heir::cggi::XNorOp)</h3><p><em>Logical XNOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.xnor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-25>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-26>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=cggixor-heircggixorop><code>cggi.xor</code> (heir::cggi::XorOp)</h3><p><em>Logical XOR of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `cggi.xor` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-26>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-27>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h2 id=cggi-additional-definitions>CGGI additional definitions</h2><h3 id=cggiboolgateenum>CGGIBoolGateEnum</h3><p><em>An enum attribute representing a CGGI boolean gate using u8 int</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>AND</td><td style=text-align:center><code>0</code></td><td>AND</td></tr><tr><td style=text-align:center>NAND</td><td style=text-align:center><code>1</code></td><td>NAND</td></tr><tr><td style=text-align:center>OR</td><td style=text-align:center><code>2</code></td><td>OR</td></tr><tr><td style=text-align:center>NOR</td><td style=text-align:center><code>3</code></td><td>NOR</td></tr><tr><td style=text-align:center>XOR</td><td style=text-align:center><code>4</code></td><td>XOR</td></tr><tr><td style=text-align:center>XNOR</td><td style=text-align:center><code>5</code></td><td>XNOR</td></tr><tr><td style=text-align:center>NOT</td><td style=text-align:center><code>6</code></td><td>NOT</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-818a3660f61ebf5859b5c98635beacc8>7.3 - CKKS</h1><h1 id=ckks-dialect>&lsquo;ckks&rsquo; Dialect</h1><p>The CKKS dialect defines the types and operations of the CKKS cryptosystem.</p><h2 id=ckks-attributes>CKKS attributes</h2><h3 id=schemeparamattr>SchemeParamAttr</h3><p><em>CKKS Scheme Parameters</em></p><p>Syntax:</p><pre tabindex=0><code>#ckks.scheme_param&lt;
  int,   # logN
  DenseI64ArrayAttr,   # Q
  DenseI64ArrayAttr,   # P
  int,   # logDefaultScale
  CKKSEncryptionType,   # encryptionType
  CKKSEncryptionTechnique   # encryptionTechnique
&gt;
</code></pre><p>This attribute is used for recording the scheme parameters for CKKS.</p><p>The attribute is a struct with the following fields:</p><ul><li><code>int</code> logN: The log of the degree of the polynomial modulus.</li><li><code>DenseI64ArrayAttr</code> Q: The array of primes in the ciphertext modulus.</li><li><code>DenseI64ArrayAttr</code> P: The array of primes in the special modulus, used for key switching.</li><li><code>int</code> logDefaultScale: The log of the default scale.</li></ul><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>logN</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>Q</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>P</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logDefaultScale</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>encryptionType</td><td style=text-align:center><code>CKKSEncryptionType</code></td><td></td></tr><tr><td style=text-align:center>encryptionTechnique</td><td style=text-align:center><code>CKKSEncryptionTechnique</code></td><td></td></tr></tbody></table><h2 id=ckks-ops>CKKS ops</h2><h3 id=ckksadd-heirckksaddop><code>ckks.add</code> (heir::ckks::AddOp)</h3><p><em>Addition operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.add` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksadd_plain-heirckksaddplainop><code>ckks.add_plain</code> (heir::ckks::AddPlainOp)</h3><p><em>Addition operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.add_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksbootstrap-heirckksbootstrapop><code>ckks.bootstrap</code> (heir::ckks::BootstrapOp)</h3><p><em>Bootstrap the ciphertext to reduce noise and refresh its parameters.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.bootstrap` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Bootstrapping is a technique used in FHE to reduce the noise in a ciphertext
and refresh its parameters, allowing for further computations on the ciphertext.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckkslevel_reduce-heirckkslevelreduceop><code>ckks.level_reduce</code> (heir::ckks::LevelReduceOp)</h3><p><em>Lower the modulus level of the ciphertext via dropping RNS limbs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.level_reduce` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksmul-heirckksmulop><code>ckks.mul</code> (heir::ckks::MulOp)</h3><p><em>Multiplication operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.mul` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksmul_plain-heirckksmulplainop><code>ckks.mul_plain</code> (heir::ckks::MulPlainOp)</h3><p><em>Multiplication operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.mul_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksnegate-heirckksnegateop><code>ckks.negate</code> (heir::ckks::NegateOp)</h3><p><em>Negate the coefficients of the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.negate` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Involution</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksrelinearize-heirckksrelinearizeop><code>ckks.relinearize</code> (heir::ckks::RelinearizeOp)</h3><p><em>Relinearize the ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.relinearize` $input (`,` $keySwitchingKey^)? attr-dict `:` functional-type(operands, results)
</code></pre><p>This op takes integer array attributes <code>from_basis</code> and <code>to_basis</code> that are
used to indicate the key basis from which and to which the ciphertext is
encrypted against. A ciphertext is canonically encrypted against key basis
<code>(1, s)</code>. After a multiplication, its size will increase and the basis will be
<code>(1, s, s^2)</code>. The array that represents the key basis is constructed by
listing the powers of <code>s</code> at each position of the array. For example, <code>(1, s, s^2)</code> corresponds to <code>[0, 1, 2]</code>, while <code>(1, s^2)</code> corresponds to <code>[0, 2]</code>.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>ElementwiseByOperandOpInterface</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>from_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr><tr><td><code>to_basis</code></td><td>::mlir::DenseI32ArrayAttr</td><td>i32 dense array attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>keySwitchingKey</code></td><td>ranked tensor of lwe-ciphertext-like values</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksrescale-heirckksrescaleop><code>ckks.rescale</code> (heir::ckks::RescaleOp)</h3><p><em>Rescales the ciphertext, which is the CKKS version of modulus switching in BGV/BFV.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.rescale` operands attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>to_ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckksrotate-heirckksrotateop><code>ckks.rotate</code> (heir::ckks::RotateOp)</h3><p><em>Rotate the coefficients of the ciphertext using a Galois automorphism.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.rotate` operands attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckkssub-heirckkssubop><code>ckks.sub</code> (heir::ckks::SubOp)</h3><p><em>Subtraction operation between ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.sub` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=ckkssub_plain-heirckkssubplainop><code>ckks.sub_plain</code> (heir::ckks::SubPlainOp)</h3><p><em>Subtraction operation between ciphertext-plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `ckks.sub_plain` operands attr-dict `:`  functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h2 id=ckks-additional-definitions>CKKS additional definitions</h2><h3 id=ckksencryptiontechnique>CKKSEncryptionTechnique</h3><p><em>An enum attribute representing an encryption technique</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>standard</td><td style=text-align:center><code>0</code></td><td>standard</td></tr><tr><td style=text-align:center>extended</td><td style=text-align:center><code>1</code></td><td>extended</td></tr></tbody></table><h3 id=ckksencryptiontype>CKKSEncryptionType</h3><p><em>An enum attribute representing an encryption method</em></p><h4 id=cases-1>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>pk</td><td style=text-align:center><code>0</code></td><td>pk</td></tr><tr><td style=text-align:center>sk</td><td style=text-align:center><code>1</code></td><td>sk</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-80cc312dd83f43a069330083f04eb4f2>7.4 - Comb</h1><h1 id=comb-dialect>&lsquo;comb&rsquo; Dialect</h1><p><em>Types and operations for comb dialect</em></p><p>This dialect defines the <code>comb</code> dialect, which is intended to be a generic
representation of combinational logic outside of a particular use-case.</p><h2 id=operations>Operations</h2><h3 id=combadd-heircombaddop><code>comb.add</code> (heir::comb::AddOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.add` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comband-heircombandop><code>comb.and</code> (heir::comb::AndOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.and` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combconcat-heircombconcatop><code>comb.concat</code> (heir::comb::ConcatOp)</h3><p><em>Concatenate a variadic list of operands together.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.concat` $inputs attr-dict `:` qualified(type($inputs))
</code></pre><p>See the comb rationale document for details on operand ordering.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combextract-heircombextractop><code>comb.extract</code> (heir::comb::ExtractOp)</h3><p><em>Extract a range of bits into a smaller value, lowBit specifies the lowest bit included.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.extract` $input `from` $lowBit attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lowBit</code></td><td>::mlir::IntegerAttr</td><td>32-bit signless integer attribute</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combicmp-heircombicmpop><code>comb.icmp</code> (heir::comb::ICmpOp)</h3><p><em>Compare two integer values</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.icmp` (`bin` $twoState^)? $predicate $lhs `,` $rhs attr-dict `:` qualified(type($lhs))
</code></pre><p>This operation compares two integers using a predicate. If the predicate is
true, returns 1, otherwise returns 0. This operation always returns a one
bit wide result.</p><pre tabindex=0><code>    %r = comb.icmp eq %a, %b : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::heir::comb::ICmpPredicateAttr</td><td>hw.icmp comparison predicate</td></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless integer</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combinv-heircombinvop><code>comb.inv</code> (heir::comb::InvOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.inv` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comblut-heircomblutop><code>comb.lut</code> (heir::comb::LUTOp)</h3><p><em>Return an integer based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.lut` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation is similar to <code>truth_table</code>, but it allows for an integer output instead of a boolean.
Requers an vector of integers as the lookup table, where each integer represents the output for a specific combination of inputs.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr><tr><td><code>lookupTable</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 8-bit signless integer</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>8-bit signless integer</td></tr></tbody></table><h3 id=combmul-heircombmulop><code>comb.mul</code> (heir::comb::MulOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mul` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-6>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmux-heircombmuxop><code>comb.mux</code> (heir::comb::MuxOp)</h3><p><em>Return one or the other operand depending on a selector bit</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mux` (`bin` $twoState^)? $cond `,` $trueValue `,` $falseValue  attr-dict `:` qualified(type($result))
</code></pre><pre tabindex=0><code>  %0 = mux %pred, %tvalue, %fvalue : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-7>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cond</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>trueValue</code></td><td>any type</td></tr><tr><td style=text-align:center><code>falseValue</code></td><td>any type</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>any type</td></tr></tbody></table><h3 id=combnand-heircombnandop><code>comb.nand</code> (heir::comb::NandOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nand` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-8>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combnor-heircombnorop><code>comb.nor</code> (heir::comb::NorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-9>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combor-heircomborop><code>comb.or</code> (heir::comb::OrOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.or` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-10>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combparity-heircombparityop><code>comb.parity</code> (heir::comb::ParityOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.parity` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-11>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combreplicate-heircombreplicateop><code>comb.replicate</code> (heir::comb::ReplicateOp)</h3><p><em>Concatenate the operand a constant number of times</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.replicate` $input attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combtruth_table-heircombtruthtableop><code>comb.truth_table</code> (heir::comb::TruthTableOp)</h3><p><em>Return a true/false based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.truth_table` $inputs `-&gt;` $lookupTable attr-dict
</code></pre><pre tabindex=0><code>  %a = ... : i1
  %b = ... : i1
  %0 = comb.truth_table %a, %b -&gt; 6 : ui4
</code></pre><p>This operation assumes that the lookup table is described as an integer of
2^n bits to fully specify the table. Inputs are sorted MSB -> LSB from left
to right and the offset into <code>lookupTable</code> is computed from them. The
integer containing the truth table value&rsquo;s LSB is the output for the input
&ldquo;all false&rdquo;, and the MSB is the output for the input &ldquo;all true&rdquo;.</p><p>No difference from array_get into an array of constants except for xprop
behavior. If one of the inputs is unknown, but said input doesn&rsquo;t make a
difference in the output (based on the lookup table) the result should not
be &lsquo;x&rsquo; &ndash; it should be the well-known result.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-12>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookupTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 1-bit signless integer</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combxnor-heircombxnorop><code>comb.xnor</code> (heir::comb::XNorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xnor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-13>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combxor-heircombxorop><code>comb.xor</code> (heir::comb::XorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-14>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h2 id=enums>Enums</h2><h3 id=icmppredicate>ICmpPredicate</h3><p><em>Hw.icmp comparison predicate</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>eq</td><td style=text-align:center><code>0</code></td><td>eq</td></tr><tr><td style=text-align:center>ne</td><td style=text-align:center><code>1</code></td><td>ne</td></tr><tr><td style=text-align:center>slt</td><td style=text-align:center><code>2</code></td><td>slt</td></tr><tr><td style=text-align:center>sle</td><td style=text-align:center><code>3</code></td><td>sle</td></tr><tr><td style=text-align:center>sgt</td><td style=text-align:center><code>4</code></td><td>sgt</td></tr><tr><td style=text-align:center>sge</td><td style=text-align:center><code>5</code></td><td>sge</td></tr><tr><td style=text-align:center>ult</td><td style=text-align:center><code>6</code></td><td>ult</td></tr><tr><td style=text-align:center>ule</td><td style=text-align:center><code>7</code></td><td>ule</td></tr><tr><td style=text-align:center>ugt</td><td style=text-align:center><code>8</code></td><td>ugt</td></tr><tr><td style=text-align:center>uge</td><td style=text-align:center><code>9</code></td><td>uge</td></tr><tr><td style=text-align:center>ceq</td><td style=text-align:center><code>10</code></td><td>ceq</td></tr><tr><td style=text-align:center>cne</td><td style=text-align:center><code>11</code></td><td>cne</td></tr><tr><td style=text-align:center>weq</td><td style=text-align:center><code>12</code></td><td>weq</td></tr><tr><td style=text-align:center>wne</td><td style=text-align:center><code>13</code></td><td>wne</td></tr></tbody></table><h2 id=comb-types>Comb types</h2><h3 id=bfloat16type>BFloat16Type</h3><p><em>Bfloat16 floating-point type</em></p><h3 id=complextype>ComplexType</h3><p><em>Complex number with a parameterized element type</em></p><p>Syntax:</p><pre tabindex=0><code>complex-type ::= `complex` `&lt;` type `&gt;`
</code></pre><p>The value of <code>complex</code> type represents a complex number with a parameterized
element type, which is composed of a real and imaginary value of that
element type. The element must be a floating point or integer scalar type.</p><h4 id=example>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>complex<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>complex<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=float4e2m1fntype>Float4E2M1FNType</h3><p><em>4-bit floating point with 2-bit exponent and 1-bit mantissa</em></p><p>An 4-bit floating point type with 1 sign bit, 2 bits exponent and 1 bit
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E2M1</li><li>exponent bias: 1</li><li>infinities: Not supported</li><li>NaNs: Not supported</li><li>denormals when exponent is 0</li></ul><p>Open Compute Project (OCP) microscaling formats (MX) specification:
<a href=https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf>https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf</a></p><h3 id=float6e2m3fntype>Float6E2M3FNType</h3><p><em>6-bit floating point with 2-bit exponent and 3-bit mantissa</em></p><p>An 6-bit floating point type with 1 sign bit, 2 bits exponent and 3 bits
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E2M3</li><li>exponent bias: 1</li><li>infinities: Not supported</li><li>NaNs: Not supported</li><li>denormals when exponent is 0</li></ul><p>Open Compute Project (OCP) microscaling formats (MX) specification:
<a href=https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf>https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf</a></p><h3 id=float6e3m2fntype>Float6E3M2FNType</h3><p><em>6-bit floating point with 3-bit exponent and 2-bit mantissa</em></p><p>An 6-bit floating point type with 1 sign bit, 3 bits exponent and 2 bits
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E3M2</li><li>exponent bias: 3</li><li>infinities: Not supported</li><li>NaNs: Not supported</li><li>denormals when exponent is 0</li></ul><p>Open Compute Project (OCP) microscaling formats (MX) specification:
<a href=https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf>https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf</a></p><h3 id=float8e3m4type>Float8E3M4Type</h3><p><em>8-bit floating point with 3 bits exponent and 4 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 3 bits exponent and 4 bits
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E3M4</li><li>exponent bias: 3</li><li>infinities: supported with exponent set to all 1s and mantissa 0s</li><li>NaNs: supported with exponent bits set to all 1s and mantissa values of
{0,1}⁴ except S.111.0000</li><li>denormals when exponent is 0</li></ul><h3 id=float8e4m3type>Float8E4M3Type</h3><p><em>8-bit floating point with 3 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 4 bits exponent and 3 bits
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E4M3</li><li>exponent bias: 7</li><li>infinities: supported with exponent set to all 1s and mantissa 0s</li><li>NaNs: supported with exponent bits set to all 1s and mantissa of
(001, 010, 011, 100, 101, 110, 111)</li><li>denormals when exponent is 0</li></ul><h3 id=float8e4m3b11fnuztype>Float8E4M3B11FNUZType</h3><p><em>8-bit floating point with 3 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 4 bits exponent and 3 bits
mantissa. This is not a standard type as defined by IEEE-754, but it follows
similar conventions, with the exception that there are no infinity values,
no negative zero, and only one NaN representation. This type has the
following characteristics:</p><ul><li>bit encoding: S1E4M3</li><li>exponent bias: 11</li><li>infinities: Not supported</li><li>NaNs: Supported with sign bit set to 1, exponent bits and mantissa bits set to all 0s</li><li>denormals when exponent is 0</li></ul><p>Related to: <a href=https://dl.acm.org/doi/10.5555/3454287.3454728>https://dl.acm.org/doi/10.5555/3454287.3454728</a></p><h3 id=float8e4m3fntype>Float8E4M3FNType</h3><p><em>8-bit floating point with 3 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 4 bits exponent and 3 bits
mantissa. This is not a standard type as defined by IEEE-754, but it follows
similar conventions, with the exception that there are no infinity values
and only two NaN representations. This type has the following
characteristics:</p><ul><li>bit encoding: S1E4M3</li><li>exponent bias: 7</li><li>infinities: Not supported</li><li>NaNs: supported with exponent bits and mantissa bits set to all 1s</li><li>denormals when exponent is 0</li></ul><p>Described in: <a href=https://arxiv.org/abs/2209.05433>https://arxiv.org/abs/2209.05433</a></p><h3 id=float8e4m3fnuztype>Float8E4M3FNUZType</h3><p><em>8-bit floating point with 3 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 4 bits exponent and 3 bits
mantissa. This is not a standard type as defined by IEEE-754, but it follows
similar conventions, with the exception that there are no infinity values,
no negative zero, and only one NaN representation. This type has the
following characteristics:</p><ul><li>bit encoding: S1E4M3</li><li>exponent bias: 8</li><li>infinities: Not supported</li><li>NaNs: Supported with sign bit set to 1, exponent bits and mantissa bits set to all 0s</li><li>denormals when exponent is 0</li></ul><p>Described in: <a href=https://arxiv.org/abs/2209.05433>https://arxiv.org/abs/2209.05433</a></p><h3 id=float8e5m2type>Float8E5M2Type</h3><p><em>8-bit floating point with 2 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 5 bits exponent and 2 bits
mantissa. This is not a standard type as defined by IEEE-754, but it
follows similar conventions with the following characteristics:</p><ul><li>bit encoding: S1E5M2</li><li>exponent bias: 15</li><li>infinities: supported with exponent set to all 1s and mantissa 0s</li><li>NaNs: supported with exponent bits set to all 1s and mantissa of
(01, 10, or 11)</li><li>denormals when exponent is 0</li></ul><p>Described in: <a href=https://arxiv.org/abs/2209.05433>https://arxiv.org/abs/2209.05433</a></p><h3 id=float8e5m2fnuztype>Float8E5M2FNUZType</h3><p><em>8-bit floating point with 2 bit mantissa</em></p><p>An 8-bit floating point type with 1 sign bit, 5 bits exponent and 2 bits
mantissa. This is not a standard type as defined by IEEE-754, but it follows
similar conventions, with the exception that there are no infinity values,
no negative zero, and only one NaN representation. This type has the
following characteristics:</p><ul><li>bit encoding: S1E5M2</li><li>exponent bias: 16</li><li>infinities: Not supported</li><li>NaNs: Supported with sign bit set to 1, exponent bits and mantissa bits set to all 0s</li><li>denormals when exponent is 0</li></ul><p>Described in: <a href=https://arxiv.org/abs/2206.02915>https://arxiv.org/abs/2206.02915</a></p><h3 id=float8e8m0fnutype>Float8E8M0FNUType</h3><p><em>8-bit floating point with 8-bit exponent, no mantissa or sign</em></p><p>An 8-bit floating point type with no sign bit, 8 bits exponent and no
mantissa. This is not a standard type as defined by IEEE-754; it is intended
to be used for representing scaling factors, so it cannot represent zeros
and negative numbers. The values it can represent are powers of two in the
range [-127,127] and NaN.</p><ul><li>bit encoding: S0E8M0</li><li>exponent bias: 127</li><li>infinities: Not supported</li><li>NaNs: Supported with all bits set to 1</li><li>denormals: Not supported</li></ul><p>Open Compute Project (OCP) microscaling formats (MX) specification:
<a href=https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf>https://www.opencompute.org/documents/ocp-microscaling-formats-mx-v1-0-spec-final-pdf</a></p><h3 id=float16type>Float16Type</h3><p><em>16-bit floating-point type</em></p><h3 id=float32type>Float32Type</h3><p><em>32-bit floating-point type</em></p><h3 id=float64type>Float64Type</h3><p><em>64-bit floating-point type</em></p><h3 id=float80type>Float80Type</h3><p><em>80-bit floating-point type</em></p><h3 id=float128type>Float128Type</h3><p><em>128-bit floating-point type</em></p><h3 id=floattf32type>FloatTF32Type</h3><p><em>TF32 floating-point type</em></p><h3 id=functiontype>FunctionType</h3><p><em>Map from a list of inputs to a list of results</em></p><p>Syntax:</p><pre tabindex=0><code>// Function types may have multiple results.
function-result-type ::= type-list-parens | non-function-type
function-type ::= type-list-parens `-&gt;` function-result-type
</code></pre><p>The function type can be thought of as a function signature. It consists of
a list of formal parameter types and a list of formal result types.</p><h4 id=example-1>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add_one</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i64</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>inputs</td><td style=text-align:center><code>ArrayRef&lt;Type></code></td><td></td></tr><tr><td style=text-align:center>results</td><td style=text-align:center><code>ArrayRef&lt;Type></code></td><td></td></tr></tbody></table><h3 id=graphtype>GraphType</h3><p><em>Map from a list of inputs to a list of results</em></p><p>Syntax:</p><pre tabindex=0><code>// Function types may have multiple results.
function-result-type ::= type-list-parens | non-function-type
function-type ::= type-list-parens `-&gt;` function-result-type
</code></pre><p>The function type can be thought of as a function signature. It consists of
a list of formal parameter types and a list of formal result types.</p><h4 id=example-2>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add_one</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i64</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>inputs</td><td style=text-align:center><code>ArrayRef&lt;Type></code></td><td></td></tr><tr><td style=text-align:center>results</td><td style=text-align:center><code>ArrayRef&lt;Type></code></td><td></td></tr></tbody></table><h3 id=indextype>IndexType</h3><p><em>Integer-like type with unknown platform-dependent bit width</em></p><p>Syntax:</p><pre tabindex=0><code>// Target word-sized integer.
index-type ::= `index`
</code></pre><p>The index type is a signless integer whose size is equal to the natural
machine word of the target ( <a href=../../Rationale/Rationale/#integer-signedness-semantics>rationale</a> )
and is used by the affine constructs in MLIR.</p><p><strong>Rationale:</strong> integers of platform-specific bit widths are practical to
express sizes, dimensionalities and subscripts.</p><h3 id=integertype>IntegerType</h3><p><em>Integer type with arbitrary precision up to a fixed limit</em></p><p>Syntax:</p><pre tabindex=0><code>// Sized integers like i1, i4, i8, i16, i32.
signed-integer-type ::= `si` [1-9][0-9]*
unsigned-integer-type ::= `ui` [1-9][0-9]*
signless-integer-type ::= `i` [1-9][0-9]*
integer-type ::= signed-integer-type |
                 unsigned-integer-type |
                 signless-integer-type
</code></pre><p>Integer types have a designated bit width and may optionally have signedness
semantics.</p><p><strong>Rationale:</strong> low precision integers (like <code>i2</code>, <code>i4</code> etc) are useful for
low-precision inference chips, and arbitrary precision integers are useful
for hardware synthesis (where a 13 bit multiplier is a lot cheaper/smaller
than a 16 bit one).</p><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>width</td><td style=text-align:center><code>unsigned</code></td><td></td></tr><tr><td style=text-align:center>signedness</td><td style=text-align:center><code>SignednessSemantics</code></td><td></td></tr></tbody></table><h3 id=memreftype>MemRefType</h3><p><em>Shaped reference to a region of memory</em></p><p>Syntax:</p><pre tabindex=0><code>layout-specification ::= attribute-value
memory-space ::= attribute-value
memref-type ::= `memref` `&lt;` dimension-list-ranked type
                (`,` layout-specification)? (`,` memory-space)? `&gt;`
</code></pre><p>A <code>memref</code> type is a reference to a region of memory (similar to a buffer
pointer, but more powerful). The buffer pointed to by a memref can be
allocated, aliased and deallocated. A memref can be used to read and write
data from/to the memory region which it references. Memref types use the
same shape specifier as tensor types. Note that <code>memref&lt;f32></code>,
<code>memref&lt;0 x f32></code>, <code>memref&lt;1 x 0 x f32></code>, and <code>memref&lt;0 x 1 x f32></code> are all
different types.</p><p>A <code>memref</code> is allowed to have an unknown rank (e.g. <code>memref&lt;*xf32></code>). The
purpose of unranked memrefs is to allow external library functions to
receive memref arguments of any rank without versioning the functions based
on the rank. Other uses of this type are disallowed or will have undefined
behavior.</p><p>Are accepted as elements:</p><ul><li>built-in integer types;</li><li>built-in index type;</li><li>built-in floating point types;</li><li>built-in vector types with elements of the above types;</li><li>another memref type;</li><li>any other type implementing <code>MemRefElementTypeInterface</code>.</li></ul><h5 id=layout>Layout</h5><p>A memref may optionally have a layout that indicates how indices are
transformed from the multi-dimensional form into a linear address. The
layout must avoid internal aliasing, i.e., two distinct tuples of
<em>in-bounds</em> indices must be pointing to different elements in memory. The
layout is an attribute that implements <code>MemRefLayoutAttrInterface</code>. The
bulitin dialect offers two kinds of layouts: strided and affine map, each
of which is available as an attribute. Other attributes may be used to
represent the layout as long as they can be converted to a
<a href=Affine.md/#semi-affine-maps>semi-affine map</a> and implement the required
interface. Users of memref are expected to fallback to the affine
representation when handling unknown memref layouts. Multi-dimensional
affine forms are interpreted in <em>row-major</em> fashion.</p><p>In absence of an explicit layout, a memref is considered to have a
multi-dimensional identity affine map layout. Identity layout maps do not
contribute to the MemRef type identification and are discarded on
construction. That is, a type with an explicit identity map is
<code>memref&lt;?x?xf32, (i,j)->(i,j)></code> is strictly the same as the one without a
layout, <code>memref&lt;?x?xf32></code>.</p><h5 id=affine-map-layout>Affine Map Layout</h5><p>The layout may be represented directly as an affine map from the index space
to the storage space. For example, the following figure shows an index map
which maps a 2-dimensional index from a 2x2 index space to a 3x3 index
space, using symbols <code>S0</code> and <code>S1</code> as offsets.</p><p><img src=/includes/img/index-map.svg alt="Index Map Example"></p><p>Semi-affine maps are sufficiently flexible to represent a wide variety of
dense storage layouts, including row- and column-major and tiled:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// MxN matrix stored in row major layout in memory:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#layout_map_row_major</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>,</span> j<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>,</span> j<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// MxN matrix stored in column major layout in memory:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#layout_map_col_major</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>,</span> j<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>j<span style=color:#000;font-weight:700>,</span> i<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// MxN matrix stored in a 2-d blocked/tiled layout with 64x64 tiles.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#layout_tiled</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>i<span style=color:#000;font-weight:700>,</span> j<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>i floordiv <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> j floordiv <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> i mod <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>,</span> j mod <span style=color:#0000cf;font-weight:700>64</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h5 id=strided-layout>Strided Layout</h5><p>Memref layout can be expressed using strides to encode the distance, in
number of elements, in (linear) memory between successive entries along a
particular dimension. For example, a row-major strided layout for
<code>memref&lt;2x3x4xf32></code> is <code>strided&lt;[12, 4, 1]></code>, where the last dimension is
contiguous as indicated by the unit stride and the remaining strides are
products of the sizes of faster-variying dimensions. Strided layout can also
express non-contiguity, e.g., <code>memref&lt;2x3, strided&lt;[6, 2]>></code> only accesses
even elements of the dense consecutive storage along the innermost
dimension.</p><p>The strided layout supports an optional <em>offset</em> that indicates the
distance, in the number of elements, between the beginning of the memref
and the first accessed element. When omitted, the offset is considered to
be zero. That is, <code>memref&lt;2, strided&lt;[2], offset: 0>></code> and
<code>memref&lt;2, strided&lt;[2]>></code> are strictly the same type.</p><p>Both offsets and strides may be <em>dynamic</em>, that is, unknown at compile time.
This is represented by using a question mark (<code>?</code>) instead of the value in
the textual form of the IR.</p><p>The strided layout converts into the following canonical one-dimensional
affine form through explicit linearization:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>...</span> dN<span style=color:#000;font-weight:700>)[</span>offset<span style=color:#000;font-weight:700>,</span> stride0<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>...</span> strideN<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>(</span>offset <span style=color:#a40000>+</span> d0 <span style=color:#000;font-weight:700>*</span> stride0 <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>...</span> dN <span style=color:#000;font-weight:700>*</span> strideN<span style=color:#000;font-weight:700>)&gt;</span>
</span></span></code></pre></div><p>Therefore, it is never subject to the implicit row-major layout
interpretation.</p><h5 id=codegen-of-unranked-memref>Codegen of Unranked Memref</h5><p>Using unranked memref in codegen besides the case mentioned above is highly
discouraged. Codegen is concerned with generating loop nests and specialized
instructions for high-performance, unranked memref is concerned with hiding
the rank and thus, the number of enclosing loops required to iterate over
the data. However, if there is a need to code-gen unranked memref, one
possible path is to cast into a static ranked type based on the dynamic
rank. Another possible path is to emit a single while loop conditioned on a
linear index and perform delinearization of the linear index to a dynamic
array containing the (unranked) indices. While this is possible, it is
expected to not be a good idea to perform this during codegen as the cost
of the translations is expected to be prohibitive and optimizations at this
level are not expected to be worthwhile. If expressiveness is the main
concern, irrespective of performance, passing unranked memrefs to an
external C++ library and implementing rank-agnostic logic there is expected
to be significantly simpler.</p><p>Unranked memrefs may provide expressiveness gains in the future and help
bridge the gap with unranked tensors. Unranked memrefs will not be expected
to be exposed to codegen but one may query the rank of an unranked memref
(a special op will be needed for this purpose) and perform a switch and cast
to a ranked memref as a prerequisite to codegen.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// With static ranks, we need a function for each possible argument type
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%A</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%B</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x64x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>call <span style=color:#000>@helper_2D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%A</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)-&gt;()</span>
</span></span><span style=display:flex><span>call <span style=color:#000>@helper_3D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%B</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x64x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)-&gt;()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// With unknown rank, the functions can be unified under one unranked type
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%A</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%B</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x64x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Remove rank info
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%A_u</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span>_cast <span style=color:#000>%A</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%B_u</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span>_cast <span style=color:#000>%B</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x64x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// call same function with dynamic ranks
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>call <span style=color:#000>@helper</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%A_u</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span>xf32<span style=color:#000;font-weight:700>&gt;)-&gt;()</span>
</span></span><span style=display:flex><span>call <span style=color:#000>@helper</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%B_u</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span>xf32<span style=color:#000;font-weight:700>&gt;)-&gt;()</span>
</span></span></code></pre></div><p>The core syntax and representation of a layout specification is a
<a href=Affine.md/#semi-affine-maps>semi-affine map</a>. Additionally,
syntactic sugar is supported to make certain layout specifications more
intuitive to read. For the moment, a <code>memref</code> supports parsing a strided
form which is converted to a semi-affine map automatically.</p><p>The memory space of a memref is specified by a target-specific attribute.
It might be an integer value, string, dictionary or custom dialect attribute.
The empty memory space (attribute is None) is target specific.</p><p>The notionally dynamic value of a memref value includes the address of the
buffer allocated, as well as the symbols referred to by the shape, layout
map, and index maps.</p><p>Examples of memref static type</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Identity index/layout map
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#identity</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Column major layout.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#col_major</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d2<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d2<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>,</span> d0<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 2-d tiled layout with tiles of size 128 x 256.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#tiled_2d_128x256</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0 div <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> d1 div <span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>,</span> d0 mod <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> d1 mod <span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A tiled data layout with non-constant tile sizes.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#tiled_dynamic</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)[</span>s0<span style=color:#000;font-weight:700>,</span> s1<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0 floordiv s0<span style=color:#000;font-weight:700>,</span> d1 floordiv s1<span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                             d0 mod s0<span style=color:#000;font-weight:700>,</span> d1 mod s1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A layout that yields a padding on two at either end of the minor dimension.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#padded</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span>d1 <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> floordiv <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span>d1 <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> mod <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// The dimension list &#34;16x32&#34; defines the following 2D index space:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   { (i, j) : 0 &lt;= i &lt; 16, 0 &lt;= j &lt; 32 }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x32x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#identity</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// The dimension list &#34;16x4x?&#34; defines the following 3D index space:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   { (i, j, k) : 0 &lt;= i &lt; 16, 0 &lt;= j &lt; 4, 0 &lt;= k &lt; N }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// where N is a symbol which represents the runtime value of the size of
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the third dimension.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// %N here binds to the size of the third dimension.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%A</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>(</span><span style=color:#000>%N</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x4x?x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#col_major</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 2-d dynamic shaped memref that also has a dynamically sized tiled
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// layout. The memref index space is of size %M x %N, while %B1 and %B2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// bind to the symbols s0, s1 respectively of the layout map #tiled_dynamic.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Data tiles of size %B1 x %B2 in the logical space will be stored
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// contiguously in memory. The allocation size will be
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// (%M ceildiv %B1) * %B1 * (%N ceildiv %B2) * %B2 f32 elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%T</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>(</span><span style=color:#000>%M</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%N</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>%B1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%B2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>?x?x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#tiled_dynamic</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A memref that has a two-element padding at either end. The allocation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// size will fit 16 * 64 float elements of data.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%P</span> <span style=color:#000;font-weight:700>=</span> alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x64x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#padded</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Affine map with symbol &#39;s0&#39; used as offset for the first dimension.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#imapS</span> <span style=color:#000;font-weight:700>=</span> affine_map<span style=color:#000;font-weight:700>&lt;(</span>d0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>[</span>s0<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span>d0 <span style=color:#a40000>+</span> s0<span style=color:#000;font-weight:700>,</span> d1<span style=color:#000;font-weight:700>)&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Allocate memref and bind the following symbols:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// &#39;%n&#39; is bound to the dynamic second dimension of the memref type.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// &#39;%o&#39; is bound to the symbol &#39;s0&#39; in the affine map of the memref type.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>%n</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000>%o</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000>%A</span> <span style=color:#000;font-weight:700>=</span> alloc <span style=color:#000;font-weight:700>(</span><span style=color:#000>%n</span><span style=color:#000;font-weight:700>)[</span><span style=color:#000>%o</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x?x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#imapS</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>shape</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td></td></tr><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>layout</td><td style=text-align:center><code>MemRefLayoutAttrInterface</code></td><td></td></tr><tr><td style=text-align:center>memorySpace</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=nonetype>NoneType</h3><p><em>A unit type</em></p><p>Syntax:</p><pre tabindex=0><code>none-type ::= `none`
</code></pre><p>NoneType is a unit type, i.e. a type with exactly one possible value, where
its value does not have a defined dynamic representation.</p><h4 id=example-3>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@none_type</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%none_val</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;foo.unknown_op&#34;</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> none
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=opaquetype>OpaqueType</h3><p><em>Type of a non-registered dialect</em></p><p>Syntax:</p><pre tabindex=0><code>opaque-type ::= `opaque` `&lt;` type `&gt;`
</code></pre><p>Opaque types represent types of non-registered dialects. These are types
represented in their raw string form, and can only usefully be tested for
type equality.</p><h4 id=example-4>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>opaque<span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;llvm&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;struct&lt;(i32, float)&gt;&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>opaque<span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;pdl&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>dialectNamespace</td><td style=text-align:center><code>StringAttr</code></td><td></td></tr><tr><td style=text-align:center>typeData</td><td style=text-align:center><code>::llvm::StringRef</code></td><td></td></tr></tbody></table><h3 id=rankedtensortype>RankedTensorType</h3><p><em>Multi-dimensional array with a fixed number of dimensions</em></p><p>Syntax:</p><pre tabindex=0><code>tensor-type ::= `tensor` `&lt;` dimension-list type (`,` encoding)? `&gt;`
dimension-list ::= (dimension `x`)*
dimension ::= `?` | decimal-literal
encoding ::= attribute-value
</code></pre><p>Values with tensor type represents aggregate N-dimensional data values, and
have a known element type and a fixed rank with a list of dimensions. Each
dimension may be a static non-negative decimal constant or be dynamically
determined (indicated by <code>?</code>).</p><p>The runtime representation of the MLIR tensor type is intentionally
abstracted - you cannot control layout or get a pointer to the data. For
low level buffer access, MLIR has a <a href=#memreftype><code>memref</code> type</a>. This
abstracted runtime representation holds both the tensor data values as well
as information about the (potentially dynamic) shape of the tensor. The
<a href=MemRef.md/#memrefdim-mlirmemrefdimop><code>dim</code> operation</a> returns the size of a
dimension from a value of tensor type.</p><p>The <code>encoding</code> attribute provides additional information on the tensor.
An empty attribute denotes a straightforward tensor without any specific
structure. But particular properties, like sparsity or other specific
characteristics of the data of the tensor can be encoded through this
attribute. The semantics are defined by a type and attribute interface
and must be respected by all passes that operate on tensor types.
TODO: provide this interface, and document it further.</p><p>Note: hexadecimal integer literals are not allowed in tensor type
declarations to avoid confusion between <code>0xf32</code> and <code>0 x f32</code>. Zero sizes
are allowed in tensors and treated as other sizes, e.g.,
<code>tensor&lt;0 x 1 x i32></code> and <code>tensor&lt;1 x 0 x i32></code> are different types. Since
zero sizes are not allowed in some other types, such tensors should be
optimized away before lowering tensors to vectors.</p><h4 id=example-5>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Known rank but unknown dimensions.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Partially known dimensions.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#0000cf;font-weight:700>13 x</span> <span style=color:#0000cf;font-weight:700>? x</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Full static shape.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>17 x</span> <span style=color:#0000cf;font-weight:700>4 x</span> <span style=color:#0000cf;font-weight:700>13 x</span> <span style=color:#0000cf;font-weight:700>4 x</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Tensor with rank zero. Represents a scalar.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Zero-element dimensions are allowed.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#0000cf;font-weight:700>42 x</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Zero-element tensor of f32 type (hexadecimal literals not allowed here).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0xf32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Tensor with an encoding attribute (where #ENCODING is a named alias).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>?x?x</span><span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>#ENCODING</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>shape</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td></td></tr><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=tupletype>TupleType</h3><p><em>Fixed-sized collection of other types</em></p><p>Syntax:</p><pre tabindex=0><code>tuple-type ::= `tuple` `&lt;` (type ( `,` type)*)? `&gt;`
</code></pre><p>The value of <code>tuple</code> type represents a fixed-size collection of elements,
where each element may be of a different type.</p><p><strong>Rationale:</strong> Though this type is first class in the type system, MLIR
provides no standard operations for operating on <code>tuple</code> types
(<a href=../../Rationale/Rationale/#tuple-types>rationale</a>).</p><h4 id=example-6>Example:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Empty tuple.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>tuple<span style=color:#000;font-weight:700>&lt;&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Single element
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>tuple<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Many elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>tuple<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i5</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>types</td><td style=text-align:center><code>ArrayRef&lt;Type></code></td><td></td></tr></tbody></table><h3 id=unrankedmemreftype>UnrankedMemRefType</h3><p><em>Shaped reference, with unknown rank, to a region of memory</em></p><p>Syntax:</p><pre tabindex=0><code>unranked-memref-type ::= `memref` `&lt;*x` type (`,` memory-space)? `&gt;`
memory-space ::= attribute-value
</code></pre><p>A <code>memref</code> type with an unknown rank (e.g. <code>memref&lt;*xf32></code>). The purpose of
unranked memrefs is to allow external library functions to receive memref
arguments of any rank without versioning the functions based on the rank.
Other uses of this type are disallowed or will have undefined behavior.</p><p>See <a href=#memreftype>MemRefType</a> for more information on
memref types.</p><h4 id=examples>Examples:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// An unranked memref with a memory space of 10.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;*</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>memorySpace</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=unrankedtensortype>UnrankedTensorType</h3><p><em>Multi-dimensional array with unknown dimensions</em></p><p>Syntax:</p><pre tabindex=0><code>tensor-type ::= `tensor` `&lt;` `*` `x` type `&gt;`
</code></pre><p>An unranked tensor is a type of tensor in which the set of dimensions have
unknown rank. See <a href=#rankedtensortype>RankedTensorType</a>
for more information on tensor types.</p><h4 id=examples-1>Examples:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;*</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h3 id=vectortype>VectorType</h3><p><em>Multi-dimensional SIMD vector type</em></p><p>Syntax:</p><pre tabindex=0><code>vector-type ::= `vector` `&lt;` vector-dim-list vector-element-type `&gt;`
vector-element-type ::= float-type | integer-type | index-type
vector-dim-list := (static-dim-list `x`)?
static-dim-list ::= static-dim (`x` static-dim)*
static-dim ::= (decimal-literal | `[` decimal-literal `]`)
</code></pre><p>The vector type represents a SIMD style vector used by target-specific
operation sets like AVX or SVE. While the most common use is for 1D
vectors (e.g. vector&lt;16 x f32>) we also support multidimensional registers
on targets that support them (like TPUs). The dimensions of a vector type
can be fixed-length, scalable, or a combination of the two. The scalable
dimensions in a vector are indicated between square brackets ([ ]).</p><p>Vector shapes must be positive decimal integers. 0D vectors are allowed by
omitting the dimension: <code>vector&lt;f32></code>.</p><p>Note: hexadecimal integer literals are not allowed in vector type
declarations, <code>vector&lt;0x42xi32></code> is invalid because it is interpreted as a
2D vector with shape <code>(0, 42)</code> and zero shapes are not allowed.</p><h4 id=examples-2>Examples:</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 2D fixed-length vector of 3x42 i32 elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>vector</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x42x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 1D scalable-length vector that contains a multiple of 4 f32 elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>vector</span><span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 2D scalable-length vector that contains a multiple of 2x8 f32 elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>vector</span><span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]x[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 2D mixed fixed/scalable vector that contains 4 scalable vectors of 4 f32 elements.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>vector</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span>xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A 3D mixed fixed/scalable vector in which only the inner dimension is
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// scalable.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>vector</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span>x8xf32<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>shape</td><td style=text-align:center><code>::llvm::ArrayRef&lt;int64_t></code></td><td></td></tr><tr><td style=text-align:center>elementType</td><td style=text-align:center><code>::mlir::Type</code></td><td>VectorElementTypeInterface instance</td></tr><tr><td style=text-align:center>scalableDims</td><td style=text-align:center><code>::llvm::ArrayRef&lt;bool></code></td><td></td></tr></tbody></table><h2 id=comb-ops>Comb ops</h2><h3 id=combadd-heircombaddop-1><code>comb.add</code> (heir::comb::AddOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.add` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-15>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comband-heircombandop-1><code>comb.and</code> (heir::comb::AndOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.and` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-16>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combconcat-heircombconcatop-1><code>comb.concat</code> (heir::comb::ConcatOp)</h3><p><em>Concatenate a variadic list of operands together.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.concat` $inputs attr-dict `:` qualified(type($inputs))
</code></pre><p>See the comb rationale document for details on operand ordering.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combextract-heircombextractop-1><code>comb.extract</code> (heir::comb::ExtractOp)</h3><p><em>Extract a range of bits into a smaller value, lowBit specifies the lowest bit included.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.extract` $input `from` $lowBit attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-17>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lowBit</code></td><td>::mlir::IntegerAttr</td><td>32-bit signless integer attribute</td></tr></table><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combicmp-heircombicmpop-1><code>comb.icmp</code> (heir::comb::ICmpOp)</h3><p><em>Compare two integer values</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.icmp` (`bin` $twoState^)? $predicate $lhs `,` $rhs attr-dict `:` qualified(type($lhs))
</code></pre><p>This operation compares two integers using a predicate. If the predicate is
true, returns 1, otherwise returns 0. This operation always returns a one
bit wide result.</p><pre tabindex=0><code>    %r = comb.icmp eq %a, %b : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-18>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::heir::comb::ICmpPredicateAttr</td><td>hw.icmp comparison predicate</td></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless integer</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-21>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combinv-heircombinvop-1><code>comb.inv</code> (heir::comb::InvOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.inv` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-19>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-22>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-22>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=comblut-heircomblutop-1><code>comb.lut</code> (heir::comb::LUTOp)</h3><p><em>Return an integer based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.lut` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation is similar to <code>truth_table</code>, but it allows for an integer output instead of a boolean.
Requers an vector of integers as the lookup table, where each integer represents the output for a specific combination of inputs.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-20>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>coefficients</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr><tr><td><code>lookupTable</code></td><td>::mlir::DenseI8ArrayAttr</td><td>i8 dense array attribute</td></tr></table><h4 id=operands-23>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 8-bit signless integer</td></tr></tbody></table><h4 id=results-23>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>8-bit signless integer</td></tr></tbody></table><h3 id=combmul-heircombmulop-1><code>comb.mul</code> (heir::comb::MulOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mul` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-21>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-24>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-24>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combmux-heircombmuxop-1><code>comb.mux</code> (heir::comb::MuxOp)</h3><p><em>Return one or the other operand depending on a selector bit</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.mux` (`bin` $twoState^)? $cond `,` $trueValue `,` $falseValue  attr-dict `:` qualified(type($result))
</code></pre><pre tabindex=0><code>  %0 = mux %pred, %tvalue, %fvalue : i4
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-22>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-25>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cond</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>trueValue</code></td><td>any type</td></tr><tr><td style=text-align:center><code>falseValue</code></td><td>any type</td></tr></tbody></table><h4 id=results-25>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>any type</td></tr></tbody></table><h3 id=combnand-heircombnandop-1><code>comb.nand</code> (heir::comb::NandOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nand` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-23>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-26>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-26>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combnor-heircombnorop-1><code>comb.nor</code> (heir::comb::NorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.nor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-24>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-27>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-27>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combor-heircomborop-1><code>comb.or</code> (heir::comb::OrOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.or` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-25>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-28>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-28>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combparity-heircombparityop-1><code>comb.parity</code> (heir::comb::ParityOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.parity` (`bin` $twoState^)? $input attr-dict `:` qualified(type($input))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-26>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-29>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-29>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combreplicate-heircombreplicateop-1><code>comb.replicate</code> (heir::comb::ReplicateOp)</h3><p><em>Concatenate the operand a constant number of times</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.replicate` $input attr-dict `:` functional-type($input, $result)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-30>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless integer</td></tr></tbody></table><h4 id=results-30>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combtruth_table-heircombtruthtableop-1><code>comb.truth_table</code> (heir::comb::TruthTableOp)</h3><p><em>Return a true/false based on a lookup table</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.truth_table` $inputs `-&gt;` $lookupTable attr-dict
</code></pre><pre tabindex=0><code>  %a = ... : i1
  %b = ... : i1
  %0 = comb.truth_table %a, %b -&gt; 6 : ui4
</code></pre><p>This operation assumes that the lookup table is described as an integer of
2^n bits to fully specify the table. Inputs are sorted MSB -> LSB from left
to right and the offset into <code>lookupTable</code> is computed from them. The
integer containing the truth table value&rsquo;s LSB is the output for the input
&ldquo;all false&rdquo;, and the MSB is the output for the input &ldquo;all true&rdquo;.</p><p>No difference from array_get into an array of constants except for xprop
behavior. If one of the inputs is unknown, but said input doesn&rsquo;t make a
difference in the output (based on the lookup table) the result should not
be &lsquo;x&rsquo; &ndash; it should be the well-known result.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>LUTOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-27>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>lookupTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-31>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of 1-bit signless integer</td></tr></tbody></table><h4 id=results-31>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>1-bit signless integer</td></tr></tbody></table><h3 id=combxnor-heircombxnorop-1><code>comb.xnor</code> (heir::comb::XNorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xnor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-28>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-32>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-32>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h3 id=combxor-heircombxorop-1><code>comb.xor</code> (heir::comb::XorOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `comb.xor` (`bin` $twoState^)? $inputs attr-dict `:` qualified(type($result))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>SameOperandsAndResultType</code>, <code>SameTypeOperands</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-29>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>twoState</code></td><td>::mlir::UnitAttr</td><td>unit attribute</td></tr></table><h4 id=operands-33>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of signless integer</td></tr></tbody></table><h4 id=results-33>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless integer</td></tr></tbody></table><h2 id=comb-additional-definitions>Comb additional definitions</h2><h3 id=icmppredicate-1>ICmpPredicate</h3><p><em>Hw.icmp comparison predicate</em></p><h4 id=cases-1>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>eq</td><td style=text-align:center><code>0</code></td><td>eq</td></tr><tr><td style=text-align:center>ne</td><td style=text-align:center><code>1</code></td><td>ne</td></tr><tr><td style=text-align:center>slt</td><td style=text-align:center><code>2</code></td><td>slt</td></tr><tr><td style=text-align:center>sle</td><td style=text-align:center><code>3</code></td><td>sle</td></tr><tr><td style=text-align:center>sgt</td><td style=text-align:center><code>4</code></td><td>sgt</td></tr><tr><td style=text-align:center>sge</td><td style=text-align:center><code>5</code></td><td>sge</td></tr><tr><td style=text-align:center>ult</td><td style=text-align:center><code>6</code></td><td>ult</td></tr><tr><td style=text-align:center>ule</td><td style=text-align:center><code>7</code></td><td>ule</td></tr><tr><td style=text-align:center>ugt</td><td style=text-align:center><code>8</code></td><td>ugt</td></tr><tr><td style=text-align:center>uge</td><td style=text-align:center><code>9</code></td><td>uge</td></tr><tr><td style=text-align:center>ceq</td><td style=text-align:center><code>10</code></td><td>ceq</td></tr><tr><td style=text-align:center>cne</td><td style=text-align:center><code>11</code></td><td>cne</td></tr><tr><td style=text-align:center>weq</td><td style=text-align:center><code>12</code></td><td>weq</td></tr><tr><td style=text-align:center>wne</td><td style=text-align:center><code>13</code></td><td>wne</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-df73b993320a0b803398dca1b5f7c3cd>7.5 - Jaxite</h1><h1 id=jaxite-dialect>&lsquo;jaxite&rsquo; Dialect</h1><p>The <code>jaxite</code> dialect is an exit dialect for generating py code against the jaxite library API,
using the jaxite parameters and encoding scheme.</p><p>See <a href=https://github.com/google/jaxite>https://github.com/google/jaxite</a></p><h2 id=jaxite-types>Jaxite types</h2><h3 id=paramstype>ParamsType</h3><p><em>The jaxite security params required to perform homomorphic operations.</em></p><p>Syntax: <code>!jaxite.params</code></p><h3 id=pmaplut3tupletype>PmapLut3TupleType</h3><p><em>A tuple of pmap_lut3 args.</em></p><p>Syntax: <code>!jaxite.pmap_lut3_tuple</code></p><h3 id=serverkeysettype>ServerKeySetType</h3><p><em>The jaxite server key set required to perform homomorphic operations.</em></p><p>Syntax: <code>!jaxite.server_key_set</code></p><h2 id=jaxite-ops>Jaxite ops</h2><h3 id=jaxiteconstant-heirjaxiteconstantop><code>jaxite.constant</code> (heir::jaxite::ConstantOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.constant` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>1-bit signless integer</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=jaxitelut3_args-heirjaxitelut3argsop><code>jaxite.lut3_args</code> (heir::jaxite::Lut3ArgsOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.lut3_args` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function is generating tuples for pmap_lut3.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>b</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>c</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>truth_table</code></td><td>8-bit signless integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A tuple of pmap_lut3 args.</td></tr></tbody></table><h3 id=jaxitelut3-heirjaxitelut3op><code>jaxite.lut3</code> (heir::jaxite::Lut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function can be
interpreted as</p><p>truth_table &#187; {c, b, a}</p><p>where {c, b, a} is the unsigned 3-bit integer with bits c, b, a from most
significant bit to least-significant bit.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>a</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>b</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>c</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>truth_table</code></td><td>8-bit signless integer</td></tr><tr><td style=text-align:center><code>serverKeySet</code></td><td>The jaxite server key set required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=jaxitepmap_lut3-heirjaxitepmaplut3op><code>jaxite.pmap_lut3</code> (heir::jaxite::PmapLut3Op)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxite.pmap_lut3` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function is a bacthed Lut3Op.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lut3_args</code></td><td>pmap_lut3_tuples</td></tr><tr><td style=text-align:center><code>serverKeySet</code></td><td>The jaxite server key set required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>params</code></td><td>The jaxite security params required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-63d08712eb5ec0da1ca62003de70e7f1>7.6 - JaxiteWord</h1><h1 id=jaxiteword-dialect>&lsquo;jaxiteword&rsquo; Dialect</h1><p>The <code>jaxiteword</code> dialect is an exit dialect for generating py code against the jaxiteword library API,
using the jaxiteword parameters and encoding scheme.</p><p>See <a href=https://github.com/google/jaxite/jaxite_word>https://github.com/google/jaxite/jaxite_word</a></p><h2 id=jaxiteword-types>JaxiteWord types</h2><h3 id=ccparamstype>CCParamsType</h3><p><em>The CCParams required to create CryptoContext.</em></p><p>Syntax: <code>!jaxiteword.cc_params</code></p><h3 id=ciphertexttype>CiphertextType</h3><p>Syntax:</p><pre tabindex=0><code>!jaxiteword.ciphertext&lt;
  int,   # polys
  int,   # towers
  int   # degrees
&gt;
</code></pre><p>A ciphertext - a three dimensional array.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>polys</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>towers</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>degrees</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h3 id=cryptocontexttype>CryptoContextType</h3><p><em>The CryptoContext required to perform homomorphic operations in JaxiteWord.</em></p><p>Syntax: <code>!jaxiteword.crypto_context</code></p><h3 id=evalkeytype>EvalKeyType</h3><p><em>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in JaxiteWord.</em></p><p>Syntax: <code>!jaxiteword.eval_key</code></p><h3 id=moduluslisttype>ModulusListType</h3><p>Syntax:</p><pre tabindex=0><code>!jaxiteword.modulus_list&lt;
  ::llvm::ArrayRef&lt;::mlir::IntegerAttr&gt;   # modulus_list
&gt;
</code></pre><p>A list of modulus values.</p><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>modulus_list</td><td style=text-align:center><code>::llvm::ArrayRef&lt;::mlir::IntegerAttr></code></td><td></td></tr></tbody></table><h3 id=privatekeytype>PrivateKeyType</h3><p><em>The private key required to decrypt a ciphertext in JaxiteWord.</em></p><p>Syntax: <code>!jaxiteword.private_key</code></p><h3 id=publickeytype>PublicKeyType</h3><p><em>The public key required to encrypt plaintext in JaxiteWord.</em></p><p>Syntax: <code>!jaxiteword.public_key</code></p><h2 id=jaxiteword-ops>JaxiteWord ops</h2><h3 id=jaxitewordadd-heirjaxitewordaddop><code>jaxiteword.add</code> (heir::jaxiteword::AddOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxiteword.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>The operation computed by this function is homomorphic addition.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value_a</code></td><td></td></tr><tr><td style=text-align:center><code>value_b</code></td><td></td></tr><tr><td style=text-align:center><code>modulus_list</code></td><td></td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td></td></tr></tbody></table><h3 id=jaxitewordmake_ciphertext-heirjaxitewordmakeciphertextop><code>jaxiteword.make_ciphertext</code> (heir::jaxiteword::MakeCiphertextOp)</h3><p><em>Create a JaxiteWord ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `jaxiteword.make_ciphertext` $polys `,` $towers `,` $degrees attr-dict `:` type($ciphertext)
</code></pre><p>Creates a JaxiteWord ciphertext with the given dimensions.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>polys</code></td><td>32-bit signless integer</td></tr><tr><td style=text-align:center><code>towers</code></td><td>32-bit signless integer</td></tr><tr><td style=text-align:center><code>degrees</code></td><td>32-bit signless integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-6857a323f6f4a36b66d9290a3b2c84fc>7.7 - Lattigo</h1><h1 id=lattigo-dialect>&rsquo;lattigo&rsquo; Dialect</h1><p>The <code>lattigo</code> dialect is an exit dialect for generating GO code against the Lattigo library API.</p><p>See <a href=https://github.com/tuneinsight/lattigo>https://github.com/tuneinsight/lattigo</a></p><h2 id=lattigo-attributes>Lattigo attributes</h2><h3 id=bgvparametersliteralattr>BGVParametersLiteralAttr</h3><p><em>Literal parameters for Lattigo BGV</em></p><p>Syntax:</p><pre tabindex=0><code>#lattigo.bgv.parameters_literal&lt;
  int,   # logN
  DenseI64ArrayAttr,   # Q
  DenseI64ArrayAttr,   # P
  DenseI32ArrayAttr,   # logQ
  DenseI32ArrayAttr,   # logP
  int64_t   # plaintextModulus
&gt;
</code></pre><p>This attribute represents the literal parameters for Lattigo BGV.</p><p>This is in accordance with <a href=https://pkg.go.dev/github.com/tuneinsight/lattigo/v6@v6.1.0/schemes/bgv#ParametersLiteral>https://pkg.go.dev/github.com/tuneinsight/lattigo/v6@v6.1.0/schemes/bgv#ParametersLiteral</a>
where some field are not present in the current implementation.</p><p>Users must set the polynomial degree (LogN) and the coefficient modulus,
by either setting the Q and P fields to the desired moduli chain,
or by setting the LogQ and LogP fields to the desired moduli sizes.</p><p>Note that for Lattigo, Q/P requires []uint64, where this attribute
only provides int64. We assume user should not select moduli so large
to consider the signedness issue.</p><p>Users must also specify the coefficient modulus in plaintext-space (T).
This modulus must be an NTT-friendly prime in the plaintext space:
it must be equal to 1 modulo 2n where n is the plaintext ring degree
(i.e., the plaintext space has n slots).</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>logN</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>Q</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>P</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logQ</td><td style=text-align:center><code>DenseI32ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logP</td><td style=text-align:center><code>DenseI32ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintextModulus</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=ckksparametersliteralattr>CKKSParametersLiteralAttr</h3><p><em>Literal parameters for Lattigo CKKS</em></p><p>Syntax:</p><pre tabindex=0><code>#lattigo.ckks.parameters_literal&lt;
  int,   # logN
  DenseI64ArrayAttr,   # Q
  DenseI64ArrayAttr,   # P
  DenseI32ArrayAttr,   # logQ
  DenseI32ArrayAttr,   # logP
  int   # logDefaultScale
&gt;
</code></pre><p>This attribute represents the literal parameters for Lattigo CKKS.</p><p>This is in accordance with <a href=https://pkg.go.dev/github.com/tuneinsight/lattigo/v6@v6.1.0/schemes/ckks#ParametersLiteral>https://pkg.go.dev/github.com/tuneinsight/lattigo/v6@v6.1.0/schemes/ckks#ParametersLiteral</a>
where some field are not present in the current implementation.</p><p>Users must set the polynomial degree (LogN) and the coefficient modulus,
by either setting the Q and P fields to the desired moduli chain,
or by setting the LogQ and LogP fields to the desired moduli sizes.</p><p>Note that for Lattigo, Q/P requires []uint64, where this attribute
only provides int64. We assume user should not select moduli so large
to consider the signedness issue.</p><p>Users must also specify a default initial scale for the plaintexts1.</p><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>logN</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>Q</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>P</td><td style=text-align:center><code>DenseI64ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logQ</td><td style=text-align:center><code>DenseI32ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logP</td><td style=text-align:center><code>DenseI32ArrayAttr</code></td><td></td></tr><tr><td style=text-align:center>logDefaultScale</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h2 id=lattigo-types>Lattigo types</h2><h3 id=bgvencodertype>BGVEncoderType</h3><p>Syntax: <code>!lattigo.bgv.encoder</code></p><p>This type represents the encoder for the BGV encryption scheme.</p><h3 id=bgvevaluatortype>BGVEvaluatorType</h3><p>Syntax: <code>!lattigo.bgv.evaluator</code></p><p>This type represents the evaluator for the BGV encryption scheme.</p><h3 id=bgvparametertype>BGVParameterType</h3><p>Syntax: <code>!lattigo.bgv.parameter</code></p><p>This type represents the parameters for the BGV encryption scheme.</p><h3 id=ckksencodertype>CKKSEncoderType</h3><p>Syntax: <code>!lattigo.ckks.encoder</code></p><p>This type represents the encoder for the CKKS encryption scheme.</p><h3 id=ckksevaluatortype>CKKSEvaluatorType</h3><p>Syntax: <code>!lattigo.ckks.evaluator</code></p><p>This type represents the evaluator for the CKKS encryption scheme.</p><h3 id=ckksparametertype>CKKSParameterType</h3><p>Syntax: <code>!lattigo.ckks.parameter</code></p><p>This type represents the parameters for the CKKS encryption scheme.</p><h3 id=rlweciphertexttype>RLWECiphertextType</h3><p>Syntax: <code>!lattigo.rlwe.ciphertext</code></p><p>This type represents the ciphertext for the RLWE encryption scheme.</p><h3 id=rlwedecryptortype>RLWEDecryptorType</h3><p>Syntax: <code>!lattigo.rlwe.decryptor</code></p><p>This type represents the decryptor for the RLWE encryption scheme.</p><h3 id=rlweencryptortype>RLWEEncryptorType</h3><p>Syntax:</p><pre tabindex=0><code>!lattigo.rlwe.encryptor&lt;
  bool   # publicKey
&gt;
</code></pre><p>This type represents the encryptor for the RLWE encryption scheme.</p><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>publicKey</td><td style=text-align:center><code>bool</code></td><td></td></tr></tbody></table><h3 id=rlweevaluationkeysettype>RLWEEvaluationKeySetType</h3><p>Syntax: <code>!lattigo.rlwe.evaluation_key_set</code></p><p>This type represents the evaluation key set for the RLWE encryption scheme.</p><h3 id=rlwegaloiskeytype>RLWEGaloisKeyType</h3><p>Syntax:</p><pre tabindex=0><code>!lattigo.rlwe.galois_key&lt;
  ::mlir::IntegerAttr   # galoisElement
&gt;
</code></pre><p>This type represents the Galois key for the RLWE encryption scheme.</p><p>galoisElement: Enabling the automorphism X -> X^{galoisElement}.</p><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>galoisElement</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td>An Attribute containing a integer value</td></tr></tbody></table><h3 id=rlwekeygeneratortype>RLWEKeyGeneratorType</h3><p>Syntax: <code>!lattigo.rlwe.key_generator</code></p><p>This type represents the key generator for the RLWE encryption scheme.</p><h3 id=rlweplaintexttype>RLWEPlaintextType</h3><p>Syntax: <code>!lattigo.rlwe.plaintext</code></p><p>This type represents the plaintext for the RLWE encryption scheme.</p><h3 id=rlwepublickeytype>RLWEPublicKeyType</h3><p>Syntax: <code>!lattigo.rlwe.public_key</code></p><p>This type represents the public key for the RLWE encryption scheme.</p><h3 id=rlwerelinearizationkeytype>RLWERelinearizationKeyType</h3><p>Syntax: <code>!lattigo.rlwe.relinearization_key</code></p><p>This type represents the relinearization key for the RLWE encryption scheme.</p><h3 id=rlwesecretkeytype>RLWESecretKeyType</h3><p>Syntax: <code>!lattigo.rlwe.secret_key</code></p><p>This type represents the secret key for the RLWE encryption scheme.</p><h2 id=lattigo-ops>Lattigo ops</h2><h3 id=lattigobgvadd_new-heirlattigobgvaddnewop><code>lattigo.bgv.add_new</code> (heir::lattigo::BGVAddNewOp)</h3><p><em>Add two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.add_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation adds two ciphertext values in the Lattigo BGV dialect.</p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvadd-heirlattigobgvaddop><code>lattigo.bgv.add</code> (heir::lattigo::BGVAddOp)</h3><p><em>Add two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation adds two ciphertext values in the Lattigo BGV dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvdecode-heirlattigobgvdecodeop><code>lattigo.bgv.decode</code> (heir::lattigo::BGVDecodeOp)</h3><p><em>Decode a plaintext value in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.decode` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation decodes a plaintext value using the specified encoder in the Lattigo BGV dialect.</p><p>The input value tensor should have elements of integer type.</p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>decoded</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h3 id=lattigobgvencode-heirlattigobgvencodeop><code>lattigo.bgv.encode</code> (heir::lattigo::BGVEncodeOp)</h3><p><em>Encode a plaintext value in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.encode` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation encodes a plaintext value using the specified encoder in the Lattigo BGV dialect.</p><p>The input value tensor should have elements of integer type.</p><p>The <code>scale</code> attribute indicates the scaling factor for encoding.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>scale</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of integer values</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoded</code></td><td></td></tr></tbody></table><h3 id=lattigobgvmul_new-heirlattigobgvmulnewop><code>lattigo.bgv.mul_new</code> (heir::lattigo::BGVMulNewOp)</h3><p><em>Multiply two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.mul_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation multiplies two ciphertext values in the Lattigo BGV dialect.</p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvmul-heirlattigobgvmulop><code>lattigo.bgv.mul</code> (heir::lattigo::BGVMulOp)</h3><p><em>Multiply two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation multiplies two ciphertext values in the Lattigo BGV dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvnew_encoder-heirlattigobgvnewencoderop><code>lattigo.bgv.new_encoder</code> (heir::lattigo::BGVNewEncoderOp)</h3><p><em>Create a new encoder in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.new_encoder` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new encoder for encoding plaintext values in the Lattigo BGV dialect.</p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr></tbody></table><h3 id=lattigobgvnew_evaluator-heirlattigobgvnewevaluatorop><code>lattigo.bgv.new_evaluator</code> (heir::lattigo::BGVNewEvaluatorOp)</h3><p><em>Create a new evaluator in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.new_evaluator` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new evaluator for performing operations on ciphertexts in the Lattigo BGV dialect.</p><p>By default, the evaluator is created with the provided parameters and could execute
operations which does not relying on evaluation keys.</p><p>To support operations that require evaluation keys,
the optional evaluation key set should be provided.</p><p>The scaleInvariant flag is used to indicate whether the evaluator is for B/FV or BGV.
If it is set to true, the evaluator will evaluate operations in B/FV style.</p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>scaleInvariant</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr><tr><td style=text-align:center><code>evaluationKeySet</code></td><td></td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr></tbody></table><h3 id=lattigobgvnew_parameters_from_literal-heirlattigobgvnewparametersfromliteralop><code>lattigo.bgv.new_parameters_from_literal</code> (heir::lattigo::BGVNewParametersFromLiteralOp)</h3><p><em>Create new BGV parameters from a literal in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.new_parameters_from_literal` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates new BGV parameters from a given literal value in the Lattigo BGV dialect.</p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>paramsLiteral</code></td><td>::mlir::heir::lattigo::BGVParametersLiteralAttr</td><td>Literal parameters for Lattigo BGV</td></tr></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h3 id=lattigobgvnew_plaintext-heirlattigobgvnewplaintextop><code>lattigo.bgv.new_plaintext</code> (heir::lattigo::BGVNewPlaintextOp)</h3><p><em>Create a new plaintext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.new_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new plaintext value in the Lattigo BGV dialect.</p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrelinearize_new-heirlattigobgvrelinearizenewop><code>lattigo.bgv.relinearize_new</code> (heir::lattigo::BGVRelinearizeNewOp)</h3><p><em>Relinearize a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.relinearize_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation relinearizes a ciphertext value in the Lattigo BGV dialect.</p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrelinearize-heirlattigobgvrelinearizeop><code>lattigo.bgv.relinearize</code> (heir::lattigo::BGVRelinearizeOp)</h3><p><em>Relinearize a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.relinearize` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation relinearizes a ciphertext value in the Lattigo BGV dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrescale_new-heirlattigobgvrescalenewop><code>lattigo.bgv.rescale_new</code> (heir::lattigo::BGVRescaleNewOp)</h3><p><em>Rescale a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rescale_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rescales a ciphertext value in the Lattigo BGV dialect.</p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrescale-heirlattigobgvrescaleop><code>lattigo.bgv.rescale</code> (heir::lattigo::BGVRescaleOp)</h3><p><em>Rescale a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rescale` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rescales a ciphertext value in the Lattigo BGV dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrotate_columns_new-heirlattigobgvrotatecolumnsnewop><code>lattigo.bgv.rotate_columns_new</code> (heir::lattigo::BGVRotateColumnsNewOp)</h3><p><em>Rotate columns of a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rotate_columns_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rotates the columns of a ciphertext value in the Lattigo BGV dialect.</p><p>Lattigo exposes the SIMD slot of BGV as a N/2 x 2 matrix, where N/2 is the column.</p><p>Offset is valid for both positive and negative number.</p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrotate_columns-heirlattigobgvrotatecolumnsop><code>lattigo.bgv.rotate_columns</code> (heir::lattigo::BGVRotateColumnsOp)</h3><p><em>Rotate columns of a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rotate_columns` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rotates the columns of a ciphertext value in the Lattigo BGV dialect.</p><p>Lattigo exposes the SIMD slot of BGV as a N/2 x 2 matrix, where N/2 is the column.</p><p>Offset is valid for both positive and negative number.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrotate_rows_new-heirlattigobgvrotaterowsnewop><code>lattigo.bgv.rotate_rows_new</code> (heir::lattigo::BGVRotateRowsNewOp)</h3><p><em>Rotate rows of a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rotate_rows_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation swap the rows of a ciphertext value in the Lattigo BGV dialect.</p><p>Lattigo exposes the SIMD slot of BGV as a N/2 x 2 matrix, where 2 is the row.</p><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvrotate_rows-heirlattigobgvrotaterowsop><code>lattigo.bgv.rotate_rows</code> (heir::lattigo::BGVRotateRowsOp)</h3><p><em>Rotate rows of a ciphertext in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.rotate_rows` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation swap the rows of a ciphertext value in the Lattigo BGV dialect.</p><p>Lattigo exposes the SIMD slot of BGV as a N/2 x 2 matrix, where 2 is the row.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvsub_new-heirlattigobgvsubnewop><code>lattigo.bgv.sub_new</code> (heir::lattigo::BGVSubNewOp)</h3><p><em>Subtract two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.sub_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation subtracts one ciphertext value from another in the Lattigo BGV dialect.</p><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigobgvsub-heirlattigobgvsubop><code>lattigo.bgv.sub</code> (heir::lattigo::BGVSubOp)</h3><p><em>Subtract two ciphertexts in the Lattigo BGV dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.bgv.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation subtracts one ciphertext value from another in the Lattigo BGV dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksadd_new-heirlattigockksaddnewop><code>lattigo.ckks.add_new</code> (heir::lattigo::CKKSAddNewOp)</h3><p><em>Add two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.add_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation adds two ciphertext values in the Lattigo CKKS dialect.</p><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksadd-heirlattigockksaddop><code>lattigo.ckks.add</code> (heir::lattigo::CKKSAddOp)</h3><p><em>Add two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation adds two ciphertext values in the Lattigo CKKS dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-21>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksdecode-heirlattigockksdecodeop><code>lattigo.ckks.decode</code> (heir::lattigo::CKKSDecodeOp)</h3><p><em>Decode a plaintext value in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.decode` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation decodes a plaintext value using the specified encoder in the Lattigo CKKS dialect.</p><p>The input value tensor should have elements of float type or complex type.</p><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of floating-point or complex-type values</td></tr></tbody></table><h4 id=results-22>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>decoded</code></td><td>ranked tensor of floating-point or complex-type values</td></tr></tbody></table><h3 id=lattigockksencode-heirlattigockksencodeop><code>lattigo.ckks.encode</code> (heir::lattigo::CKKSEncodeOp)</h3><p><em>Encode a plaintext value in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.encode` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation encodes a plaintext value using the specified encoder in the Lattigo CKKS dialect.</p><p>The input value tensor should have elements of float type or complex type.</p><p>The <code>scale</code> attribute indicates the scaling factor for encoding.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>scale</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-22>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of floating-point or complex-type values</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h4 id=results-23>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoded</code></td><td></td></tr></tbody></table><h3 id=lattigockksmul_new-heirlattigockksmulnewop><code>lattigo.ckks.mul_new</code> (heir::lattigo::CKKSMulNewOp)</h3><p><em>Multiply two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.mul_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation multiplies two ciphertext values in the Lattigo CKKS dialect.</p><h4 id=operands-23>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results-24>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksmul-heirlattigockksmulop><code>lattigo.ckks.mul</code> (heir::lattigo::CKKSMulOp)</h3><p><em>Multiply two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation multiplies two ciphertext values in the Lattigo CKKS dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-24>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-25>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksnew_encoder-heirlattigockksnewencoderop><code>lattigo.ckks.new_encoder</code> (heir::lattigo::CKKSNewEncoderOp)</h3><p><em>Create a new encoder in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.new_encoder` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new encoder for encoding plaintext values in the Lattigo CKKS dialect.</p><h4 id=operands-25>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h4 id=results-26>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encoder</code></td><td></td></tr></tbody></table><h3 id=lattigockksnew_evaluator-heirlattigockksnewevaluatorop><code>lattigo.ckks.new_evaluator</code> (heir::lattigo::CKKSNewEvaluatorOp)</h3><p><em>Create a new evaluator in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.new_evaluator` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new evaluator for performing operations on ciphertexts in the Lattigo CKKS dialect.</p><p>By default, the evaluator is created with the provided parameters and could execute
operations which does not relying on evaluation keys.</p><p>To support operations that require evaluation keys,
the optional evaluation key set should be provided.</p><h4 id=operands-26>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr><tr><td style=text-align:center><code>evaluationKeySet</code></td><td></td></tr></tbody></table><h4 id=results-27>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr></tbody></table><h3 id=lattigockksnew_parameters_from_literal-heirlattigockksnewparametersfromliteralop><code>lattigo.ckks.new_parameters_from_literal</code> (heir::lattigo::CKKSNewParametersFromLiteralOp)</h3><p><em>Create new CKKS parameters from a literal in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.new_parameters_from_literal` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates new CKKS parameters from a given literal value in the Lattigo CKKS dialect.</p><h4 id=attributes-6>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>paramsLiteral</code></td><td>::mlir::heir::lattigo::CKKSParametersLiteralAttr</td><td>Literal parameters for Lattigo CKKS</td></tr></table><h4 id=results-28>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h3 id=lattigockksnew_plaintext-heirlattigockksnewplaintextop><code>lattigo.ckks.new_plaintext</code> (heir::lattigo::CKKSNewPlaintextOp)</h3><p><em>Create a new plaintext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.new_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new plaintext value in the Lattigo CKKS dialect.</p><h4 id=operands-27>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td></td></tr></tbody></table><h4 id=results-29>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h3 id=lattigockksrelinearize_new-heirlattigockksrelinearizenewop><code>lattigo.ckks.relinearize_new</code> (heir::lattigo::CKKSRelinearizeNewOp)</h3><p><em>Relinearize a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.relinearize_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation relinearizes a ciphertext value in the Lattigo CKKS dialect.</p><h4 id=operands-28>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-30>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksrelinearize-heirlattigockksrelinearizeop><code>lattigo.ckks.relinearize</code> (heir::lattigo::CKKSRelinearizeOp)</h3><p><em>Relinearize a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.relinearize` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation relinearizes a ciphertext value in the Lattigo CKKS dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-29>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-31>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksrescale_new-heirlattigockksrescalenewop><code>lattigo.ckks.rescale_new</code> (heir::lattigo::CKKSRescaleNewOp)</h3><p><em>Rescale a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.rescale_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rescales a ciphertext value in the Lattigo CKKS dialect.</p><h4 id=operands-30>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-32>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksrescale-heirlattigockksrescaleop><code>lattigo.ckks.rescale</code> (heir::lattigo::CKKSRescaleOp)</h3><p><em>Rescale a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.rescale` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rescales a ciphertext value in the Lattigo CKKS dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-31>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-33>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksrotate_new-heirlattigockksrotatenewop><code>lattigo.ckks.rotate_new</code> (heir::lattigo::CKKSRotateNewOp)</h3><p><em>Rotate slots of a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.rotate_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rotates slots of a ciphertext value in the Lattigo CKKS dialect.</p><p>For vanilla CKKS, the maximum number of slots is N/2 with each slot being complex number.
Lattigo also support a conjugate-invariant version of CKKS, i.e. the ring is
Z[X + X^{-1} ]/(X^N+1), which allows for a maximum of N slots with each slot being real number.</p><p>Offset is valid for both positive and negative number.</p><h4 id=attributes-7>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-32>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-34>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockksrotate-heirlattigockksrotateop><code>lattigo.ckks.rotate</code> (heir::lattigo::CKKSRotateOp)</h3><p><em>Rotate slots of a ciphertext in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.rotate` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation rotates slots of a ciphertext value in the Lattigo CKKS dialect.</p><p>For vanilla CKKS, the maximum number of slots is N/2 with each slot being complex number.
Lattigo also support a conjugate-invariant version of CKKS, i.e. the ring is
Z[X + X^{-1} ]/(X^N+1), which allows for a maximum of N slots with each slot being real number.</p><p>Offset is valid for both positive and negative number.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=attributes-8>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>offset</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-33>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-35>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockkssub_new-heirlattigockkssubnewop><code>lattigo.ckks.sub_new</code> (heir::lattigo::CKKSSubNewOp)</h3><p><em>Subtract two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.sub_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation subtracts one ciphertext value from another in the Lattigo CKKS dialect.</p><h4 id=operands-34>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr></tbody></table><h4 id=results-36>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigockkssub-heirlattigockkssubop><code>lattigo.ckks.sub</code> (heir::lattigo::CKKSSubOp)</h3><p><em>Subtract two ciphertexts in the Lattigo CKKS dialect</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.ckks.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation subtracts one ciphertext value from another in the Lattigo CKKS dialect.</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-35>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td></td></tr><tr><td style=text-align:center><code>lhs</code></td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>or</td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-37>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigorlwedecrypt-heirlattigorlwedecryptop><code>lattigo.rlwe.decrypt</code> (heir::lattigo::RLWEDecryptOp)</h3><p><em>Decrypts a ciphertext using RLWE</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.decrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation decrypts a ciphertext using RLWE</p><h4 id=operands-36>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>decryptor</code></td><td></td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td></td></tr></tbody></table><h4 id=results-38>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h3 id=lattigorlwedrop_level_new-heirlattigorlwedroplevelnewop><code>lattigo.rlwe.drop_level_new</code> (heir::lattigo::RLWEDropLevelNewOp)</h3><p><em>Drop level of a ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.drop_level_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=attributes-9>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-37>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td>or</td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-39>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigorlwedrop_level-heirlattigorlwedroplevelop><code>lattigo.rlwe.drop_level</code> (heir::lattigo::RLWEDropLevelOp)</h3><p><em>Drop level of a ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.drop_level` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation drops the level of a ciphertext</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code>result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=attributes-10>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-38>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td>or</td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-40>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigorlweencrypt-heirlattigorlweencryptop><code>lattigo.rlwe.encrypt</code> (heir::lattigo::RLWEEncryptOp)</h3><p><em>Encrypts a plaintext using RLWE</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.encrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation encrypts a plaintext using RLWE</p><h4 id=operands-39>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encryptor</code></td><td></td></tr><tr><td style=text-align:center><code>plaintext</code></td><td></td></tr></tbody></table><h4 id=results-41>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td></td></tr></tbody></table><h3 id=lattigorlwegen_galois_key-heirlattigorlwegengaloiskeyop><code>lattigo.rlwe.gen_galois_key</code> (heir::lattigo::RLWEGenGaloisKeyOp)</h3><p><em>Generates a new RLWE Galois key</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.gen_galois_key` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation generates a new RLWE Galois key</p><p>galoisElement: Enabling the automorphism X -> X^{galoisElement}.</p><h4 id=attributes-11>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>galoisElement</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-40>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>keyGenerator</code></td><td></td></tr><tr><td style=text-align:center><code>secretKey</code></td><td></td></tr></tbody></table><h4 id=results-42>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>galoisKey</code></td><td></td></tr></tbody></table><h3 id=lattigorlwegen_key_pair-heirlattigorlwegenkeypairop><code>lattigo.rlwe.gen_key_pair</code> (heir::lattigo::RLWEGenKeyPairOp)</h3><p><em>Generates a new RLWE key pair</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.gen_key_pair` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation generates a new RLWE key pair</p><h4 id=operands-41>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>keyGenerator</code></td><td></td></tr></tbody></table><h4 id=results-43>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>secretKey</code></td><td></td></tr><tr><td style=text-align:center><code>publicKey</code></td><td></td></tr></tbody></table><h3 id=lattigorlwegen_relinearization_key-heirlattigorlwegenrelinearizationkeyop><code>lattigo.rlwe.gen_relinearization_key</code> (heir::lattigo::RLWEGenRelinearizationKeyOp)</h3><p><em>Generates a new RLWE relinearization key</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.gen_relinearization_key` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation generates a new RLWE relinearization key</p><h4 id=operands-42>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>keyGenerator</code></td><td></td></tr><tr><td style=text-align:center><code>secretKey</code></td><td></td></tr></tbody></table><h4 id=results-44>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>relinearizationKey</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenegate_new-heirlattigorlwenegatenewop><code>lattigo.rlwe.negate_new</code> (heir::lattigo::RLWENegateNewOp)</h3><p><em>Negate a ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.negate_new` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands-43>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td>or</td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr></tbody></table><h4 id=results-45>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenegate-heirlattigorlwenegateop><code>lattigo.rlwe.negate</code> (heir::lattigo::RLWENegateOp)</h3><p><em>Negate of a ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.negate` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation negates a ciphertext</p><p>The result will be written to the <code>inplace</code> operand. The <code>output</code> result is
a transitive reference to the <code>inplace</code> operand for sake of the MLIR SSA form.</p><p>Interfaces: <code>InplaceOpInterface</code></p><h4 id=operands-44>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluator</code></td><td>or</td></tr><tr><td style=text-align:center><code>input</code></td><td></td></tr><tr><td style=text-align:center><code>inplace</code></td><td></td></tr></tbody></table><h4 id=results-46>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenew_decryptor-heirlattigorlwenewdecryptorop><code>lattigo.rlwe.new_decryptor</code> (heir::lattigo::RLWENewDecryptorOp)</h3><p><em>Creates a new RLWE decryptor</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.new_decryptor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new RLWE decryptor</p><h4 id=operands-45>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>or</td></tr><tr><td style=text-align:center><code>secretKey</code></td><td></td></tr></tbody></table><h4 id=results-47>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>decryptor</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenew_encryptor-heirlattigorlwenewencryptorop><code>lattigo.rlwe.new_encryptor</code> (heir::lattigo::RLWENewEncryptorOp)</h3><p><em>Creates a new RLWE encryptor</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.new_encryptor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation creates a new RLWE encryptor</p><h4 id=operands-46>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>or</td></tr><tr><td style=text-align:center><code>encryptionKey</code></td><td>or</td></tr></tbody></table><h4 id=results-48>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>encryptor</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenew_evaluation_key_set-heirlattigorlwenewevaluationkeysetop><code>lattigo.rlwe.new_evaluation_key_set</code> (heir::lattigo::RLWENewEvaluationKeySetOp)</h3><p><em>Generates a new RLWE evaluation key set</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.new_evaluation_key_set` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation generates a new RLWE evaluation key set</p><h4 id=operands-47>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>keys</code></td><td>variadic of any type</td></tr></tbody></table><h4 id=results-49>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluationKeySet</code></td><td></td></tr></tbody></table><h3 id=lattigorlwenew_key_generator-heirlattigorlwenewkeygeneratorop><code>lattigo.rlwe.new_key_generator</code> (heir::lattigo::RLWENewKeyGeneratorOp)</h3><p><em>Generates a new RLWE key generator</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lattigo.rlwe.new_key_generator` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This operation generates a new RLWE key generator</p><h4 id=operands-48>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>or</td></tr></tbody></table><h4 id=results-50>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>keyGenerator</code></td><td></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c5dda3cb8e694541eacbee638af7317d>7.8 - LWE</h1><h1 id=lwe-dialect>&rsquo;lwe&rsquo; Dialect</h1><p>The <code>lwe</code> dialect is a dialect for concepts related to cryptosystems
in the Learning With Errors (LWE) family.</p><p>See <a href=https://en.wikipedia.org/wiki/Learning_with_errors>Wikipedia</a>
for an overview of LWE and the related
<a href=https://en.wikipedia.org/wiki/Ring_learning_with_errors>RLWE</a>
problem.</p><p>While one might expect this dialect to contain types along the lines
of LWE and RLWE ciphertexts, and operations like encryption, decryption,
adding and multiplying ciphertexts, these concepts are not centralized
here because they are too scheme-specific.</p><p>Instead, this dialect provides attributes that can be attached to tensors
of integer or <code>poly.poly</code> types, which indicate that they are semantically
LWE and RLWE ciphertexts, respectively.</p><h2 id=lwe-attributes>LWE attributes</h2><h3 id=applicationdataattr>ApplicationDataAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.application_data&lt;
  mlir::Type,   # message_type
  Attribute   # overflow
&gt;
</code></pre><p>An attribute describing the semantics of the underlying application data.</p><p>The <code>messageType</code> parameter is used to describe the type and bits of the
original application data, e.g. i1, i32, f32. This type is later mapped
into the plaintext space of an FHE scheme by embedding, scaling, or other
techniques.</p><p>This attribute also contains information about the overflow semantics of the
data in the application. By default, we assume that the application program
was written so that the overflow is not expected and the overflow attribute
can can be <code>no_overflow</code>. For LWE-based CGGI ciphertexts, the overflow
attribute will usually be <code>preserve_overflow</code>, since messages will overflow
into padding bits.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>message_type</td><td style=text-align:center><code>mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>overflow</td><td style=text-align:center><code>Attribute</code></td><td></td></tr></tbody></table><h3 id=ciphertextspaceattr>CiphertextSpaceAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.ciphertext_space&lt;
  ::mlir::heir::polynomial::RingAttr,   # ring
  ::mlir::heir::lwe::LweEncryptionType,   # encryption_type
  unsigned   # size
&gt;
</code></pre><p>An attribute describing the ciphertext space and the transformation from
plaintext space to ciphertext space of an FHE scheme.</p><p>The ciphertext space information includes the ring attribute, describing the
space that the ciphertext elements belong to. The ring attribute contains a
coefficient type attribute that describes the semantics of the coefficient.
For example, a ring modulo $1 + x^1024$ with coefficients modulo $q =
298374$ will be described as</p><pre tabindex=0><code>!cmod = !mod_arith.int&lt;298374 : i64&gt;
#ring = #polynomial.ring&lt;coefficientType = !cmod, polynomialModulus = &lt;1 + x**1024&gt;&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = lsb&gt;
</code></pre><p>Ciphertexts using an RNS representation for $q$ will use an RNS type in
their ring&rsquo;s coefficient type attribute.</p><pre tabindex=0><code>!limb1 = !mod_arith.int&lt;2251799814045697 : i64&gt;
!limb2 = !mod_arith.int&lt;65537 : i64&gt;
#rns_mod = !rns.rns&lt;!limb1, !limb2&gt;
#ring = #polynomial.ring&lt;coefficientType = #rns_mod, polynomialModulus = &lt;1 + x**1024&gt;&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = lsb&gt;
</code></pre><p>Scalar LWE ciphertexts (like those used in CGGI) use an ideal polynomial of
degree 1, $x$. CGGI ciphertexts will typically use a power of two modulus
and may use a native integer type for its coefficient modulus.</p><pre tabindex=0><code>#ring = #polynomial.ring&lt;coefficientType = i32, polynomialModulus = &lt;1 + x**1024&gt;&gt;
#ciphertext_space = #lwe.ciphertext_space&lt;ring = #ring, encryption_type = lsb&gt;
</code></pre><p>The ciphertext encoding info is used to describe the way the plaintext data
is encoded into the ciphertext (in the MSB, LSB, or mixed).</p><p>The <code>size</code> parameter is used to describe the number of polynomials
comprising the ciphertext. This is typically 2 for RLWE ciphertexts that
are made up of an $(a, b)$ pair and greater than 2 for LWE instances. For
example, after an RLWE multiplication of two size 2 ciphertexts,
the ciphertext&rsquo;s size will be 3.</p><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr><tr><td style=text-align:center>encryption_type</td><td style=text-align:center><code>::mlir::heir::lwe::LweEncryptionType</code></td><td></td></tr><tr><td style=text-align:center>size</td><td style=text-align:center><code>unsigned</code></td><td></td></tr></tbody></table><h3 id=coefficientencodingattr>CoefficientEncodingAttr</h3><p><em>An encoding of cleartexts directly as coefficients.</em></p><p>Syntax:</p><pre tabindex=0><code>#lwe.coefficient_encoding&lt;
  int64_t   # scaling_factor
&gt;
</code></pre><p>A coefficient encoding of a list of integers asserts that the coefficients
of the polynomials contain the integers, with the same semantics as
<code>constant_coefficient_encoding</code> for per-coefficient encodings.</p><p>A <code>scaling_factor</code> is optionally applied on the scalar when converting from
a rounded floating point to an integer.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.coefficient_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=constantcoefficientencodingattr>ConstantCoefficientEncodingAttr</h3><p><em>An encoding of a scalar in the constant coefficient</em></p><p>Syntax:</p><pre tabindex=0><code>#lwe.constant_coefficient_encoding&lt;
  int64_t   # scaling_factor
&gt;
</code></pre><p>An encoding of a single scalar into the constant coefficient of the plaintext.</p><p>All other coefficients of the plaintext are set to be zero. This encoding is
used to encode scalar LWE ciphertexts where the plaintext space is viewed
as a polynomial ring modulo <code>x</code>.</p><p>The scalar is first multiplied by the <code>scaling_factor</code> and then rounded to
the nearest integer before encoding into the plaintext coefficient.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.constant_coefficient_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=fullcrtpackingencodingattr>FullCRTPackingEncodingAttr</h3><p><em>An encoding of cleartexts via CRT slots.</em></p><p>Syntax:</p><pre tabindex=0><code>#lwe.full_crt_packing_encoding&lt;
  int64_t   # scaling_factor
&gt;
</code></pre><p>This encoding maps a list of integers via the Chinese Remainder Theorem (CRT) into the plaintext space.</p><p>Given a ring with irreducible ideal polynomial <code>f(x)</code> and coefficient
modulus <code>q</code>, <code>f(x)</code> can be decomposed modulo <code>q</code> into a direct product of
lower-degree polynomials. This allows full SIMD-style homomorphic operations
across the slots formed from each factor.</p><p>This attribute can only be used in the context of on full CRT packing, where
the polynomial <code>f(x)</code> splits completely (into linear factors) and the number
of slots equals the degree of <code>f(x)</code>. This happens when <code>q</code> is prime and <code>q = 1 mod n</code>.</p><p>A <code>scaling_factor</code> is optionally applied on the scalar when converting from
a rounded floating point to an integer.</p><p>Example:</p><pre tabindex=0><code>#coeff_encoding = #lwe.full_crt_packing_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=inversecanonicalencodingattr>InverseCanonicalEncodingAttr</h3><p><em>An encoding of cleartexts via the inverse canonical embedding.</em></p><p>Syntax:</p><pre tabindex=0><code>#lwe.inverse_canonical_encoding&lt;
  int64_t   # scaling_factor
&gt;
</code></pre><p>Let $n$ be the degree of the polynomials in the plaintext space. An
&ldquo;inverse_canonical_encoding&rdquo; of a list of real or complex values
$v_1, \dots, v_{n/2}$ is (almost) the inverse of the following decoding
map.</p><p>Define a map $\tau_N$ that maps a polynomial $p \in \mathbb{Z}[x] / (x^N + 1)
\to \mathbb{C}^{N/2}$ by evaluating it at the following $N/2$ points,
where $\omega = e^{2 \pi i / 2N}$ is the primitive $2N$th root of unity:</p><p>[
\omega, \omega^3, \omega^5, \dots, \omega^{N-1}
]</p><p>Then the complete decoding operation is $\textup{Decode}(p) =
(1/\Delta)\tau_N(p)$, where $\Delta$ is a scaling parameter and $\tau_N$ is
the truncated canonical embedding above. The encoding operation is the
inverse of the decoding operation, with some caveats explained below.</p><p>The map $\tau_N$ is derived from the so-called <em>canonical embedding</em>
$\tau$, though in the standard canonical embedding, we evaluate at all odd
powers of the root of unity, $\omega, \omega^3, \dots, \omega^{2N-1}$. For
polynomials in the slightly larger space $\mathbb{R}[x] / (x^N + 1)$, the
image of the canonical embedding is the subspace $H \subset \mathbb{C}^N$
defined by tuples $(z_1, \dots, z_N)$ such that $\overline{z_i} =
\overline{z_{N-i+1}}$. Note that this property holds because polynomial
evaluation commutes with complex conjugates, and the second half of the
roots of unity evaluate are complex conjugates of the first half. The
converse, that any such tuple with complex conjugate symmetry has an
inverse under $\tau$ with all real coefficients, makes $\tau$ is a
bijection onto $H$. $\tau$ and its inverse are explicitly computable as
discrete Fourier Transforms.</p><p>Because of the symmetry in canonical embedding for real polynomials, inputs
to this encoding can be represented as a list of $N/2$ complex points, with
the extra symmetric structure left implicit. $\tau_N$ and its inverse can
also be explicitly computed without need to expand the vectors to length
$N$.</p><p>The rounding step is required to invert the decoding because, while
cleartexts must be (implicitly) in the subspace $H$, they need not be the
output of $\tau_N$ for an <em>integer</em> polynomial. The rounding step ensures
we can use integer polynomial plaintexts for the FHE operations. There are
multiple rounding mechanisms, and this attribute does not specify which is
used, because in theory two ciphertexts that have used different roundings
are still compatible, though they may have different noise growth patterns.</p><p>The scaling parameter $\Delta$ is specified by the <code>scaling_factor</code>, which
are applied coefficient-wise using the same semantics as the
<code>constant_coefficient_encoding</code>.</p><p>A typical flow for the CKKS scheme using this encoding would be to apply an
inverse FFT operation to invert the canonical embedding to be a polynomial
with real coefficients, then encrypt scale the resulting polynomial&rsquo;s
coefficients according to the scaling parameters, then round to get integer
coefficients.</p><p>Example:</p><pre tabindex=0><code>#canonical_encoding = #lwe.inverse_canonical_encoding&lt;scaling_factor=10000&gt;
</code></pre><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>scaling_factor</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=keyattr>KeyAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.key&lt;
  int   # slot_index
&gt;
</code></pre><p>An attribute describing the key with which the message is currently
encrypted.</p><p>The key attribute describes the key with which the message is currently
encrypted and decryption can be performed. For example, if the decryption of
a ciphertext $c = (c_0(x), c_1(x))$ is performed by computing the inner
product $(c_0(x), c_1(x)) \cdot (1, s(x))$ then the key is $(1, s(x))$.</p><p>The <code>slot_index</code> describes the key after using a Galois automorphism to
rotate the plaintext slots by <code>slot_index</code>. This will correspond to an
action $\phi_k: x \rightarrow x^k$ for some <code>k</code> that depends on the
structure of the Galois group for the chosen scheme parameters. The
corresponding key will have a new basis $(1, s(x^(k)))$.</p><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>slot_index</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h3 id=moduluschainattr>ModulusChainAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.modulus_chain&lt;
  ::llvm::ArrayRef&lt;mlir::IntegerAttr&gt;,   # elements
  int   # current
&gt;
</code></pre><p>An attribute describing the elements of the modulus chain of an RLWE scheme.</p><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>elements</td><td style=text-align:center><code>::llvm::ArrayRef&lt;mlir::IntegerAttr></code></td><td></td></tr><tr><td style=text-align:center>current</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h3 id=nooverflowattr>NoOverflowAttr</h3><p><em>An attribute informing that application data never overflows.</em></p><p>Syntax: <code>#lwe.no_overflow</code></p><p>This attribute informs lowerings that a program is written so that the message data
will never overflow beyond the message type.</p><p>// FIXME: Have a separate WraparoundOverflow, which lowers the same as NoOverflow?</p><h3 id=plaintextspaceattr>PlaintextSpaceAttr</h3><p>Syntax:</p><pre tabindex=0><code>#lwe.plaintext_space&lt;
  ::mlir::heir::polynomial::RingAttr,   # ring
  Attribute   # encoding
&gt;
</code></pre><p>An attribute describing the plaintext space and the transformation from
application data to plaintext space of an FHE scheme.</p><p>The plaintext space information is the ring structure, which contains the
plaintext modulus $t$, which may be a power of two in the case of CGGI
ciphertexts, or a prime power for RLWE. LWE ciphertexts use the
ideal polynomial of degree 1 $x$. The plaintext modulus used in LWE-based
CGGI plaintexts describes the full message space $\mathbb{Z}_p$ including
the padding bits. The application data info attribute describes the space
$\mathbb{Z}_p&rsquo;$ where $p&rsquo; &lt; p$ that the underlying message belongs to.</p><p>For RLWE schemes, this will include the type of encoding of application data
integers to a plaintext space <code>Z_p[X]/X^N + 1</code>. This may be a constant
coefficient encoding, CRT-based packing for SIMD semantics, or other slot
packing. When using full CRT packing, the ring must split into linear
factors. The CKKS scheme will also include attributes describing the complex
encoding, including the scaling factor, which will change after
multiplication and rescaling.</p><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr><tr><td style=text-align:center>encoding</td><td style=text-align:center><code>Attribute</code></td><td>An encoding of a scalar in the constant coefficient or An encoding of cleartexts directly as coefficients. or An encoding of cleartexts via the inverse canonical embedding. or An encoding of cleartexts via CRT slots.</td></tr></tbody></table><h3 id=preserveoverflowattr>PreserveOverflowAttr</h3><p><em>An attribute informing that application data overflows in the message type.</em></p><p>Syntax: <code>#lwe.preserve_overflow</code></p><p>This attribute informs lowerings that a program is written so that the message data
may overflow beyond the message type.</p><h2 id=lwe-types>LWE types</h2><h3 id=lweciphertexttype>LWECiphertextType</h3><p><em>A ciphertext type</em></p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_ciphertext&lt;
  ApplicationDataAttr,   # application_data
  PlaintextSpaceAttr,   # plaintext_space
  CiphertextSpaceAttr,   # ciphertext_space
  KeyAttr,   # key
  ModulusChainAttr   # modulus_chain
&gt;
</code></pre><p>An LWE ciphertext will always contain the application data, plaintext space,
ciphertext space, and key information.</p><p>A modulus chain is optionally specified for parameter choices in RLWE
schemes that use more than one of modulus. When no modulus chain is
specified, the ciphertext modulus is always the ciphertext ring&rsquo;s
coefficient modulus.</p><h4 id=parameters-9>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>application_data</td><td style=text-align:center><code>ApplicationDataAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintext_space</td><td style=text-align:center><code>PlaintextSpaceAttr</code></td><td></td></tr><tr><td style=text-align:center>ciphertext_space</td><td style=text-align:center><code>CiphertextSpaceAttr</code></td><td></td></tr><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>modulus_chain</td><td style=text-align:center><code>ModulusChainAttr</code></td><td></td></tr></tbody></table><h3 id=lweplaintexttype>LWEPlaintextType</h3><p><em>A plaintext type</em></p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_plaintext&lt;
  ApplicationDataAttr,   # application_data
  PlaintextSpaceAttr   # plaintext_space
&gt;
</code></pre><h4 id=parameters-10>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>application_data</td><td style=text-align:center><code>ApplicationDataAttr</code></td><td></td></tr><tr><td style=text-align:center>plaintext_space</td><td style=text-align:center><code>PlaintextSpaceAttr</code></td><td></td></tr></tbody></table><h3 id=lwepublickeytype>LWEPublicKeyType</h3><p><em>A public key for LWE</em></p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_public_key&lt;
  KeyAttr,   # key
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><h4 id=parameters-11>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr></tbody></table><h3 id=lwesecretkeytype>LWESecretKeyType</h3><p><em>A secret key for LWE</em></p><p>Syntax:</p><pre tabindex=0><code>!lwe.lwe_secret_key&lt;
  KeyAttr,   # key
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><h4 id=parameters-12>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>key</td><td style=text-align:center><code>KeyAttr</code></td><td></td></tr><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td></td></tr></tbody></table><h2 id=lwe-ops>LWE ops</h2><h3 id=lweadd-heirlweaddop><code>lwe.add</code> (heir::lwe::AddOp)</h3><p><em>Add two LWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.add` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lweencode-heirlweencodeop><code>lwe.encode</code> (heir::lwe::EncodeOp)</h3><p><em>Encode an integer to yield an LWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.encode` $input attr-dict `:` qualified(type($input)) `to` qualified(type($output))
</code></pre><p>Encode an integer to yield an LWE plaintext.</p><p>This op uses an overflow attribute to indicate the overflow semantics. For
CGGI ciphertexts, this will typically be <code>preserve_overflow</code> to indicate
that the message bits can overflow into the carry bit space.</p><p>The LWE plaintext ring is constructed with a plaintext bit width using <code>plaintext_bits</code> and a
polynomial modulus of <code>x</code>.</p><p>Examples:</p><pre tabindex=0><code>%Y = lwe.encode %value {overflow = #overflow, plaintext_bits = 3}: i1 to !lwe.lwe_plaintext&lt;application_data = #app_data, plaintext_space = #space&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>plaintext_bits</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr><tr><td><code>overflow</code></td><td>::mlir::Attribute</td><td>An attribute informing that application data never overflows. or An attribute informing that application data overflows in the message type.</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=lwemul_scalar-heirlwemulscalarop><code>lwe.mul_scalar</code> (heir::lwe::MulScalarOp)</h3><p><em>Multiply an LWE ciphertext by a scalar</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.mul_scalar` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>scalar</code></td><td>integer</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lweradd-heirlweraddop><code>lwe.radd</code> (heir::lwe::RAddOp)</h3><p><em>Add two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.radd` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lweradd_plain-heirlweraddplainop><code>lwe.radd_plain</code> (heir::lwe::RAddPlainOp)</h3><p><em>Addition between RLWE ciphertext-plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.radd_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwerlwe_decode-heirlwerlwedecodeop><code>lwe.rlwe_decode</code> (heir::lwe::RLWEDecodeOp)</h3><p><em>Decode an RLWE plaintext to an underlying type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_decode` $input attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>encoding</code></td><td>::mlir::Attribute</td><td>An encoding of a scalar in the constant coefficient or An encoding of cleartexts directly as coefficients. or An encoding of cleartexts via the inverse canonical embedding. or An encoding of cleartexts via CRT slots.</td></tr><tr><td><code>ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A plaintext type</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table><h3 id=lwerlwe_decrypt-heirlwerlwedecryptop><code>lwe.rlwe_decrypt</code> (heir::lwe::RLWEDecryptOp)</h3><p><em>Decrypt an RLWE ciphertext to a RLWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_decrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Decrypt an RLWE ciphertext to yield a RLWE plaintext</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>secret_key</code></td><td>A secret key for LWE</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=lwerlwe_encode-heirlwerlweencodeop><code>lwe.rlwe_encode</code> (heir::lwe::RLWEEncodeOp)</h3><p><em>Encode an integer to yield an RLWE plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_encode` $input attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($output))
</code></pre><p>Encode an integer to yield an RLWE plaintext.</p><p>This op uses a an encoding attribute to encode the bits of the integer into
an RLWE plaintext value that can then be encrypted. CKKS cleartext inputs may
be floating points, and a scaling factor described by the encoding will be
applied.</p><p>Examples:</p><pre tabindex=0><code>%Y = lwe.rlwe_encode %value {encoding = #enc, ring = #ring}: i1 to !lwe.rlwe_plaintext&lt;encoding = #enc, ring = #ring&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>encoding</code></td><td>::mlir::Attribute</td><td>An encoding of a scalar in the constant coefficient or An encoding of cleartexts directly as coefficients. or An encoding of cleartexts via the inverse canonical embedding. or An encoding of cleartexts via CRT slots.</td></tr><tr><td><code>ring</code></td><td>::mlir::heir::polynomial::RingAttr</td><td>an attribute specifying a polynomial ring</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=lwerlwe_encrypt-heirlwerlweencryptop><code>lwe.rlwe_encrypt</code> (heir::lwe::RLWEEncryptOp)</h3><p><em>Encrypt an RLWE plaintext to a RLWE ciphertext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rlwe_encrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Encrypt an RLWE plaintext to yield a RLWE ciphertext.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A plaintext type</td></tr><tr><td style=text-align:center><code>key</code></td><td>A secret key for LWE or A public key for LWE</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=lwermul-heirlwermulop><code>lwe.rmul</code> (heir::lwe::RMulOp)</h3><p><em>Multiplies two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rmul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwermul_plain-heirlwermulplainop><code>lwe.rmul_plain</code> (heir::lwe::RMulPlainOp)</h3><p><em>Multiplication between RLWE ciphertext-plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rmul_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwernegate-heirlwernegateop><code>lwe.rnegate</code> (heir::lwe::RNegateOp)</h3><p><em>Negate a RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rnegate` operands attr-dict `:` type($output)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwersub-heirlwersubop><code>lwe.rsub</code> (heir::lwe::RSubOp)</h3><p><em>Subtract two RLWE ciphertexts</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rsub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultPlaintextTypes</code>, <code>SameOperandsAndResultRings</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwersub_plain-heirlwersubplainop><code>lwe.rsub_plain</code> (heir::lwe::RSubPlainOp)</h3><p><em>Subtraction between RLWE ciphertext-plaintext</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.rsub_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>IsCiphertextPlaintextOp</code>, <code>SameOperandsAndResultPlaintextTypes</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>lwe-plaintext-or-ciphertext-like</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h3 id=lwetrivial_encrypt-heirlwetrivialencryptop><code>lwe.trivial_encrypt</code> (heir::lwe::TrivialEncryptOp)</h3><p><em>Create a trivial encryption of a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.trivial_encrypt` $input attr-dict `:`  qualified(type(operands)) `to` qualified(type(results))
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>ciphertext_bits</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A plaintext type</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=lwereinterpret_application_data-heirlwereinterpretapplicationdataop><code>lwe.reinterpret_application_data</code> (heir::lwe::ReinterpretApplicationDataOp)</h3><p><em>A placeholder cast from one ciphertext type to another</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `lwe.reinterpret_application_data` $input attr-dict `:` qualified(type($input)) `to` qualified(type($output))
</code></pre><p>The <code>cast</code> op is thus used to translate application data (e.g., <code>message_type</code>)
between ciphertexts in particular situations, such as when the bitwidth of the
message type changes, but this change is not observed in the plaintext space,
or when lowering to an API that does not keep track of types.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>lwe-ciphertext-like</td></tr></tbody></table><h2 id=lwe-additional-definitions>LWE additional definitions</h2><h3 id=lweencryptiontype>LweEncryptionType</h3><p><em>An enum attribute representing an encryption method</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>msb</td><td style=text-align:center><code>0</code></td><td>msb</td></tr><tr><td style=text-align:center>lsb</td><td style=text-align:center><code>1</code></td><td>lsb</td></tr><tr><td style=text-align:center>mix</td><td style=text-align:center><code>2</code></td><td>mix</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-024e5f7d26a5dfbbc21bb90c29119ca6>7.9 - MathExt</h1><h1 id=math_ext-dialect>&lsquo;math_ext&rsquo; Dialect</h1><p>Math-related operations we require for HEIR
which do not (yet) exist in upstream <code>math</code>.</p><h2 id=mathext-ops>MathExt ops</h2><h3 id=math_extsign-heirmath_extsignop><code>math_ext.sign</code> (heir::math_ext::SignOp)</h3><p><em>Returns the sign of the input value</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `math_ext.sign` $value attr-dict `:` type($result)
</code></pre><p>Returns -1 if the input is negative, 0 if it is zero, and 1 if it is positive.
The behavior is undefined for NaN inputs.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>signless-integer-like or floating-point-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b15a871dcca009396e70be943220c783>7.10 - Mgmt</h1><h1 id=mgmt-dialect>&lsquo;mgmt&rsquo; Dialect</h1><p>The <code>mgmt</code> dialect contains scheme-agnostic ciphertext management ops
(like relinearize and mod reduce), to enable initial high-level compiler
passes to perform a first pass at parameter selection, while lower-level
passes may refine them with scheme-specific information.</p><h2 id=mgmt-attributes>Mgmt attributes</h2><h3 id=mgmtattr>MgmtAttr</h3><p><em>Container attribute for all mgmt parameter</em></p><p>Syntax:</p><pre tabindex=0><code>#mgmt.mgmt&lt;
  int,   # level
  int,   # dimension
  int64_t   # scale
&gt;
</code></pre><p>This attribute is used to store all mgmt parameters.</p><p>The attribute is a struct with the following fields:</p><ul><li><code>level</code> : the level of the ciphertext, from L to 0</li><li><code>dimension</code> : the dimension of the ciphertext, defaults to 2</li></ul><p>Internally, this attribute is used by secret-to-<scheme>
for determining the level and dimension of the ciphertext.</p><p>It should be populated by &ndash;secret-with-mgmt-<scheme> before
going through the secret-to-<scheme> pass.</p><p>Example:</p><pre tabindex=0><code>#mgmt = #mgmt.mgmt&lt;level = 1&gt; // dimension defaults to 2
#mgmt1 = #mgmt.mgmt&lt;level = 1, dimension = 3&gt;
%0 = secret.generic(%arg0, %arg1 : !secret.secret&lt;i16&gt;) attrs = {mgmt.mgmt = #mgmt} {
   ...
} -&gt; !secret.secret&lt;i16&gt;
</code></pre><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>level</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>dimension</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>scale</td><td style=text-align:center><code>int64_t</code></td><td></td></tr></tbody></table><h3 id=openfheparamsattr>OpenfheParamsAttr</h3><p><em>Container attribute for some OpenFHE-specific parameters</em></p><p>Syntax:</p><pre tabindex=0><code>#mgmt.openfhe_params&lt;
  int,   # evalAddCount
  int   # keySwitchCount
&gt;
</code></pre><p>This attribute is used to store some OpenFHE-specific parameters.</p><p>The attribute is a struct with the following fields:</p><ul><li><code>evalAddCount</code> : param for OpenFHE SetEvalAddCount</li><li><code>keySwitchCount</code> : param for OpenFHE SetKeySwitchCount</li></ul><p>When this attribute presents, the lowering of openfhe pass
will use these parameters to set the corresponding OpenFHE
parameters.</p><p>It should be populated by &ndash;secret-with-mgmt-bgv before
going through the secret-to-bgv bgv-to-openfhe pass.</p><p>Example:</p><pre tabindex=0><code>#openfhe_params = #mgmt.openfhe_params&lt;evalAddCount = 1, keySwitchCount = 1&gt;
</code></pre><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>evalAddCount</td><td style=text-align:center><code>int</code></td><td></td></tr><tr><td style=text-align:center>keySwitchCount</td><td style=text-align:center><code>int</code></td><td></td></tr></tbody></table><h2 id=mgmt-ops>Mgmt ops</h2><h3 id=mgmtadjust_scale-heirmgmtadjustscaleop><code>mgmt.adjust_scale</code> (heir::mgmt::AdjustScaleOp)</h3><p><em>Adjust the scale of the input ciphertext (for BGV and CKKS)</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.adjust_scale` operands attr-dict `:` type($output)
</code></pre><p>This is scheme-agonistic operation that adjust the scale of the input
ciphertext. This is an opaque operation, and the concrete value of the
scale is determined by other methods.</p><p>To distinguish different opaque adjust_scale operations, the <code>id</code> attribute
is used.</p><p>At the time of <code>secret-insert-mgmt-&lt;scheme></code>, the concrete scale
is not known as the scheme parameter is not generated.
Further passes like <code>populate-scale-&lt;scheme></code> is responsible for materializing
the concrete scale when the scheme parameter is known.</p><p>When further lowered, it could be lowered to <code>bgv.mul_plain</code>
or <code>ckks.mul_plain</code> depending on the scheme.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>id</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=mgmtbootstrap-heirmgmtbootstrapop><code>mgmt.bootstrap</code> (heir::mgmt::BootstrapOp)</h3><p><em>Bootstrap the input ciphertext to refresh its noise budget</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.bootstrap` operands attr-dict `:` type($output)
</code></pre><p>This is a scheme-agnostic operation that implies bootstrapping
of the input ciphertext to refresh its noise budget.</p><p>Bootstrapping is a technique used in homomorphic encryption to
reduce the noise in a ciphertext, allowing further operations
to be performed on it without decryption.</p><p>When further lowered, it could be lowered to bgv.bootstrap
or ckks.bootstrap depending on the scheme.</p><p>For the current backend, only ckks.bootstrap is supported.
Further backend may include bgv.bootstrap.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=mgmtinit-heirmgmtinitop><code>mgmt.init</code> (heir::mgmt::InitOp)</h3><p><em>Init the plaintext with mgmt attributes</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.init` operands attr-dict `:` type($output)
</code></pre><p>This is a scheme-agnostic operation that initializes the plaintext
with <code>mgmt</code> attributes.</p><p>Plaintext has multiple sources, e.g. function argument, arith.constant,
tensor.empty, etc. However, they may have multiple uses in HE circuit
and the level/scale information for them may be different, so we could
not annotate them with <code>mgmt</code> attributes directly, as they could not have
more than one annotation.</p><p>Also, <code>mgmt</code> attributes annotated on them may get lost as other optimization
like CSE or constant folding may canonicalize them away.</p><p>To address the problem, for each <em>use</em> of the plaintext, we insert an <code>mgmt.init</code>
operation to initialize the plaintext with <code>mgmt</code> attributes.</p><p>Technical reasons for registering memory effects:</p><p>Register a (bogus) memory effect to prevent CSE from merging this op.
Two mgmt.init ops could be seen as equivalent only if they have the same
MgmtAttr with <em>level/dimension/scale</em> annotated, otherwise we could not
judge whether they are equivalent or not. In practice, we create the op first
and only in later analyses we know whether they are equivalent or not.</p><p>ConditionallySpeculatable is for isSpeculatable check in hoisting canonicalization.</p><p>Traits: <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>MemoryEffectOpInterface (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{MemoryEffects::Write on ::mlir::SideEffects::DefaultResource}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=mgmtlevel_reduce-heirmgmtlevelreduceop><code>mgmt.level_reduce</code> (heir::mgmt::LevelReduceOp)</h3><p><em>Reduce the level of input ciphertext by dropping the last k RNS limbs</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.level_reduce` operands attr-dict `:` type($output)
</code></pre><p>This scheme-agonistic operation reduces the ciphertext level
by k, as specified by the <code>levelToDrop</code> attribute.</p><p>If <code>levelToDrop</code> is not specified, it defaults to 1.</p><p>Input ciphertext is assumed to be in RNS form when further lowered.</p><p>Later passes may lower this op to <code>bgv.level_reduce</code>
or <code>ckks.level_reduce</code> depending on the scheme.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=mgmtmodreduce-heirmgmtmodreduceop><code>mgmt.modreduce</code> (heir::mgmt::ModReduceOp)</h3><p><em>Modulus switch the input ciphertext down by one limb (RNS assumed)</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.modreduce` operands attr-dict `:` type($output)
</code></pre><p>This is scheme-agonistic operation that implies modulus switching/rescaling
by one limb.</p><p>Input ciphertext is assumed to be in RNS form when further lowered.</p><p>When further lowered, it could be lowered to bgv.modulus_switch
or ckks.rescale depending on the scheme.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=mgmtrelinearize-heirmgmtrelinearizeop><code>mgmt.relinearize</code> (heir::mgmt::RelinearizeOp)</h3><p><em>Relinearize the input ciphertext to be <em>linear</em></em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mgmt.relinearize` operands attr-dict `:` type($output)
</code></pre><p>This is scheme-agonistic operation that implies relinearization
of the input ciphertext to be <em>linear</em> (i.e. returns to dimension 2).</p><p>This is used solely by multiplication. For rotation, currently HEIR
assumes relinearization is done internally and does not have a separate
scheme-specific operation for it.</p><p>This accepts a ciphertext with dimension > 2 and returns a ciphertext
with dimension 2. Note that the semantic includes the relinearization
of higher dimension input like input with dimension 4 or higher,
which when materialized should require multiple relinearization keys.</p><p>When further lowered, it could be lowered to bgv.relinearize
or ckks.relinearize depending on the scheme.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>any type</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-75945813f3978b67fb0398cc4f17cb8b>7.11 - ModArith</h1><h1 id=mod_arith-dialect>&lsquo;mod_arith&rsquo; Dialect</h1><p>The <code>mod_arith</code> dialect contains operations used for modulo arithmetic.</p><h2 id=modarith-types>ModArith types</h2><h3 id=modarithtype>ModArithType</h3><p><em>Integer type with modular arithmetic</em></p><p>Syntax:</p><pre tabindex=0><code>!mod_arith.int&lt;
  ::mlir::IntegerAttr   # modulus
&gt;
</code></pre><p><code>mod_arith.int&lt;p></code> represents an element of the ring of integers modulo $p$.
The <code>modulus</code> attribute is the ring modulus, and <code>mod_arith</code> operations lower to
<code>arith</code> operations that produce results in the range <code>[0, modulus)</code>, often called
the <em>canonical representative</em>.</p><p><code>modulus</code> is specified with an integer type suffix, for example,
<code>mod_arith.int&lt;65537 : i32></code>. This corresponds to the storage type for the
modulus, and is <code>i64</code> by default.</p><p>It is required that the underlying integer type should be larger than
twice the modulus (have one extra bit of storage space) to avoid signedness
issues. For example, when <code>modulus == 2 ** 32 - 1</code>, the underlying type
for the modulus should be at least <code>i33</code>, though <code>i64</code> is a natural choice.</p><p>Passes may allow intermediate values that do not always produce a
canonical representative in <code>[0, modulus)</code>. For example, if the machine storage
type is <code>i64</code>, but the <code>modulus</code> fits within an <code>i32</code>, a lowering could
allow intermediate arithmetic values to grow to as large as an <code>i64</code> before
reducing them. However, all passes must ensure that values used outside
the local scope (e.g., function return values or arguments to calls to linked
functions) are appropriately reduced to the canonical representative.
<code>modulus</code> is the modulus the arithmetic working with.</p><p>Examples:</p><pre tabindex=0><code>!Zp1 = !mod_arith.int&lt;7&gt; // implicitly being i64
!Zp2 = !mod_arith.int&lt;65537 : i32&gt;
!Zp3 = !mod_arith.int&lt;536903681 : i64&gt;
</code></pre><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>modulus</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr></tbody></table><h2 id=modarith-ops>ModArith ops</h2><h3 id=mod_arithadd-heirmod_arithaddop><code>mod_arith.add</code> (heir::mod_arith::AddOp)</h3><p><em>Modular addition operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.add` operands attr-dict `:` type($output)
</code></pre><p>Computes modular addition.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith_or_rns-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h3 id=mod_arithbarrett_reduce-heirmod_arithbarrettreduceop><code>mod_arith.barrett_reduce</code> (heir::mod_arith::BarrettReduceOp)</h3><p><em>Compute the first step of the Barrett reduction.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.barrett_reduce` operands attr-dict `:` qualified(type($input))
</code></pre><p>Let $q$ denote a statically known modulus and $b = 4^{w}$, where $w$ is the
smallest bit-width that contains the range $[0, q)$. The Barrett reduce
operation computes <code>barret_reduce x = x - floor(x * floor(b / q) / b) * q</code>.</p><p>Given $0 &lt;= x &lt; q^2$, then this will compute $(x \mod q)$ or $(x \mod q) + q$.</p><p>Traits: <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>modulus</code></td><td>::mlir::IntegerAttr</td><td>arbitrary integer attribute</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer</td></tr></tbody></table><h3 id=mod_arithconstant-heirmod_arithconstantop><code>mod_arith.constant</code> (heir::mod_arith::ConstantOp)</h3><p><em>Define a constant value via an attribute.</em></p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> mod_arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>:</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>ConstantLike</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>value</code></td><td>::mlir::TypedAttr</td><td>TypedAttr instance</td></tr></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithencapsulate-heirmod_arithencapsulateop><code>mod_arith.encapsulate</code> (heir::mod_arith::EncapsulateOp)</h3><p><em>Encapsulate an integer into a mod_arith type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.encapsulate` operands attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>mod_arith.encapsulate</code> converts the integer to be of mod_arith or RNS type.</p><p>Examples:</p><pre tabindex=0><code>mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
mod_arith.encapsulate %c1 : i64 -&gt; mod_arith.int&lt;65537 : i64&gt;
mod_arith.encapsulate %c2 : tensor&lt;4x2xi32&gt; -&gt; tensor&lt;4xrns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt;&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>signless-integer</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h3 id=mod_arithextract-heirmod_arithextractop><code>mod_arith.extract</code> (heir::mod_arith::ExtractOp)</h3><p><em>Extract the integer stored inside mod_arith type</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.extract` operands attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>mod_arith.extract</code> extracts the integer inside the mod_arith or RNS type.</p><p>It is required that the bitwidth of the output (tensor of) integer type is
the same as that of the storage type of the input mod_arith (or RNS) type.</p><p>Examples:</p><pre tabindex=0><code>%m0 = mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
%m1 = mod_arith.encapsulate %c1 : i64 -&gt; mod_arith.int&lt;65537 : i64&gt;
%m2 = mod_arith.encapsulate %c2 : tensor&lt;4x2xi32&gt; -&gt; tensor&lt;4xrns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt;&gt;
%c3 = mod_arith.extract %m0 : mod_arith.int&lt;65537 : i32&gt; -&gt; i32
%c4 = mod_arith.extract %m1 : mod_arith.int&lt;65537 : i64&gt; -&gt; i64
%c5 = mod_arith.extract %m2 : tensor&lt;4xrns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt;&gt; -&gt; tensor&lt;4x2xi32&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer</td></tr></tbody></table><h3 id=mod_arithmac-heirmod_arithmacop><code>mod_arith.mac</code> (heir::mod_arith::MacOp)</h3><p><em>Modular multiplication-and-accumulation operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.mac` operands attr-dict `:` type($output)
</code></pre><p><code>mod_arith.mac x, y, z</code> computes $(x * y) + z$</p><p>Unless otherwise specified, the operation assumes all inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith-like</td></tr><tr><td style=text-align:center><code>acc</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithmod_switch-heirmod_arithmodswitchop><code>mod_arith.mod_switch</code> (heir::mod_arith::ModSwitchOp)</h3><p><em>Change the modulus of a mod_arith</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.mod_switch` $input attr-dict `:` type($input) `to` type($output)
</code></pre><p>The &ldquo;mod_switch&rdquo; operation performs either modulus switching (changing the
modulus of a mod_arith type to a new value by reducing modulo the new
modulus) or CRT decomposition/interpolation.</p><p>A CRT decomposition can handle switching from a mod_arith type to the RNS
modulus when the modulus of the mod_arith type is equal to the product of
the RNS modulus. If the modulus is less than the RNS modulus product, it
treats the input as an element of the larger product space via an injection.</p><p>Examples:</p><pre tabindex=0><code>mod_arith.mod_switch %c0 : mod_arith.int&lt;65537 : i32&gt; to mod_arith.int&lt;65539 : i32&gt;
mod_arith.mod_switch %c0 : mod_arith.int&lt;65537 : i32&gt; to mod_arith.int&lt;257 : i32&gt;
mod_arith.mod_switch %c0 : mod_arith.int&lt;85 : i32&gt; to rns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt;
mod_arith.mod_switch %c0 : mod_arith.int&lt;45 : i32&gt; to rns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt;
mod_arith.mod_switch %c0 : rns.rns&lt;mod_arith.int&lt;5 : i32&gt;, mod_arith.int&lt;17 : i32&gt;&gt; to mod_arith.int&lt;85 : i32&gt;
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h3 id=mod_arithmul-heirmod_arithmulop><code>mod_arith.mul</code> (heir::mod_arith::MulOp)</h3><p><em>Modular multiplication operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.mul` operands attr-dict `:` type($output)
</code></pre><p>Computes modular multiplication.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith_or_rns-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h3 id=mod_arithreduce-heirmod_arithreduceop><code>mod_arith.reduce</code> (heir::mod_arith::ReduceOp)</h3><p><em>Reduce the mod arith type to its canonical representative</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.reduce` operands attr-dict `:` type($output)
</code></pre><p><code>mod_arith.reduce x</code> produces $y$, the canonical representative in $[0, q)$
such that $x \equiv y \mod q$.</p><p>Examples:</p><pre tabindex=0><code>%c0 = arith.constant 65538 : i32
%m0 = mod_arith.encapsulate %c0 : i32 -&gt; mod_arith.int&lt;65537 : i32&gt;
// mod_arith.extract %m0 produces 65538
%m1 = mod_arith.reduce %m0 : mod_arith.int&lt;65537: i32&gt;
// mod_arith.extract %m1 produces 1
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>mod_arith-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith-like</td></tr></tbody></table><h3 id=mod_arithsubifge-heirmod_arithsubifgeop><code>mod_arith.subifge</code> (heir::mod_arith::SubIfGEOp)</h3><p><em>Compute (x >= y) ? x - y : x.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.subifge` operands attr-dict `:` qualified(type($output))
</code></pre><p>Traits: <code>SameOperandsAndResultType</code></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>signless-integer</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>signless-integer</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>signless-integer</td></tr></tbody></table><h3 id=mod_arithsub-heirmod_arithsubop><code>mod_arith.sub</code> (heir::mod_arith::SubOp)</h3><p><em>Modular subtraction operation</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `mod_arith.sub` operands attr-dict `:` type($output)
</code></pre><p>Computes modular subtraction.</p><p>Unless otherwise specified, the operation assumes both inputs are canonical
representatives and guarantees the output being canonical representative.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>mod_arith_or_rns-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>mod_arith_or_rns-like</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-e397c035ea096bd861aadf40d3fccd0a>7.12 - Openfhe</h1><h1 id=openfhe-dialect>&lsquo;openfhe&rsquo; Dialect</h1><p>The <code>openfhe</code> dialect is an exit dialect for generating c++ code against the OpenFHE library API.</p><p>See <a href=https://github.com/openfheorg/openfhe-development>https://github.com/openfheorg/openfhe-development</a></p><h2 id=openfhe-types>Openfhe types</h2><h3 id=ccparamstype>CCParamsType</h3><p><em>The CCParams required to create CryptoContext.</em></p><p>Syntax: <code>!openfhe.cc_params</code></p><h3 id=cryptocontexttype>CryptoContextType</h3><p><em>The CryptoContext required to perform homomorphic operations in OpenFHE.</em></p><p>Syntax: <code>!openfhe.crypto_context</code></p><h3 id=digitdecompositiontype>DigitDecompositionType</h3><p><em>A precomputed digit decomposition for for EvalFastRotation</em></p><p>Syntax: <code>!openfhe.digit_decomp</code></p><h3 id=evalkeytype>EvalKeyType</h3><p><em>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</em></p><p>Syntax: <code>!openfhe.eval_key</code></p><h3 id=privatekeytype>PrivateKeyType</h3><p><em>The private key required to decrypt a ciphertext in OpenFHE.</em></p><p>Syntax: <code>!openfhe.private_key</code></p><h3 id=publickeytype>PublicKeyType</h3><p><em>The public key required to encrypt plaintext in OpenFHE.</em></p><p>Syntax: <code>!openfhe.public_key</code></p><h2 id=openfhe-ops>Openfhe ops</h2><h3 id=openfheadd_inplace-heiropenfheaddinplaceop><code>openfhe.add_inplace</code> (heir::openfhe::AddInPlaceOp)</h3><p><em>Performs in-place homomorphic addition, modifying lhs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.add_inplace` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfheadd-heiropenfheaddop><code>openfhe.add</code> (heir::openfhe::AddOp)</h3><p><em>OpenFHE add operation of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfheadd_plain-heiropenfheaddplainop><code>openfhe.add_plain</code> (heir::openfhe::AddPlainOp)</h3><p><em>OpenFHE add operation of a ciphertext and a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.add_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type or A plaintext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type or A plaintext type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfheautomorph-heiropenfheautomorphop><code>openfhe.automorph</code> (heir::openfhe::AutomorphOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.automorph` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>evalKey</code></td><td>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhebootstrap-heiropenfhebootstrapop><code>openfhe.bootstrap</code> (heir::openfhe::BootstrapOp)</h3><p><em>OpenFHE bootstrap operation of a ciphertext. (For CKKS)</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.bootstrap` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhedecrypt-heiropenfhedecryptop><code>openfhe.decrypt</code> (heir::openfhe::DecryptOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.decrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=openfheencrypt-heiropenfheencryptop><code>openfhe.encrypt</code> (heir::openfhe::EncryptOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.encrypt` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td>A plaintext type</td></tr><tr><td style=text-align:center><code>encryptionKey</code></td><td>The public key required to encrypt plaintext in OpenFHE. or The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhefast_rotation-heiropenfhefastrotationop><code>openfhe.fast_rotation</code> (heir::openfhe::FastRotationOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.fast_rotation` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>index</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr><tr><td><code>cyclotomicOrder</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>input</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>precomputedDigitDecomp</code></td><td>A precomputed digit decomposition for for EvalFastRotation</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhefast_rotation_precompute-heiropenfhefastrotationprecomputeop><code>openfhe.fast_rotation_precompute</code> (heir::openfhe::FastRotationPrecomputeOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.fast_rotation_precompute` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>input</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A precomputed digit decomposition for for EvalFastRotation</td></tr></tbody></table><h3 id=openfhegen_bootstrapkey-heiropenfhegenbootstrapkeyop><code>openfhe.gen_bootstrapkey</code> (heir::openfhe::GenBootstrapKeyOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_bootstrapkey` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h3 id=openfhegen_context-heiropenfhegencontextop><code>openfhe.gen_context</code> (heir::openfhe::GenContextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_context` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>supportFHE</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr></table><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>The CCParams required to create CryptoContext.</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>context</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr></tbody></table><h3 id=openfhegen_mulkey-heiropenfhegenmulkeyop><code>openfhe.gen_mulkey</code> (heir::openfhe::GenMulKeyOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_mulkey` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h3 id=openfhegen_params-heiropenfhegenparamsop><code>openfhe.gen_params</code> (heir::openfhe::GenParamsOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_params` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Generates the parameters for the OpenFHE scheme.</p><p><code>mulDepth</code> is the depth of the multiplication circuit,
including the bootstrapping depth.</p><p><code>plainMod</code> is the modulus of the plaintext space. If we
are using CKKS, this is 0.</p><p><code>insecure</code> is a flag that determines whether the parameters
are generated securely or not. In Openfhe, this means setting
HEStd_NotSet for security level.</p><p>For other flags, see the OpenFHE documentation in
<a href=https://github.com/openfheorg/openfhe-development/blob/main/src/pke/examples/README.md#description-of-the-cryptocontext-parameters-and-their-restrictions>https://github.com/openfheorg/openfhe-development/blob/main/src/pke/examples/README.md#description-of-the-cryptocontext-parameters-and-their-restrictions</a></p><p>Interfaces: <code>InferTypeOpInterface</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>mulDepth</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>plainMod</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>ringDim</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>batchSize</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>firstModSize</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>scalingModSize</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>evalAddCount</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>keySwitchCount</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>digitSize</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>numLargeDigits</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>maxRelinSkDeg</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr><tr><td><code>insecure</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr><tr><td><code>encryptionTechniqueExtended</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr><tr><td><code>keySwitchingTechniqueBV</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr><tr><td><code>scalingTechniqueFixedManual</code></td><td>::mlir::BoolAttr</td><td>bool attribute</td></tr></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>params</code></td><td>The CCParams required to create CryptoContext.</td></tr></tbody></table><h3 id=openfhegen_rotkey-heiropenfhegenrotkeyop><code>openfhe.gen_rotkey</code> (heir::openfhe::GenRotKeyOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.gen_rotkey` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>indices</code></td><td>::mlir::DenseI64ArrayAttr</td><td>i64 dense array attribute</td></tr></table><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>privateKey</code></td><td>The private key required to decrypt a ciphertext in OpenFHE.</td></tr></tbody></table><h3 id=openfhekey_switch-heiropenfhekeyswitchop><code>openfhe.key_switch</code> (heir::openfhe::KeySwitchOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.key_switch` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>evalKey</code></td><td>The evaluation key required to keyswitch/relinearize/rotate/automorphism operation in OpenFHE.</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhelevel_reduce-heiropenfhelevelreduceop><code>openfhe.level_reduce</code> (heir::openfhe::LevelReduceOp)</h3><p><em>OpenFHE level_reduce operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.level_reduce` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelToDrop</code></td><td>::mlir::IntegerAttr</td><td>64-bit signless integer attribute</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhemake_ckks_packed_plaintext-heiropenfhemakeckkspackedplaintextop><code>openfhe.make_ckks_packed_plaintext</code> (heir::openfhe::MakeCKKSPackedPlaintextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.make_ckks_packed_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of floating-point or integer values</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=openfhemake_packed_plaintext-heiropenfhemakepackedplaintextop><code>openfhe.make_packed_plaintext</code> (heir::openfhe::MakePackedPlaintextOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.make_packed_plaintext` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>value</code></td><td>ranked tensor of integer values</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>plaintext</code></td><td>A plaintext type</td></tr></tbody></table><h3 id=openfhemod_reduce-heiropenfhemodreduceop><code>openfhe.mod_reduce</code> (heir::openfhe::ModReduceOp)</h3><p><em>OpenFHE mod_reduce operation of a ciphertext. (used only for BGV/CKKS)</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mod_reduce` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhemul_const-heiropenfhemulconstop><code>openfhe.mul_const</code> (heir::openfhe::MulConstOp)</h3><p><em>OpenFHE mul operation of a ciphertext and a constant.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_const` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-18>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>constant</code></td><td>64-bit signless integer</td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhemul_no_relin-heiropenfhemulnorelinop><code>openfhe.mul_no_relin</code> (heir::openfhe::MulNoRelinOp)</h3><p><em>OpenFHE mul operation of two ciphertexts without relinearization.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_no_relin` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-19>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhemul-heiropenfhemulop><code>openfhe.mul</code> (heir::openfhe::MulOp)</h3><p><em>OpenFHE mul operation of two ciphertexts with relinearization.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-20>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhemul_plain-heiropenfhemulplainop><code>openfhe.mul_plain</code> (heir::openfhe::MulPlainOp)</h3><p><em>OpenFHE mul operation of a ciphertext and a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.mul_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-21>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>plaintext</code></td><td>A plaintext type</td></tr></tbody></table><h4 id=results-18>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhenegate-heiropenfhenegateop><code>openfhe.negate</code> (heir::openfhe::NegateOp)</h3><p><em>OpenFHE negate operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.negate` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-22>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-19>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfherelin-heiropenfherelinop><code>openfhe.relin</code> (heir::openfhe::RelinOp)</h3><p><em>OpenFHE relinearize operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.relin` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-23>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-20>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfherot-heiropenfherotop><code>openfhe.rot</code> (heir::openfhe::RotOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.rot` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-5>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>index</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-24>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-21>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhesetup_bootstrap-heiropenfhesetupbootstrapop><code>openfhe.setup_bootstrap</code> (heir::openfhe::SetupBootstrapOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.setup_bootstrap` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=attributes-6>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>levelBudgetEncode</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr><tr><td><code>levelBudgetDecode</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-25>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr></tbody></table><h3 id=openfhesquare-heiropenfhesquareop><code>openfhe.square</code> (heir::openfhe::SquareOp)</h3><p><em>OpenFHE square operation of a ciphertext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.square` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-26>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-22>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhesub_inplace-heiropenfhesubinplaceop><code>openfhe.sub_inplace</code> (heir::openfhe::SubInPlaceOp)</h3><p><em>Performs in-place homomorphic subtraction, modifying lhs.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.sub_inplace` operands attr-dict `:` functional-type(operands, results)
</code></pre><h4 id=operands-27>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhesub-heiropenfhesubop><code>openfhe.sub</code> (heir::openfhe::SubOp)</h3><p><em>OpenFHE sub operation of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code>, <code>SameOperandsAndResultRings</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-28>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type</td></tr></tbody></table><h4 id=results-23>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table><h3 id=openfhesub_plain-heiropenfhesubplainop><code>openfhe.sub_plain</code> (heir::openfhe::SubPlainOp)</h3><p><em>OpenFHE sub operation of a ciphertext and a plaintext.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `openfhe.sub_plain` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AllCiphertextTypesMatch</code>, <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-29>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cryptoContext</code></td><td>The CryptoContext required to perform homomorphic operations in OpenFHE.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>A ciphertext type or A plaintext type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>A ciphertext type or A plaintext type</td></tr></tbody></table><h4 id=results-24>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A ciphertext type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-b18fea903e4651113f5317788f1491e1>7.13 - Polynomial</h1><h1 id=polynomial-dialect>&lsquo;polynomial&rsquo; Dialect</h1><p>The Polynomial dialect defines single-variable polynomial types and
operations.</p><p>The simplest use of <code>polynomial</code> is to represent mathematical operations in
a polynomial ring <code>R[x]</code>, where <code>R</code> is another MLIR type like <code>i32</code>.</p><p>More generally, this dialect supports representing polynomial operations in a
quotient ring <code>R[X]/(f(x))</code> for some statically fixed polynomial <code>f(x)</code>.
Two polyomials <code>p(x), q(x)</code> are considered equal in this ring if they have the
same remainder when dividing by <code>f(x)</code>. When a modulus is given, ring operations
are performed with reductions modulo <code>f(x)</code> and relative to the coefficient ring
<code>R</code>.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A constant polynomial in a ring with i32 coefficients and no polynomial modulus
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>3x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A constant polynomial in a ring with i32 coefficients, modulo (x^1024 + 1)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#modulus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#modulus</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>3x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// A constant polynomial in a ring with i32 coefficients, with a polynomial
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// modulus of (x^1024 + 1) and a coefficient modulus of 17.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#modulus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>coeff_ty =</span> <span style=color:#000;font-weight:700>!</span>mod_arith<span style=color:#000;font-weight:700>.</span>int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>17</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#000;font-weight:700>!</span>coeff_ty<span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#modulus</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%a</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>3x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h2 id=polynomial-attributes>Polynomial attributes</h2><h3 id=chebyshevpolynomialattr>ChebyshevPolynomialAttr</h3><p><em>An attribute containing a single-variable polynomial with float coefficients in the Chebyshev basis</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.chebyshev_polynomial&lt;
  ArrayAttr   # coefficients
&gt;
</code></pre><p>This attribute represents a single-variable polynomial with double
precision floating point coefficients, represented in the basis of
Chebyshev polynomials of the first kind.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.chebyshev_polynomial</span><span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4.0</span><span style=color:#000;font-weight:700>]&gt;</span>
</span></span></code></pre></div><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>coefficients</td><td style=text-align:center><code>ArrayAttr</code></td><td></td></tr></tbody></table><h3 id=floatpolynomialattr>FloatPolynomialAttr</h3><p><em>An attribute containing a single-variable polynomial with double precision floating point coefficients</em></p><p>A polynomial attribute represents a single-variable polynomial with double
precision floating point coefficients.</p><p>The polynomial must be expressed as a list of monomial terms, with addition
or subtraction between them. The choice of variable name is arbitrary, but
must be consistent across all the monomials used to define a single
attribute. The order of monomial terms is arbitrary, each monomial degree
must occur at most once.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.float_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1.5</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>polynomial</td><td style=text-align:center><code>FloatPolynomial</code></td><td></td></tr></tbody></table><h3 id=intpolynomialattr>IntPolynomialAttr</h3><p><em>An attribute containing a single-variable polynomial with integer coefficients</em></p><p>A polynomial attribute represents a single-variable polynomial with integer
coefficients, which is used to define the modulus of a <code>RingAttr</code>, as well
as to define constants and perform constant folding for <code>polynomial</code> ops.</p><p>The polynomial must be expressed as a list of monomial terms, with addition
or subtraction between them. The choice of variable name is arbitrary, but
must be consistent across all the monomials used to define a single
attribute. The order of monomial terms is arbitrary, each monomial degree
must occur at most once.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-2>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>polynomial</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomial</code></td><td></td></tr></tbody></table><h3 id=primitiverootattr>PrimitiveRootAttr</h3><p><em>An attribute containing an integer and its degree as a root of unity</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.primitive_root&lt;
  ::mlir::IntegerAttr,   # value
  ::mlir::IntegerAttr   # degree
&gt;
</code></pre><p>A primitive root attribute stores an integer root <code>value</code> and an integer
<code>degree</code>, corresponding to a primitive root of unity of the given degree in
an unspecified ring.</p><p>This is used as an attribute on <code>polynomial.ntt</code> and <code>polynomial.intt</code> ops
to specify the root of unity used in lowering the transform.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.primitive_root</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>value=</span><span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> degree <span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters-3>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr><tr><td style=text-align:center>degree</td><td style=text-align:center><code>::mlir::IntegerAttr</code></td><td></td></tr></tbody></table><h3 id=ringattr>RingAttr</h3><p><em>An attribute specifying a polynomial ring</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.ring&lt;
  Type,   # coefficientType
  ::mlir::heir::polynomial::IntPolynomialAttr   # polynomialModulus
&gt;
</code></pre><p>A ring describes the domain in which polynomial arithmetic occurs. The ring
attribute in <code>polynomial</code> represents the more specific case of polynomials
with a single indeterminate; whose coefficients can be represented by
another MLIR type (<code>coefficientType</code>).</p><p>All semantics pertaining to arithmetic in the ring must be owned by the
coefficient type. For example, if the polynomials are with integer
coefficients taken modulo a prime $p$, then <code>coefficientType</code> must be a
type that represents integers modulo $p$, such as <code>mod_arith&lt;p></code>.</p><p>Additionally, a polynomial ring may specify a <code>polynomialModulus</code>, which
converts polynomial arithmetic to the analogue of modular integer
arithmetic, where each polynomial is represented as its remainder when
dividing by the modulus. For single-variable polynomials, a polynomial
modulus is always specified via a single polynomial.</p><p>An expressive example is polynomials with i32 coefficients, whose
coefficients are taken modulo <code>2**32 - 5</code>, with a polynomial modulus of
<code>x**1024 - 1</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly_mod</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>-1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>1024</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly_mod</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>:</span> polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In this case, the value of a polynomial is always &ldquo;converted&rdquo; to a
canonical form by applying repeated reductions by setting <code>x**1024 = 1</code>
and simplifying.</p><h4 id=parameters-4>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>coefficientType</td><td style=text-align:center><code>Type</code></td><td></td></tr><tr><td style=text-align:center>polynomialModulus</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=typedchebyshevpolynomialattr>TypedChebyshevPolynomialAttr</h3><p><em>A typed chebyshev_polynomial</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.typed_chebyshev_polynomial&lt;
  ::mlir::Type,   # type
  ::mlir::heir::polynomial::ChebyshevPolynomialAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> float<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1.4</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>#poly_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_chebyshev_polynomial</span><span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1.4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7.0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span></code></pre></div><h4 id=parameters-5>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::heir::polynomial::ChebyshevPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=typedfloatpolynomialattr>TypedFloatPolynomialAttr</h3><p><em>A typed float_polynomial</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.typed_float_polynomial&lt;
  ::mlir::Type,   # type
  ::mlir::heir::polynomial::FloatPolynomialAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> float<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1.4</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>#poly_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_float_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1.4</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span></code></pre></div><h4 id=parameters-6>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::heir::polynomial::FloatPolynomialAttr</code></td><td></td></tr></tbody></table><h3 id=typedintpolynomialattr>TypedIntPolynomialAttr</h3><p><em>A typed int_polynomial</em></p><p>Syntax:</p><pre tabindex=0><code>#polynomial.typed_int_polynomial&lt;
  ::mlir::Type,   # type
  ::mlir::heir::polynomial::IntPolynomialAttr   # value
&gt;
</code></pre><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1 x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>#poly_verbose</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1 x</span><span style=color:#000;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>7</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span></code></pre></div><h4 id=parameters-7>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>type</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>value</td><td style=text-align:center><code>::mlir::heir::polynomial::IntPolynomialAttr</code></td><td></td></tr></tbody></table><h2 id=polynomial-types>Polynomial types</h2><h3 id=polynomialtype>PolynomialType</h3><p><em>An element of a polynomial ring.</em></p><p>Syntax:</p><pre tabindex=0><code>!polynomial.polynomial&lt;
  ::mlir::heir::polynomial::RingAttr   # ring
&gt;
</code></pre><p>A type for polynomials in a polynomial quotient ring.</p><h4 id=parameters-8>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>ring</td><td style=text-align:center><code>::mlir::heir::polynomial::RingAttr</code></td><td>an attribute specifying a polynomial ring</td></tr></tbody></table><h2 id=polynomial-ops>Polynomial ops</h2><h3 id=polynomialadd-heirpolynomialaddop><code>polynomial.add</code> (heir::polynomial::AddOp)</h3><p><em>Addition operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.add` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial addition on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// add two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>add <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialconstant-heirpolynomialconstantop><code>polynomial.constant</code> (heir::polynomial::ConstantOp)</h3><p><em>Define a constant polynomial via an attribute.</em></p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>int_poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>int_poly_ty
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>float_poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> float<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1.3e06</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>float_poly_ty
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>InferTypeOpAdaptor</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>value</code></td><td>::mlir::Attribute</td><td>a typed float_polynomial or a typed int_polynomial or a typed chebyshev_polynomial</td></tr></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialeval-heirpolynomialevalop><code>polynomial.eval</code> (heir::polynomial::EvalOp)</h3><p><em>Evaluate a static polynomial attribute at a given SSA value.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.eval` $polynomial `,` $value attr-dict `:` type($value)
</code></pre><p>Evaluates the result of a polynomial specified as a static attribute at
a given SSA value. The result represents the evaluation of the
polynomial at the input value and produces a corresponding scalar
value.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly_ty =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring=</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.typed_int_polynomial</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly_ty
</span></span><span style=display:flex><span><span style=color:#000>%x</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>eval <span style=color:#000>#poly</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%x</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>The coefficient type of the polynomial does not necessarily need to be
the same as the scalar input type. For example, one may evaluate a
square matrix in a polynomial, because the scalar-matrix operation is
well-defined. It is the responsibility of the lowering to determine
if the input is compatible with the polynomial coefficient type.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>polynomial</code></td><td>::mlir::Attribute</td><td>a typed float_polynomial or a typed int_polynomial or a typed chebyshev_polynomial</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>any type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=polynomialfrom_tensor-heirpolynomialfromtensorop><code>polynomial.from_tensor</code> (heir::polynomial::FromTensorOp)</h3><p><em>Creates a polynomial from integer coefficients stored in a tensor.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.from_tensor` $input attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>polynomial.from_tensor</code> creates a polynomial value from a tensor of coefficients.
The input tensor must list the coefficients in degree-increasing order.</p><p>The input one-dimensional tensor may have size at most the degree of the
ring&rsquo;s polynomialModulus generator polynomial, with smaller dimension implying that
all higher-degree terms have coefficient zero.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%two</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>from_elements <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%five</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>from_tensor <span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialintt-heirpolynomialinttop><code>polynomial.intt</code> (heir::polynomial::INTTOp)</h3><p><em>Computes the reverse integer Number Theoretic Transform (NTT).</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.intt` $input attr-dict `:` qualified(type($input)) `-&gt;` type($output)
</code></pre><p><code>polynomial.intt</code> computes the reverse integer Number Theoretic Transform
(INTT) on the input tensor. This is the inverse operation of the
<code>polynomial.ntt</code> operation.</p><p>The input tensor is interpreted as a point-value representation of the
output polynomial at powers of a primitive <code>n</code>-th root of unity (see
<code>polynomial.ntt</code>). The ring of the polynomial is taken from the required
encoding attribute of the tensor.</p><p>The choice of primitive root may be optionally specified.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>root</code></td><td>::mlir::heir::polynomial::PrimitiveRootAttr</td><td>an attribute containing an integer and its degree as a root of unity</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ranked tensor of Integer type with modular arithmetic values</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialkey_switch_inner-heirpolynomialkeyswitchinnerop><code>polynomial.key_switch_inner</code> (heir::polynomial::KeySwitchInnerOp)</h3><p><em>Key switch on an RNS polynomial component</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.key_switch_inner` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Generates a linear ciphertext that, when added to a ciphertext encrypted
under the input key, switches it to a ciphertext encrypted under the output
key.</p><p>This operation is intended to be an internal implementation detail of
higher-level ciphertext operations such as <code>ckks.relinearize</code>, isolated
here for reuse among multiple op lowerings.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>An element of a polynomial ring.</td></tr><tr><td style=text-align:center><code>keySwitchingKey</code></td><td>ranked tensor of An element of a polynomial ring. values</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>constantOutput</code></td><td>An element of a polynomial ring.</td></tr><tr><td style=text-align:center><code>linearOutput</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialleading_term-heirpolynomialleadingtermop><code>polynomial.leading_term</code> (heir::polynomial::LeadingTermOp)</h3><p><em>Compute the leading term of the polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.leading_term` operands attr-dict `:` type($input) `-&gt;` `(` type($degree) `,` type($coefficient) `)`
</code></pre><p>The degree of a polynomial is the largest $k$ for which the coefficient
<code>a_k</code> of <code>x^k</code> is nonzero. The leading term is the term <code>a_k * x^k</code>, which
this op represents as a pair of results. The first is the degree <code>k</code> as an
index, and the second is the coefficient, whose type matches the
coefficient type of the polynomial&rsquo;s ring attribute.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>leading_term <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>degree</code></td><td>index</td></tr><tr><td style=text-align:center><code>coefficient</code></td><td>any type</td></tr></tbody></table><h3 id=polynomialmod_switch-heirpolynomialmodswitchop><code>polynomial.mod_switch</code> (heir::polynomial::ModSwitchOp)</h3><p><em>Change the coefficient type of a polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.mod_switch` $input attr-dict `:` type($input) `to` type($output)
</code></pre><p><code>polynomial.mod_switch</code> changes the coefficient type of a polynomial.</p><p>The two polynomials must have the same polynomialModulus.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring32</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring64</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>mod_switch <span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring64</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialmonic_monomial_mul-heirpolynomialmonicmonomialmulop><code>polynomial.monic_monomial_mul</code> (heir::polynomial::MonicMonomialMulOp)</h3><p><em>Multiply a polynomial by a monic monomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.monic_monomial_mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Multiply a polynomial by a monic monomial, meaning a polynomial of the form
<code>1 * x^k</code> for an index operand <code>k</code>.</p><p>In some special rings of polynomials, such as a ring of polynomials
modulo <code>x^n - 1</code>, <code>monomial_mul</code> can be interpreted as a cyclic shift of
the coefficients of the polynomial. For some rings, this results in
optimized lowerings that involve rotations and rescaling of the
coefficients of the input.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>monomialDegree</code></td><td>index</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialmonomial-heirpolynomialmonomialop><code>polynomial.monomial</code> (heir::polynomial::MonomialOp)</h3><p><em>Create a polynomial that consists of a single monomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.monomial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Construct a polynomial that consists of a single monomial term, from its
degree and coefficient as dynamic inputs.</p><p>The coefficient type of the output polynomial&rsquo;s ring attribute must match
the <code>coefficient</code> input type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%deg</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1023</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>monomial <span style=color:#000>%five</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%deg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>coefficient</code></td><td>any type</td></tr><tr><td style=text-align:center><code>degree</code></td><td>index</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h3 id=polynomialmul-heirpolynomialmulop><code>polynomial.mul</code> (heir::polynomial::MulOp)</h3><p><em>Multiplication operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.mul` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial multiplication on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// multiply two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>mul <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialmul_scalar-heirpolynomialmulscalarop><code>polynomial.mul_scalar</code> (heir::polynomial::MulScalarOp)</h3><p><em>Multiplication by a scalar of the field.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.mul_scalar` operands attr-dict `:` type($polynomial) `,` type($scalar)
</code></pre><p>Multiplies the polynomial operand&rsquo;s coefficients by a given scalar value.
The <code>scalar</code> input must have the same type as the polynomial ring&rsquo;s
coefficientType.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// multiply two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>mul_scalar <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>polynomial</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>scalar</code></td><td>any type</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialntt-heirpolynomialnttop><code>polynomial.ntt</code> (heir::polynomial::NTTOp)</h3><p><em>Computes point-value tensor representation of a polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.ntt` $input attr-dict `:` qualified(type($input)) `-&gt;` type($output)
</code></pre><p><code>polynomial.ntt</code> computes the forward integer Number Theoretic Transform
(NTT) on the input polynomial. It returns a tensor containing a point-value
representation of the input polynomial. The output tensor has shape equal
to the degree of the ring&rsquo;s <code>polynomialModulus</code>. The polynomial&rsquo;s RingAttr
is embedded as the encoding attribute of the output tensor.</p><p>Given an input polynomial <code>F(x)</code> over a ring whose <code>polynomialModulus</code> has
degree <code>n</code>, and a primitive <code>n</code>-th root of unity <code>omega_n</code>, the output is
the list of $n$ evaluations</p><p><code>f[k] = F(omega[n]^k) ; k = {0, ..., n-1}</code></p><p>The choice of primitive root may be optionally specified.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>root</code></td><td>::mlir::heir::polynomial::PrimitiveRootAttr</td><td>an attribute containing an integer and its degree as a root of unity</td></tr></table><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of Integer type with modular arithmetic values</td></tr></tbody></table><h3 id=polynomialsub-heirpolynomialsubop><code>polynomial.sub</code> (heir::polynomial::SubOp)</h3><p><em>Subtraction operation between polynomials.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.sub` operands attr-dict `:` type($result)
</code></pre><p>Performs polynomial subtraction on the operands. The operands may be single
polynomials or containers of identically-typed polynomials, i.e., polynomials
from the same underlying ring with the same coefficient types.</p><p>This op is defined to occur in the ring defined by the ring attribute of
the two operands, meaning the arithmetic is taken modulo the
polynomialModulus of the ring as well as modulo any semantics defined by
the coefficient type.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// subtract two polynomials modulo x^1024 - 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#a40000>+</span> <span style=color:#000;font-weight:700>x**</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> int<span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>5</span> <span style=color:#a40000>-</span> <span style=color:#000;font-weight:700>x</span> <span style=color:#a40000>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>sub <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>SameOperandsAndResultType</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lhs</code></td><td>polynomial-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>polynomial-like</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>result</code></td><td>polynomial-like</td></tr></tbody></table><h3 id=polynomialto_tensor-heirpolynomialtotensorop><code>polynomial.to_tensor</code> (heir::polynomial::ToTensorOp)</h3><p><em>Creates a tensor containing the coefficients of a polynomial.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `polynomial.to_tensor` $input attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p><code>polynomial.to_tensor</code> creates a dense tensor value containing the
coefficients of the input polynomial. The output tensor contains the
coefficients in degree-increasing order.</p><p>Operations that act on the coefficients of a polynomial, such as extracting
a specific coefficient or extracting a range of coefficients, should be
implemented by composing <code>to_tensor</code> with the relevant <code>tensor</code> dialect
ops.</p><p>The output tensor has shape equal to the degree of the polynomial ring
attribute&rsquo;s polynomialModulus, including zeroes.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#poly</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.int_polynomial</span><span style=color:#000;font-weight:700>&lt;x**</span><span style=color:#0000cf;font-weight:700>1024</span> <span style=color:#a40000>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#ring</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType=</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>polynomialModulus=</span><span style=color:#000>#poly</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%two</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%five</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>from_elements <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%two</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%five</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>from_tensor <span style=color:#000>%coeffs</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%tensor</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>to_tensor <span style=color:#000>%poly</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>#ring</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1024x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>An element of a polynomial ring.</td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of any type values</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c9ea40a8d17399f57cdd3c18b53cedef>7.14 - Random</h1><h1 id=random-dialect>&lsquo;random&rsquo; Dialect</h1><p>The <code>random</code> dialect contains operations used to generate random numbers.</p><h2 id=random-types>Random types</h2><h3 id=distributiontype>DistributionType</h3><p><em>A random distribution type</em></p><p>Syntax:</p><pre tabindex=0><code>!random.distribution&lt;
  ::mlir::heir::random::Distribution   # distribution_type
&gt;
</code></pre><p>A generic type, representing a specific random distribution type of either
uniform or gaussian as an attribute ($distribution_type).</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>distribution_type</td><td style=text-align:center><code>::mlir::heir::random::Distribution</code></td><td></td></tr></tbody></table><h3 id=prngtype>PRNGType</h3><p><em>A pseudorandom number generator type</em></p><p>Syntax: <code>!random.prng</code></p><p>A type that provides pseudorandom number generator.</p><h2 id=random-ops>Random ops</h2><h3 id=randomdiscrete_gaussian_distribution-heirrandomdiscretegaussiandistributionop><code>random.discrete_gaussian_distribution</code> (heir::random::DiscreteGaussianDistributionOp)</h3><p><em>Initializes the Discrete Gaussian Distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.discrete_gaussian_distribution` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Initializes the Discrete Gaussian Distribution. The distribution is
initialized with a mean and a standard deviation and pseudorandom generator
that provides the source of the randomness.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>mean</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr><tr><td><code>stddev</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value whose value is non-negative</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A random distribution type</td></tr></tbody></table><h3 id=randomdiscrete_uniform_distribution-heirrandomdiscreteuniformdistributionop><code>random.discrete_uniform_distribution</code> (heir::random::DiscreteUniformDistributionOp)</h3><p><em>Initializes the Discrete Uniform Distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.discrete_uniform_distribution` $input `{` `range` `=` `[` $min `,` $max `]` `}` attr-dict `:` `(` qualified(type($input)) `)` `-&gt;` type($output)
</code></pre><p>Initializes the Discrete Uniform Distribution. The distribution is
initialized with a minimum and a maximum value and pseudo random generator
that provides the source of the randomness. The distribution is inclusive of
the minimum and exclusive of the maximum.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>min</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr><tr><td><code>max</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A random distribution type</td></tr></tbody></table><h3 id=randominit_prng-heirrandominitop><code>random.init_prng</code> (heir::random::InitOp)</h3><p><em>Initializes the pseudorandom number generator with a seed.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.init_prng` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Initializes the PRNG with a seed. The seed is dynamically provided due to
protocols that agree on shared randomness. The PRNG is used to initialized
the random distributions such as the discrete gaussian distribution and the
discrete uniform distribution. This initialization also takes as input a
number of bits that are generated for each number value sampled (num_bits).
For instance, a num_bits of 32 will mean that distributions will generate a
32-bit integer value. We expect that the seed initialization is done statically
and globally once per thread for all distributions; however, if multiple threads are
generating randomness, then seed initialization should be done per thread;
otherwise there is no guarantee of consistent behavior. Thread safety is so
far not considered.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>num_bits</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>seed</code></td><td>index</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A pseudorandom number generator type</td></tr></tbody></table><h3 id=randomsample-heirrandomsampleop><code>random.sample</code> (heir::random::SampleOp)</h3><p><em>Samples from a distribution</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `random.sample` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Samples from the distribution to obtain a random value
or tensor of values.</p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A random distribution type</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h2 id=random-additional-definitions>Random additional definitions</h2><h3 id=distribution>Distribution</h3><p><em>An enum attribute representing a random distribution</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>uniform</td><td style=text-align:center><code>0</code></td><td>uniform</td></tr><tr><td style=text-align:center>gaussian</td><td style=text-align:center><code>1</code></td><td>gaussian</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-aeae60b865ac85372556b396a5a052ce>7.15 - RNS</h1><h1 id=rns-dialect>&lsquo;rns&rsquo; Dialect</h1><p>The <code>rns</code> dialect represents types and ops related to residue number
system (RNS) representations of ring-like types, such as integers or
polynomials decomposed from high-bit width to lower-bit-width prime
moduli. Sometimes RNS is referred to as CRT, for &ldquo;Chinese Remainder
Theorem.&rdquo;</p><p>This dialect is intended to be as generic as possible in terms of its
interaction with standard MLIR. However, because of upstream MLIR
constraints, we do not have the ability to override, say, <code>arith.addi</code>
to operate on an <code>rns</code> type. So such situations require dedicated ops,
canonicalization patterns, etc.</p><h2 id=rns-types>RNS types</h2><h3 id=rnstype>RNSType</h3><p><em>A residue number system representation</em></p><p>Syntax:</p><pre tabindex=0><code>!rns.rns&lt;
  ::llvm::ArrayRef&lt;mlir::Type&gt;   # basisTypes
&gt;
</code></pre><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>basisTypes</td><td style=text-align:center><code>::llvm::ArrayRef&lt;mlir::Type></code></td><td></td></tr></tbody></table><h2 id=rns-ops>RNS ops</h2><h3 id=rnsextract_slice-heirrnsextractsliceop><code>rns.extract_slice</code> (heir::rns::ExtractSliceOp)</h3><p><em>Extracts a slice of RNS limbs</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `rns.extract_slice` $input attr-dict `:` type($input) `-&gt;` type($output)
</code></pre><p>Given an RNS-typed value with $k$ basis types (limbs), extract the slice of
RNS components starting at <code>start</code> and having size <code>size</code>.</p><p>The result type is an RNS type containing the subset of basis types
corresponding to the extracted slice. This is useful for operations like
truncating or partitioning a modulus chain.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>start</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr><tr><td><code>size</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>rns-like</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>rns-like</td></tr></tbody></table><h2 id=rns-additional-definitions>RNS additional definitions</h2><h1 id=typeinterface-definitions>TypeInterface definitions</h1><h2 id=rnsbasistypeinterface-rnsbasistypeinterface>RNSBasisTypeInterface (<code>RNSBasisTypeInterface</code>)</h2><p>This interface is required for a type to be used as a parameter
to an <code>rns</code> type.</p><h3 id=methods>Methods:</h3><h4 id=iscompatiblewith><code>isCompatibleWith</code></h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>isCompatibleWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>mlir</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Type</span> <span style=color:#000>otherRnsBasisType</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>Returns true if this type is compatible with another type in the
same RNS basis. In particular, the set of types used for a single
RNS basis are never equal as types, but instead have some common
attribute that must be checked here. For example, an RNS type where
the basis types are polynomials would return true if the two types
are both polynomial types, even if they have different coefficient
moduli.</p><p>Another example is using mod arith types as the basis types, where
by the nature of chinese reminder theorem, it is required that
the modulus of them must be mutually coprime.</p><p><code>isCompatibleWith</code> must be commutative, in the sense
that <code>type1.isCompatibleWith(type2)</code> if and only if
<code>type2.isCompatibleWith(type1)</code>.</p><p>NOTE: This method <em>must</em> be implemented by the user.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f7ffac8ba93b73b8a62e185ec8643d63>7.16 - Secret</h1><h1 id=secret-dialect>&lsquo;secret&rsquo; Dialect</h1><p>Secret is a dialect for computations that operate on encrypted data.</p><p>Secret is intended to serve as a scheme-agnostic front-end for the HEIR
ecosystem of dialects. It is supposed to be fully interoperable with the
rest of MLIR via secret.generic, while lower-level HEIR dialects would have
custom types for arithmetic on secret integers of various bit widths.</p><h2 id=secret-attributes>Secret attributes</h2><h3 id=kernelattr>KernelAttr</h3><p><em>An annotation describing an implementation kernel for a given op.</em></p><p>Syntax:</p><pre tabindex=0><code>#secret.kernel&lt;
  ::mlir::heir::KernelName,   # name
  bool   # force
&gt;
</code></pre><p>This attribute is used for two purposes:</p><ol><li>To allow the input IR to annotate fixed kernels on ops that the rest of the
compiler must respect.</li><li>To allow the layout optimization pipeline to materialize its kernel selection
decisions to the IR.</li></ol><p>The <code>name</code> field corresponds to an internally-defined kernel name, and if
<code>force</code> is set to <code>true</code>, then the kernel may not be overridden by HEIR&rsquo;s
internal passes.</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>name</td><td style=text-align:center><code>::mlir::heir::KernelName</code></td><td></td></tr><tr><td style=text-align:center>force</td><td style=text-align:center><code>bool</code></td><td></td></tr></tbody></table><h2 id=secret-types>Secret types</h2><h3 id=secrettype>SecretType</h3><p><em>A secret value</em></p><p>Syntax:</p><pre tabindex=0><code>!secret.secret&lt;
  Type   # valueType
&gt;
</code></pre><p>A generic wrapper around another MLIR type, representing an encrypted value
but not specifying the manner of encryption. This is useful in HEIR because
the compiler may choose various details of the FHE scheme based on the
properties of the input program, the backend target hardware, and cost
models of the various passes.</p><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>valueType</td><td style=text-align:center><code>Type</code></td><td></td></tr></tbody></table><h2 id=secret-ops>Secret ops</h2><h3 id=secretcast-heirsecretcastop><code>secret.cast</code> (heir::secret::CastOp)</h3><p><em>A placeholder cast from one secret type to another</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.cast` $input attr-dict `:` qualified(type($input)) `to` qualified(type($output))
</code></pre><p>A <code>cast</code> operation represents a type cast from one secret type to another,
that is used to enable the intermixing of various equivalent secret types
before a lower-level FHE scheme has been chosen.</p><p>For example, <code>secret.cast</code> can be used to convert a <code>secret&lt;i8></code> to a
<code>secret&lt;tensor&lt;8xi1>></code> as a compatibility layer between boolean and
non-boolean parts of a program. The pass that later lowers the IR to
specific FHE schemes would need to replace these casts with appropriate
scheme-specific operations, and it is left to those later passes to
determine which casts are considered valid.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%result</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>cast <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%result2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>cast <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i8</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#204a87;font-weight:700>i4</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A secret value</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A secret value</td></tr></tbody></table><h3 id=secretconceal-heirsecretconcealop><code>secret.conceal</code> (heir::secret::ConcealOp)</h3><p><em>Convert a non-secret value into a secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.conceal` $cleartext attr-dict `:` qualified(type($cleartext)) `-&gt;` qualified(type($output))
</code></pre><p>Convert a value to a secret containing the same value.</p><p>This op represents a scheme-agnostic encryption operation, as well as a
&ldquo;trivial encryption&rdquo; operation which is needed for some FHE schemes. This
op is also useful for type materialization in the dialect conversion
framework.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>conceal <span style=color:#000>%value</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cleartext</code></td><td>any type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>A secret value</td></tr></tbody></table><h3 id=secretgeneric-heirsecretgenericop><code>secret.generic</code> (heir::secret::GenericOp)</h3><p><em>Lift a plaintext computation to operate on secrets.</em></p><p><code>secret.generic</code> lifts a plaintext computation to operate on one or more
secrets. The lifted computation is represented as a region containing a
single block terminated by <code>secret.yield</code>. The arguments of the <code>secret.generic</code>
may include one or more <code>!secret.secret</code> types. The arguments of the block
in the op&rsquo;s body correspond to the underlying plaintext types of the secrets.</p><p><code>secret.generic</code> is not isolated from above, so you may directly reference
values in the enclosing scope. This is required to support using
<code>secret.generic</code> inside of ops with <code>AffineScope</code>, while having the body
of the generic use the induction variables defined by the affine scope.</p><p>Basic examples:</p><p>Add two secret integers together</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>Add a secret value with a plaintext value. I.e., not all arguments to the
op need be secret.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>The same as above, but the plaintext op is not passed through the basic
block.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%y</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%Z</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%X</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%x</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%y</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%z</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span></code></pre></div><p>Traits: <code>SingleBlockImplicitTerminator&lt;YieldOp></code>, <code>SingleBlock</code></p><p>Interfaces: <code>OpAsmOpInterface</code>, <code>OperandAndResultAttrInterface</code>, <code>RegionBranchOpInterface</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>results</code></td><td>variadic of any type</td></tr></tbody></table><h3 id=secretreveal-heirsecretrevealop><code>secret.reveal</code> (heir::secret::RevealOp)</h3><p><em>Convert a secret value into a non-secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.reveal` $input attr-dict `:` qualified(type($input)) `-&gt;` qualified(type($cleartext))
</code></pre><p>Convert a secret into a non-secret containing the same value.</p><p>This op represents a scheme-agnostic decryption operation. This op is also
useful for target materialization in the dialect conversion framework.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%Y</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>reveal <span style=color:#000>%secret_value</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>A secret value</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>cleartext</code></td><td>any type</td></tr></tbody></table><h3 id=secretseparator-heirsecretseparatorop><code>secret.separator</code> (heir::secret::SeparatorOp)</h3><p><em>Convert a non-secret value into a secret</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `secret.separator` attr-dict ($inputs^ `:` type($inputs))?
</code></pre><p>This operation is used as a separation boundary between logical subunits of
the module. This is used in conjunction with
<code>--secret-distribute-generic=distribute-through=secret.separator</code> to break a
generic around these separators and allow for optimization passes to
analyze and optimize the sub-units locally.</p><p>In order to allow bufferization of modules with this operation, we must
register a (bogus) memory effect that also prevents this operation from
being trivially dead during operation folding.</p><p>This operation also accepts operands, which act as boundaries between the
logical units. This enforces separation of memref and affine optimizations
between the subunits, preventing optimizations from removing the operand and
combining the two separated regions. The operand can be thought of as an
return value of the logical subunit.</p><p>Interfaces: <code>MemoryEffectOpInterface (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{MemoryEffects::Write on ::mlir::SideEffects::DefaultResource}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>inputs</code></td><td>variadic of any type</td></tr></tbody></table><h3 id=secretyield-heirsecretyieldop><code>secret.yield</code> (heir::secret::YieldOp)</h3><p><em>Secret yield operation</em></p><p><code>secret.yield</code> is a special terminator operation for blocks inside regions
in <code>secret</code> generic ops. It returns the cleartext value of the
corresponding private computation to the immediately enclosing <code>secret</code>
generic op.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>HasParent&lt;GenericOp></code>, <code>ReturnLike</code>, <code>Terminator</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code>, <code>RegionBranchTerminatorOpInterface</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>values</code></td><td>variadic of any type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-ca9ddb02db7c0683037407c6f9eb1f2a>7.17 - TensorExt</h1><h1 id=tensor_ext-dialect>&rsquo;tensor_ext&rsquo; Dialect</h1><p>The <code>tensor_ext</code> dialect contains operations on plaintext tensors that
correspond to the computation model of certain FHE schemes, but are
unlikely to be upstreamed to MLIR due to their specificity to FHE.</p><h2 id=tensorext-attributes>TensorExt attributes</h2><h3 id=layoutattr>LayoutAttr</h3><p><em>The description of the layout of a data-semantic tensor.</em></p><p>Syntax:</p><pre tabindex=0><code>#tensor_ext.layout&lt;
  mlir::StringAttr   # layout
&gt;
</code></pre><p>This attribute describes how a data-semantic tensor is laid out among a
tensor of ciphertexts. The layout is described by an integer relation $(d,
s)$, where $d$ is a multiset of data-semantic tensor indices and $s$ is a
multiset of slot indices (or coefficient indices). The slot indices are
defined by two indices: the ciphertext index and the slot index in that
order. The elements of the relation are defined by a set of quasi-affine
constraints.</p><p>I.e., a point $((2, 3), (7, 0))$ in the relation says that the data entry
at index $(2, 3)$ is placed in slot 0 of ciphertext 7. This could be
defined as part of the relation by a constraint like <code>row + col + 2 - ct + slot = 0</code>.</p><p>The attribute stores a string representation of the integer relation,
which follows the ISL syntax for <code>isl_basic_map</code>. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#vec_layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 7 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>#mat_layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [row, col] -&gt; [ct, slot] : (slot - row) mod 512 = 0 and (ct + slot - col) mod 512 = 0 and row &gt;= 0 and col &gt;= 0 and ct &gt;= 0 and slot &gt;= 0 and 1023 &gt;= slot and 511 &gt;= ct and 511 &gt;= row and 511 &gt;= col }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Example with local (existential) variables.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>#layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{[d0] -&gt; [ct, slot] : exists d3, d4 : -ct + d3 = 0 and d0 - d4 * 1024 = 0 and -d0 + 31 &gt;= 0 and d0 &gt;= 0 and ct &gt;= 0 and slot &gt;= 0 and -slot + 1023 &gt;= 0 and -d0 + d3 * 1024 + 1023 &gt;= 0 and d0 - d3 * 1024 &gt;= 0 and -d0 + d4 * 1024 + 1023 &gt;= 0 and d0 - d4 * 1024 &gt;= 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>layout</td><td style=text-align:center><code>mlir::StringAttr</code></td><td></td></tr></tbody></table><h3 id=originaltypeattr>OriginalTypeAttr</h3><p><em>The original type of a secret tensor whose layout has been converted to ciphertext semantics.</em></p><p>Syntax:</p><pre tabindex=0><code>#tensor_ext.original_type&lt;
  ::mlir::Type,   # originalType
  ::mlir::Attribute   # layout
&gt;
</code></pre><p>This attribute is used to retain the original type of a secret tensor after
its conversion to ciphertext semantics, i.e. after applying any padding or
alignment to fill ciphertext data types. For example, if a
<code>!secret.secret&lt;tensor&lt;32xi8>></code> is laid out in a ciphertext with
1024 slots, the new type would be <code>!secret.secret&lt;tensor&lt;1024xi8>></code>
with attribute <code>tensor_ext.original_type&lt;!secret.secret&lt;tensor&lt;32xi8>></code>.</p><h4 id=parameters-1>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>originalType</td><td style=text-align:center><code>::mlir::Type</code></td><td></td></tr><tr><td style=text-align:center>layout</td><td style=text-align:center><code>::mlir::Attribute</code></td><td></td></tr></tbody></table><h2 id=tensorext-ops>TensorExt ops</h2><h3 id=tensor_extassign_layout-heirtensor_extassignlayoutop><code>tensor_ext.assign_layout</code> (heir::tensor_ext::AssignLayoutOp)</h3><p><em>Assign a layout to a plaintext tensor or scalar.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.assign_layout` operands attr-dict `:` type($output)
</code></pre><p>This op allows the ingestion of a plaintext value into the layout system.
For example, ops like <code>linalg.reduce</code>, require a tensor input to represent
initial values. These will generally be created by an <code>arith.constant</code> or
<code>tensor.empty</code> op, which does not have secret results. Lowerings will
convert this to a packed plaintext, so that the subsequent ops can be
lowered as ciphertext-plaintext ops.</p><p>This op is inserted by layout selection passes.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>layout</code></td><td>::mlir::Attribute</td><td>The description of the layout of a data-semantic tensor.</td></tr></table><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>any type</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=tensor_extconvert_layout-heirtensor_extconvertlayoutop><code>tensor_ext.convert_layout</code> (heir::tensor_ext::ConvertLayoutOp)</h3><p><em>Convert from one layout to another.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.convert_layout` operands attr-dict `:` type($output)
</code></pre><p>This op represents the conversion of a value from one packed layout to
another. This is implemented via a &ldquo;shift network&rdquo; of ciphertext rotations,
plaintext masks (ciphertext-plaintext multiplications), and additions.</p><p>This op is inserted by layout selection passes.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>from_layout</code></td><td>::mlir::Attribute</td><td>The description of the layout of a data-semantic tensor.</td></tr><tr><td><code>to_layout</code></td><td>::mlir::Attribute</td><td>The description of the layout of a data-semantic tensor.</td></tr></table><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>any type</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table><h3 id=tensor_extpermute-heirtensor_extpermuteop><code>tensor_ext.permute</code> (heir::tensor_ext::PermuteOp)</h3><p><em>Permute a tensor by a static permutation.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.permute` operands attr-dict `:` type($input)
</code></pre><p>This op represents a permutation of a tensor.</p><p>This is lowered from a <code>convert_layout</code> op, and is implemented in terms of
<code>rotate</code> operations.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>permutation</code></td><td>::mlir::Attribute</td><td>64-bit integer elements attribute or The description of the layout of a data-semantic tensor.</td></tr></table><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>input</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h3 id=tensor_extrotate_and_reduce-heirtensor_extrotateandreduceop><code>tensor_ext.rotate_and_reduce</code> (heir::tensor_ext::RotateAndReduceOp)</h3><p><em>Performs a reduction of a periodically rotated tensor.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.rotate_and_reduce` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This op reduces products of a plaintext with a periodically rotated
tensor.</p><p>In almost full generality, the reduction performed is</p><p>[
\sum_{i \in [0, n]} p(P, T<em>i) \cdot rotate(v, T</em>i)
]</p><p>where $f$ is a function, $p(P, T<em>i)$ is a function of a plaintext $P$ and
$rotate(v, T</em>i)$ is a rotation of the ciphertext $v$ with period $T$. The
operation takes as input the ciphertext vector $v$, the period $T$, the
number of reductions $n$, and a tensor of plaintext values <code>[p(P, 0), p(P, T), ..., p(P, T*(n-1))]</code>.</p><p>This can be used to implement a matrix vector product that uses a
Halevi-Shoup diagonalization of the plaintext matrix. In this case, the
reduction is</p><p>[
\sum_{i \in [0, n]} P(i) \cdot rotate(v, i)
]</p><p>where $P(i)$ is the $i$th diagonal of the plaintext matrix and the period
$T$ is $1$.</p><p>An accumulation of the ciphertext slots is also handled via this operation
by omitting the plaintext $p(P, T*i)$ argument and using a period of 1 with
<code>n = |v|</code> so that the reduction is simply a sum of all rotation of the
ciphertext.</p><p>If <code>reduceOp</code> is set to an MLIR operation name (e.g., <code>arith.mulf</code>), then
the reduction operation is modified to use that operation instead of a sum.
The chosen op must be one of <code>arith.muli</code>, <code>arith.mulf</code>, <code>arith.addi</code>,
or <code>arith.addf</code>.</p><p>Efficient lowerings of this operation can use the Baby-Step / Giant-Step
approach from <a href=https://eprint.iacr.org/2018/244.pdf>Faster Homomorphic Linear Transformations in
HElib</a> to reduce the number of
ciphertext rotations.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>period</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr><tr><td><code>steps</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr><tr><td><code>reduceOp</code></td><td>::mlir::StringAttr</td><td>An Attribute containing a string</td></tr></table><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>tensor</code></td><td>ranked tensor of any type values</td></tr><tr><td style=text-align:center><code>plaintexts</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h3 id=tensor_extrotate-heirtensor_extrotateop><code>tensor_ext.rotate</code> (heir::tensor_ext::RotateOp)</h3><p><em>Rotate a tensor some number of indices left.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.rotate` operands attr-dict `:` qualified(type($tensor)) `,` type($shift)
</code></pre><p>This op represents a left-rotation of a tensor by given number of indices.
Negative shift values are interpreted as right-rotations.</p><p>This corresponds to the <code>rotate</code> operation in arithmetic FHE schemes like
BGV. This op currently only supports 1D rotations of the last axis of a
tensor. A <code>tensor&lt;4x64xi32></code> is interpreted as 4 ciphertexts each with 64
slots, and a rotation on a value of this type rotates each ciphertext by
the given amount.</p><p>// In the future, the op will be adjusted to support rotations of general
// multi-dimensional tensors with a vector of rotation indices for each
// dimension. The lowering will implement the correct operations to rotate
// the tensor along the indices given its packing.</p><p>Examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>tensor</code></td><td>ranked tensor of any type values</td></tr><tr><td style=text-align:center><code>shift</code></td><td>signless-integer-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>ranked tensor of any type values</td></tr></tbody></table><h3 id=tensor_extunpack-heirtensor_extunpackop><code>tensor_ext.unpack</code> (heir::tensor_ext::UnpackOp)</h3><p><em>Unpack data from a ciphertext-semantic tensor.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tensor_ext.unpack` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>This op extracts the underlying cleartext data from a ciphertext-semantic
tensor.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-4>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>layout</code></td><td>::mlir::Attribute</td><td>The description of the layout of a data-semantic tensor.</td></tr></table><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>value</code></td><td>any type</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>any type</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-678c1db0f9b2ed4c9d43b790f890bea0>7.18 - TfheRust</h1><h1 id=tfhe_rust-dialect>&rsquo;tfhe_rust&rsquo; Dialect</h1><p>The <code>thfe_rust</code> dialect is an exit dialect for generating rust code against the tfhe-rs library API,
using the shortint parameters and encoding scheme.</p><p>See <a href=https://github.com/zama-ai/tfhe-rs>https://github.com/zama-ai/tfhe-rs</a></p><h2 id=tfherust-types>TfheRust types</h2><h3 id=encryptedbooltype>EncryptedBoolType</h3><p><em>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.
Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp.</em></p><p>Syntax: <code>!tfhe_rust.bool</code></p><h3 id=encryptedint2type>EncryptedInt2Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt2 type</em></p><p>Syntax: <code>!tfhe_rust.ei2</code></p><h3 id=encryptedint4type>EncryptedInt4Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt4 type</em></p><p>Syntax: <code>!tfhe_rust.ei4</code></p><h3 id=encryptedint8type>EncryptedInt8Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type</em></p><p>Syntax: <code>!tfhe_rust.ei8</code></p><h3 id=encryptedint16type>EncryptedInt16Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type</em></p><p>Syntax: <code>!tfhe_rust.ei16</code></p><h3 id=encryptedint32type>EncryptedInt32Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type</em></p><p>Syntax: <code>!tfhe_rust.ei32</code></p><h3 id=encryptedint64type>EncryptedInt64Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type</em></p><p>Syntax: <code>!tfhe_rust.ei64</code></p><h3 id=encryptedint128type>EncryptedInt128Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type</em></p><p>Syntax: <code>!tfhe_rust.ei128</code></p><h3 id=encryptedint256type>EncryptedInt256Type</h3><p><em>An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</em></p><p>Syntax: <code>!tfhe_rust.ei256</code></p><h3 id=encrypteduint2type>EncryptedUInt2Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type</em></p><p>Syntax: <code>!tfhe_rust.eui2</code></p><h3 id=encrypteduint3type>EncryptedUInt3Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type</em></p><p>Syntax: <code>!tfhe_rust.eui3</code></p><h3 id=encrypteduint4type>EncryptedUInt4Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type</em></p><p>Syntax: <code>!tfhe_rust.eui4</code></p><h3 id=encrypteduint8type>EncryptedUInt8Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type</em></p><p>Syntax: <code>!tfhe_rust.eui8</code></p><h3 id=encrypteduint10type>EncryptedUInt10Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type</em></p><p>Syntax: <code>!tfhe_rust.eui10</code></p><h3 id=encrypteduint12type>EncryptedUInt12Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type</em></p><p>Syntax: <code>!tfhe_rust.eui12</code></p><h3 id=encrypteduint14type>EncryptedUInt14Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type</em></p><p>Syntax: <code>!tfhe_rust.eui14</code></p><h3 id=encrypteduint16type>EncryptedUInt16Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type</em></p><p>Syntax: <code>!tfhe_rust.eui16</code></p><h3 id=encrypteduint32type>EncryptedUInt32Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type</em></p><p>Syntax: <code>!tfhe_rust.eui32</code></p><h3 id=encrypteduint64type>EncryptedUInt64Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type</em></p><p>Syntax: <code>!tfhe_rust.eui64</code></p><h3 id=encrypteduint128type>EncryptedUInt128Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type</em></p><p>Syntax: <code>!tfhe_rust.eui128</code></p><h3 id=encrypteduint256type>EncryptedUInt256Type</h3><p><em>An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type</em></p><p>Syntax: <code>!tfhe_rust.eui256</code></p><h3 id=lookuptabletype>LookupTableType</h3><p><em>A univariate lookup table used for programmable bootstrapping.</em></p><p>Syntax: <code>!tfhe_rust.lookup_table</code></p><h3 id=serverkeytype>ServerKeyType</h3><p><em>The short int server key required to perform homomorphic operations.</em></p><p>Syntax: <code>!tfhe_rust.server_key</code></p><h2 id=tfherust-ops>TfheRust ops</h2><h3 id=tfhe_rustadd-heirtfhe_rustaddop><code>tfhe_rust.add</code> (heir::tfhe_rust::AddOp)</h3><p><em>Arithmetic add of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.add` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustapply_lookup_table-heirtfhe_rustapplylookuptableop><code>tfhe_rust.apply_lookup_table</code> (heir::tfhe_rust::ApplyLookupTableOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.apply_lookup_table` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>input</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr><tr><td style=text-align:center><code>lookupTable</code></td><td>A univariate lookup table used for programmable bootstrapping.</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustbitand-heirtfhe_rustbitandop><code>tfhe_rust.bitand</code> (heir::tfhe_rust::BitAndOp)</h3><p><em>Logical AND of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.bitand` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustbitor-heirtfhe_rustbitorop><code>tfhe_rust.bitor</code> (heir::tfhe_rust::BitOrOp)</h3><p><em>Logical OR of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.bitor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustbitxor-heirtfhe_rustbitxorop><code>tfhe_rust.bitxor</code> (heir::tfhe_rust::BitXorOp)</h3><p><em>Logical XOR of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.bitxor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustcast-heirtfhe_rustcastop><code>tfhe_rust.cast</code> (heir::tfhe_rust::CastOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.cast` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustcmp-heirtfhe_rustcmpop><code>tfhe_rust.cmp</code> (heir::tfhe_rust::CmpOp)</h3><p>_High level operation to check the relation of two ciphertexts.</p><ul><li>equal (mnemonic: &ldquo;eq&rdquo;; integer value: 0)</li><li>not equal (mnemonic: &ldquo;ne&rdquo;; integer value: 1)</li><li>signed less than (mnemonic: &ldquo;slt&rdquo;; integer value: 2)</li><li>signed less than or equal (mnemonic: &ldquo;sle&rdquo;; integer value: 3)</li><li>signed greater than (mnemonic: &ldquo;sgt&rdquo;; integer value: 4)</li><li>signed greater than or equal (mnemonic: &ldquo;sge&rdquo;; integer value: 5)</li><li>unsigned less than (mnemonic: &ldquo;ult&rdquo;; integer value: 6)</li><li>unsigned less than or equal (mnemonic: &ldquo;ule&rdquo;; integer value: 7)</li><li>unsigned greater than (mnemonic: &ldquo;ugt&rdquo;; integer value: 8)</li><li>unsigned greater than or equal (mnemonic: &ldquo;uge&rdquo;; integer value: 9)</li></ul><p>Note: <a href=https://mlir.llvm.org/docs/Dialects/ArithOps/#arithcmpi-arithcmpiop>https://mlir.llvm.org/docs/Dialects/ArithOps/#arithcmpi-arithcmpiop</a>_</p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.cmp` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>predicate</code></td><td>::mlir::arith::CmpIPredicateAttr</td><td>allowed 64-bit signless integer cases: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</td></tr></table><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp.</td><td></td></tr></tbody></table><h3 id=tfhe_rustcreate_trivial-heirtfhe_rustcreatetrivialop><code>tfhe_rust.create_trivial</code> (heir::tfhe_rust::CreateTrivialOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.create_trivial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>value</code></td><td>integer</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rusteq-heirtfhe_rusteqop><code>tfhe_rust.eq</code> (heir::tfhe_rust::EqOp)</h3><p><em>High level operation to check equality of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.eq` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustgenerate_lookup_table-heirtfhe_rustgeneratelookuptableop><code>tfhe_rust.generate_lookup_table</code> (heir::tfhe_rust::GenerateLookupTableOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.generate_lookup_table` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-1>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>truthTable</code></td><td>::mlir::IntegerAttr</td><td>An Attribute containing a integer value</td></tr></table><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>lookupTable</code></td><td>A univariate lookup table used for programmable bootstrapping.</td></tr></tbody></table><h3 id=tfhe_rustmax-heirtfhe_rustmaxop><code>tfhe_rust.max</code> (heir::tfhe_rust::MaxOp)</h3><p><em>High level operation to return maximum of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.max` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-10>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-10>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustmin-heirtfhe_rustminop><code>tfhe_rust.min</code> (heir::tfhe_rust::MinOp)</h3><p><em>High level operation to return minimum of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.min` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-11>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-11>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustmul-heirtfhe_rustmulop><code>tfhe_rust.mul</code> (heir::tfhe_rust::MulOp)</h3><p><em>Arithmetic mul of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.mul` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-12>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-12>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustneq-heirtfhe_rustneqop><code>tfhe_rust.neq</code> (heir::tfhe_rust::NeqOp)</h3><p><em>High level operation to check inequality of two ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.neq` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-13>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-13>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustscalar_left_shift-heirtfhe_rustscalarleftshiftop><code>tfhe_rust.scalar_left_shift</code> (heir::tfhe_rust::ScalarLeftShiftOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.scalar_left_shift` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-2>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>shiftAmount</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-14>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-14>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustscalar_right_shift-heirtfhe_rustscalarrightshiftop><code>tfhe_rust.scalar_right_shift</code> (heir::tfhe_rust::ScalarRightShiftOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.scalar_right_shift` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes-3>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>shiftAmount</code></td><td>::mlir::IntegerAttr</td><td>index attribute</td></tr></table><h4 id=operands-15>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>ciphertext</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-15>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h3 id=tfhe_rustcmux-heirtfhe_rustselectop><code>tfhe_rust.cmux</code> (heir::tfhe_rust::SelectOp)</h3><p><em>Multiplexer operations, the <code>select</code> ciphertext will return the <code>trueCtxt</code>
if in contains a 1. In the other case, it will will return the <code>falseCtxt</code>.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.cmux` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-16>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>select</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp.</td><td></td></tr><tr><td style=text-align:center><code>trueCtxt</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>falseCtxt</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h4 id=results-16>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>tfhe-ciphertext-like</td></tr></tbody></table><h3 id=tfhe_rustsub-heirtfhe_rustsubop><code>tfhe_rust.sub</code> (heir::tfhe_rust::SubOp)</h3><p><em>Arithmetic sub of two tfhe ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust.sub` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-17>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The short int server key required to perform homomorphic operations.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>tfhe-ciphertext-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>Integer type with arbitrary precision up to a fixed limit or An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table><h4 id=results-17>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted bool corresponding to tfhe-rs&rsquo;s FHEBool, not in the Boolean TFHE-rs.</td></tr><tr><td style=text-align:center>Note this is not an encryption of a boolean, but the outcome of operations as Eq or Cmp. or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint2 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint3 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint4 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint8 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint10 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint12 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint14 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint16 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint32 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint64 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint128 type or An encrypted unsigned integer corresponding to tfhe-rs&rsquo;s FHEUint256 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt8 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt16 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt32 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt64 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt128 type or An encrypted signed integer corresponding to tfhe-rs&rsquo;s FHEInt256 type</td><td></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-d46d9ee8aeb1f8889ca7cfc9a061a7cc>7.19 - TfheRustBool</h1><h1 id=tfhe_rust_bool-dialect>&rsquo;tfhe_rust_bool&rsquo; Dialect</h1><p>The <code>tfhe_rust_bool</code> dialect is an exit dialect for generating rust code against the tfhe-rs library API,
using the boolean parameter set.</p><p>See <a href=https://github.com/zama-ai/tfhe-rs>https://github.com/zama-ai/tfhe-rs</a></p><h2 id=tfherustbool-attributes>TfheRustBool attributes</h2><h3 id=tfherustboolgatesattr>TfheRustBoolGatesAttr</h3><p><em>An Attribute containing an array of strings to store bool gates</em></p><p>Syntax:</p><pre tabindex=0><code>#tfhe_rust_bool.tfhe_rust_bool_gates&lt;
  ::llvm::ArrayRef&lt;::mlir::heir::tfhe_rust_bool::TfheRustBoolGateEnumAttr&gt;   # gates
&gt;
</code></pre><p>This attributes stores a list of integer identifiers for Boolean gates.</p><p>Uses following mapping:
AND_GATE = 0;
NAND_GATE = 1;
OR_GATE = 2;
NOR_GATE = 3;
XOR_GATE = 4;
XNOR_GATE = 5;
NOT_GATE = 6;</p><h4 id=parameters>Parameters:</h4><table><thead><tr><th style=text-align:center>Parameter</th><th style=text-align:center>C++ type</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center>gates</td><td style=text-align:center><code>::llvm::ArrayRef&lt;::mlir::heir::tfhe_rust_bool::TfheRustBoolGateEnumAttr></code></td><td></td></tr></tbody></table><h2 id=tfherustbool-types>TfheRustBool types</h2><h3 id=encryptedbooltype>EncryptedBoolType</h3><p><em>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</em></p><p>Syntax: <code>!tfhe_rust_bool.eb</code></p><h3 id=packedserverkeytype>PackedServerKeyType</h3><p><em>The Belfort packed API boolean server key.</em></p><p>Syntax: <code>!tfhe_rust_bool.server_key_enum</code></p><h3 id=serverkeytype>ServerKeyType</h3><p><em>The boolean server key required to perform homomorphic operations.</em></p><p>Syntax: <code>!tfhe_rust_bool.server_key</code></p><h2 id=tfherustbool-ops>TfheRustBool ops</h2><h3 id=tfhe_rust_boolcreate_trivial-heirtfhe_rust_boolcreatetrivialop><code>tfhe_rust_bool.create_trivial</code> (heir::tfhe_rust_bool::CreateTrivialOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.create_trivial` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>tfhe rust bool server key</td></tr><tr><td style=text-align:center><code>value</code></td><td>1-bit signless integer</td></tr></tbody></table><h4 id=results>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h3 id=tfhe_rust_booland-heirtfhe_rust_boolandop><code>tfhe_rust_bool.and</code> (heir::tfhe_rust_bool::AndOp)</h3><p><em>Logical AND of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.and` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-1>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-1>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolmux-heirtfhe_rust_boolmuxop><code>tfhe_rust_bool.mux</code> (heir::tfhe_rust_bool::MuxOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.mux` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-2>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>cnd</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h4 id=results-2>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>An encrypted Boolean corresponding to tfhe-rs&rsquo;s FHEBool type</td></tr></tbody></table><h3 id=tfhe_rust_boolnand-heirtfhe_rust_boolnandop><code>tfhe_rust_bool.nand</code> (heir::tfhe_rust_bool::NandOp)</h3><p><em>Logical NAND of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.nand` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-3>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-3>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolnor-heirtfhe_rust_boolnorop><code>tfhe_rust_bool.nor</code> (heir::tfhe_rust_bool::NorOp)</h3><p><em>Logical NOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.nor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-4>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-4>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolnot-heirtfhe_rust_boolnotop><code>tfhe_rust_bool.not</code> (heir::tfhe_rust_bool::NotOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.not` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-5>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>input</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-5>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolor-heirtfhe_rust_boolorop><code>tfhe_rust_bool.or</code> (heir::tfhe_rust_bool::OrOp)</h3><p><em>Logical OR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.or` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-6>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-6>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolgates_packed-heirtfhe_rust_boolpackedop><code>tfhe_rust_bool.gates_packed</code> (heir::tfhe_rust_bool::PackedOp)</h3><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.gates_packed` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Operation to where different Boolean gates are executed pairwise between elements of two ciphertext arrays.</p><p>For example,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>packed_gates <span style=color:#000>%a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%b</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>gates =</span> <span style=color:#000>#tfhe_rust_bool.tfhe_rust_bool_gates</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>server_key<span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;,</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x</span><span style=color:#000;font-weight:700>!</span>tfhe_rust_bool<span style=color:#000;font-weight:700>.</span>eb<span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>applies an &ldquo;and&rdquo; gate to the first elements of %a and %b and an xor gate to the
second elements.</p><p>Mapping is defined in the BooleanGates.td file.</p><p>Traits: <code>AlwaysSpeculatableImplTrait</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=attributes>Attributes:</h4><table><tr><th>Attribute</th><th>MLIR Type</th><th>Description</th></tr><tr><td><code>gates</code></td><td>::mlir::heir::tfhe_rust_bool::TfheRustBoolGatesAttr</td><td>An Attribute containing an array of strings to store bool gates</td></tr></table><h4 id=operands-7>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-7>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolxnor-heirtfhe_rust_boolxnorop><code>tfhe_rust_bool.xnor</code> (heir::tfhe_rust_bool::XnorOp)</h3><p><em>Logical XNOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.xnor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-8>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-8>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h3 id=tfhe_rust_boolxor-heirtfhe_rust_boolxorop><code>tfhe_rust_bool.xor</code> (heir::tfhe_rust_bool::XorOp)</h3><p><em>Logical XOR of two TFHE-rs Bool ciphertexts.</em></p><p>Syntax:</p><pre tabindex=0><code>operation ::= `tfhe_rust_bool.xor` operands attr-dict `:` functional-type(operands, results)
</code></pre><p>Traits: <code>AlwaysSpeculatableImplTrait</code>, <code>Commutative</code>, <code>Elementwise</code>, <code>Scalarizable</code>, <code>Tensorizable</code>, <code>Vectorizable</code></p><p>Interfaces: <code>ConditionallySpeculatable</code>, <code>InferTypeOpInterface</code>, <code>NoMemoryEffect (MemoryEffectOpInterface)</code></p><p>Effects: <code>MemoryEffects::Effect{}</code></p><h4 id=operands-9>Operands:</h4><table><thead><tr><th style=text-align:center>Operand</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>serverKey</code></td><td>The boolean server key required to perform homomorphic operations. or The Belfort packed API boolean server key.</td></tr><tr><td style=text-align:center><code>lhs</code></td><td>eb-like</td></tr><tr><td style=text-align:center><code>rhs</code></td><td>eb-like</td></tr></tbody></table><h4 id=results-9>Results:</h4><table><thead><tr><th style=text-align:center>Result</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:center><code>output</code></td><td>eb-like</td></tr></tbody></table><h2 id=tfherustbool-additional-definitions>TfheRustBool additional definitions</h2><h3 id=tfherustboolgateenum>TfheRustBoolGateEnum</h3><p><em>An enum attribute representing a TFHE-rs boolean gate using u8 int</em></p><h4 id=cases>Cases:</h4><table><thead><tr><th style=text-align:center>Symbol</th><th style=text-align:center>Value</th><th>String</th></tr></thead><tbody><tr><td style=text-align:center>AND</td><td style=text-align:center><code>0</code></td><td>AND</td></tr><tr><td style=text-align:center>NAND</td><td style=text-align:center><code>1</code></td><td>NAND</td></tr><tr><td style=text-align:center>OR</td><td style=text-align:center><code>2</code></td><td>OR</td></tr><tr><td style=text-align:center>NOR</td><td style=text-align:center><code>3</code></td><td>NOR</td></tr><tr><td style=text-align:center>XOR</td><td style=text-align:center><code>4</code></td><td>XOR</td></tr><tr><td style=text-align:center>XNOR</td><td style=text-align:center><code>5</code></td><td>XNOR</td></tr><tr><td style=text-align:center>NOT</td><td style=text-align:center><code>6</code></td><td>NOT</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-19aafd690c3a7edde7a9c3e1fbaf737f>8 - Passes</h1><h3 id=-add-client-interface><code>-add-client-interface</code></h3><p><em>Add client interfaces to secret functions</em></p><p>This pass adds encrypt and decrypt functions for each compiled function in
the IR. These functions maintain the same interface as the original
function, while the compiled function may lose some of this information by
the lowerings to ciphertext types (e.g., a scalar ciphertext, when lowered
through RLWE schemes, must be encoded as a tensor).</p><p>This pass occurs at the secret level, which is necessary because some
backends like the plaintext backend don&rsquo;t actually encrypt, but still
require the ciphertext layout/packing logic to convert cleartexts to
plaintexts.</p><h4 id=example>Example</h4><p>Command: <code>heir-opt --add-client-interface=ciphertext-size=1024 tests/Transforms/add_client_interface/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>ct_ty =</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (slot - i0) mod 32 = 0 and ct = 0 and 1023 &gt;= slot &gt;= 0 and 31 &gt;= i0 &gt;= 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#original_type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.original_type</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>originalType =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_add</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct_ty <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct_ty <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>ct_ty <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct_ty<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct_ty<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%pt_arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%pt_arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%pt_arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%pt_arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>ct_ty
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct_ty
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (slot - i0) mod 32 = 0 and ct = 0 and 1023 &gt;= slot &gt;= 0 and 31 &gt;= i0 &gt;= 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#original_type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.original_type</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>originalType =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#original_type</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_add__encrypt__arg0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>client.enc_func =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>func_name =</span> <span style=color:#4e9a06>&#34;simple_add&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1023</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1023</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%c1023</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0</span> to <span style=color:#000>%0</span> step <span style=color:#000>%c1_0</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%cst</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>remsi <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c0_1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted</span> into <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0_1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>conceal <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_add__encrypt__arg1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>client.enc_func =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>func_name =</span> <span style=color:#4e9a06>&#34;simple_add&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1023</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1023</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%c1023</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0</span> to <span style=color:#000>%0</span> step <span style=color:#000>%c1_0</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%cst</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>remsi <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c0_1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted</span> into <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0_1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>conceal <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@simple_add__decrypt__result0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>client.dec_func =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>func_name =</span> <span style=color:#4e9a06>&#34;simple_add&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>index =</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>reveal <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1023</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1023</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%c1023</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0</span> to <span style=color:#000>%1</span> step <span style=color:#000>%c1_0</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%cst</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>remsi <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c0_1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0_1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x1024x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted</span> into <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options>Options</h4><pre tabindex=0><code>-ciphertext-size          : Power of two length of the ciphertexts the data is packed in.
-enable-layout-assignment : If false, skips the emission of layout assignment operations, essentially assuming that the input was already using correctly (ciphertext-)sized tensors.
</code></pre><h3 id=-annotate-mgmt><code>-annotate-mgmt</code></h3><p><em>Annotate MgmtAttr for secret SSA values in the IR</em></p><p>This pass runs the secretness/level/dimension analysis and annotates the IR with the results,
saving it into each op&rsquo;s attribute dictionary as mgmt.mgmt : <analysis results></p><h4 id=options-1>Options</h4><pre tabindex=0><code>-base-level : Level to start counting from (used by B/FV)
</code></pre><h3 id=-annotate-module><code>-annotate-module</code></h3><p><em>Annotate ModuleOp with Scheme And/Or Backend</em></p><p>This pass annotates the module with a scheme and/or backend.</p><p>This pass should be called before all lowering to enable lowering
to the desired scheme and backend.</p><p>Available scheme:</p><ul><li><code>bgv</code></li><li><code>ckks</code></li><li><code>bfv</code></li><li><code>cggi</code></li></ul><p>Available backend:</p><ul><li><code>openfhe</code></li><li><code>lattigo</code></li></ul><h4 id=example-1>Example</h4><p>Command: <code>heir-opt --annotate-module="backend=openfhe scheme=ckks" tests/Transforms/annotate_module/pass.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span>backend<span style=color:#000;font-weight:700>.</span>openfhe<span style=color:#000;font-weight:700>,</span> scheme<span style=color:#000;font-weight:700>.</span>ckks<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-2>Options</h4><pre tabindex=0><code>-scheme  : The scheme to annotate the module with.
-backend : The backend to annotate the module with.
</code></pre><h3 id=-annotate-secretness><code>-annotate-secretness</code></h3><p><em>Annotate secret SSA values in the IR</em></p><p>Debugging helper that runs the secretness analysis and annotates the IR with
the results, extending the <code>{secret.secret}</code> annotation to all operation
results that are secret.</p><p>In addition to annotating operation results, the pass also annotates
arguments and return types in <code>func.func</code> operations, as well as any
terminators (e.g. <code>return</code>)</p><p>In <code>verbose</code> mode, all results are annotated, including public ones with
<code>{secret.public}</code>, and values for which the secretness analysis is missing
are annotated with <code>{secret.missing}</code>, while values where the secretness
analysis is inconclusive are annotated with <code>{secret.unknown}</code>.</p><h4 id=example-2>Example</h4><p>Command: <code>heir-opt --annotate-secretness='verbose=true' tests/Transforms/annotate_secretness/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mixed_secretness</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secret</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%public</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secret</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%public</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secret_val</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%public_val</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%public_val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%public_val</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>          <span style=color:#8f5902;font-style:italic>// public + public = public
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%secret_val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secret_val</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>          <span style=color:#8f5902;font-style:italic>// secret * secret = secret
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%secret_val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%public_val</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>          <span style=color:#8f5902;font-style:italic>// secret + public = secret
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>                           <span style=color:#8f5902;font-style:italic>// secret + secret = secret
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mixed_secretness</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>public<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>public<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>}</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-3>Options</h4><pre tabindex=0><code>-verbose : If true, annotate secretness state all values, including public ones, and values with missing or inconclusive analysis.
</code></pre><h3 id=-apply-folders><code>-apply-folders</code></h3><p><em>Apply all folding patterns from canonicalize</em></p><p>This pass applies all registered folding patterns greedily to the input IR.
This is useful when running a full canonicalize is too slow, but applying
folders before canonicalize is sufficient to simplify the IR for later
passes, or even sufficient to then subsequently run a full canonicalize
pass.</p><p>This is used to prepare an IR for <code>insert-rotate</code> after fully unrolling
loops.</p><h3 id=-arith-to-cggi-quart><code>-arith-to-cggi-quart</code></h3><p><em>Lower <code>arith</code> to <code>cggi</code> dialect and divide each operation into smaller parts.</em></p><p>This pass converts high precision arithmetic operations, i.e. operations on 32 bit integer,
into a sequence of lower precision operations, i.e 8b operations.
Currently, the pass splits the 32b integer into four 8b integers, using the tensor dialect.
These smaller integers are stored in an 16b integer, so that we don&rsquo;t lose the carry information.
This pass converts the <code>arith</code> dialect to the <code>cggi</code> dialect.</p><p>Based on the <code>arith-emulate-wide-int</code> pass from the MLIR arith dialect.</p><p>General assumption: the first element in the tensor is also the LSB element.</p><h3 id=-arith-to-cggi><code>-arith-to-cggi</code></h3><p><em>Lower <code>arith</code> to <code>cggi</code> dialect.</em></p><h3 id=-arith-to-mod-arith><code>-arith-to-mod-arith</code></h3><p><em>Lower standard <code>arith</code> to <code>mod-arith</code>.</em></p><p>This pass lowers the <code>arith</code> dialect to their <code>mod-arith</code> equivalents.</p><p>This pass will transform <code>arith</code> operations to the mod-arith dialect, where
the find-mac pass can be used to convert consecutive multiply addition
operations into a single operation. In a later pass, these large precision
MAC operations (typically 64 or 32-bit) will be lowered into small
precision (8 or 4b) operations that can be mapped to CGGI operations.</p><h4 id=options-4>Options</h4><pre tabindex=0><code>-modulus : Modulus to use for the mod-arith dialect. If not specified, the pass will use the natural modulus for that integer type
</code></pre><h3 id=-bgv-to-lwe><code>-bgv-to-lwe</code></h3><p><em>Lower <code>bgv</code> to <code>lwe</code> dialect.</em></p><p>This pass lowers the <code>bgv</code> dialect to <code>lwe</code> dialect.
Note that some scheme specific ops (e.g., modswitch) that
have no direct analogue in the <code>lwe</code> dialect are left unchanged.
TODO (#1193): support both &ldquo;common&rdquo; and &ldquo;full&rdquo; lwe lowering</p><h3 id=-cggi-boolean-vectorize><code>-cggi-boolean-vectorize</code></h3><p><em>Group different logic gates with the packed API</em></p><p>This pass groups independent logic gates into a single call of the packed
operations. Pass is based on the straight-line-vectorizer, but is fundamentally different.
This pass combines any type of boolean gates and is not restricted to combining the same type of gate operand.</p><p>Pass is intended for the <code>FPT</code> tfhe-rs API, where <code>packed_gates</code> function get a
the boolean gates are passed as a string vector and a left and right vector of ciphertexts.
Each boolean gates specified in <code>gates</code> is then applied element wise.</p><pre tabindex=0><code>let outputs_ct = fpga_key.packed_gates(&amp;gates, &amp;ref_to_ct_lefts, &amp;ref_to_ct_rights);
</code></pre><h4 id=options-5>Options</h4><pre tabindex=0><code>-parallelism : Parallelism factor for batching. 0 is infinite parallelism
</code></pre><h3 id=-cggi-decompose-operations><code>-cggi-decompose-operations</code></h3><p><em>Expands CGGI operations into LWE operations and programmable bootstraps</em></p><p>This pass expands high level CGGI operations (e.g. LUT2, XOR, etc.).</p><p>If the option <code>expand-lincomb</code> is set, the expansion will continue into the
component LWE scalar operations and a programmable bootstrap operation.
Otherwise, the expansion will be stop at the <code>cggi.lut_lincomb</code> level. By
default, <code>expand-lincomb</code> is true.</p><p>For example, a LUT3 operation is composed of three LWE ciphertext inputs $c,
b, a$ (in MSB to LSB ordering) which must be combined via the linear
combination $4 * c + 2 * b + a$ before being fed into a programmable
bootstrap defined by the lookup table.</p><p>This pass supports XOR, LUT2, LUT3, and LutLincomb operations.</p><h4 id=options-6>Options</h4><pre tabindex=0><code>-expand-lincomb : Expand lincomb operations to the PBS and scalar level
</code></pre><h3 id=-cggi-to-jaxite><code>-cggi-to-jaxite</code></h3><p><em>Lower <code>cggi</code> to <code>jaxite</code> dialect.</em></p><h3 id=-cggi-to-tfhe-rust-bool><code>-cggi-to-tfhe-rust-bool</code></h3><p><em>Lower <code>cggi</code> to <code>tfhe_rust_bool</code> dialect.</em></p><h3 id=-cggi-to-tfhe-rust><code>-cggi-to-tfhe-rust</code></h3><p><em>Lower <code>cggi</code> to <code>tfhe_rust</code> dialect.</em></p><h3 id=-ckks-to-lwe><code>-ckks-to-lwe</code></h3><p><em>Lower <code>ckks</code> to <code>lwe</code> dialect.</em></p><p>This pass lowers the <code>ckks</code> dialect to <code>lwe</code> dialect.
Note that some scheme specific ops (e.g., rescale) that
have no direct analogue in the <code>lwe</code> dialect are left unchanged.
TODO (#1193): support both &ldquo;common&rdquo; and &ldquo;full&rdquo; lwe lowering</p><h3 id=-collapse-insertion-chains><code>-collapse-insertion-chains</code></h3><p><em>Collapse chains of extract/insert ops into rotate ops when possible</em></p><p>This pass is a cleanup pass for <code>insert-rotate</code>. That pass sometimes leaves
behind a chain of insertion operations like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted</span> into <span style=color:#000>%dest</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c6</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_0</span> into <span style=color:#000>%inserted</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_2</span> into <span style=color:#000>%inserted_1</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000>%extracted_28</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%14</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%inserted_29</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%extracted_28</span> into <span style=color:#000>%inserted_27</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c15</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>yield <span style=color:#000>%inserted_29</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>In many cases, this chain will insert into every index of the <code>dest</code> tensor,
and the extracted values all come from consistently aligned indices of the same
source tensor. In this case, the chain can be collapsed into a single <code>rotate</code>.</p><p>Each index used for insertion or extraction must be constant; this may
require running <code>--canonicalize</code> or <code>--sccp</code> before this pass to apply
folding rules (use <code>--sccp</code> if you need to fold constant through control flow).</p><h3 id=-compare-to-sign-rewrite><code>-compare-to-sign-rewrite</code></h3><p><em>Rewrites arith.cmpi/arith.cmpf to a math_ext.sign based expression</em></p><p>This pass rewrites arith.cmpi/cmpf <pred>%a, %b to some combination of
add/mul and sign operations.
TODO(#1929): provide detailed description of the expression for each
predicate.</p><h4 id=example-3>Example</h4><p>Command: <code>heir-opt --compare-to-sign-rewrite tests/Transforms/compare_to_sign_rewrite/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@cmpi_sgt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sgt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@cmpi_sgt</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>sitofp <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> to <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>sitofp <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> to <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subf <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> math_ext<span style=color:#000;font-weight:700>.</span>sign <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1.000000e+00</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5.000000e-01</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addf <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>mulf <span style=color:#000>%4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>fptosi <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span> to <span style=color:#204a87;font-weight:700>i1</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-elementwise-to-affine><code>-convert-elementwise-to-affine</code></h3><p><em>This pass lowers ElementwiseMappable operations to Affine loops.</em></p><p>This pass lowers ElementwiseMappable operations over tensors
to affine loop nests that instead apply the operation to the underlying scalar values.</p><p>Usage:
&lsquo;&ndash;convert-elementwise-to-affine=convert-ops=arith.mulf '
restrict conversion to mulf op from arith dialect.</p><p>&lsquo;&ndash;convert-elementwise-to-affine=convert-ops=arith.addf,arith.divf convert-dialects=bgv&rsquo;
restrict conversion to addf and divf ops from arith dialect and all of the ops in bgv dialect.</p><p>&ndash;convert-elementwise-to-affine=convert-dialects=arith
restrict conversion to arith dialect so ops only from arith dialect is processed.</p><p>&ndash;convert-elementwise-to-affine=convert-ops=arith.addf,arith.mulf
restrict conversion only to these two ops - addf and mulf - from arith dialect.</p><h4 id=options-7>Options</h4><pre tabindex=0><code>-convert-ops      : comma-separated list of ops to run this pass on 
-convert-dialects : comma-separated list of dialects to run this pass on 
</code></pre><h3 id=-convert-if-to-select><code>-convert-if-to-select</code></h3><p><em>Convert scf.if operations on secret conditions to arith.select operations.</em></p><p>Conversion for If-operations that evaluate secret condition to alternative
select operations.</p><h4 id=example-4>Example</h4><p>Command: <code>heir-opt --convert-if-to-select tests/Transforms/convert_if_to_select/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@secret_condition_with_non_secret_int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%inp</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%inp</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cond</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%copy_inp</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%secret_cond</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%secret_cond</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%copy_inp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%copy_inp</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%copy_inp</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@secret_condition_with_non_secret_int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>select <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-polynomial-mul-to-ntt><code>-convert-polynomial-mul-to-ntt</code></h3><p><em>Rewrites polynomial operations to their NTT equivalents</em></p><p>Applies a rewrite pattern to convert polynomial multiplication to the
equivalent using the number-theoretic transforms (NTT) when possible.</p><p>Polynomial multiplication can be rewritten as polynomial.NTT
on each operand, followed by modulo elementwise multiplication of the
point-value representation and then the inverse-NTT back to coefficient
representation.</p><h3 id=-convert-secret-extract-to-static-extract><code>-convert-secret-extract-to-static-extract</code></h3><p><em>Convert <code>tensor.extract</code> operations on secret index to static extract operations.</em></p><p>Converts <code>tensor.extract</code> operations that read value at secret index to
alternative static <code>tensor.extract</code> operations that extracts value at each
index and conditionally selects the value extracted at the secret index.</p><p>Note: Running this pass alone does not result in a data-oblivious program;
we have to run the <code>--convert-if-to-select</code> pass to the resulting program
to convert the secret-dependent If-operation to a Select-operation.</p><h4 id=example-5>Example</h4><p>Command: <code>heir-opt --convert-secret-extract-to-static-extract tests/Transforms/convert_secret_extract_to_static_extract/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%index</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extractedValue</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>32</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%extracted_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-secret-for-to-static-for><code>-convert-secret-for-to-static-for</code></h3><p><em>Convert secret scf.for ops to affine.for ops with constant bounds.</em></p><p>Conversion for For-operation that evaluate secret bound(s) to alternative
affine For-operation with constant bound(s).</p><p>It replaces data-dependent bounds with an If-operation to check the bounds,
and conditionally execute and yield values from the For-operation&rsquo;s body.
Note: Running this pass alone does not result in a data-oblivious program;
we have to run the <code>--convert-if-to-select</code> pass to the resulting program
to convert the secret-dependent If-operation to a Select-operation.</p><h4 id=example-6>Example</h4><p>Command: <code>heir-opt --convert-secret-for-to-static-for tests/Transforms/convert_secret_for_to_static_for/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretLower</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%secretUpper</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretLower</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%secretUpper</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%lower</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%upper</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span> <span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%i</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%lower</span> to <span style=color:#000>%upper</span> step <span style=color:#000>%c1</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%sum</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0_i32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%c0_i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sge<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi slt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>andi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i1</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>%extracted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%extracted</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>lower =</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>upper =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-8>Options</h4><pre tabindex=0><code>-convert-all-scf-for : If true, convert all scf.for ops to affine.for, not just those with secret bounds.
</code></pre><h3 id=-convert-secret-insert-to-static-insert><code>-convert-secret-insert-to-static-insert</code></h3><p><em>Convert <code>tensor.insert</code> operations on secret index to static insert operations.</em></p><p>Converts <code>tensor.insert</code> operations that write to secret index to
alternative static <code>tensor.insert</code> operations that inserts the inserted
value at each index and conditionally selects the newly produced tensor
that contains the value at the secret index.</p><p>Note: Running this pass alone does not result in a data-oblivious program;
we have to run the <code>--convert-if-to-select</code> pass to the resulting program
to convert the secret-dependent If-operation to a Select-operation.</p><h4 id=example-7>Example</h4><p>Command: <code>heir-opt --convert-secret-insert-to-static-insert tests/Transforms/convert_secret_insert_to_static_insert/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretTensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%secretIndex</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%index</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Violation: tensor.insert writes value at secret index
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%c0</span> into <span style=color:#000>%tensor</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%index</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c0_i16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>32</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi eq<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert <span style=color:#000>%c0_i16</span> into <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%inserted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>32x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-secret-while-to-static-for><code>-convert-secret-while-to-static-for</code></h3><p><em>Convert secret scf.while ops to affine.for ops that have constant bounds.</em></p><p>Convert scf.while with a secret condition to affine.for with constant
bounds. It replaces the scf.condition operation found in the scf.while loop
with an scf.if operation that conditionally executes operations in the while
operation&rsquo;s body and yields values.</p><p>A &ldquo;max_iter&rdquo; attribute should be specified as part of the secret-dependent
scf.while operation to successfully transform to a secret-independent
affine.for operation. This attribute determines the maximum number of
iterations for the new affine.for operation.</p><p>Note: Running this pass alone does not result in a data-oblivious program;
we have to run the <code>--convert-if-to-select</code> pass to the resulting program
to convert the secret-dependent If-operation to a Select-operation.</p><h4 id=example-8>Example</h4><p>Command: <code>heir-opt --convert-secret-while-to-static-for tests/Transforms/convert_secret_while_to_static_for/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%secretInput</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>while <span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sgt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>condition<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> do <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c100_i16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>16</span> iter_args<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>cmpi sgt<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c100_i16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> scf<span style=color:#000;font-weight:700>.</span>if <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span> else <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          scf<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%arg2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>max_iter =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-convert-tensor-to-scalars><code>-convert-tensor-to-scalars</code></h3><p><em>Effectively &lsquo;unrolls&rsquo; tensors of static shape to scalars.</em></p><p>This pass will convert a static-shaped tensor type to a TypeRange
containing product(dim) copies of the element type of the tensor.
This pass currently includes two patterns:</p><ol><li>It converts tensor.from_elements operations to
the corresponding scalar inputs.</li><li>It converts tensor.insert operations by updating the
ValueRange corresponding to the converted input and
updating it with the scalar to be inserted.</li></ol><p>It also applies folders greedily to simplify, e.g., extract(from_elements).</p><p>Note: The pass is designed to be run on an IR, where the only operations
with tensor typed operands are tensor &ldquo;management&rdquo; operations such as insert/extract,
with all other operations (e.g., arith operations) already taking (extracted) scalar inputs.
For example, an IR where elementwise operations have been converted to scalar operations via
<code>--convert-elementwise-to-affine</code>.</p><p>The pass might insert new tensor.from_elements operations or manually create the scalar ValueRange
via inserting tensor.extract operations if any operations remain that operate on tensors.
The pass currently applies irrespective of tensor size, i.e., might be very slow for large tensors.</p><p>TODO (#1023): Extend this pass to support more tensor operations, e.g., <code>tensor.slice</code></p><h4 id=options-9>Options</h4><pre tabindex=0><code>-max-size : Limits `unrolling` to tensors with at most max-size elements
</code></pre><h3 id=-convert-to-ciphertext-semantics><code>-convert-to-ciphertext-semantics</code></h3><p><em>Converts programs with tensor semantics to ciphertext semantics</em></p><p>This pass performs two inherently intertwined transformations:</p><ol><li>Convert a program from tensor semantics to ciphertext semantics, explained below.</li><li>Implement ops defined on tensor-semantic types in terms of ops defined on
ciphertext-semantic types.</li></ol><p>A program is defined to have <em>tensor semantics</em> if the tensor-typed values
are manipulated according to standard MLIR tensor operations and semantics.</p><p>A program is defined to have <em>ciphertext semantics</em> if the tensor-typed
values correspond to tensors of FHE ciphertexts, where the last dimension of
the tensor type is the number of ciphertext slots.</p><p>For example, a tensor of type <code>tensor&lt;32x32xi16></code> with tensor semantics might
be converted by this pass, depending on the pass options, to a single
ciphertext-semantics <code>tensor&lt;65536xi16></code>. A larger tensor might, depending on
the layout chosen by earlier passes, be converted to a <code>tensor&lt;4x32768xi16></code>,
where the trailing dimension corresponds to the number of slots in the
ciphertext.</p><p>Tensors with ciphertext semantics can be thought of as an intermediate step
between lowering from tensor types with tensor semantics to concrete <code>lwe</code>
dialect ciphertext types in a particular FHE scheme. Having this intermediate
step is useful because some optimizations are easier to implement, and can be
implemented more generically, in the abstract FHE computational model
where the data types are large tensors, and the operations are SIMD additions,
multiplications, and cyclic rotations.</p><p>Function arguments and return values are annotated with the original tensor
type in the <code>secret.original_type</code> attribute. This enables later lowerings
to implement appropriate encoding and decoding routines for FHE schemes.</p><p>The second role of this pass is to implement FHE kernels for various high-level
tensor operations, such as <code>linalg.matvec</code>. This must happen at the same time
as the type conversion because the high-level ops like <code>linalg.matvec</code> are
not well-defined on ciphertext-semantic tensors, while their implementation
as SIMD/rotation ops are not well-defined on tensor-semantic tensors.</p><p>TODO(#1541): provide example docs</p><h4 id=options-10>Options</h4><pre tabindex=0><code>-ciphertext-size : Power of two length of the ciphertexts the data is packed in.
</code></pre><h3 id=-drop-unit-dims><code>-drop-unit-dims</code></h3><p><em>Drops unit dimensions from linalg ops.</em></p><p>This pass converts <code>linalg</code> whose operands have unit dimensions
in their types to specialized ops that drop these unit dimensions.</p><p>For example, a <code>linalg.matmul</code> whose RHS has type <code>tensor&lt;32x1xi32></code> is
converted to a <code>linalg.matvec</code> op on the underlying <code>tensor&lt;32xi32></code>.</p><h3 id=-emit-c-interface><code>-emit-c-interface</code></h3><p><em>Adds llvm.emit_c_interface to each public function.</em></p><h3 id=-expand-copy><code>-expand-copy</code></h3><p><em>Expands memref.copy ops to explicit affine loads and stores</em></p><p>This pass removes memref copy operations by expanding them to affine loads
and stores. This pass introduces affine loops over the dimensions of the
MemRef, so must be run prior to any affine loop unrolling in a pipeline.</p><h4 id=example-9>Example</h4><p>Command: <code>heir-opt --expand-copy tests/Transforms/expand_copy/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@memref_copy</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>copy <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@memref_copy</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%alloc</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%alloc_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>alloc<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      affine<span style=color:#000;font-weight:700>.</span>for <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span> to <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%alloc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        affine<span style=color:#000;font-weight:700>.</span>store <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%alloc_0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x3x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-11>Options</h4><pre tabindex=0><code>-disable-affine-loop : Use this to control to disable using affine loops
</code></pre><h3 id=-extract-loop-body><code>-extract-loop-body</code></h3><p><em>Extracts logic of a loop bodies into functions.</em></p><p>This pass extracts logic in the inner body of for loops into functions.</p><p>This pass requires that tensors are lowered to memref. It expects that a
loop body contains a number of affine.load statements used as inputs to the
extracted function, and a single affine.store used as the extracted
function&rsquo;s output.</p><p>Input</p><pre tabindex=0><code>module {
  func.func @loop_body() {
    %c-128_i8 = arith.constant -128 : i8
    %c127_i8 = arith.constant 127 : i8
    %alloc_7 = memref.alloc() {alignment = 64 : i64} : memref&lt;25x20x8xi8&gt;
    affine.for %arg1 = 0 to 25 {
      affine.for %arg2 = 0 to 20 {
        affine.for %arg3 = 0 to 8 {
          %98 = affine.load %alloc_6[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
          %99 = arith.cmpi slt, %arg0, %c-128_i8 : i8
          %100 = arith.select %99, %c-128_i8, %arg0 : i8
          %101 = arith.cmpi sgt, %arg0, %c127_i8 : i8
          %102 = arith.select %101, %c127_i8, %100 : i8
          affine.store %102, %alloc_7[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
        }
      }
    }
  }
}
</code></pre><p>Output</p><pre tabindex=0><code>module {
  func.func @loop_body() {
    %alloc_7 = memref.alloc() {alignment = 64 : i64} : memref&lt;25x20x8xi8&gt;
    affine.for %arg1 = 0 to 25 {
      affine.for %arg2 = 0 to 20 {
        affine.for %arg3 = 0 to 8 {
          %98 = affine.load %alloc_6[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
          %102 = func.call @__for_loop(%98) : (i8) -&gt; i8
          affine.store %102, %alloc_7[%arg1, %arg2, %arg3] : memref&lt;25x20x8xi8&gt;
        }
      }
    }
  }
  func.func private @__for_loop(%arg0: i8) -&gt; i8 {
    %c-128_i8 = arith.constant -128 : i8
    %c127_i8 = arith.constant 127 : i8
    %99 = arith.cmpi slt, %arg0, %c-128_i8 : i8
    %100 = arith.select %99, %c-128_i8, %arg0 : i8
    %101 = arith.cmpi sgt, %arg0, %c127_i8 : i8
    %102 = arith.select %101, %c127_i8, %100 : i8
    return %102 : i8
  }
}
</code></pre><h4 id=options-12>Options</h4><pre tabindex=0><code>-min-loop-size : Use this to control the minimum loop size to apply this pass
-min-body-size : Use this to control the minimum loop body size to apply this pass
</code></pre><h3 id=-fold-constant-tensors><code>-fold-constant-tensors</code></h3><p><em>This pass folds any constant tensors.</em></p><p>This pass folds tensor operations on constants to new constants.</p><p>The following folders are supported:</p><ul><li><code>tensor.insert</code> of a constant tensor</li><li><code>tensor.collapse_shape</code> of a constant or empty tensor</li><li><code>tensor.extract_slice</code> of a splat to a splat of the new shape</li></ul><h3 id=-fold-convert-layout-into-assign-layout><code>-fold-convert-layout-into-assign-layout</code></h3><p><em>Merges tensor_ext.convert_layout ops into preceding tensor_ext.assign_layout ops</em></p><p>A <code>tensor_ext.assign_layout</code> op corresponds to an encoding of a cleartext
into a plaintext or ciphertext. If this is immediately followed by a
<code>tensor_ext.convert_layout</code> op, then one can just change the initial encoding
to correspond to the result of the conversion.</p><p>If the result of an <code>assign_layout</code> has multiple subsequent <code>convert_layout</code>
ops, then they are folded into multiple <code>assign_layout</code> ops applied to the
same cleartext.</p><h3 id=-forward-insert-to-extract><code>-forward-insert-to-extract</code></h3><p><em>Forward inserts to extracts within a single block</em></p><p>This pass is similar to forward-store-to-load pass where store ops
are forwarded load ops; here instead tensor.insert ops are forwarded
to tensor.extract ops.</p><p>Does not support complex control flow within a block, nor ops with
arbitrary subregions.</p><h3 id=-forward-store-to-load><code>-forward-store-to-load</code></h3><p><em>Forward stores to loads within a single block</em></p><p>This pass is a simplified version of mem2reg and similar passes.
It analyzes an operation, finding all basic blocks within that op
that have memrefs whose stores can be forwarded to loads.</p><p>Does not support complex control flow within a block, nor ops
with arbitrary subregions.</p><h3 id=-full-loop-unroll><code>-full-loop-unroll</code></h3><p><em>Fully unroll all loops</em></p><p>Scan the IR for affine.for loops and unroll them all.</p><h3 id=-generate-param-bfv><code>-generate-param-bfv</code></h3><p><em>Generate BFV Scheme Parameter</em></p><p>The pass generates the BFV scheme parameter using a given noise model.</p><p>There are four noise models available:</p><ul><li><code>bfv-noise-by-bound-coeff-average-case</code> or <code>bfv-noise-kpz21</code></li><li><code>bfv-noise-by-bound-coeff-worst-case</code></li><li><code>bfv-noise-by-variance-coeff</code> or <code>bfv-noise-bmcm23</code></li><li><code>bfv-noise-canon-emb</code></li></ul><p>To use public-key encryption/secret-key encryption in the model, the option
<code>usePublicKey</code> could be set accordingly.</p><p>The first two models are taken from <a href=https://ia.cr/2021/204>KPZ21</a>, and they work by bounding
the coefficient embedding of the ciphertexts. The difference
of the two models is expansion factor used for multiplication
of the coefficients, the first being $2 \sqrt{N}$ ($4 \sqrt{N}$ in some
special cases) and the second being $N$.</p><p>The third model is taken from <a href=https://ia.cr/2023/600>BMCM23</a>. It works by tracking the variance
of the coefficient embedding of the ciphertexts. This gives a much tighter
noise estimate for independent ciphertext input, but may give underestimation
for dependent ciphertext input. See the paper for more details.
One possible explanation of the underestimation is <a href=https://ia.cr/2025/1036>this paper</a></p><p>The last model is adapted from <a href=https://ia.cr/2022/706>MMLGA22</a> with mixes from BMCM23 and KPZ21.
It uses the canonical embedding to bound the critical quantity of a ciphertext
that defines whether c can be decrypted correctly.</p><p>This pass then generates the moduli chain consisting of primes
of bits specified by the <code>mod-bits</code> field.</p><p>Usually for B/FV <code>mod-bits</code> is set to 60. But when machine word size is
small, users may also want to set it to 57.</p><p>This pass relies on the presence of the <code>mgmt</code> dialect ops to model
relinearize, and it relies on <code>mgmt.mgmt</code> attribute to determine
the ciphertext level/dimension. These ops and attributes can be added by
a pass like <code>--secret-insert-mgmt-bgv</code> and <code>--annotate-mgmt</code>.</p><p>User can provide custom scheme parameters by annotating bgv::SchemeParamAttr
at the module level. Note that we reuse bgv::SchemeParamAttr for BFV.</p><h4 id=example-10>Example</h4><p>Command: <code>heir-opt --generate-param-bfv tests/Transforms/generate_param_bfv/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>bgv.schemeParam =</span> <span style=color:#000>#bgv.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2147565569</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2147573761</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>plaintextModulus =</span> <span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-13>Options</h4><pre tabindex=0><code>-model                         : Noise model to validate against.
-mod-bits                      : Default number of bits for all prime coefficient modulusto use for the ciphertext space.
-slot-number                   : Minimum number of slots for parameter generation.
-plaintext-modulus             : Plaintext modulus.
-use-public-key                : If true, uses a public key for encryption.
-encryption-technique-extended : If true, uses EXTENDED encryption technique for encryption. (See https://ia.cr/2022/915)
</code></pre><h3 id=-generate-param-bgv><code>-generate-param-bgv</code></h3><p><em>Generate BGV Scheme Parameter using a given noise model</em></p><p>The pass generates the BGV scheme parameter using a given noise model.</p><p>There are four noise models available:</p><ul><li><code>bgv-noise-by-bound-coeff-average-case</code> or <code>bgv-noise-kpz21</code></li><li><code>bgv-noise-by-bound-coeff-worst-case</code></li><li><code>bgv-noise-by-variance-coeff</code> or <code>bgv-noise-mp24</code></li><li><code>bgv-noise-mono</code></li></ul><p>To use public-key encryption/secret-key encryption in the model, the option
<code>usePublicKey</code> could be set accordingly.</p><p>The first two models are taken from <a href=https://ia.cr/2021/204>KPZ21</a>, and they work by bounding
the coefficient embedding of the ciphertexts. The difference
of the two models is expansion factor used for multiplication
of the coefficients, the first being $2 \sqrt{N}$ ($4 \sqrt{N}$ in some
special cases) and the second being $N$.</p><p>The third model is taken from <a href=https://ia.cr/2019/452>MP24</a>. It works by tracking the variance
of the coefficient embedding of the ciphertexts. This gives a more accurate
noise estimate, but it may give underestimates in some cases. See the paper
for more details. One possible explanation of the underestimation is <a href=https://ia.cr/2025/1036>this paper</a>.</p><p>The last model is taken from <a href=https://ia.cr/2022/706>MMLGA22</a>. It uses the canonical embedding to
bound the critical quantity of a ciphertext that defines whether c can be
decrypted correctly. According to the authors they achieve more accurate and
better bounds than KPZ21. See the paper for more details.</p><p>This pass relies on the presence of the <code>mgmt</code> dialect ops to model
relinearize/modreduce, and it relies on <code>mgmt.mgmt</code> attribute to determine
the ciphertext level/dimension. These ops and attributes can be added by
a pass like <code>--secret-insert-mgmt-bgv</code>.</p><p>User can provide custom scheme parameters by annotating bgv::SchemeParamAttr
at the module level.</p><h4 id=example-11>Example</h4><p>Command: <code>heir-opt --generate-param-bgv tests/Transforms/generate_param_bgv/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>bgv.schemeParam =</span> <span style=color:#000>#bgv.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4294991873</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4295049217</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>plaintextModulus =</span> <span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-14>Options</h4><pre tabindex=0><code>-model                         : Noise model to validate against.
-plaintext-modulus             : Plaintext modulus.
-slot-number                   : Minimum number of slots for parameter generation.
-use-public-key                : If true, uses a public key for encryption.
-encryption-technique-extended : If true, uses EXTENDED encryption technique for encryption. (See https://ia.cr/2022/915)
</code></pre><h3 id=-generate-param-ckks><code>-generate-param-ckks</code></h3><p><em>Generate CKKS Scheme Parameter</em></p><p>The pass generates the CKKS scheme parameter.</p><p>The pass asks the user to provide the number of bits for the first modulus
and scaling modulus. The default values are 55 and 45, respectively.
Then the pass generates the moduli chain using the provided values.</p><p>This pass relies on the presence of the <code>mgmt</code> dialect ops to model
relinearize/modreduce, and it relies on <code>mgmt.mgmt</code> attribute to determine
the ciphertext level/dimension. These ops and attributes can be added by
a pass like <code>--secret-insert-mgmt-&lt;scheme></code> and <code>--annotate-mgmt</code>.</p><p>User can provide custom scheme parameters by annotating bgv::SchemeParamAttr
at the module level.</p><h4 id=example-12>Example</h4><p>Command: <code>heir-opt --generate-param-ckks tests/Transforms/generate_param_ckks/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addf <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>ckks.schemeParam =</span> <span style=color:#000>#ckks.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019389953</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019488257</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>logDefaultScale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#f57900>attrs =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>arg0 =</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addf <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-15>Options</h4><pre tabindex=0><code>-slot-number                   : Minimum number of slots for parameter generation.
-first-mod-bits                : Default number of bits of the first prime coefficient modulus to use for the ciphertext space.
-scaling-mod-bits              : Default number of bits of the scaling prime coefficient modulus to use for the ciphertext space.
-use-public-key                : If true, uses a public key for encryption.
-encryption-technique-extended : If true, uses EXTENDED encryption technique for encryption. (See https://ia.cr/2022/915)
-input-range                   : The range of the plaintexts for input ciphertexts for the CKKS scheme; default to [-1, 1]. For other ranges like [-D, D], use D.
</code></pre><h3 id=-implement-rotate-and-reduce><code>-implement-rotate-and-reduce</code></h3><p><em>Implement tensor_ext.rotate_and_reduce ops with baby-steps / giant-steps</em></p><p>This pass converts <code>tensor_ext.rotate_and_reduce</code> ops
into a sequence of arithmetic operations and <code>tensor_ext.rotate</code> ops, aiming
to minimize the number of ciphertext rotation operations using a Baby-Steps /
Giant-Steps approach.</p><p>A <code>tensor_ext.rotate_and_reduce</code> op computes the reduction of rotated tensors
in the form <code>\sum_{i = 0}^{n} P(i) \cdot rotate(v, T*i)</code> where <code>T</code> is some
period of rotation. The naive approach would compute <code>n</code> rotations of the
ciphertext <code>v</code>. The Baby-Steps / Giant-Steps approach from <a href=https://eprint.iacr.org/2018/244.pdf>Faster Homomorphic
Linear Transformations in HElib</a> can
compute the sum with <code>O(sqrt(n))</code> ciphertext rotations instead by evaluating
the sum with the following expression</p><p>[
\sum_{i = 0}^{n} P(i) \cdot rotate(v, T<em>i) =
\sum_{j = 0}^{\sqrt{n}} \sum_{k = 0}^{\sqrt{n}} P(j + gk) rotate(v, T</em>(j + gk)) =
\sum_{j = 0}^{\sqrt{n}} rotate( \sum_{k = 0}^{\sqrt{n}} rotate(P(j + gk), -gk) rotate(v, T*j) , -gk)
]</p><p>This approach uses <code>\sqrt{n}</code> ciphertext rotations of <code>v</code> in the inner sum
(the baby steps) and then <code>\sqrt{n}</code> ciphertext rotations of the partial sums
(the giant steps) to compute the full sum.</p><p>The input IR must have tensors that correspond to plaintexts or
ciphertexts.</p><h4 id=example-13>Example</h4><p>Command: <code>heir-opt --implement-rotate-and-reduce --canonicalize --cse --sccp tests/Dialect/TensorExt/Transforms/implement_rotate_and_reduce.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Giant steps (chunked in four) will also need 3 rotations to align the sums.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Each giant step consists of 4 plaintext extractions. muls, and rotates
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Baby step giant step should reduce the number of ciphertext rotations to 3 (shifts of 0, 1, 2, 3)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// First chunk of 4 baby steps is interleaved with the initial rotations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Plaintexts are all rotated by a fixed amount and multiplied by the baby step ciphertexts
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// The result is shifted back to the correct position
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_halevi_shoup_reduction</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate_and_reduce <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>period =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>steps =</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_halevi_shoup_reduction</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice_0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice_1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice_2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%14</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%15</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%17</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%18</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%19</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%18</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%20</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%17</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%19</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%21</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%20</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%22</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%21</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_7</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%23</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%24</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%23</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%25</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%26</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%27</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%24</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%26</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_9</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%28</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%29</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%28</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%30</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%27</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%29</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_10</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%31</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%31</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%33</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%32</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%34</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%33</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%35</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%22</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%34</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_11</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%36</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%37</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%36</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_12</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%38</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%39</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%38</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%40</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%39</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_13</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%41</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%42</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%41</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%43</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%40</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%42</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_14</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%44</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%extracted_slice_14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%45</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%44</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%46</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%43</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%45</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%47</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%46</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%48</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%47</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%48</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-implement-shift-network><code>-implement-shift-network</code></h3><p><em>Implement tensor_ext.convert_layout ops as shift newtorks</em></p><p>This pass converts <code>tensor_ext.permute</code> ops into a network of
<code>tensor_ext.rotate</code> ops, aiming to minimize the overall latency of the
permutation. The input IR must have tensors that correspond to plaintexts or
ciphertexts, and be in &ldquo;ciphertext semantics,&rdquo; i.e., after an IR has been
processed via <code>convert-to-ciphertext-semantics</code>.</p><p>The method uses graph coloring, an approach based on Vos-Vos-Erkin 2022,
<a href=https://link.springer.com/chapter/10.1007/978-3-031-17140-6_20>&ldquo;Efficient Circuits for Permuting and Mapping Packed Values Across
Leveled Homomorphic Ciphertexts&rdquo;</a>.</p><h4 id=example-14>Example</h4><p>Command: <code>heir-opt --implement-shift-network tests/Dialect/TensorExt/Transforms/implement_shift_network_example.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#map</span> <span style=color:#000;font-weight:700>=</span> dense<span style=color:#000;font-weight:700>&lt;[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x4x</span><span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@figure3</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>permute <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>permutation =</span> <span style=color:#000>#map</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@figure3</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_6</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%14</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_7</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%15</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1_8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%16</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1_8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%17</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%14</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%18</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%17</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_9</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%19</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%17</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_10</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2_11</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%20</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%19</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2_11</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%21</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%18</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%20</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_12</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%22</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%21</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_12</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%23</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%21</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_13</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c4_14</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%24</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%23</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4_14</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%25</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%22</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%24</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_15</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%26</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_15</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%27</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%25</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c8_17</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%28</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%27</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8_17</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%29</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%26</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%28</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%30</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%29</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_18</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%31</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_18</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_19</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%extracted_slice</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_19</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1_20</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%33</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1_20</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%34</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%31</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%33</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_21</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%35</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%34</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_21</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2_22</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%36</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%35</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c2_22</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_23</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%37</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%36</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_23</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_24</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%38</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%36</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_24</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c4_25</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%39</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%38</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c4_25</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%40</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%37</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%39</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_26</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%41</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%40</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_26</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst_27</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%42</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%40</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%cst_27</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c8_28</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%43</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%42</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c8_28</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%44</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%41</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%43</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%45</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%30</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%44</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%46</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert_slice <span style=color:#000>%45</span> into <span style=color:#000>%46</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> into <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%inserted_slice</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-inline-activations><code>-inline-activations</code></h3><p><em>Inline activation functions</em></p><p>This pass inlines activation functions into the IR.</p><p>Conversion paths from PyTorch to linalg use PyTorch/XLA utilities that
convert the torch activation functions into separate functions. This pass
inlines these functions into the IR. The candidate activations are identified
with an allowlist of function names and are otherwise not checked for
correctness. See
<a href=https://docs.pytorch.org/docs/stable/nn.html#non-linear-activations-weighted-sum-nonlinearity>https://docs.pytorch.org/docs/stable/nn.html#non-linear-activations-weighted-sum-nonlinearity</a>.</p><h4 id=example-15>Example</h4><p>Command: <code>heir-opt --inline-activations tests/Transforms/inline_activations/relu.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> call <span style=color:#000>@relu</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> private <span style=color:#000>@relu</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.000000e+00</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%broadcasted</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>broadcast ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#f57900>dimensions =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mapped</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>map <span style=color:#000;font-weight:700>{</span> arith<span style=color:#000;font-weight:700>.</span>maximumf <span style=color:#000;font-weight:700>}</span> ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%broadcasted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%mapped</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.000000e+00</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%broadcasted</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>broadcast ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#f57900>dimensions =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> 
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%mapped</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>map <span style=color:#000;font-weight:700>{</span> arith<span style=color:#000;font-weight:700>.</span>maximumf <span style=color:#000;font-weight:700>}</span> ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%broadcasted</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%mapped</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-insert-rotate><code>-insert-rotate</code></h3><p><em>Vectorize arithmetic FHE operations using HECO-style heuristics</em></p><p>This pass implements the SIMD-vectorization passes from the
<a href=https://arxiv.org/abs/2202.01649>HECO paper</a>.</p><p>The pass operates by identifying arithmetic operations that can be suitably
combined into a combination of cyclic rotations and vectorized operations
on tensors. It further identifies a suitable &ldquo;slot target&rdquo; for each operation
and heuristically aligns the operations to reduce unnecessary rotations.</p><p>This pass by itself does not eliminate any operations, but instead inserts
well-chosen rotations so that, for well-structured code (like unrolled affine loops),
a subsequent <code>--cse</code> and <code>--canonicalize</code> pass will dramatically reduce the IR.
As such, the pass is designed to be paired with the canonicalization patterns
in <code>tensor_ext</code>, as well as the <code>collapse-insertion-chains</code> pass, which
cleans up remaining insertion and extraction ops after the main simplifications
are applied.</p><p>Unlike HECO, this pass operates on plaintext types and tensors, along with
the HEIR-specific <code>tensor_ext</code> dialect for its cyclic <code>rotate</code> op. It is intended
to be run before lowering to a scheme dialect like <code>bgv</code>.</p><h3 id=-lattigo-alloc-to-inplace><code>-lattigo-alloc-to-inplace</code></h3><p><em>Convert AllocOps to InplaceOps in Lattigo</em></p><p>This pass converts AllocOps to InplaceOps in Lattigo.</p><h3 id=-lattigo-configure-crypto-context><code>-lattigo-configure-crypto-context</code></h3><p><em>Configure the crypto context in Lattigo</em></p><p>This pass generates helper functions to configure the Lattigo objects for the given function.</p><p>For example, for an MLIR function <code>@my_func</code>, the generated helpers have the following signatures</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@my_func__configure</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>lattigo<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>.</span>evaluator<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lattigo<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>.</span>parameter<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lattigo<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>.</span>encoder<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lattigo<span style=color:#000;font-weight:700>.</span>rlwe<span style=color:#000;font-weight:700>.</span>encryptor<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>lattigo<span style=color:#000;font-weight:700>.</span>rlwe<span style=color:#000;font-weight:700>.</span>decryptor<span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h4 id=options-16>Options</h4><pre tabindex=0><code>-entry-function : Default entry function name of entry function.
</code></pre><h3 id=-layout-optimization><code>-layout-optimization</code></h3><p><em>Optimize layout conversions in the IR</em></p><p>This pass performance a greedy layout optimization pass similar to the
automatic layout assignment from <a href=https://dl.acm.org/doi/pdf/10.1145/3656382>A Tensor Compiler with Automatic Data
Packing for Simple and Efficient Fully Homomorphic
Encryption</a>. The pass assumes that
an initial layout assignment was provided on each operation through the
<code>layout-propagation</code> pass.</p><p>The pass iterates on each operation of the IR in reverse order, attempting to
hoist a layout conversion of the operation&rsquo;s result before the operation. For
each of the result&rsquo;s layout conversions, the pass will compute the net cost of
hoisting the conversion through the operation by considering the following:</p><ol><li>The cost of performing the operation with new input layouts that result
in the desired layout.</li><li>The cost of the converting the layout of each input.</li><li>The new cost of converting from the desired layout to each other layout
conversions of the result.</li></ol><p>The layout conversion that results in the lowest net cost is chosen to be
hoisted.</p><h4 id=example-16>Example</h4><p>Command: <code>heir-opt --layout-optimization --canonicalize tests/Transforms/layout_optimization/hoist_matvec.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#vec_layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 4 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#vec_layout_2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 7 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#mat_layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [row, col] -&gt; [ct, slot] : (slot - row) mod 512 = 0 and (ct + slot - col) mod 512 = 0 and row &gt;= 0 and col &gt;= 0 and ct &gt;= 0 and slot &gt;= 0 and 1023 &gt;= slot and 511 &gt;= ct and 511 &gt;= row and 511 &gt;= col }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout_2</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.000000e+00</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#mat_layout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#mat_layout</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>matvec <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>secret.kernel =</span> <span style=color:#000>#secret.kernel</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>name=</span><span style=color:#4e9a06>&#34;MatvecDiagonal&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>force=</span>false<span style=color:#000;font-weight:700>&gt;}</span>
</span></span><span style=display:flex><span>        ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>convert_layout <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>from_layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout_2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>to_layout =</span> <span style=color:#000>#vec_layout_2</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout_2</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#kernel</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#secret.kernel</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>name =</span> <span style=color:#4e9a06>&#34;MatvecDiagonal&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>force =</span> false<span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 7 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>#layout1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0, i1] -&gt; [ct, slot] : (4 + i0) mod 512 = 0 and (-4 - i1 + ct) mod 512 = 0 and (7 + slot) mod 1024 = 0 and 0 &lt;= i0 &lt;= 511 and 0 &lt;= i1 &lt;= 511 and 0 &lt;= ct &lt;= 511 and 0 &lt;= slot &lt;= 1023 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#layout1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout1</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> linalg<span style=color:#000;font-weight:700>.</span>matvec <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>secret.kernel =</span> <span style=color:#000>#kernel</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>}</span> ins<span style=color:#000;font-weight:700>(</span><span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> outs<span style=color:#000;font-weight:700>(</span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>512x</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-17>Options</h4><pre tabindex=0><code>-ciphertext-size  : Power of two length of the ciphertexts the data is packed in.
-vve-random-seed  : Random seed for Vos-Vos-Erkin shift network randomization. Will be hash-combined with additional seeds based on layouts being converted from and to.
-vve-random-tries : Number of random tries used to find best Vos-Vos-Erkin shift network during layout optimization.
</code></pre><h3 id=-layout-propagation><code>-layout-propagation</code></h3><p><em>Propagate ciphertext layouts through the IR</em></p><p>This pass performs a forward propagation of layout (packing) information
through the input IR, starting from the assumption that each secret tensor
argument to a function has a row-major layout.</p><p>The chosen layouts (Integer Relations) are annotated on ops throughout the IR.
In particular,</p><ul><li>Ops with a nested region and block arguments use a dictionary attribute to
mark the layout of each block argument. <code>func.func</code> in particular uses the
<code>tensor_ext.layout</code> dialect attribute, while others use an affine map
attribute.</li><li>Other ops annotate their results with layouts as an ArrayAttr of layouts.
The order of the affine maps corresponds to the order of results.</li></ul><p>When a plaintext SSA value is encountered as an input to a secret operation,
a <code>tensor_ext.assign_layout</code> op is inserted that assigns it a default layout.
This semantically corresponds to a plaintext packing operation. This is
performed as late as possible before the SSA value is used, to avoid
unnecessary layout conversions of plaintexts. This implies that not all SSA
values in the IR are annotated with layouts, only those that have secret
results or secret operands.</p><p>When two incompatible layouts are encountered as operands to the same op,
<code>tensor_ext.convert_layout</code> ops are inserted. For example, consider the
<code>linalg.reduce</code> operation for a summation. Summing along each of the two axes
of a row-major-packed <code>tensor&lt;32x32xi16></code> results in two <code>tensor&lt;32xi16></code>,
but with incompatible layouts: the first has a compact layout residing in the
first 32-entries of a ciphertext, while the second is a strided layout with a
stride of 32.</p><p>The converted op is arbitrarily chosen to have the layout of the first input,
and later passes are responsible for optimizing the choice of which operand
is converted and where the conversion operations are placed. This separation
of duties allows this pass to be reused as a pure dataflow analysis, in which
case it annotates an un-annotated IR with layout attributes.</p><p>TODO(#2047): Add doctest examples with the new layout</p><h4 id=options-18>Options</h4><pre tabindex=0><code>-ciphertext-size : Power of two length of the ciphertexts the data is packed in.
</code></pre><h3 id=-linalg-canonicalizations><code>-linalg-canonicalizations</code></h3><p><em>This pass canonicalizes the linalg.transpose operation of a constant into a transposed constant.</em></p><p>This pass canonicalizes the linalg.transpose operation of a constant into a
transposed constant.</p><h3 id=-lower-polynomial-eval><code>-lower-polynomial-eval</code></h3><p><em>Lowers the polynomial.eval operation</em></p><p>This pass lowers the <code>polynomial.eval</code> operation to a sequence of arithmetic
operations in the relevant dialect.</p><p>Dialects that wish to support this pass must implement the
<code>DialectPolynomialEvalInterface</code> dialect interface, which informs this pass
what operations in the target dialect correspond to scalar multiplication and
addition, as well as how to properly materialize constants as values.</p><p>This pass supports multiple options for lowering a <code>polynomial.eval</code> op,
including the following. The required basis representation of the polynomial
is listed alongside each method. The chosen method is controlled by the
<code>method</code> pass option, which defaults to automatically select the method.</p><ul><li><code>"horner"</code>: Horner&rsquo;s method (monomial basis)</li><li><code>"ps"</code> Paterson-Stockmeyer (monomial basis)</li><li><code>"pscheb"</code>: Paterson-Stockmeyer (Chebyshev basis)</li></ul><p>// TODO(#1565): Add support for Chebyshev-basis methods
// - <code>"clenshaw"</code>: Clenshaw&rsquo;s method (Chebyshev basis)
// - <code>"bsgs"</code>: Baby Step Giant Step (Chebyshev basis)</p><h4 id=options-19>Options</h4><pre tabindex=0><code>-method : The method used to lower polynomial.eval
</code></pre><h3 id=-lower-unpack><code>-lower-unpack</code></h3><p><em>Lower tensor_ext.unpack to standard MLIR</em></p><p>This pass lowers tensor_ext.unpack.</p><h3 id=-lwe-add-debug-port><code>-lwe-add-debug-port</code></h3><p><em>Add debug port to (R)LWE encrypted functions</em></p><p>This pass adds debug ports to the specified function in the IR. The debug ports
are prefixed with &ldquo;__heir_debug&rdquo; and are invoked after each homomorphic operation in the
function. The debug ports are declarations and user should provide functions with
the same name in their code.</p><p>For example, if the function is called &ldquo;foo&rdquo;, the secret key is added to its
arguments, and the debug port is called after each homomorphic operation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// declaration of external debug function
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> private <span style=color:#000>@__heir_debug</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%sk</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>sk<span style=color:#000;font-weight:700>,</span> <span style=color:#000>%ct</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>ct<span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// secret key added as function arg
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%sk</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>sk<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>...)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%ct</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>radd <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// invoke external debug function
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  __heir_debug<span style=color:#000;font-weight:700>(</span><span style=color:#000>%sk</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%ct</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%ct1</span> <span style=color:#000;font-weight:700>=</span> lwe<span style=color:#000;font-weight:700>.</span>rmul <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  __heir_debug<span style=color:#000;font-weight:700>(</span><span style=color:#000>%sk</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%ct1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-20>Options</h4><pre tabindex=0><code>-entry-function : Default entry function name of entry function.
</code></pre><h3 id=-lwe-to-lattigo><code>-lwe-to-lattigo</code></h3><p><em>Lower <code>lwe</code> to <code>lattigo</code> dialect.</em></p><p>This pass lowers the <code>lwe</code> dialect to <code>Lattigo</code> dialect.</p><h3 id=-lwe-to-openfhe><code>-lwe-to-openfhe</code></h3><p><em>Lower <code>lwe</code> to <code>openfhe</code> dialect.</em></p><p>This pass lowers the <code>lwe</code> dialect to <code>Openfhe</code> dialect.
Currently, this also includes patterns that apply directly to <code>ckks</code> and <code>bgv</code> dialect operations.
TODO (#1193): investigate if the need for <code>ckks/bgv</code> patterns in <code>--lwe-to-openfhe</code> is permanent.</p><h3 id=-lwe-to-polynomial><code>-lwe-to-polynomial</code></h3><p><em>Lower <code>lwe</code> to <code>polynomial</code> dialect.</em></p><p>This pass lowers the <code>lwe</code> dialect to <code>polynomial</code> dialect.</p><h3 id=-memref-global-replace><code>-memref-global-replace</code></h3><p><em>MemrefGlobalReplacePass forwards global memrefs accessors to arithmetic values</em></p><p>This pass forwards constant global MemRef values to referencing affine
loads. This pass requires that the MemRef global values are initialized as
constants and that the affine load access indices are constants (i.e. not
variadic). Unroll affine loops prior to running this pass.</p><p>MemRef removal is required to remove any memory allocations from the input
model (for example, TensorFlow models contain global memory holding model
weights) to support FHE transpilation.</p><h4 id=example-17>Example</h4><p>Command: <code>heir-opt --memref-global-replace tests/Transforms/memref_global_replace/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>global <span style=color:#4e9a06>&#34;private&#34;</span> <span style=color:#204a87;font-weight:700>constant</span> <span style=color:#000>@__constant_8xi16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x4x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>=</span> dense<span style=color:#000;font-weight:700>&lt;[[</span><span style=color:#0000cf;font-weight:700>-10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#000;font-weight:700>]]&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>.</span>get_global <span style=color:#000>@__constant_8xi16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x4x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> affine<span style=color:#000;font-weight:700>.</span>load <span style=color:#000>%0</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>%c1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c1</span> <span style=color:#a40000>+</span> <span style=color:#000>%c2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>memref</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>2x4x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c8_i16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%c8_i16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-mod-arith-to-arith><code>-mod-arith-to-arith</code></h3><p><em>Lower <code>mod_arith</code> to standard <code>arith</code>.</em></p><p>This pass lowers the <code>mod_arith</code> dialect to their <code>arith</code> equivalents.</p><h3 id=-mod-arith-to-mac><code>-mod-arith-to-mac</code></h3><p><em>Finds consecutive ModArith mul and add operations and converts them to a Mac operation</em></p><p>Walks over the programs to find Add operations, it checks if the any operands
originates from a mul operation. If so, it converts the Add operation to a
Mac operation and removes the mul operation.</p><h3 id=-new-layout-propagation><code>-new-layout-propagation</code></h3><p><em>Propagate ciphertext layouts through the IR</em></p><p>This pass performs a forward propagation of layout (packing) information
through the input IR, starting from the assumption that each secret tensor
argument to a function has a row-major layout.</p><p>The chosen layouts (Integer Relations) are annotated on ops throughout the IR.
In particular,</p><ul><li>Ops with a nested region and block arguments use a dictionary attribute to
mark the layout of each block argument. <code>func.func</code> in particular uses the
<code>tensor_ext.layout</code> dialect attribute, while others use an affine map
attribute.</li><li>Other ops annotate their results with layouts as an ArrayAttr of layouts.
The order of the affine maps corresponds to the order of results.</li></ul><p>When a plaintext SSA value is encountered as an input to a secret operation,
a <code>tensor_ext.assign_layout</code> op is inserted that assigns it a default layout.
This semantically corresponds to a plaintext packing operation. This is
performed as late as possible before the SSA value is used, to avoid
unnecessary layout conversions of plaintexts. This implies that not all SSA
values in the IR are annotated with layouts, only those that have secret
results or secret operands.</p><p>When two incompatible layouts are encountered as operands to the same op,
<code>tensor_ext.convert_layout</code> ops are inserted. For example, consider the
<code>linalg.reduce</code> operation for a summation. Summing along each of the two axes
of a row-major-packed <code>tensor&lt;32x32xi16></code> results in two <code>tensor&lt;32xi16></code>,
but with incompatible layouts: the first has a compact layout residing in the
first 32-entries of a ciphertext, while the second is a strided layout with a
stride of 32.</p><p>The converted op is arbitrarily chosen to have the layout of the first input,
and later passes are responsible for optimizing the choice of which operand
is converted and where the conversion operations are placed. This separation
of duties allows this pass to be reused as a pure dataflow analysis, in which
case it annotates an un-annotated IR with layout attributes.</p><p>TODO(#2047): Add doctest examples with the new layout</p><h4 id=options-21>Options</h4><pre tabindex=0><code>-ciphertext-size : Power of two length of the ciphertexts the data is packed in.
</code></pre><h3 id=-openfhe-configure-crypto-context><code>-openfhe-configure-crypto-context</code></h3><p><em>Configure the crypto context in OpenFHE</em></p><p>This pass generates helper functions to generate and configure the OpenFHE crypto context for the given function. Generating the crypto context sets the appropriate encryption parameters, while the configuration generates the necessary evaluation keys (relinearization and rotation keys).</p><p>For the options, reader can refer to the OpenFHE documentation at
<a href=https://github.com/openfheorg/openfhe-development/blob/main/src/pke/examples/README.md#description-of-the-cryptocontext-parameters-and-their-restrictions>https://github.com/openfheorg/openfhe-development/blob/main/src/pke/examples/README.md#description-of-the-cryptocontext-parameters-and-their-restrictions</a></p><p>For example, for an MLIR function <code>@my_func</code>, the generated helpers have the following signatures</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span>  <span style=color:#000>@my_func__generate_crypto_context</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span>  <span style=color:#000>@my_func__configure_crypto_context</span><span style=color:#000;font-weight:700>(!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>private_key<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>openfhe<span style=color:#000;font-weight:700>.</span>crypto_context
</span></span></code></pre></div><h4 id=options-22>Options</h4><pre tabindex=0><code>-entry-function                 : Default entry function name of entry function.
-mul-depth                      : Manually specify the mul depth
-ring-dim                       : Manually specify the ring dimension (insecure is implied)
-batch-size                     : Manually specify the batch size
-first-mod-size                 : Manually specify the first mod size
-scaling-mod-size               : Manually specify the scaling mod size
-digit-size                     : Manually specify the digit size for relinearization
-num-large-digits               : Manually specify the number of large digits for HYBRID relinearization
-max-relin-sk-deg               : Manually specify the max number of relin sk deg
-insecure                       : Whether to use insecure parameter (defaults to false)
-key-switching-technique-bv     : Whether to use BV key switching technique (defaults to false)
-scaling-technique-fixed-manual : Whether to use fixed manual scaling technique (defaults to false)
-level-budget-encode            : Level budget for CKKS bootstrap encode (s2c) phase
-level-budget-decode            : Level budget for CKKS bootstrap decode (c2s) phase
</code></pre><h3 id=-openfhe-count-add-and-key-switch><code>-openfhe-count-add-and-key-switch</code></h3><p><em>Count the number of add and key-switch operations in OpenFHE</em></p><p>This pass counts the number of add and key-switch operations in the given function.</p><p>This is used for setting the EvalAddCount and EvalKeySwitchCount in OpenFHE library.
Cf. <a href=https://eprint.iacr.org/2024/203>Alexandru et al. 2024</a> for why this
is important for security.</p><p>The detailed definition of these counts could be found in the KPZ21 paper
<a href=https://ia.cr/2021/204>Revisiting Homomorphic Encryption Schemes for Finite Fields</a></p><p>The pass should be run at the secret arithmetic level when management operations
have been inserted and the IR is stable.</p><h3 id=-openfhe-fast-rotation-precompute><code>-openfhe-fast-rotation-precompute</code></h3><p><em>Identify and apply EvalFastRotation when possible.</em></p><p>This pass identifies when a ciphertext is rotated by multiple different
shifts, and replaces the <code>EvalRot</code> ops with <code>EvalFastRotationPrecompute</code>
followed by <code>EvalFastRotate</code>.</p><h3 id=-operation-balancer><code>-operation-balancer</code></h3><p><em>This pass balances addition and multiplication operations.</em></p><p>This pass examines a tree or graph of add and multiplication operations and
balances them to minimize the depth of the tree. This exposes better parallelization
and reducing the multiplication depth can decrease the parameters used in FHE,
which improves performance. This pass is not necessarily optimal, as there may
be intermediate computations that this pass does not optimally minimize the depth for.</p><p>The algorithm is to analyze a graph of addition operations and do a depth-first
search for the operands (from the last computed values in the graph). If there
are intermediate computations that are used more than once, then the pass
treats that computation as its own tree to balance instead of trying to minimize
the global depth of the tree.</p><p>This pass only runs on addition and multiplication operations on the arithmetic
dialect that are encapsulated inside a secret.generic.</p><p>This pass was inspired by section 2.6 of <a href=https://eprint.iacr.org/2021/1505>&lsquo;EVA Improved: Compiler and Extension
Library for CKKS&rsquo; by Chowdhary et al</a>.</p><h3 id=-optimize-relinearization><code>-optimize-relinearization</code></h3><p><em>Optimize placement of relinearization ops</em></p><p>This pass defers relinearization ops as late as possible in the IR.
This is more efficient in cases where multiplication operations are followed by
additions, such as in a dot product. Because relinearization also adds error,
deferring it can reduce the need for bootstrapping.</p><p>In this pass, we use an integer linear program to determine the optimal
relinearization strategy. It solves an ILP for each <code>func</code> op in the IR.</p><p>The assumptions of this pass include:</p><ul><li>All return values of functions must be linearized.</li><li>All ciphertext arguments to an op must have the same key basis</li><li>Rotation op inputs must have be linearized.</li></ul><p>For an ILP model specification, see the
<a href=https://heir.dev/docs/design/relinearization_ilp/>docs at the HEIR website</a>.
The model is an adaptation of the ILP described in
<a href=https://www.jeremykun.com/2023/11/15/mlir-a-global-optimization-and-dataflow-analysis>a blog post by Jeremy Kun</a>.</p><h4 id=options-23>Options</h4><pre tabindex=0><code>-use-loc-based-variable-names : When true, the ILP uses op source locations in variable names, which can help debug ILP model bugs.
-allow-mixed-degree-operands  : When true, allow ops to have mixed-degree ciphertexts as inputs, e.g., adding two ciphertexts with different key bases; this is supported by many FHE backends, like OpenFHE and Lattigo
</code></pre><h3 id=-polynomial-approximation><code>-polynomial-approximation</code></h3><p><em>Approximate ops by polynomials</em></p><p>This pass replaces certain operations that are incompatible
with the FHE computational model with polynomial approximations.</p><p>The pass applies to the following ops in the <code>math</code> dialect. When the
op is binary, the pass applies when one op is the result of an
<code>arith.constant</code> which is scalar-valued or a splatted tensor.</p><ul><li><code>absf</code></li><li><code>acos</code></li><li><code>acosh</code></li><li><code>asin</code></li><li><code>asinh</code></li><li><code>atan2</code></li><li><code>atan</code></li><li><code>atanh</code></li><li><code>cbrt</code></li><li><code>ceil</code></li><li><code>copysign</code></li><li><code>cos</code></li><li><code>cosh</code></li><li><code>erf</code></li><li><code>erfc</code></li><li><code>exp2</code></li><li><code>exp</code></li><li><code>expm1</code></li><li><code>floor</code></li><li><code>fpowi</code></li><li><code>log10</code></li><li><code>log1p</code></li><li><code>log2</code></li><li><code>log</code></li><li><code>powf</code></li><li><code>round</code></li><li><code>roundeven</code></li><li><code>rsqrt</code></li><li><code>sin</code></li><li><code>sinh</code></li><li><code>sqrt</code></li><li><code>tan</code></li><li><code>tanh</code></li><li><code>trunc</code></li></ul><p>As well as the following ops in the <code>math_ext</code> dialect:</p><ul><li><code>sign</code></li></ul><p>The following ops in the <code>arith</code> dialect are also supported:</p><ul><li><code>maxf</code></li><li><code>maxnumf</code></li><li><code>minf</code></li><li><code>minnumf</code></li></ul><p>These ops are replaced with <code>polynomial.eval</code> ops with a static polynomial
attribute.</p><h4 id=example-18>Example</h4><p>Command: <code>heir-opt --polynomial-approximation tests/Transforms/polynomial_approximation/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_exp</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%x</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>f32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> math<span style=color:#000;font-weight:700>.</span>exp <span style=color:#000>%x</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>degree =</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>domain_lower =</span> <span style=color:#0000cf;font-weight:700>-1.0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>domain_upper =</span> <span style=color:#0000cf;font-weight:700>1.0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#ring_f64</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#polynomial.ring</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>coefficientType =</span> <span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>!</span><span style=color:#f57900>poly =</span> <span style=color:#000;font-weight:700>!</span>polynomial<span style=color:#000;font-weight:700>.</span>polynomial<span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>ring =</span> <span style=color:#000>#ring_f64</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_exp</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>f32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> polynomial<span style=color:#000;font-weight:700>.</span>eval <span style=color:#000>#polynomial</span><span style=color:#000;font-weight:700>&lt;</span>typed_chebyshev_polynomial <span style=color:#000;font-weight:700>&lt;[</span><span style=color:#0000cf;font-weight:700>1.2660658705156256</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.1303178227397606</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0.2714863941909304</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0.044883370904043471</span><span style=color:#000;font-weight:700>]&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>poly<span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>domain_lower =</span> <span style=color:#0000cf;font-weight:700>-1.000000e+00</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>domain_upper =</span> <span style=color:#0000cf;font-weight:700>1.000000e+00</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-polynomial-to-mod-arith><code>-polynomial-to-mod-arith</code></h3><p><em>Lower <code>polynomial</code> to standard MLIR dialects.</em></p><p>This pass lowers the <code>polynomial</code> dialect to standard MLIR plus mod_arith,
including possibly ops from affine, tensor, linalg, and arith.</p><h4 id=options-24>Options</h4><pre tabindex=0><code>-build-materializations : Whether to build materializations
</code></pre><h3 id=-populate-scale-bgv><code>-populate-scale-bgv</code></h3><p><em>Populate the scale for BGV (GHS variant) ciphertext</em></p><p>In the original BGV scheme, it is required that each modulus in
the modulus chain is a prime number q such that $q \equiv 1 \pmod{t}$,
the plaintext modulus. This is to ensure that the after each modulus
switching, the plaintext message is preserved. However, this limits
the possible choices of the moduli chain.</p><p>In the GHS variant of BGV, such requirement is removed by introducing
scaling factor to the ciphertext, with the cost of scale management.
This pass is responsible for such management.</p><p>This pass relies on concrete SchemeParamAttr annotated on the module
to determine the scale for each ciphertext. Such annotation can be
generated by the <code>generate-param-bgv</code> pass.</p><h4 id=example-19>Example</h4><p>Command: <code>heir-opt tests/Transforms/populate_scale/bgv/doctest.mlir --populate-scale-bgv</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>bgv.schemeParam =</span> <span style=color:#000>#bgv.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>67239937</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8796093202433</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8796093349889</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>plaintextModulus =</span> <span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>&gt;,</span> scheme<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>modreduce <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>bgv.schemeParam =</span> <span style=color:#000>#bgv.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>67239937</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>8796093202433</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>8796093349889</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>plaintextModulus =</span> <span style=color:#0000cf;font-weight:700>65537</span><span style=color:#000;font-weight:700>&gt;,</span> scheme<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>42541</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>modreduce <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>42541</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>42541</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-populate-scale-ckks><code>-populate-scale-ckks</code></h3><p><em>Populate the scale for CKKS ciphertext</em></p><p>In CKKS, each ciphertext is associated with a scaling factor $\Delta$,
and such scaling factor will change after homomorphic operations
such as multiplication and modulus reducing.</p><p>However, certain operations such as addition require the input ciphertexts
to have the same scale. This pass is then responsible for managing the scale
of the ciphertexts.</p><p>This pass relies on concrete SchemeParamAttr annotated on the module
to determine the scale for each ciphertext. Such annotation can be
generated by the <code>generate-param-ckks</code> pass.</p><p>The scaling factor is expressed in logarithm form.</p><h4 id=example-20>Example</h4><p>Command: <code>heir-opt tests/Transforms/populate_scale/ckks/doctest.mlir --populate-scale-ckks</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>ckks.schemeParam =</span> <span style=color:#000>#ckks.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019389953</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>35184372121601</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019488257</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>logDefaultScale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;,</span> scheme<span style=color:#000;font-weight:700>.</span>ckks<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>mulf <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>90</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>modreduce <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>ckks.schemeParam =</span> <span style=color:#000>#ckks.scheme_param</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>logN =</span> <span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>Q =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019389953</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>35184372121601</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>P =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>36028797019488257</span><span style=color:#000;font-weight:700>],</span> <span style=color:#f57900>logDefaultScale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;,</span> scheme<span style=color:#000;font-weight:700>.</span>ckks<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@mul</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>mulf <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>90</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>90</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>modreduce <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>f32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>scale =</span> <span style=color:#0000cf;font-weight:700>45</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>f32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-25>Options</h4><pre tabindex=0><code>-before-mul-include-first-mul : Modulus switching before each multiplication, including the first multiplication (default to false)
</code></pre><h3 id=-propagate-annotation><code>-propagate-annotation</code></h3><p><em>Propagate annotation from operation to subsequent operations</em></p><p>This pass propagates the attribute from one operation to subsequent operations
if these operations does not have the attribute already.</p><p>Example: with <code>--propagate-annotation=attr-name=test.attr</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>test.attr =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>the above IR becomes</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>test.attr =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i16</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>test.attr =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>test.attr =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>test.attr =</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-26>Options</h4><pre tabindex=0><code>-attr-name : The attribute name to propagate with.
-reverse   : Whether to propagate in reverse
</code></pre><h3 id=-remove-unused-memref><code>-remove-unused-memref</code></h3><p><em>Cleanup any unused memrefs</em></p><p>Scan the IR for unused memrefs and remove them.</p><p>This pass looks for locally allocated memrefs that are never used and
deletes them. This pass can be used as a cleanup pass from other IR
simplifications that forward stores to loads.</p><h3 id=-rotate-and-reduce><code>-rotate-and-reduce</code></h3><p><em>Use a logarithmic number of rotations to reduce a tensor.</em></p><p>This pass identifies when a commutative, associative binary operation is used
to reduce all of the entries of a tensor to a single value, and optimizes the
operations by using a logarithmic number of reduction operations.</p><p>In particular, this pass identifies an unrolled set of operations of the form
(the binary ops may come in any order):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%6</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%7</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract <span style=color:#000>%t</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%8</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%9</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%8</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%10</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%9</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%11</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%10</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%12</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%13</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%6</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000>%14</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%13</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%7</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span></code></pre></div><p>and replaces it with a logarithmic number of <code>rotate</code> and <code>addi</code> operations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h3 id=-secret-add-debug-port><code>-secret-add-debug-port</code></h3><p><em>Add debug port to secret-arithmetic ops</em></p><p>This pass adds debug ports to secret-arithmetic ops in the IR, namely operations
wrapped by secret.generic. The debug ports are prefixed with &ldquo;__heir_debug&rdquo; and
are invoked after each operation in the generic body. The debug ports are
declarations and user should provide functions with the same name in their code.</p><p>For example, if the function is called &ldquo;foo&rdquo;, the debug port is called after
each homomorphic operation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// declaration of external debug function
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> private <span style=color:#000>@__heir_debug_tensor_8xi16_</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>8x</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@foo</span><span style=color:#000;font-weight:700>(...)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>generic <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// invoke external debug function
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    __heir_debug_tensor_8xi16_<span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>    __heir_debug_tensor_8xi16_<span style=color:#000;font-weight:700>(</span><span style=color:#000>%1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-secret-capture-generic-ambient-scope><code>-secret-capture-generic-ambient-scope</code></h3><p><em>Capture the ambient scope used in a secret.generic</em></p><p>For each value used in the body of a <code>secret.generic</code> op, which is defined
in the ambient scope outside the <code>generic</code>, add it to the argument list of
the <code>generic</code>.</p><h3 id=-secret-distribute-generic><code>-secret-distribute-generic</code></h3><p><em>Distribute <code>generic</code> ops through their bodies.</em></p><p>Converts <code>generic</code> ops whose region contains many ops into smaller
sequences of generic ops whose regions contain a single op, dropping the
<code>generic</code> part from any resulting <code>generic</code> ops that have no
<code>secret.secret</code> inputs. If the op has associated regions, and the operands
are not secret, then the generic is distributed recursively through the
op&rsquo;s regions as well.</p><p>This pass is intended to be used as part of a front-end pipeline, where a
program that operates on a secret type annotates the input to a region as
<code>secret</code>, and then wraps the contents of the region in a single large
<code>secret.generic</code>, then uses this pass to simplify it.</p><p>The <code>distribute-through</code> option allows one to specify a comma-separated
list of op names (e.g., <code>distribute-thorugh="affine.for,scf.if"</code>), which
limits the distribution to only pass through those ops. If unset, all ops
are distributed through when possible.</p><h4 id=options-27>Options</h4><pre tabindex=0><code>-distribute-through : comma-separated list of ops that should be distributed through
</code></pre><h3 id=-secret-extract-generic-body><code>-secret-extract-generic-body</code></h3><p><em>Extract the bodies of all generic ops into functions</em></p><p>This pass extracts the body of all generic ops into functions, and
replaces the generic bodies with call ops. Used as a sub-operation in
some passes, and extracted into its own pass for testing purposes.</p><p>This pass works best when <code>--secret-generic-absorb-constants</code> is run
before it so that the extracted function contains any constants used
in the generic op&rsquo;s body.</p><h3 id=-secret-forget-secrets><code>-secret-forget-secrets</code></h3><p><em>Convert secret types to standard types</em></p><p>Drop the <code>secret&lt;...></code> type from the IR, replacing it with the contained
type and the corresponding cleartext computation.</p><p><code>secret.cast</code> ops are replaced with freshly alloc&rsquo;ed memrefs that extract
individual bits of the input type or reshape them if possible.</p><h3 id=-secret-generic-absorb-constants><code>-secret-generic-absorb-constants</code></h3><p><em>Copy constants into a secret.generic body</em></p><p>For each constant value used in the body of a <code>secret.generic</code> op, which is
defined in the ambient scope outside the <code>generic</code>, add it&rsquo;s definition into
the <code>generic</code> body.</p><h3 id=-secret-generic-absorb-dealloc><code>-secret-generic-absorb-dealloc</code></h3><p><em>Copy deallocs of internal memrefs into a secret.generic body</em></p><p>For each memref allocated and used only within a body of a <code>secret.generic</code>
op, add it&rsquo;s dealloc of the memref into its <code>generic</code> body.</p><h3 id=-secret-import-execution-result><code>-secret-import-execution-result</code></h3><p><em>Annotate execution result to secret-arithmetic ops</em></p><p>When the execution result of each op is known by <code>secret-add-debug-port</code> pass,
the result could be imported back to the IR.</p><p>This pass adds a new attribute <code>secret.execution_result</code> to the secret-arithmetic ops.</p><p>This is useful when users want to compare the precision of the result between
the plaintext and the ciphertext (especially the CKKS case).</p><p>For example, if you have a <code>trace.log</code> that is generated by plaintext backend with
<code>--secret-add-debug-port</code> where the result is printed out like</p><pre tabindex=0><code>1.0 2.0 3.0 4.0 5.0 6.0 7.0 8.0
2.0 3.0 4.0 5.0 6.0 7.0 8.0 9.0
</code></pre><p>Each <em>line</em> corresponds to one SSA value in the IR. You can then import the result
back to the IR by using <code>--secret-import-execution-result=file-name=trace.log</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@foo</span><span style=color:#000;font-weight:700>(...)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  secret<span style=color:#000;font-weight:700>.</span>generic <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>secret.execution_result =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1.0</span> <span style=color:#0000cf;font-weight:700>2.0</span> <span style=color:#0000cf;font-weight:700>3.0</span> <span style=color:#0000cf;font-weight:700>4.0</span> <span style=color:#0000cf;font-weight:700>5.0</span> <span style=color:#0000cf;font-weight:700>6.0</span> <span style=color:#0000cf;font-weight:700>7.0</span> <span style=color:#0000cf;font-weight:700>8.0</span><span style=color:#000;font-weight:700>]}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000;font-weight:700>...</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>secret.execution_result =</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2.0</span> <span style=color:#0000cf;font-weight:700>3.0</span> <span style=color:#0000cf;font-weight:700>4.0</span> <span style=color:#0000cf;font-weight:700>5.0</span> <span style=color:#0000cf;font-weight:700>6.0</span> <span style=color:#0000cf;font-weight:700>7.0</span> <span style=color:#0000cf;font-weight:700>8.0</span> <span style=color:#0000cf;font-weight:700>9.0</span><span style=color:#000;font-weight:700>]}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-28>Options</h4><pre tabindex=0><code>-file-name : file name of the execution result
</code></pre><h3 id=-secret-insert-mgmt-bfv><code>-secret-insert-mgmt-bfv</code></h3><p><em>Place BFV ciphertext management operations</em></p><p>This pass inserts relinearization operation for multiplication, and
compute the multiplicative depth, or the level information.</p><p>For most cases B/FV is instantiated with no mod reduce so it is not a
leveled scheme. However, for instantiating B/FV parameters it is often
meaningful to know the multiplicative depth of the circuit.</p><h4 id=example-21>Example</h4><p>Command: <code>heir-opt --secret-insert-mgmt-bfv tests/Transforms/secret_insert_mgmt_bfv/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span>scheme<span style=color:#000;font-weight:700>.</span>bfv<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-secret-insert-mgmt-bgv><code>-secret-insert-mgmt-bgv</code></h3><p><em>Place BGV ciphertext management operations</em></p><p>This pass implements the following placement strategy:</p><p>For relinearize, after every homomorphic ciphertext-ciphertext
multiplication, a mgmt.relinearize is placed after the operation. This is
done to ensure that the ciphertext keeps <em>linear</em>.</p><p>For modulus switching, it is inserted right before a homomorphic
multiplication, including ciphertext-plaintext ones. There is an option
<code>include-first</code> controlling whether to switch modulus before the first
multiplication.</p><p>User can check the FLEXIBLEAUTOEXT and FLEXIBLEAUTO mode in OpenFHE as a
reference. To know more technical difference about them, user can refer to
the paper <a href=https://ia.cr/2021/204>&ldquo;Revisiting homomorphic encryption schemes for finite firelds&rdquo;</a>.</p><p>Then, for level-mismatching binary operations like addition and subtraction,
additional modulus switch is placed for the operand until it reaches the
same level.</p><p>This is different from crosslevel operation handling in other
implementations like using modulus switching and level drop together. The
reason we only use modulus switching is for simplicity for now. Further
optimization on this pass could implement such a strategy.</p><p>Before yield the final result, a modulus switching is placed if it is a
result of multiplication or derived value of a multiplication.</p><p>Also, it annotates the mgmt.mgmt attribute for each operation, which
includes the level and dimension information of a ciphertext. This
information is subsequently used by the secret-to-bgv pass to properly
lower to corresponding RNS Type.</p><h4 id=example-22>Example</h4><p>Command: <code>heir-opt --secret-insert-mgmt-bgv tests/Transforms/secret_insert_mgmt_bgv/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^bb0</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%arg2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg3</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module attributes <span style=color:#000;font-weight:700>{</span>scheme<span style=color:#000;font-weight:700>.</span>bgv<span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>muli <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>dimension =</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>relinearize <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>adjust_scale <span style=color:#000>%input1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>id =</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i64</span><span style=color:#000;font-weight:700>,</span> <span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>=</span> mgmt<span style=color:#000;font-weight:700>.</span>modreduce <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i16</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>mgmt.mgmt =</span> <span style=color:#000>#mgmt.mgmt</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>level =</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>&gt;})</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i16</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=options-29>Options</h4><pre tabindex=0><code>-after-mul                    : Modulus switching after each multiplication (default to false)
-before-mul-include-first-mul : Modulus switching before each multiplication, including the first multiplication (default to false)
</code></pre><h3 id=-secret-insert-mgmt-ckks><code>-secret-insert-mgmt-ckks</code></h3><p><em>Place CKKS ciphertext management operations</em></p><p>Check the description of secret-insert-mgmt-bgv. This pass
implements similar strategy, where mgmt.modreduce stands for
ckks.rescale here.</p><p>For bootstrap insertion policy, currently a greedy policy is used
where when all levels are consumed then a bootstrap is inserted.</p><p>The max level available after bootstrap is controlled by the option
<code>bootstrap-waterline</code>.</p><p>Number of bootstrap consumed level is not shown here, which is
handled by further lowering.
TODO(#1207): handle it here so parameter selection can depend on it.
TODO(#1207): with this info we can encrypt at max level (with bootstrap consumed level).</p><h4 id=options-30>Options</h4><pre tabindex=0><code>-after-mul                    : Modulus switching after each multiplication (default to false)
-before-mul-include-first-mul : Modulus switching before each multiplication, including the first multiplication (default to false)
-slot-number                  : Default number of slots use for ciphertext space.
-bootstrap-waterline          : Waterline for insert bootstrap op
</code></pre><h3 id=-secret-merge-adjacent-generics><code>-secret-merge-adjacent-generics</code></h3><p><em>Merge two adjacent generics into a single generic</em></p><p>This pass merges two immediately sequential generics into a single
generic. Useful as a sub-operation in some passes, and extracted into
its own pass for testing purposes.</p><h3 id=-secret-to-bgv><code>-secret-to-bgv</code></h3><p><em>Lower <code>secret</code> to <code>bgv</code> dialect.</em></p><p>This pass lowers an IR with <code>secret.generic</code> blocks containing arithmetic
operations to operations on ciphertexts with the BGV dialect.</p><p>The pass assumes that the <code>secret.generic</code> regions have been distributed
through arithmetic operations so that only one ciphertext operation appears
per generic block. It also requires that <code>canonicalize</code> was run so that
non-secret values used are removed from the <code>secret.generic</code>&rsquo;s block
arguments.</p><p>The pass requires that all types are tensors of a uniform shape matching the
dimension of the ciphertext space specified my <code>poly-mod-degree</code>.</p><h4 id=options-31>Options</h4><pre tabindex=0><code>-poly-mod-degree : Default degree of the cyclotomic polynomial modulus to use for ciphertext space.
</code></pre><h3 id=-secret-to-cggi><code>-secret-to-cggi</code></h3><p><em>Lower <code>secret</code> to <code>cggi</code> dialect.</em></p><p>This pass lowers the <code>secret</code> dialect to <code>cggi</code> dialect.</p><h3 id=-secret-to-ckks><code>-secret-to-ckks</code></h3><p><em>Lower <code>secret</code> to <code>ckks</code> dialect.</em></p><p>This pass lowers an IR with <code>secret.generic</code> blocks containing arithmetic
operations to operations on ciphertexts with the CKKS dialect.</p><p>The pass assumes that the <code>secret.generic</code> regions have been distributed
through arithmetic operations so that only one ciphertext operation appears
per generic block. It also requires that <code>canonicalize</code> was run so that
non-secret values used are removed from the <code>secret.generic</code>&rsquo;s block
arguments.</p><p>The pass requires that all types are tensors of a uniform shape matching the
dimension of the ciphertext space specified my <code>poly-mod-degree</code>.</p><h4 id=options-32>Options</h4><pre tabindex=0><code>-poly-mod-degree : Default degree of the cyclotomic polynomial modulus to use for ciphertext space.
</code></pre><h3 id=-secret-to-mod-arith><code>-secret-to-mod-arith</code></h3><p><em>Lower <code>secret</code> to <code>mod-arith</code> dialect.</em></p><p>This pass lowers an IR with <code>secret.generic</code> blocks containing arithmetic
operations to operations on plaintexts using the <code>mod_arith</code> dialect.
This is primarily used in the plaintext lowering pipeline, where operations
are performed directly against plaintexts.</p><p>The pass assumes that the <code>secret.generic</code> regions have been distributed
through arithmetic operations so that only one ciphertext operation appears
per generic block. It also requires that <code>canonicalize</code> was run so that
non-secret values used are removed from the <code>secret.generic</code>&rsquo;s block
arguments.</p><h4 id=options-33>Options</h4><pre tabindex=0><code>-modulus   : Modulus to use for the mod-arith dialect. If not specified, the pass will use the natural modulus for that integer type
-log-scale : Log base 2 of the scale for encoding floating points as ints.
</code></pre><h3 id=-secretize><code>-secretize</code></h3><p><em>Adds secret argument attributes to entry function</em></p><p>Helper pass that adds a secret.secret attribute argument to each function argument.
By default, the pass applies to all functions in the module.
This may be overridden with the option -function=func_name to apply to a single function only.</p><h4 id=options-34>Options</h4><pre tabindex=0><code>-function : function to add secret annotations to
</code></pre><h3 id=-select-rewrite><code>-select-rewrite</code></h3><p><em>Rewrites arith.select to a CMUX style expression</em></p><p>&ldquo;This pass rewrites arith.select %c, %t, %f to %c * %t + (1 - %c) * %f.
It supports all three variants of arith.select: scalar, shaped, and mixed types.
In the latter case, it will broadcast/splat the scalar condition value to the required shape.&rdquo;</p><h3 id=-shape-inference><code>-shape-inference</code></h3><p><em>Infer shapes for shaped types</em></p><p>This pass infers the shapes of shaped types in a function,
starting from function arguments annotated with a {shape.shape} attribute.
Shape inference is only supported for operations that implement InferTypeOpInterface.</p><p>This is primarily intended to be used in conjunction with the Python frontend,
which infers the rank, but not the length of each dimension, for tensor types.</p><h3 id=-split-preprocessing><code>-split-preprocessing</code></h3><p><em>Splits a function into a preprocessing and a main part</em></p><p>This pass splits a function into a preprocessing and a main part. The
preprocessing part is executed before the main function and its results are
passed to the main function. This is used to allow packing of
plaintexts to be done in advance of the main workload, and passed in as
arguments. Only plaintexts of <code>arith.constant</code> ops are currently extracted
for preprocessing.</p><h4 id=example-23>Example</h4><p>Command: <code>heir-opt --split-preprocessing tests/Transforms/split_preprocessing/split_preprocessing.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#vec_layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 0 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@hoist_one_assign</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%assign</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%c1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#vec_layout</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%add</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%assign</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%add</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#000>#layout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>#tensor_ext.layout</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#4e9a06>&#34;{ [i0] -&gt; [ct, slot] : (i0 - slot) mod 1024 = 0 and i0 &gt;= 0 and 0 &gt;= i0 and slot &gt;= 0 and 1023 &gt;= slot and ct = 0 }&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@hoist_one_assign__preprocessed</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>},</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.original_type =</span> <span style=color:#000>#tensor_ext.original_type</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#f57900>originalType =</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#f57900>layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>&gt;})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%input0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@hoist_one_assign</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>tensor_ext.layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> dense<span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>assign_layout <span style=color:#000>%cst</span> <span style=color:#000;font-weight:700>{</span><span style=color:#f57900>layout =</span> <span style=color:#000>#layout</span><span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> call <span style=color:#000>@hoist_one_assign__preprocessed</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;,</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>4x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-straight-line-vectorize><code>-straight-line-vectorize</code></h3><p><em>A vectorizer for straight line programs.</em></p><p>This pass ignores control flow and only vectorizes straight-line programs
within a given region.</p><h4 id=options-35>Options</h4><pre tabindex=0><code>-dialect : Use this to restrict the dialect whose ops should be vectorized.
</code></pre><h3 id=-tensor-ext-to-tensor><code>-tensor-ext-to-tensor</code></h3><p><em>Lower <code>tensor_ext</code> to <code>tensor</code> dialect.</em></p><p>This pass lowers the <code>tensor_ext</code> dialect to the <code>tensor</code> dialect.</p><p>This pass is intended to be used for testing purpose where the
secret arithmetic IR containing <code>tensor_ext</code> dialect is lowered
to the IR containing <code>tensor</code> dialect, which could be further
lowered to the LLVM dialect.</p><h4 id=example-24>Example</h4><p>Command: <code>heir-opt --tensor-ext-to-tensor tests/Dialect/TensorExt/Conversions/tensor_ext_to_tensor/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_rotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%c5</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_rotate_dynamic_multidim</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%shift</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span>_ext<span style=color:#000;font-weight:700>.</span>rotate <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%shift</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_rotate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c5_i32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c16_i32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>5x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>11x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert_slice <span style=color:#000>%extracted_slice</span> into <span style=color:#000>%0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>5x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> into <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted_slice_1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert_slice <span style=color:#000>%extracted_slice_0</span> into <span style=color:#000>%inserted_slice</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>11x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> into <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%inserted_slice_1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@test_rotate_dynamic_multidim</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;,</span> <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%c16</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>remsi <span style=color:#000>%arg1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>remsi <span style=color:#000>%1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%c16</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%3</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>subi <span style=color:#000>%c16</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>index</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x?x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%extracted_slice_0</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>extract_slice <span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> to <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x?x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%4</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>empty<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted_slice</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert_slice <span style=color:#000>%extracted_slice</span> into <span style=color:#000>%4</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x?x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> into <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%inserted_slice_1</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>.</span>insert_slice <span style=color:#000>%extracted_slice_0</span> into <span style=color:#000>%inserted_slice</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x?x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> into <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%inserted_slice_1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>tensor</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>3x4x16x</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-tensor-linalg-to-affine-loops><code>-tensor-linalg-to-affine-loops</code></h3><p><em>A port of convert-linalg-to-affine-loops for loops with tensor semantics</em></p><p>This pass primarily exists to support the conversion of <code>linalg.generic</code>
operations that implement <code>tensor_ext.assign_layout</code> ops.</p><h3 id=-unroll-and-forward><code>-unroll-and-forward</code></h3><p><em>Loop unrolls and forwards stores to loads.</em></p><p>This pass processes the first function in a given module, and, starting from
the first loop, iteratively does the following:</p><ol><li>Fully unroll the loop.</li><li>Scan for load ops. For each load op with a statically-inferrable access
index:</li><li>Backtrack to the original memref alloc</li><li>Find all store ops at the corresponding index (possibly transitively
through renames/subviews of the underlying alloc).</li><li>Find the last store that occurs and forward it to the load.</li><li>If the original memref is an input memref, then forward through any
renames to make the target load load directly from the argument memref
(instead of any subviews, say)</li><li>Apply the same logic to any remaining loads not inside any for loop.</li></ol><p>This pass requires that tensors are lowered to memref, and only supports
affine loops with affine.load/store ops.</p><p>Memrefs that result from memref.get_global ops are excluded from
forwarding, even if they are loaded with a static index, and are instead
handled by memref-global-replace, which should be run after this pass.</p><h3 id=-validate-noise><code>-validate-noise</code></h3><p><em>Validate the HE circuit against a given noise model</em></p><p>This pass validates the noise of the HE circuit against a given noise model.</p><p>The pass expects the scheme parameters to be annotated in the IR. Usually
this is done by the <code>generate-param-&lt;scheme></code> passes.</p><p>For available noise models, see <code>generate-param-&lt;scheme></code> passes.</p><p>The result should be observed using &ndash;debug-only=ValidateNoise.</p><p>Example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># with commandline --debug-only=ValidateNoise</span>
</span></span><span style=display:flex><span>Noise Bound: 29.27 Budget: 149.73 Total: 179.00 <span style=color:#204a87;font-weight:700>for</span> value: &lt;block argument&gt; of <span style=color:#204a87>type</span> <span style=color:#4e9a06>&#39;tensor&lt;8xi16&gt;&#39;</span> at index: <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>Noise Bound: 29.27 Budget: 149.73 Total: 179.00 <span style=color:#204a87;font-weight:700>for</span> value: &lt;block argument&gt; of <span style=color:#204a87>type</span> <span style=color:#4e9a06>&#39;tensor&lt;8xi16&gt;&#39;</span> at index: <span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><h4 id=options-36>Options</h4><pre tabindex=0><code>-model                : Noise model to validate against.
-annotate-noise-bound : Annotate the noise bound to the IR.
</code></pre><h3 id=-wrap-generic><code>-wrap-generic</code></h3><p><em>Wraps regions using secret args in secret.generic bodies</em></p><p>This pass converts functions (<code>func.func</code>) with <code>{secret.secret}</code> annotated
arguments to use <code>!secret.secret&lt;...></code> types and wraps the function body in
a <code>secret.generic</code> region. The output type is also converted to
<code>!secret.secret&lt;...></code>.</p><h4 id=example-25>Example</h4><p>Command: <code>heir-opt --wrap-generic tests/Transforms/wrap_generic/doctest.mlir</code></p><p>Input:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#204a87;font-weight:700>i32</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%arg0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mlir data-lang=mlir><span style=display:flex><span>module <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>@main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>=</span> secret<span style=color:#000;font-weight:700>.</span>generic<span style=color:#000;font-weight:700>(</span><span style=color:#000>%arg0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>^body</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>%input0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%c100_i32</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>constant</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>=</span> arith<span style=color:#000;font-weight:700>.</span>addi <span style=color:#000>%c100_i32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>%input0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>      secret<span style=color:#000;font-weight:700>.</span>yield <span style=color:#000>%1</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>i32</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>%0</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>!</span>secret<span style=color:#000;font-weight:700>.</span>secret<span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>i32</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=-yosys-optimizer><code>-yosys-optimizer</code></h3><p><em>Invoke Yosys to perform circuit optimization.</em></p><p>This pass invokes Yosys to convert an arithmetic circuit to an optimized
boolean circuit that uses the arith and comb dialects.</p><p>Note that booleanization changes the function signature: multi-bit integers
are transformed to a tensor of booleans, for example, an <code>i8</code> is converted
to <code>tensor&lt;8xi1></code>.</p><p>The optimizer will be applied to each <code>secret.generic</code> op containing
arithmetic ops that can be optimized.</p><p>Optional parameters:</p><ul><li><code>abc-fast</code>: Run the abc optimizer in &ldquo;fast&rdquo; mode, getting faster compile
time at the expense of a possibly larger output circuit.</li><li><code>unroll-factor</code>: Before optimizing the circuit, unroll loops by a given
factor. If unset, this pass will not unroll any loops.</li><li><code>print-stats</code>: Prints statistics about the optimized circuits.</li><li><code>mode={Boolean,LUT}</code>: Map gates to boolean gates or lookup table gates.</li><li><code>use-submodules</code>: Extract the body of a generic op into submodules.
Useful for large programs with generics that can be isolated. This should
not be used when distributing generics through loops to avoid index
arguments in the function body.</li></ul><h4 id=statistics>Statistics</h4><pre tabindex=0><code>total circuit size : The total circuit size for all optimized circuits, after optimization is done.
</code></pre></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/google/heir aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 The HEIR Authors All Rights Reserved</span>
<span class=ms-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.027d75d71824837bee74c12a7806c5fe51249c1ca7accc27553a251a75cdb3a4.js integrity="sha256-An111xgkg3vudMEqeAbF/lEknBynrMwnVTolGnXNs6Q=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>